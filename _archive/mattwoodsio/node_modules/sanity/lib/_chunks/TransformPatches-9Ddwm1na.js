'use strict';var jsxRuntime=require('react/jsx-runtime');var React=require('react');var flatten$1=require('lodash/flatten.js');var reactRx=require('react-rx');var rxjs=require('rxjs');var operators=require('rxjs/operators');var isEqual$1=require('lodash/isEqual.js');var resizeObserver$1=require('@juggle/resize-observer');var createPubSub=require('nano-pubsub');require('lodash/throttle.js');var isString$1=require('lodash/isString.js');var bifurClient=require('@sanity/bifur-client');var client=require('@sanity/client');var ui=require('@sanity/ui');var startCase=require('lodash/startCase.js');var reactIs=require('react-is');var icons=require('@sanity/icons');var uniqueId=require('lodash/uniqueId.js');var styled=require('styled-components');var TooltipDelayGroupProvider=require('./TooltipDelayGroupProvider-CXQG_E3r.js');var history$1=require('history');var i18next=require('i18next');var reactI18next=require('react-i18next');var isPlainObject=require('lodash/isPlainObject.js');var schema=require('@sanity/schema');var _internal=require('@sanity/schema/_internal');var cloneDeep=require('lodash/cloneDeep.js');var get$2=require('lodash/get.js');var types=require('@sanity/types');var legacyDateFormat=require('@sanity/util/legacyDateFormat');var memoize$1=require('lodash/memoize.js');var client$1=require('@sanity/util/client');var concurrencyLimiter=require('@sanity/util/concurrency-limiter');var uniqBy=require('lodash/uniqBy.js');var PathUtils=require('@sanity/util/paths');var deepCompare=require('react-fast-compare');var debounce=require('lodash/debounce.js');var theme=require('@sanity/ui/theme');var sortBy=require('lodash/sortBy.js');var reactVirtual=require('@tanstack/react-virtual');var throttle=require('lodash/throttle');var observableCallback=require('observable-callback');var portableTextEditor=require('@sanity/portable-text-editor');var color=require('@sanity/color');var dateFns=require('date-fns');var omit=require('lodash/omit.js');var diffMatchPatch$1=require('@sanity/diff-match-patch');var orderBy=require('lodash/orderBy.js');var assetUtils=require('@sanity/asset-utils');var imageUrlBuilder=require('@sanity/image-url');var withSelector=require('use-sync-external-store/with-selector');var escapeRegExp$1=require('lodash/escapeRegExp.js');var router=require('sanity/router');var shallowEquals=require('shallow-equals');var FocusLock=require('react-focus-lock');var useDevicePixelRatio=require('use-device-pixel-ratio');var uniq=require('lodash/uniq.js');var xor=require('lodash/xor.js');var sanityDiffPatch=require('sanity-diff-patch');var classNames=require('classnames');var groupBy=require('lodash/groupBy.js');var scrollIntoView=require('scroll-into-view-if-needed');var isFinite=require('lodash/isFinite.js');var compact=require('lodash/compact.js');var intersection=require('lodash/intersection.js');var keyBy=require('lodash/keyBy.js');var partition=require('lodash/partition.js');var toLower=require('lodash/toLower.js');var union=require('lodash/union.js');var words=require('lodash/words.js');var flow=require('lodash/flow.js');var trim=require('lodash/trim.js');var uuid=require('@sanity/uuid');var mutator=require('@sanity/mutator');var jsonReduce=require('json-reduce');var rxjsExhaustmapWithTrailing=require('rxjs-exhaustmap-with-trailing');var content=require('@sanity/util/content');var getRandomValues=require('get-random-values-esm');var capitalize=require('lodash/capitalize.js');var core=require('@dnd-kit/core');var modifiers=require('@dnd-kit/modifiers');var sortable=require('@dnd-kit/sortable');var utilities=require('@dnd-kit/utilities');var range=require('lodash/range.js');var speakingurl=require('speakingurl');var difference=require('lodash/difference.js');var react=require('@sanity/telemetry/react');var telemetry=require('@sanity/telemetry');var blockTools=require('@sanity/block-tools');var find=require('lodash/find.js');require('lodash/castArray.js');var pick=require('lodash/pick.js');var identity=require('lodash/identity.js');var values=require('lodash/values.js');var assignWith=require('lodash/assignWith.js');require('polished');var exif=require('exif-component');var groqJs=require('groq-js');var operators$1=require('rxjs-etc/operators');var mendoza=require('mendoza');var diff=require('@sanity/diff');var nanoid=require('nanoid');var sample=require('lodash/sample.js');var DataLoader=require('dataloader');var raf=require('raf');var color2k=require('color2k');require('react-dom/client');var Refractor=require('react-refractor');var bash=require('refractor/lang/bash');var javascript=require('refractor/lang/javascript');var json=require('refractor/lang/json');var jsx2=require('refractor/lang/jsx');var typescript=require('refractor/lang/typescript');var react$1=require('@portabletext/react');var logos=require('@sanity/logos');var generateHelpUrl=require('@sanity/generate-help-url');var useHotModuleReload=require('use-hot-module-reload');var arrify=require('arrify');var framerMotion=require('framer-motion');var isHotkey=require('is-hotkey');var intersection$1=require('lodash/intersection');var isEmpty$1=require('lodash/isEmpty');var server=require('react-dom/server');var isEqual$2=require('lodash/isEqual');var omit$1=require('lodash/omit');var startCase$1=require('lodash/startCase');var debug$3=require('debug');var upperFirst=require('lodash/upperFirst.js');var isValidDate$1=require('date-fns/isValid');var isObject=require('lodash/isObject.js');var findIndex$1=require('lodash/findIndex.js');var clone=require('lodash/clone.js');function _interopDefaultCompat(e){return e&&typeof e==='object'&&'default'in e?e:{default:e};}function _interopNamespaceCompat(e){if(e&&typeof e==='object'&&'default'in e)return e;var n=Object.create(null);if(e){Object.keys(e).forEach(function(k){if(k!=='default'){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:true,get:function(){return e[k];}});}});}n.default=e;return Object.freeze(n);}var flatten__default=/*#__PURE__*/_interopDefaultCompat(flatten$1);var isEqual__default=/*#__PURE__*/_interopDefaultCompat(isEqual$1);var createPubSub__default=/*#__PURE__*/_interopDefaultCompat(createPubSub);var isString__default=/*#__PURE__*/_interopDefaultCompat(isString$1);var startCase__default=/*#__PURE__*/_interopDefaultCompat(startCase);var uniqueId__default=/*#__PURE__*/_interopDefaultCompat(uniqueId);var styled__default=/*#__PURE__*/_interopDefaultCompat(styled);var isPlainObject__default=/*#__PURE__*/_interopDefaultCompat(isPlainObject);var cloneDeep__default=/*#__PURE__*/_interopDefaultCompat(cloneDeep);var get__default=/*#__PURE__*/_interopDefaultCompat(get$2);var legacyDateFormat__namespace=/*#__PURE__*/_interopNamespaceCompat(legacyDateFormat);var memoize__default=/*#__PURE__*/_interopDefaultCompat(memoize$1);var uniqBy__default=/*#__PURE__*/_interopDefaultCompat(uniqBy);var PathUtils__namespace=/*#__PURE__*/_interopNamespaceCompat(PathUtils);var deepCompare__default=/*#__PURE__*/_interopDefaultCompat(deepCompare);var debounce__default=/*#__PURE__*/_interopDefaultCompat(debounce);var sortBy__default=/*#__PURE__*/_interopDefaultCompat(sortBy);var throttle__default=/*#__PURE__*/_interopDefaultCompat(throttle);var omit__default=/*#__PURE__*/_interopDefaultCompat(omit);var orderBy__default=/*#__PURE__*/_interopDefaultCompat(orderBy);var imageUrlBuilder__default=/*#__PURE__*/_interopDefaultCompat(imageUrlBuilder);var escapeRegExp__default=/*#__PURE__*/_interopDefaultCompat(escapeRegExp$1);var shallowEquals__default=/*#__PURE__*/_interopDefaultCompat(shallowEquals);var FocusLock__default=/*#__PURE__*/_interopDefaultCompat(FocusLock);var uniq__default=/*#__PURE__*/_interopDefaultCompat(uniq);var xor__default=/*#__PURE__*/_interopDefaultCompat(xor);var classNames__default=/*#__PURE__*/_interopDefaultCompat(classNames);var groupBy__default=/*#__PURE__*/_interopDefaultCompat(groupBy);var scrollIntoView__default=/*#__PURE__*/_interopDefaultCompat(scrollIntoView);var isFinite__default=/*#__PURE__*/_interopDefaultCompat(isFinite);var compact__default=/*#__PURE__*/_interopDefaultCompat(compact);var intersection__default=/*#__PURE__*/_interopDefaultCompat(intersection);var keyBy__default=/*#__PURE__*/_interopDefaultCompat(keyBy);var partition__default=/*#__PURE__*/_interopDefaultCompat(partition);var toLower__default=/*#__PURE__*/_interopDefaultCompat(toLower);var union__default=/*#__PURE__*/_interopDefaultCompat(union);var words__default=/*#__PURE__*/_interopDefaultCompat(words);var flow__default=/*#__PURE__*/_interopDefaultCompat(flow);var trim__default=/*#__PURE__*/_interopDefaultCompat(trim);var getRandomValues__default=/*#__PURE__*/_interopDefaultCompat(getRandomValues);var capitalize__default=/*#__PURE__*/_interopDefaultCompat(capitalize);var range__default=/*#__PURE__*/_interopDefaultCompat(range);var speakingurl__default=/*#__PURE__*/_interopDefaultCompat(speakingurl);var difference__default=/*#__PURE__*/_interopDefaultCompat(difference);var find__default=/*#__PURE__*/_interopDefaultCompat(find);var pick__default=/*#__PURE__*/_interopDefaultCompat(pick);var identity__default=/*#__PURE__*/_interopDefaultCompat(identity);var values__default=/*#__PURE__*/_interopDefaultCompat(values);var assignWith__default=/*#__PURE__*/_interopDefaultCompat(assignWith);var exif__default=/*#__PURE__*/_interopDefaultCompat(exif);var sample__default=/*#__PURE__*/_interopDefaultCompat(sample);var DataLoader__default=/*#__PURE__*/_interopDefaultCompat(DataLoader);var raf__default=/*#__PURE__*/_interopDefaultCompat(raf);var Refractor__default=/*#__PURE__*/_interopDefaultCompat(Refractor);var bash__default=/*#__PURE__*/_interopDefaultCompat(bash);var javascript__default=/*#__PURE__*/_interopDefaultCompat(javascript);var json__default=/*#__PURE__*/_interopDefaultCompat(json);var jsx2__default=/*#__PURE__*/_interopDefaultCompat(jsx2);var typescript__default=/*#__PURE__*/_interopDefaultCompat(typescript);var arrify__default=/*#__PURE__*/_interopDefaultCompat(arrify);var isHotkey__default=/*#__PURE__*/_interopDefaultCompat(isHotkey);var intersection__default$1=/*#__PURE__*/_interopDefaultCompat(intersection$1);var isEmpty__default=/*#__PURE__*/_interopDefaultCompat(isEmpty$1);var isEqual__default$1=/*#__PURE__*/_interopDefaultCompat(isEqual$2);var omit__default$1=/*#__PURE__*/_interopDefaultCompat(omit$1);var startCase__default$1=/*#__PURE__*/_interopDefaultCompat(startCase$1);var debug__default=/*#__PURE__*/_interopDefaultCompat(debug$3);var upperFirst__default=/*#__PURE__*/_interopDefaultCompat(upperFirst);var isValidDate__default=/*#__PURE__*/_interopDefaultCompat(isValidDate$1);var isObject__default=/*#__PURE__*/_interopDefaultCompat(isObject);var findIndex__default=/*#__PURE__*/_interopDefaultCompat(findIndex$1);var clone__default=/*#__PURE__*/_interopDefaultCompat(clone);const ConnectorContext=React.createContext({isReviewChangesOpen:false,onOpenReviewChanges:()=>void 0,onSetFocus:()=>void 0});function createStore(){const reportedValues=/* @__PURE__ */new Map();const{publish,subscribe}=createPubSub__default.default();const debouncedPublish=debounce__default.default(publish,10,{trailing:true});const read=()=>Array.from(reportedValues.entries());function add(id,value){if(reportedValues.has(id));reportedValues.set(id,value);debouncedPublish(read());}function update(id,value){if(!reportedValues.has(id));reportedValues.set(id,value);debouncedPublish(read());}function remove(id){if(!reportedValues.has(id));reportedValues.delete(id);debouncedPublish(read());}return{add,remove,update,read,subscribe};}function isFunc(value){return typeof value==="function";}function read(value){return isFunc(value)?value():value;}const noop$4=()=>void 0;function createUseReporter(Context){return function useReporter(id,value){let isEqual=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Object.is;const{add,update,remove}=React.useContext(Context);const previous=React.useRef();React.useLayoutEffect(()=>{if(id===null){return noop$4;}const current=read(value);add(id,current);previous.current=current;return()=>{remove(id);};},[add,id,remove,value]);React.useLayoutEffect(()=>{const current=read(value);if(typeof previous.current!=="undefined"&&!isEqual(previous.current,current)&&id!==null){update(id,current);}previous.current=current;});};}let didWarn=false;const useReporterGuard=id2=>{if(!didWarn){console.warn(new Error('No context provided for reporter. Make sure that the component calling "useReporter('.concat(id2,', ...)", is wrapped in a <Tracker> element')));}didWarn=true;};function useReportedValueGuard(){if(!didWarn){console.warn(new Error('No context provided for reporter. Make sure that the component calling "useReportedValues()", is wrapped inside a <Tracker> element'));}didWarn=true;return[];}const useSubscribeGuard=()=>{if(!didWarn){console.warn(new Error('No context provided for reporter. Make sure that the component calling "useReportedValues()", is wrapped inside a <Tracker> element'));}didWarn=true;return()=>{};};const DEFAULT_CONTEXT={add:useReporterGuard,update:useReporterGuard,remove:useReporterGuard,subscribe:useSubscribeGuard,read:useReportedValueGuard};let id$1=0;const getNextId=()=>++id$1;function createTrackerScope(){const Context=React.createContext(DEFAULT_CONTEXT);function useReportedValues(){const context=React.useContext(Context);const[values,setValues]=React.useState(context.read());React.useLayoutEffect(()=>{setValues(context.read());return context.subscribe(setValues);},[context]);return values;}function Tracker(props){const store=React.useMemo(()=>createStore(),[]);return/* @__PURE__ */jsxRuntime.jsx(Context.Provider,{value:store,children:props.children});}const useReporter=createUseReporter(Context);return{Tracker,useReportedValues,useReporter,useAutoIdReporter:function(value){let isEqual=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Object.is;return useReporter("element-".concat(React.useRef(getNextId()).current),value,isEqual);}};}const CORNER_RADIUS=4;const INTERACTIVE_STROKE_WIDTH=16;const CONNECTOR_MARGIN=8;const ARROW_MARGIN_X=8;const ARROW_MARGIN_Y=2;const ARROW_SIZE=4;const ARROW_THRESHOLD=12;const STROKE_WIDTH$2=1;const DEBUG$1=false;const DEBUG_LAYER_BOUNDS=false;const trackerScope=createTrackerScope();const Tracker$1=trackerScope.Tracker;const useReportedValues$1=trackerScope.useReportedValues;const useReporter$1=trackerScope.useReporter;function useUnique(value){const valueRef=React.useRef(value);if(!isEqual__default.default(valueRef.current,value)){valueRef.current=value;}return valueRef.current;}function createHookFromObservableFactory(observableFactory,initialValue){const initialLoadingTuple=[initialValue,true];const initialResult={type:"tuple",tuple:initialLoadingTuple};return function useLoadableFromCreateLoadable(_arg){const memoArg=useUnique(_arg);const result=reactRx.useMemoObservable(()=>rxjs.of(memoArg).pipe(operators.switchMap(arg=>rxjs.concat(rxjs.of({type:"loading"}),observableFactory(arg).pipe(operators.map(value=>({type:"value",value}))))),operators.scan((_ref2,next)=>{let[prevValue]=_ref2;if(next.type==="loading")return[prevValue,true];return[next.value,false];},initialLoadingTuple),operators.distinctUntilChanged((_ref3,_ref4)=>{let[prevValue,prevIsLoading]=_ref3;let[nextValue,nextIsLoading]=_ref4;if(prevValue!==nextValue)return false;if(prevIsLoading!==nextIsLoading)return false;return true;}),operators.map(tuple=>({type:"tuple",tuple})),operators.catchError(error=>rxjs.of({type:"error",error}))),[memoArg],initialResult);if(result.type==="error")throw result.error;return result.tuple;};}function isNonNullable$2(value){return value!==null&&value!==void 0;}const DRAFTS_FOLDER="drafts";const DRAFTS_PREFIX="".concat(DRAFTS_FOLDER,".");function documentIdEquals(documentId,equalsDocumentId){return getPublishedId(documentId)===getPublishedId(equalsDocumentId);}function isDraft(document){return isDraftId(document._id);}function isDraftId(id){return id.startsWith(DRAFTS_PREFIX);}function getIdPair(id){return{draftId:getDraftId(id),publishedId:getPublishedId(id)};}function isPublishedId(id){return!isDraftId(id);}function getDraftId(id){return isDraftId(id)?id:DRAFTS_PREFIX+id;}function getPublishedId(id){return isDraftId(id)?id.slice(DRAFTS_PREFIX.length):id;}function createDraftFrom(document){return{...document,_id:getDraftId(document._id)};}function newDraftFrom(document){return{...document,_id:DRAFTS_PREFIX};}function createPublishedFrom(document){return{...document,_id:getPublishedId(document._id)};}function collate(documents){const byId=documents.reduce((res,doc)=>{const publishedId=getPublishedId(doc._id);let entry=res.get(publishedId);if(!entry){entry={id:publishedId,type:doc._type,published:void 0,draft:void 0};res.set(publishedId,entry);}entry[publishedId===doc._id?"published":"draft"]=doc;return res;},/* @__PURE__ */new Map());return Array.from(byId.values());}function removeDupes(documents){return collate(documents).map(entry=>entry.draft||entry.published).filter(isNonNullable$2);}const EMPTY_OBJECT=Object.freeze({});const EMPTY_ARRAY$9=Object.freeze([]);function getGlobalScope(){if(typeof globalThis!=="undefined")return globalThis;if(typeof window!=="undefined")return window;if(typeof self!=="undefined")return self;if(typeof global!=="undefined")return global;throw new Error("@sanity/ui: could not locate global scope");}const globalScope=getGlobalScope();function isRecord$4(value){return Boolean(value)&&typeof value==="object"&&!Array.isArray(value);}function isString(value){return typeof value==="string";}const ResizeObserver=typeof document==="object"&&typeof window==="object"&&window.ResizeObserver?window.ResizeObserver:resizeObserver$1.ResizeObserver;const createSharedResizeObserver=()=>{const event=createPubSub__default.default();const resizeObserver2=new ResizeObserver(entries=>event.publish(entries));return{observe:(element,observer,options)=>{const unsubscribe=event.subscribe(entries=>{const entry=entries.find(e=>e.target===element);if(entry){observer(entry);}});resizeObserver2.observe(element,options);return()=>{unsubscribe();resizeObserver2.unobserve(element);};},unobserve:element=>resizeObserver2.unobserve(element)};};const resizeObserver=createSharedResizeObserver();const GROQ_KEYWORDS=["match","in","asc","desc","true","false","null"];const VALID_FIELD=/^[a-zA-Z_][a-zA-Z0-9_]*$/;const fieldNeedsEscape=fieldName=>!VALID_FIELD.test(fieldName)||GROQ_KEYWORDS.includes(fieldName);const escapeField=fieldName=>'["'.concat(fieldName,'"]');const escapeFirst=fieldName=>"@".concat(escapeField(fieldName));const isEmptyArray=value=>Array.isArray(value)&&value.length===0;const joinPath=pathArray=>{let path="";for(let i=0;i<pathArray.length;i++){const pathSegment=pathArray[i];if(isEmptyArray(pathSegment)){path+="[]";continue;}if(typeof pathSegment==="number"){path+="[".concat(pathSegment,"]");continue;}const isFirst=i===0;const needsEscape=fieldNeedsEscape(pathSegment);if(needsEscape){path=isFirst?escapeFirst(pathSegment):"".concat(path).concat(escapeField(pathSegment));}else{path=isFirst?pathSegment:"".concat(path,".").concat(pathSegment);}}return path;};const supportsTouch=isTouchDevice$1();function isTouchDevice$1(){if(typeof window==="undefined")return false;return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;}const segmenter=typeof Intl==="object"&&"Segmenter"in Intl?new Intl.Segmenter():void 0;function sliceString(str,start,end){if(end<start){throw new Error("End must be greater than start, use `String.prototype.slice()` for negative values");}if(!segmenter){return str.slice(start,end);}let i=0;let sliced="";for(const value of segmenter.segment(str)){if(i===end){return sliced;}sliced+=value.segment;i++;}return sliced;}function truncateString(str,maxLength){const truncated=sliceString(str,0,maxLength);return truncated===str?truncated:"".concat(truncated,"\u2026");}const LOADING_STATE={isLoading:true,value:void 0,error:null};function useLoadable(value$,initialValue){const initial=typeof initialValue==="undefined"?LOADING_STATE:{isLoading:false,value:initialValue,error:null};return reactRx.useMemoObservable(()=>value$.pipe(asLoadable()),[value$],initial);}function asLoadable(){return value$=>value$.pipe(operators.map(value=>({isLoading:false,value,error:null})),operators.catchError(error=>rxjs.of({isLoading:false,value:void 0,error})));}function userHasRole(user,roleId){return user!==null&&user.roles.some(role=>role.name===roleId);}var _a$2z;const DEBUG_MODE$2=typeof process==="undefined"?false:(_a$2z=process==null?void 0:process.env)==null?void 0:_a$2z.SANITY_STUDIO_DEBUG_I18N;const DEBUG_I18N=Boolean(DEBUG_MODE$2);const debugWrappers={reverse:str=>"\u202E".concat(str),triangles:str=>"\u25E4 ".concat(str," \u25E2")};function maybeWrapT(t){const wrapper=DEBUG_MODE$2==="reverse"||DEBUG_MODE$2==="triangles"?debugWrappers[DEBUG_MODE$2]:null;return wrapper?function(){return wrapper(t(...arguments));}:t;}const translationOptionOverrides={// We're manually forcing a re-render with the locale key in the LocaleProvider,
// so we don't need to bind to the i18n instance for language change events.
bindI18n:false};function useTranslation(ns,options){const{t}=reactI18next.useTranslation(ns,options?{keyPrefix:options.keyPrefix,lng:options.lng,...translationOptionOverrides}:translationOptionOverrides);return{t:maybeWrapT(t)};}var __freeze$2x=Object.freeze;var __defProp$2x=Object.defineProperty;var __template$2x=(cooked,raw)=>__freeze$2x(__defProp$2x(cooked,"raw",{value:__freeze$2x(raw||cooked.slice())}));var _a$2y,_b$17,_c$B,_d$o,_e$d,_f$a,_g$7,_h$4,_i$2,_j$1;const animationSpeed=250;const ChangeBarWrapper$1=styled__default.default.div(_ref5=>{let{$changed,$disabled,$hasFocus,$isReviewChangeOpen}=_ref5;if($disabled)return styled.css(_a$2y||(_a$2y=__template$2x(["\n        ",":after {\n          display: none;\n        }\n      "])),ChangeBarMarker);return styled.css(_e$d||(_e$d=__template$2x(["\n      --change-bar-offset: 4px;\n\n      display: flex;\n      position: relative;\n\n      ",":after {\n        opacity: 0.5;\n      }\n\n      @media (hover: hover) {\n        &:hover {\n          z-index: 10;\n          ",":after {\n            opacity: 1;\n          }\n        }\n      }\n\n      /* hide when field is not changed */\n      ","\n\n      /* hide when field is not changed */\n      ","\n\n      /* hide hover effect when review changes is open */\n      ","\n    "])),ChangeBarMarker,ChangeBarMarker,$hasFocus&&styled.css(_b$17||(_b$17=__template$2x(["\n        ",":after {\n          opacity: 1;\n        }\n      "])),ChangeBarMarker),!$changed&&styled.css(_c$B||(_c$B=__template$2x(["\n        ",":after {\n          opacity: 0;\n          pointer-events: none;\n        }\n      "])),ChangeBarMarker),$isReviewChangeOpen&&styled.css(_d$o||(_d$o=__template$2x(["\n        "," {\n          opacity: 0;\n        }\n      "])),ChangeBarButton));});const FieldWrapper=styled__default.default.div(_f$a||(_f$a=__template$2x(["\n  flex-grow: 1;\n  min-width: 0;\n"])));const ChangeBar=styled__default.default.div(_g$7||(_g$7=__template$2x(["\n  position: relative;\n  opacity: 1;\n  transition: opacity 100ms;\n  z-index: ",";\n"])),_ref6=>{let{$zIndex}=_ref6;return $zIndex;});const ChangeBarMarker=styled__default.default.div(props=>{const{media}=theme.getTheme_v2(props.theme);return styled.css(_h$4||(_h$4=__template$2x(["\n    position: absolute;\n    top: -1px;\n    left: var(--change-bar-offset);\n    width: 1px;\n    bottom: -1px;\n    background-color: var(--card-bg-color);\n\n    @media (min-width: ","px) {\n      display: unset;\n    }\n\n    &:after {\n      content: '';\n      display: block;\n      position: absolute;\n      top: 1px;\n      left: 0;\n      width: 1px;\n      bottom: 1px;\n      background-color: var(--card-badge-caution-dot-color);\n      border-radius: 0.5px;\n    }\n  "])),media[0]);});const ChangeBarButton=styled__default.default.button(props=>{const{$withHoverEffect}=props;return styled.css(_j$1||(_j$1=__template$2x(["\n    appearance: none;\n    border: 0;\n    outline: 0;\n    display: block;\n    padding: 0;\n    background: transparent;\n    opacity: 0;\n    position: absolute;\n    height: 100%;\n    cursor: pointer;\n    pointer-events: all;\n    left: calc(-0.25rem + var(--change-bar-offset));\n    width: calc(1rem - 1px);\n    transition: opacity ","ms;\n\n    &:focus {\n      border: 0;\n      outline: 0;\n    }\n\n    &:focus {\n      border: 0;\n      outline: 0;\n    }\n\n    ","\n  "])),animationSpeed,$withHoverEffect&&styled.css(_i$2||(_i$2=__template$2x(["\n      @media (hover: hover) {\n        &:hover {\n          opacity: 0.2;\n        }\n      }\n    "]))));});function ElementWithChangeBar(props){const{children,disabled,hasFocus,isChanged,withHoverEffect=true}=props;const{onOpenReviewChanges,isReviewChangesOpen}=React.useContext(ConnectorContext);const{zIndex}=ui.useLayer();const{t}=useTranslation();const changeBar=React.useMemo(()=>disabled||!isChanged?null:/* @__PURE__ */jsxRuntime.jsxs(ChangeBar,{"data-testid":"change-bar",$zIndex:zIndex,children:[/* @__PURE__ */jsxRuntime.jsx(ChangeBarMarker,{"data-testid":"change-bar__marker"}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:t("changes.change-bar.aria-label"),portal:true,children:/* @__PURE__ */jsxRuntime.jsx(ChangeBarButton,{"aria-label":t("changes.change-bar.aria-label"),"data-testid":"change-bar__button",onClick:isReviewChangesOpen?void 0:onOpenReviewChanges,tabIndex:-1,type:"button",$withHoverEffect:withHoverEffect})})]}),[disabled,isChanged,isReviewChangesOpen,onOpenReviewChanges,t,withHoverEffect,zIndex]);return/* @__PURE__ */jsxRuntime.jsxs(ChangeBarWrapper$1,{"data-testid":"change-bar-wrapper",$changed:isChanged,$disabled:disabled,$hasFocus:hasFocus,$isReviewChangeOpen:isReviewChangesOpen,children:[/* @__PURE__ */jsxRuntime.jsx(FieldWrapper,{"data-testid":"change-bar__field-wrapper",children}),changeBar]});}const ChangeBarWrapper=React.memo(function ChangeBarWrapper2(props){const{children,disabled,hasFocus,isChanged,onMouseEnter:onMouseEnterProp,onMouseLeave:onMouseLeaveProp,path=EMPTY_ARRAY$9,withHoverEffect,...restProps}=props;const layer=ui.useLayer();const[hasHover,setHover]=React.useState(false);const onMouseEnter=React.useCallback(event=>{onMouseEnterProp==null?void 0:onMouseEnterProp(event);setHover(true);},[onMouseEnterProp]);const onMouseLeave=React.useCallback(event=>{onMouseLeaveProp==null?void 0:onMouseLeaveProp(event);setHover(false);},[onMouseLeaveProp]);const ref=React.useRef(null);useReporter$1(disabled?null:"field-".concat(PathUtils__namespace.toString(path)),()=>({element:ref.current,path,isChanged,hasFocus,hasHover,zIndex:layer.zIndex}),deepCompare__default.default// note: deepCompare should be ok here since we're not comparing deep values
);return/* @__PURE__ */jsxRuntime.jsx("div",{...restProps,ref,onMouseEnter,onMouseLeave,children:/* @__PURE__ */jsxRuntime.jsx(ElementWithChangeBar,{hasFocus,isChanged,disabled,withHoverEffect,children})});});function ChangeIndicator(props){const{children,hasFocus,isChanged,path,withHoverEffect,...restProps}=props;return/* @__PURE__ */jsxRuntime.jsx(ChangeBarWrapper,{...restProps,path,hasFocus,isChanged,withHoverEffect,children});}const ChangeIndicatorContext=React.createContext({path:[],fullPath:[],focusPath:[],isChanged:false});const ScrollContext=React.createContext(null);const noop$3=()=>void 0;const ScrollContainer=React.forwardRef(function ScrollContainer2(props,ref){const{as="div",onScroll,...rest}=props;const forwardedRef=ui.useForwardedRef(ref);const parentContext=React.useContext(ScrollContext);const childContext=React.useMemo(()=>createPubSub__default.default(),[]);React.useEffect(()=>{if(onScroll){return childContext.subscribe(onScroll);}return noop$3;},[childContext,onScroll]);React.useEffect(()=>{if(parentContext){return childContext.subscribe(parentContext.publish);}return noop$3;},[parentContext,childContext]);React.useEffect(()=>{const handleScroll=event=>{childContext.publish(event);};const el=forwardedRef.current;if(!el){return void 0;}el.addEventListener("scroll",handleScroll,{passive:true,capture:true});return()=>{el.removeEventListener("scroll",handleScroll);};},[childContext,forwardedRef]);return/* @__PURE__ */jsxRuntime.jsx(ScrollContext.Provider,{value:childContext,children:React.createElement(as,{ref:forwardedRef,"data-testid":"scroll-container",...rest})});});function ClampedRect(props){const{bounds,...rest}=props;const x=Math.max(bounds.left,props.left);const y=Math.max(props.top,bounds.top);const height=Math.max(0,props.height-(y-props.top));const width=Math.max(0,props.width-(x-props.left));return/* @__PURE__ */jsxRuntime.jsx("rect",{...rest,x,y,height,width});}var __freeze$2w=Object.freeze;var __defProp$2w=Object.defineProperty;var __template$2w=(cooked,raw)=>__freeze$2w(__defProp$2w(cooked,"raw",{value:__freeze$2w(raw||cooked.slice())}));var _a$2x,_b$16,_c$A,_d$n;styled__default.default.rect(_a$2x||(_a$2x=__template$2w(["\n  stroke: #ccc;\n  fill: none;\n  pointer-events: none;\n  stroke-linecap: round;\n"])));const ConnectorPath=styled__default.default.path(_b$16||(_b$16=__template$2w(["\n  fill: none;\n  pointer-events: none;\n  stroke-linejoin: round;\n  stroke: var(--card-badge-caution-dot-color);\n"])));const InteractivePath=styled__default.default.path(_c$A||(_c$A=__template$2w(["\n  fill: none;\n  pointer-events: stroke;\n  stroke: transparent;\n  cursor: pointer;\n  stroke-linecap: round;\n  stroke-linejoin: round;\n  opacity: 0;\n\n  &:hover {\n    opacity: 0.2;\n  }\n"])));const RightBarWrapper=styled__default.default(ClampedRect)(_d$n||(_d$n=__template$2w(["\n  stroke: none;\n  pointer-events: none;\n  fill: var(--card-badge-caution-dot-color);\n"])));function arrowPath(x,y,dir){return["M ".concat(x-ARROW_SIZE," ").concat(y-ARROW_SIZE*dir," "),"L ".concat(x," ").concat(y),"L ".concat(x+ARROW_SIZE," ").concat(y-ARROW_SIZE*dir)].join("");}function moveTo(x,y){return"M".concat(x," ").concat(y);}function lineTo(x,y){return"L".concat(x," ").concat(y);}function join(strings){let delim=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";return strings.join(delim);}function quadCurve(x1,y1,x,y){return"Q".concat(x1," ").concat(y1," ").concat(x," ").concat(y);}function generateConnectorPath(line){const{from,to}=line;const{left:fromX,top:fromY}=from;const{left:toX,top:toY}=to;const cmds=[];const r1=Math.min(CORNER_RADIUS,Math.abs(fromY-toY)/2);if(from.isAbove){cmds.push(moveTo(fromX+ARROW_MARGIN_X,fromY-ARROW_THRESHOLD+ARROW_MARGIN_Y),lineTo(fromX+ARROW_MARGIN_X,fromY-CORNER_RADIUS),quadCurve(fromX+ARROW_MARGIN_X,fromY,fromX+ARROW_MARGIN_X+CORNER_RADIUS,fromY));}else if(from.isBelow){cmds.push(moveTo(fromX+ARROW_MARGIN_X,fromY+ARROW_THRESHOLD-ARROW_MARGIN_Y),lineTo(fromX+ARROW_MARGIN_X,fromY+CORNER_RADIUS),quadCurve(fromX+ARROW_MARGIN_X,fromY,fromX+ARROW_MARGIN_X+CORNER_RADIUS,fromY));}else{cmds.push(moveTo(fromX,fromY));}if(to.isAbove){if(fromY<to.bounds.top){cmds.push(lineTo(to.bounds.left-8-r1,fromY),quadCurve(to.bounds.left-8,fromY,to.bounds.left-8,fromY+r1),lineTo(to.bounds.left-8,toY-r1),quadCurve(to.bounds.left-8,toY,to.bounds.left-8+r1,toY),lineTo(to.bounds.left+ARROW_MARGIN_X-CORNER_RADIUS,toY),quadCurve(to.bounds.left+ARROW_MARGIN_X,toY,to.bounds.left+ARROW_MARGIN_X,toY-CORNER_RADIUS),lineTo(to.bounds.left+ARROW_MARGIN_X,toY-ARROW_THRESHOLD+ARROW_MARGIN_Y));}else{cmds.push(lineTo(to.bounds.left+ARROW_MARGIN_X-CORNER_RADIUS,fromY),quadCurve(to.bounds.left+ARROW_MARGIN_X,fromY,to.bounds.left+ARROW_MARGIN_X,fromY-CORNER_RADIUS),lineTo(to.bounds.left+ARROW_MARGIN_X,toY-ARROW_THRESHOLD+ARROW_MARGIN_Y));}}else if(to.isBelow){if(fromY>to.bounds.top+to.bounds.height){cmds.push(lineTo(to.bounds.left-ARROW_MARGIN_X-r1,fromY),quadCurve(to.bounds.left-ARROW_MARGIN_X,fromY,to.bounds.left-ARROW_MARGIN_X,fromY-r1),lineTo(to.bounds.left-ARROW_MARGIN_X,toY+r1),quadCurve(to.bounds.left-ARROW_MARGIN_X,toY,to.bounds.left-ARROW_MARGIN_X+r1,toY),lineTo(to.bounds.left+ARROW_MARGIN_X-CORNER_RADIUS,toY),quadCurve(to.bounds.left+ARROW_MARGIN_X,toY,to.bounds.left+ARROW_MARGIN_X,toY+CORNER_RADIUS),lineTo(to.bounds.left+ARROW_MARGIN_X,toY+ARROW_THRESHOLD-ARROW_MARGIN_Y));}else{cmds.push(lineTo(to.bounds.left+ARROW_MARGIN_X-CORNER_RADIUS,fromY),quadCurve(to.bounds.left+ARROW_MARGIN_X,fromY,to.bounds.left+ARROW_MARGIN_X,fromY+CORNER_RADIUS),lineTo(to.bounds.left+ARROW_MARGIN_X,toY+ARROW_THRESHOLD-ARROW_MARGIN_Y));}}else if(fromY<toY){cmds.push(lineTo(to.bounds.left+ARROW_MARGIN_X-r1,fromY),quadCurve(to.bounds.left+ARROW_MARGIN_X,fromY,to.bounds.left+ARROW_MARGIN_X,fromY+r1),lineTo(to.bounds.left+ARROW_MARGIN_X,toY-r1),quadCurve(to.bounds.left+ARROW_MARGIN_X,toY,to.bounds.left+ARROW_MARGIN_X+r1,toY),lineTo(toX,toY));}else{cmds.push(lineTo(to.bounds.left+ARROW_MARGIN_X-r1,fromY),quadCurve(to.bounds.left+ARROW_MARGIN_X,fromY,to.bounds.left+ARROW_MARGIN_X,fromY-r1),lineTo(to.bounds.left+ARROW_MARGIN_X,toY+r1),quadCurve(to.bounds.left+ARROW_MARGIN_X,toY,to.bounds.left+ARROW_MARGIN_X+r1,toY),lineTo(toX,toY));}return join(cmds);}function getConnectorLinePoint(rect,bounds){const centerY=rect.top+rect.height/2;const isAbove=rect.top+rect.height<bounds.top+ARROW_MARGIN_Y;const isBelow=rect.top>bounds.top+bounds.height-ARROW_MARGIN_Y;return{bounds,left:rect.left,top:centerY,centerY,startY:rect.top+CONNECTOR_MARGIN,endY:rect.top+rect.height-CONNECTOR_MARGIN,isAbove,isBelow,outOfBounds:isAbove||isBelow};}function mapConnectorToLine(connector){const fromBounds={top:connector.from.bounds.top+ARROW_THRESHOLD,bottom:connector.from.bounds.top+connector.from.bounds.height-ARROW_THRESHOLD,left:connector.from.bounds.left,right:connector.from.bounds.left+connector.from.bounds.width,width:connector.from.bounds.width,height:connector.from.bounds.height-ARROW_THRESHOLD*2};const from=getConnectorLinePoint(connector.from.rect,fromBounds);from.left=connector.from.rect.left+connector.from.rect.width+1;const toBounds={top:connector.to.bounds.top+ARROW_THRESHOLD,bottom:connector.to.bounds.top+connector.to.bounds.height-ARROW_THRESHOLD,left:connector.to.bounds.left,right:connector.to.bounds.left+connector.to.bounds.width,width:connector.to.bounds.width,height:connector.to.bounds.height-ARROW_THRESHOLD*2};const to=getConnectorLinePoint(connector.to.rect,toBounds);const maxStartY=Math.max(to.startY,from.startY);from.top=Math.min(maxStartY,from.endY);if(from.top<toBounds.top){from.top=Math.min(toBounds.top,from.endY);}else if(from.top>toBounds.bottom){from.top=Math.max(toBounds.bottom,from.startY);}to.top=Math.min(maxStartY,to.endY);if(to.top<fromBounds.top){to.top=Math.min(fromBounds.top,to.endY);}else if(to.top>fromBounds.bottom){to.top=Math.max(fromBounds.bottom,to.startY);}from.top=Math.min(Math.max(from.top,fromBounds.top),fromBounds.bottom);to.top=Math.min(Math.max(to.top,toBounds.top),toBounds.bottom);return{from,to};}const Connector=React.memo(function Connector2(_ref7){let{from,to}=_ref7;const line=mapConnectorToLine({from,to});if(line.from.outOfBounds&&line.to.outOfBounds){return null;}const linePathDescription=generateConnectorPath(line);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(InteractivePath,{d:linePathDescription,strokeWidth:INTERACTIVE_STROKE_WIDTH}),/* @__PURE__ */jsxRuntime.jsx(ConnectorPath,{d:linePathDescription,strokeWidth:STROKE_WIDTH$2}),/* @__PURE__ */jsxRuntime.jsx(RightBarWrapper,{top:to.rect.top,left:to.rect.left-0.5,height:to.rect.height,width:STROKE_WIDTH$2,bounds:to.bounds}),line.from.isAbove&&/* @__PURE__ */jsxRuntime.jsx(ConnectorPath,{d:arrowPath(line.from.left+ARROW_MARGIN_X,line.from.bounds.top-ARROW_THRESHOLD+ARROW_MARGIN_Y,-1),strokeWidth:STROKE_WIDTH$2}),line.from.isBelow&&/* @__PURE__ */jsxRuntime.jsx(ConnectorPath,{d:arrowPath(line.from.left+ARROW_MARGIN_X,line.from.bounds.top+line.from.bounds.height+ARROW_THRESHOLD-ARROW_MARGIN_Y,1),strokeWidth:STROKE_WIDTH$2}),line.to.isAbove&&/* @__PURE__ */jsxRuntime.jsx(ConnectorPath,{d:arrowPath(line.to.bounds.left+ARROW_MARGIN_X,line.to.bounds.top-ARROW_THRESHOLD+ARROW_MARGIN_Y,-1),strokeWidth:STROKE_WIDTH$2}),line.to.isBelow&&/* @__PURE__ */jsxRuntime.jsx(ConnectorPath,{d:arrowPath(line.to.bounds.left+ARROW_MARGIN_X,line.to.bounds.top+line.to.bounds.height+ARROW_THRESHOLD-ARROW_MARGIN_Y,1),strokeWidth:STROKE_WIDTH$2}),DEBUG$1]});});var __freeze$2v=Object.freeze;var __defProp$2v=Object.defineProperty;var __template$2v=(cooked,raw)=>__freeze$2v(__defProp$2v(cooked,"raw",{value:__freeze$2v(raw||cooked.slice())}));var _a$2w;const SvgWrapper=styled__default.default.svg(_a$2w||(_a$2w=__template$2v(["\n  pointer-events: none;\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n"])));var __freeze$2u=Object.freeze;var __defProp$2u=Object.defineProperty;var __template$2u=(cooked,raw)=>__freeze$2u(__defProp$2u(cooked,"raw",{value:__freeze$2u(raw||cooked.slice())}));var _a$2v;function focusRingBorderStyle$2(border){return"inset 0 0 0 ".concat(border.width,"px ").concat(border.color);}const AlignedBottomGrid$1=styled__default.default(ui.Grid)(_a$2v||(_a$2v=__template$2u(["\n  align-items: flex-end;\n"])));function focusRingStyle$2(opts){const{base,border,focusRing}=opts;const focusRingOutsetWidth=focusRing.offset+focusRing.width;const focusRingInsetWidth=0-focusRing.offset;const bgColor=base?base.bg:"var(--card-bg-color)";return[focusRingInsetWidth>0&&"inset 0 0 0 ".concat(focusRingInsetWidth,"px var(--card-focus-ring-color)"),border&&focusRingBorderStyle$2(border),focusRingInsetWidth<0&&"0 0 0 ".concat(0-focusRingInsetWidth,"px ").concat(bgColor),focusRingOutsetWidth>0&&"0 0 0 ".concat(focusRingOutsetWidth,"px var(--card-focus-ring-color)")].filter(Boolean).join(",");}var __freeze$2t=Object.freeze;var __defProp$2t=Object.defineProperty;var __template$2t=(cooked,raw)=>__freeze$2t(__defProp$2t(cooked,"raw",{value:__freeze$2t(raw||cooked.slice())}));var _a$2u,_b$15,_c$z,_d$m;const LIST_ITEM_DATA_ATTR_ACTIVE="data-active";const LIST_ITEM_INTERACTIVE_SELECTOR="a,button";const FocusOverlayDiv=styled__default.default.div(_ref8=>{let{theme,offset}=_ref8;return styled.css(_a$2u||(_a$2u=__template$2t(["\n    bottom: ","px;\n    border-radius: ",";\n    left: ","px;\n    pointer-events: none;\n    position: absolute;\n    right: ","px;\n    top: ","px;\n    z-index: 2;\n\n    ",":focus-visible & {\n      box-shadow: ",";\n    }\n  "])),-offset,ui.rem(theme.sanity.radius[1]),-offset,-offset,-offset,VirtualListBox,focusRingStyle$2({base:theme.sanity.color.base,focusRing:theme.sanity.focusRing}));});const PointerOverlayDiv=styled__default.default.div(_b$15||(_b$15=__template$2t(["\n  bottom: 0;\n  display: none;\n  left: 0;\n  position: absolute;\n  right: 0;\n  top: 0;\n  z-index: 1;\n\n  @media (hover: hover) {\n    &[data-enabled='true'] {\n      display: block;\n    }\n  }\n"])));const VirtualListBox=styled__default.default(ui.Box)(_c$z||(_c$z=__template$2t(["\n  height: 100%;\n  outline: none;\n  overflow-x: hidden;\n  overflow-y: auto;\n  overscroll-behavior: contain;\n  width: 100%;\n"])));const VirtualListChildBox=styled__default.default(ui.Box).attrs(_ref9=>{let{$height}=_ref9;return{style:{height:"".concat($height,"px")}};})(_d$m||(_d$m=__template$2t(["\n  position: relative;\n  width: 100%;\n"])));const CommandList=React.forwardRef(function CommandList2(_ref10,ref){let{activeItemDataAttr=LIST_ITEM_DATA_ATTR_ACTIVE,ariaLabel,ariaMultiselectable=false,autoFocus,canReceiveFocus,fixedHeight,focusRingOffset=0,getItemDisabled,getItemKey,getItemSelected,initialIndex,initialScrollAlign="start",inputElement,itemHeight,items,onEndReached,onEndReachedIndexOffset=0,onlyShowSelectionWhenActive,overscan,renderItem,wrapAround=true,...responsivePaddingProps}=_ref10;const isMountedRef=React.useRef(false);const commandListId=React.useRef(React.useId());const activeIndexRef=React.useRef(initialIndex!=null?initialIndex:0);const[childContainerElement,setChildContainerElement]=React.useState(null);const[hovered,setHovered]=React.useState(false);const[pointerOverlayElement,setPointerOverlayElement]=React.useState(null);const[virtualListElement,setVirtualListElement]=React.useState(null);const handleChange=React.useCallback(v=>{if(!onEndReached)return;const[lastItem]=[...v.getVirtualItems()].reverse();if(!lastItem)return;const reachedEnd=lastItem.index>=items.length-onEndReachedIndexOffset-1;if(reachedEnd&&isMountedRef.current){onEndReached();}},[onEndReached,items.length,onEndReachedIndexOffset]);const virtualizer=reactVirtual.useVirtualizer({count:items.length,getItemKey,getScrollElement:()=>virtualListElement,estimateSize:()=>itemHeight,onChange:handleChange,overscan});const itemIndices=React.useMemo(()=>{let i=-1;return items.reduce((acc,_,index)=>{var _a2,_b2;const disabled=(_a2=getItemDisabled==null?void 0:getItemDisabled(index))!=null?_a2:false;const selected=(_b2=getItemSelected==null?void 0:getItemSelected(index))!=null?_b2:false;if(!disabled){i+=1;}acc[index]={activeIndex:disabled?null:i,disabled,selected};return acc;},[]);},[getItemDisabled,getItemSelected,items]);const activeItemCount=React.useMemo(()=>itemIndices.filter(v=>!v.disabled).length,[itemIndices]);const enableChildContainerPointerEvents=React.useCallback(enabled=>pointerOverlayElement==null?void 0:pointerOverlayElement.setAttribute("data-enabled",(!enabled).toString()),[pointerOverlayElement]);const getChildDescendantId=React.useCallback(index=>"".concat(commandListId.current,"-item-").concat(index),[]);const getCommandListChildrenId=React.useCallback(()=>"".concat(commandListId.current,"-children"),[]);const showChildrenActiveState=React.useCallback(()=>{const hasFocus=[inputElement,virtualListElement].some(el=>document.activeElement===el);if(onlyShowSelectionWhenActive&&!hasFocus&&!hovered){return;}const childElements=Array.from((childContainerElement==null?void 0:childContainerElement.children)||[]);childElements==null?void 0:childElements.forEach(child=>{var _a2,_b2,_c2;const virtualIndex=Number((_a2=child.dataset)==null?void 0:_a2.index);const targetIndex=(_b2=itemIndices[virtualIndex])==null?void 0:_b2.activeIndex;(_c2=child.querySelector(LIST_ITEM_INTERACTIVE_SELECTOR))==null?void 0:_c2.toggleAttribute(activeItemDataAttr,targetIndex===activeIndexRef.current);});},[activeItemDataAttr,childContainerElement==null?void 0:childContainerElement.children,hovered,inputElement,itemIndices,onlyShowSelectionWhenActive,virtualListElement]);const hideChildrenActiveState=React.useCallback(()=>{const childElements=Array.from((childContainerElement==null?void 0:childContainerElement.children)||[]);childElements==null?void 0:childElements.forEach(child=>{var _a2;(_a2=child.querySelector(LIST_ITEM_INTERACTIVE_SELECTOR))==null?void 0:_a2.toggleAttribute(activeItemDataAttr,false);});},[activeItemDataAttr,childContainerElement==null?void 0:childContainerElement.children]);const refreshChildrenActiveStateThrottled=React.useMemo(()=>{return throttle__default.default(showChildrenActiveState,200);},[showChildrenActiveState]);const handleUpdateActiveDescendant=React.useCallback(()=>{const activeIndex=activeIndexRef==null?void 0:activeIndexRef.current;if(items.length>0){inputElement==null?void 0:inputElement.setAttribute("aria-activedescendant",getChildDescendantId(activeIndex));virtualListElement==null?void 0:virtualListElement.setAttribute("aria-activedescendant",getChildDescendantId(activeIndex));}else{inputElement==null?void 0:inputElement.removeAttribute("aria-activedescendant");virtualListElement==null?void 0:virtualListElement.removeAttribute("aria-activedescendant");}},[getChildDescendantId,inputElement,items.length,virtualListElement]);const handleGetTopIndex=React.useCallback(()=>{var _a2,_b2;const childContainerParentElement=childContainerElement==null?void 0:childContainerElement.parentElement;if(childContainerElement&&childContainerParentElement){const offset=childContainerParentElement.getBoundingClientRect().top-childContainerElement.getBoundingClientRect().top;return(_b2=(_a2=virtualizer.getVirtualItemForOffset(offset))==null?void 0:_a2.index)!=null?_b2:-1;}return-1;},[childContainerElement,virtualizer]);const setActiveIndex=React.useCallback(_ref11=>{let{index,scrollAlign,scrollIntoView=true}=_ref11;activeIndexRef.current=index;handleUpdateActiveDescendant();showChildrenActiveState();if(scrollIntoView){const virtualListIndex=itemIndices.findIndex(i=>i.activeIndex===index);if(virtualListIndex>-1){virtualizer.scrollToIndex(virtualListIndex,scrollAlign?{align:scrollAlign}:{});}}},[handleUpdateActiveDescendant,itemIndices,showChildrenActiveState,virtualizer]);const selectAdjacentItemIndex=React.useCallback(direction=>{let nextIndex=-1;const lastIndex=activeItemCount-1;if(direction==="next"){const wrapAroundIndex=wrapAround?0:lastIndex;nextIndex=activeIndexRef.current<activeItemCount-1?activeIndexRef.current+1:wrapAroundIndex;}if(direction==="previous"){const wrapAroundIndex=wrapAround?lastIndex:0;nextIndex=activeIndexRef.current>0?activeIndexRef.current-1:wrapAroundIndex;}setActiveIndex({index:nextIndex,scrollIntoView:true});enableChildContainerPointerEvents(false);},[activeItemCount,enableChildContainerPointerEvents,setActiveIndex,wrapAround]);const focusElement=React.useCallback(type=>{switch(type){case"input":inputElement==null?void 0:inputElement.focus();break;case"list":virtualListElement==null?void 0:virtualListElement.focus();break;}},[inputElement,virtualListElement]);const focusInputElement=React.useCallback(()=>{inputElement==null?void 0:inputElement.focus();},[inputElement]);const focusListElement=React.useCallback(()=>{virtualListElement==null?void 0:virtualListElement.focus();},[virtualListElement]);const handleChildMouseEnter=React.useCallback(index=>()=>{setActiveIndex({index,scrollIntoView:false});},[setActiveIndex]);const handleFocus=React.useCallback(()=>{showChildrenActiveState();},[showChildrenActiveState]);const handleKeyDown=React.useCallback(type=>event=>{const childElements=Array.from((childContainerElement==null?void 0:childContainerElement.children)||[]);if(!childElements.length){return;}if(event.key==="ArrowDown"){event.preventDefault();focusElement(type);selectAdjacentItemIndex("next");}if(event.key==="ArrowUp"){event.preventDefault();focusElement(type);selectAdjacentItemIndex("previous");}if(event.key==="Enter"){event.preventDefault();focusElement(type);const currentElement=childElements.find(el=>Number(el.dataset.index)===itemIndices.findIndex(i=>i.activeIndex===activeIndexRef.current));if(currentElement){const clickableElement=currentElement==null?void 0:currentElement.querySelector(LIST_ITEM_INTERACTIVE_SELECTOR);clickableElement==null?void 0:clickableElement.click();}}},[childContainerElement==null?void 0:childContainerElement.children,focusElement,itemIndices,selectAdjacentItemIndex]);const handleKeyDownInput=React.useCallback(event=>handleKeyDown("input")(event),[handleKeyDown]);const handleKeyDownList=React.useCallback(event=>handleKeyDown("list")(event),[handleKeyDown]);const handleVirtualListMouseEnter=React.useCallback(()=>{if(onlyShowSelectionWhenActive){showChildrenActiveState();setHovered(true);}},[onlyShowSelectionWhenActive,showChildrenActiveState]);const handleVirtualListMouseLeave=React.useCallback(()=>{if(onlyShowSelectionWhenActive){hideChildrenActiveState();setHovered(false);}},[hideChildrenActiveState,onlyShowSelectionWhenActive]);React.useImperativeHandle(ref,()=>{return{focusInputElement(){focusInputElement();},focusListElement(){focusListElement();},getTopIndex(){return handleGetTopIndex();},scrollToIndex(index){setActiveIndex({index});enableChildContainerPointerEvents(true);}};},[enableChildContainerPointerEvents,focusInputElement,focusListElement,handleGetTopIndex,setActiveIndex]);React.useEffect(()=>{if(typeof initialIndex!=="undefined"&&!isMountedRef.current){setActiveIndex({index:initialIndex,scrollAlign:initialScrollAlign,scrollIntoView:true});}isMountedRef.current=true;},[initialIndex,initialScrollAlign,onlyShowSelectionWhenActive,setActiveIndex]);React.useEffect(()=>{function handleMouseEvent(){enableChildContainerPointerEvents(true);}virtualListElement==null?void 0:virtualListElement.addEventListener("mousemove",handleMouseEvent);virtualListElement==null?void 0:virtualListElement.addEventListener("wheel",handleMouseEvent,{passive:true});return()=>{virtualListElement==null?void 0:virtualListElement.removeEventListener("mousemove",handleMouseEvent);virtualListElement==null?void 0:virtualListElement.removeEventListener("wheel",handleMouseEvent);};},[enableChildContainerPointerEvents,virtualListElement]);React.useEffect(()=>{inputElement==null?void 0:inputElement.addEventListener("focus",handleFocus);inputElement==null?void 0:inputElement.addEventListener("keydown",handleKeyDownInput);virtualListElement==null?void 0:virtualListElement.addEventListener("focus",handleFocus);virtualListElement==null?void 0:virtualListElement.addEventListener("keydown",handleKeyDownList);return()=>{inputElement==null?void 0:inputElement.removeEventListener("focus",handleFocus);inputElement==null?void 0:inputElement.removeEventListener("keydown",handleKeyDownInput);virtualListElement==null?void 0:virtualListElement.removeEventListener("focus",handleFocus);virtualListElement==null?void 0:virtualListElement.removeEventListener("keydown",handleKeyDownList);};},[canReceiveFocus,handleFocus,handleKeyDown,handleKeyDownInput,handleKeyDownList,hideChildrenActiveState,inputElement,showChildrenActiveState,virtualListElement]);React.useEffect(()=>{handleUpdateActiveDescendant();},[handleUpdateActiveDescendant,items]);React.useEffect(()=>{const mutationObserver=new MutationObserver(refreshChildrenActiveStateThrottled);if(childContainerElement){mutationObserver.observe(childContainerElement,{childList:true,subtree:true});}return()=>{mutationObserver.disconnect();};},[childContainerElement,refreshChildrenActiveStateThrottled]);React.useEffect(()=>{inputElement==null?void 0:inputElement.setAttribute("aria-autocomplete","list");inputElement==null?void 0:inputElement.setAttribute("aria-expanded","true");inputElement==null?void 0:inputElement.setAttribute("aria-controls",getCommandListChildrenId());inputElement==null?void 0:inputElement.setAttribute("role","combobox");},[getCommandListChildrenId,inputElement]);React.useEffect(()=>{if(autoFocus){focusElement(autoFocus);}},[autoFocus,canReceiveFocus,focusListElement,focusInputElement,focusElement]);const rootTabIndex=canReceiveFocus?0:-1;return/* @__PURE__ */jsxRuntime.jsxs(VirtualListBox,{id:getCommandListChildrenId(),onMouseEnter:handleVirtualListMouseEnter,onMouseLeave:handleVirtualListMouseLeave,ref:setVirtualListElement,sizing:"border",tabIndex:rootTabIndex,...responsivePaddingProps,children:[canReceiveFocus&&/* @__PURE__ */jsxRuntime.jsx(FocusOverlayDiv,{offset:focusRingOffset}),/* @__PURE__ */jsxRuntime.jsx(PointerOverlayDiv,{"aria-hidden":"true","data-enabled":true,ref:setPointerOverlayElement}),virtualizer&&/* @__PURE__ */jsxRuntime.jsx(VirtualListChildBox,{forwardedAs:"ul",$height:virtualizer.getTotalSize(),"aria-label":ariaLabel,"aria-multiselectable":ariaMultiselectable,flex:1,ref:setChildContainerElement,role:"listbox",children:virtualizer.getVirtualItems().map(virtualRow=>{const virtualIndex=virtualRow.index;const{activeIndex,disabled,selected}=itemIndices[virtualIndex];const itemToRender=renderItem(items[virtualIndex],{activeIndex,disabled,selected,virtualIndex});const clonedItem=React.cloneElement(itemToRender,{tabIndex:-1});const activeAriaAttributes=typeof activeIndex==="number"&&!disabled?{"aria-posinset":activeIndex+1,...(ariaMultiselectable?{"aria-selected":selected.toString()}:{}),"aria-setsize":activeItemCount,id:getChildDescendantId(activeIndex),role:"option",onMouseEnter:handleChildMouseEnter(activeIndex)}:{};return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"li","data-index":virtualIndex,ref:fixedHeight?void 0:virtualizer.measureElement,style:{flex:1,...(fixedHeight?{height:"".concat(virtualRow.size,"px")}:{}),left:0,position:"absolute",top:0,transform:"translateY(".concat(virtualRow.start,"px)"),width:"100%"},tabIndex:-1,...activeAriaAttributes,children:clonedItem},virtualRow.key);})})]});});const ContextMenuButton=React.forwardRef(function ContextMenuButton2(props,ref){const{mode="bleed",tooltipProps,tone,...rest}=props;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{...rest,icon:icons.EllipsisHorizontalIcon,mode,ref,tone,tooltipProps:{...tooltipProps,content:(tooltipProps==null?void 0:tooltipProps.content)||t("common.context-menu-button.tooltip")}});});function getWorkspaceIdentifier(_ref12,index){let{name,title}=_ref12;if(typeof name==="string"&&name.trim().length>0){return name;}return getNamelessWorkspaceIdentifier(title,index);}function getNamelessWorkspaceIdentifier(title,index){const withTitle=typeof title==="string"&&title.trim().length>0?' (titled "'.concat(title,'")'):"";return"at index ".concat(index).concat(withTitle);}const WorkspacesContext=React.createContext(null);function useWorkspaces(){const workspaces=React.useContext(WorkspacesContext);if(!workspaces)throw new Error("Could not find `workspaces` context");return workspaces;}class WorkspaceValidationError extends Error{constructor(message,options){super(message);this.index=options==null?void 0:options.index;this.identifier=(options==null?void 0:options.workspace)&&getWorkspaceIdentifier(options.workspace,options.index);}}function validateWorkspaces(_ref13){let{workspaces}=_ref13;if(workspaces.length===0){throw new WorkspaceValidationError("At least one workspace is required.");}validateNames(workspaces);validateBasePaths(workspaces);}function validateNames(workspaces){const isSingleWorkspace=workspaces.length===1;const names=/* @__PURE__ */new Map();workspaces.forEach((workspace,index)=>{const{name:rawName,title}=workspace;const thisIdentifier=getNamelessWorkspaceIdentifier(title,index);if(!rawName&&!isSingleWorkspace){throw new WorkspaceValidationError("All workspaces must have a `name`, unless only a single workspace is defined. "+"Workspace ".concat(thisIdentifier," did not define a `name`."),{workspace,index});}const name=isSingleWorkspace&&typeof rawName==="undefined"?"default":rawName;if(typeof name!=="string"){throw new WorkspaceValidationError("Workspace at index ".concat(index," defined an invalid `name` - must be a string."),{workspace,index});}const normalized=name.toLowerCase();const existingWorkspace=names.get(normalized);if(existingWorkspace){const prevIdentifier=getNamelessWorkspaceIdentifier(existingWorkspace.workspace.title,existingWorkspace.index);throw new WorkspaceValidationError("`name`s must be unique. Workspace ".concat(prevIdentifier," and ")+"workspace ".concat(thisIdentifier," both have the `name` `").concat(name,"`"),{workspace,index});}names.set(normalized,{index,workspace});if(!/^[a-z0-9][a-z0-9_-]*$/i.test(name)){throw new WorkspaceValidationError("All workspace `name`s must consist of only a-z, 0-9, underscore and dashes, and cannot begin with an underscore or dash. "+"Workspace ".concat(thisIdentifier," has the invalid name `").concat(name,"`"),{workspace,index});}});}function validateBasePaths(workspaces){if(workspaces.length>1){workspaces.every(hasBasePath);}workspaces.every(validateBasePath);const[firstWorkspace,...restOfWorkspaces]=workspaces;const firstWorkspaceSegmentCount=(firstWorkspace.basePath||"/").substring(1).split("/").filter(Boolean).length;restOfWorkspaces.forEach((workspace,index)=>{const workspaceSegmentCount=(workspace.basePath||"/").substring(1).split("/").length;if(firstWorkspaceSegmentCount!==workspaceSegmentCount){throw new WorkspaceValidationError("All workspace `basePath`s must have the same amount of segments. Workspace `".concat(getWorkspaceIdentifier(firstWorkspace,index),"` had ").concat(firstWorkspaceSegmentCount," segment").concat(firstWorkspaceSegmentCount===1?"":"s"," `").concat(firstWorkspace.basePath,"` but workspace `").concat(getWorkspaceIdentifier(workspace,index),"` had ").concat(workspaceSegmentCount," segment").concat(workspaceSegmentCount===1?"":"s"," `").concat(workspace.basePath,"`"),{workspace,index});}});const basePaths=/* @__PURE__ */new Map();workspaces.forEach((workspace,index)=>{const basePath=(workspace.basePath||"").toLowerCase();const existingWorkspace=basePaths.get(basePath);if(existingWorkspace){throw new WorkspaceValidationError("`basePath`s must be unique. Workspaces `".concat(existingWorkspace,"` and ")+"`".concat(getWorkspaceIdentifier(workspace,index),"` both have the `basePath` `").concat(basePath,"`"),{workspace,index});}basePaths.set(basePath,getWorkspaceIdentifier(workspace,index));});}function hasBasePath(workspace,index){const{name,basePath}=workspace;if(basePath&&typeof basePath==="string"){return true;}if(typeof basePath==="undefined"){throw new WorkspaceValidationError("If more than one workspace is defined, every workspace must have a `basePath` defined. "+"Workspace `".concat(name,"` is missing a `basePath`"),{workspace,index});}throw new WorkspaceValidationError("If more than one workspace is defined, every workspace must have a `basePath` defined. "+"Workspace `".concat(name,"` has an invalid `basePath` (must be a non-empty string)"),{workspace,index});}function validateBasePath(workspace,index){const{name,basePath}=workspace;if(!basePath||basePath==="/"){return;}if(!/^\/[a-z0-9/_-]*[a-z0-9_-]+$/i.test(basePath)){throw new WorkspaceValidationError("All workspace `basePath`s must start with a leading `/`, consist of only URL safe characters, and cannot end with a trailing `/`. "+"Workspace `".concat(name,"`'s basePath is `").concat(basePath,"`"),{workspace,index});}}const emptyRender=()=>React.createElement(React.Fragment);function _createMiddlewareComponent(defaultComponent,middlewareComponents){return outerProps=>{let next=props=>React.createElement(defaultComponent,props);for(const middleware of middlewareComponents){const renderDefault=next;next=props=>React.createElement(middleware,{...props,renderDefault});}return next({...outerProps,// NOTE: it's safe to pass the empty render function, since it'll be overwritten in the next step (above).
// NOTE: it's important that the default component does not use `renderDefault`, since it will
// get the `emptyRender` callback will be passed when the middleware stack is empty.
renderDefault:emptyRender});};}function useMiddlewareComponents(props){const{options}=useSource().__internal;const{defaultComponent,pick}=props;return React.useMemo(()=>{const flattened=[...flattenConfig(options,[])];flattened.reverse();const pickedComponents=flattened.map(_ref14=>{let{config}=_ref14;return pick(config);});const result=pickedComponents.filter(Boolean);return _createMiddlewareComponent(defaultComponent,result);},[defaultComponent,options,pick]);}class ConfigPropertyError extends Error{constructor(_ref15){let{propertyName,path,cause}=_ref15;const message=isRecord$4(cause)&&typeof(cause==null?void 0:cause.message)==="string"?": ".concat(cause.message):"";super("An error occurred while resolving `".concat(propertyName,"` from ").concat(path.join(" > ")).concat(message));this.propertyName=propertyName;this.cause=cause;this.path=path;}}class ConfigResolutionError extends Error{constructor(_ref16){let{causes,name,type}=_ref16;const messages=causes.filter(Boolean).map(cause=>isRecord$4(cause)&&typeof(cause==null?void 0:cause.message)==="string"?cause.message:String(cause));super("Could not resolve ".concat(type).concat(name?" `".concat(name,"`"):"",":\n").concat(messages.map(message=>"	- ".concat(message)).join("\n"),"\n\n"));this.name=name;this.causes=causes;this.type=type;}}const documentFieldActionsReducer=(prev,_ref17,context)=>{let{document}=_ref17;const documentFieldActions=document==null?void 0:document.unstable_fieldActions;if(!documentFieldActions)return prev;if(typeof documentFieldActions==="function")return documentFieldActions(prev,context);if(Array.isArray(documentFieldActions))return[...prev,...documentFieldActions];throw new Error("Expected `document.unstable_fieldActions` to be an array or a function, but received ".concat(typeof documentFieldActions));};const initialDocumentFieldActions=[];const flattenConfig=(_ref18,path)=>{let{plugins=[],...currentConfig}=_ref18;const rootConfig={config:currentConfig,path:[...path,currentConfig.name]};const allPlugins=plugins.flatMap(plugin=>flattenConfig(plugin,[...path,currentConfig.name]));const resolved=[...allPlugins,rootConfig];return resolved;};var __freeze$2s=Object.freeze;var __defProp$2s=Object.defineProperty;var __template$2s=(cooked,raw)=>__freeze$2s(__defProp$2s(cooked,"raw",{value:__freeze$2s(raw||cooked.slice())}));var _a$2t,_b$14,_d$l,_e$c,_f$9;const DEBUG_MODE$1=false;const SPINNER_DELAY=750;const TEXT_DELAY=2e3;const StyledCard$4=styled__default.default(ui.Card)(_ref19=>{let{$fill}=_ref19;return styled.css(_d$l||(_d$l=__template$2s(["\n    align-items: center;\n    box-sizing: border-box;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n\n    ","\n\n    ","\n\n    > * {\n      position: absolute;\n    }\n  "])),$fill?styled.css(_a$2t||(_a$2t=__template$2s(["\n          bottom: 0;\n          height: 100%;\n          left: 0;\n          position: absolute;\n          right: 0;\n          top: 0;\n          width: 100%;\n        "]))):styled.css(_b$14||(_b$14=__template$2s(["\n          min-height: 75px;\n          height: stretch;\n          height: -webkit-fill-available;\n          width: stretch;\n          width: -webkit-fill-available;\n        "]))),DEBUG_MODE$1);});const StyledSpinner=styled__default.default(ui.Spinner)(_ref20=>{let{$animatePosition=true}=_ref20;return styled.css(_e$c||(_e$c=__template$2s(["\n    @keyframes fadeIn {\n      from {\n        opacity: 0;\n      }\n      to {\n        opacity: 1;\n      }\n    }\n    @keyframes slideUp {\n      from {\n        transform: translateY(0);\n      }\n      to {\n        transform: translateY(-15px);\n      }\n    }\n    animation: ",";\n  "])),$animatePosition?"500ms ease-out ".concat(SPINNER_DELAY,"ms 1 normal both running fadeIn, 750ms ease-out ").concat(TEXT_DELAY,"ms 1 normal both running slideUp"):"500ms ease-out ".concat(SPINNER_DELAY,"ms 1 normal both running fadeIn"));});const StyledText$5=styled__default.default(ui.Text)(_f$9||(_f$9=__template$2s(["\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n  @keyframes slideDown {\n    from {\n      transform: translateY(0);\n    }\n    to {\n      transform: translateY(15px);\n    }\n  }\n  animation:\n    1500ms ease-out ","ms 1 normal both running fadeIn,\n    750ms ease-out ","ms 1 normal both running slideDown;\n"])),TEXT_DELAY,TEXT_DELAY);function LoadingBlock(_ref21){let{fill,showText,title}=_ref21;return/* @__PURE__ */jsxRuntime.jsxs(StyledCard$4,{$fill:fill,as:fill?ui.Layer:"div",children:[/* @__PURE__ */jsxRuntime.jsx(StyledSpinner,{$animatePosition:!!showText,muted:true}),showText&&/* @__PURE__ */jsxRuntime.jsx(LoadingText,{title})]});}function LoadingText(_ref22){let{title}=_ref22;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(StyledText$5,{muted:true,size:1,children:title||t("common.loading")});}const LocaleContext=React.createContext(void 0);function defineLocaleResourceBundle(bundle){return bundle;}function defineLocale(locale){return locale;}function isStaticResourceBundle(bundle){return!("then"in bundle.resources&&typeof bundle.resources.then==="function");}function defineLocalesResources(namespace,resources){return resources;}function removeUndefinedLocaleResources(resources){const result={};for(const key in resources){if(typeof resources[key]!=="undefined"){result[key]=resources[key];}}return result;}const studioLocaleNamespace="studio";const validationLocaleNamespace="validation";const studioLocaleStrings=defineLocalesResources("studio",{/** Menu item for deleting the asset */"asset-source.asset-list.menu.delete":"Delete",/** Menu item for showing where a particular asset is used */"asset-source.asset-list.menu.show-usage":"Show usage",/** Header in usage dialog for file assets */"asset-source.asset-usage-dialog.header_file":"Documents using file",/** Header in usage dialog for image assets */"asset-source.asset-usage-dialog.header_image":"Documents using image",/** Text shown in usage dialog when loading documents using the selected asset */"asset-source.asset-usage-dialog.loading":"Loading\u2026",/** Text for cancel action in delete-asset dialog */"asset-source.delete-dialog.action.cancel":"Cancel",/** Text for "confirm delete" action in delete-asset dialog */"asset-source.delete-dialog.action.delete":"Delete",/** Dialog header for delete-asset dialog when deleting a file */"asset-source.delete-dialog.header_file":"Delete file",/** Dialog header for delete-asset dialog when deleting an image */"asset-source.delete-dialog.header_image":"Delete image",/** Text shown in delete dialog when loading documents using the selected asset */"asset-source.delete-dialog.loading":"Loading\u2026",/** Message confirming to delete *named* file */"asset-source.delete-dialog.usage-list.confirm-delete-file_named":"You are about to delete the file <strong>{{filename}}}</strong> and its metadata. Are you sure?",/** Message confirming to delete *unnamed* file */"asset-source.delete-dialog.usage-list.confirm-delete-file_unnamed":"You are about to delete the file and its metadata. Are you sure?",/** Message confirming to delete *named* image */"asset-source.delete-dialog.usage-list.confirm-delete-image_named":"You are about to delete the image <strong>{{filename}}</strong> and its metadata. Are you sure?",/** Message confirming to delete *unnamed* image */"asset-source.delete-dialog.usage-list.confirm-delete-image_unnamed":"You are about to delete the image and its metadata. Are you sure?",/** Alt text showing on image preview in delete asset dialog  */"asset-source.delete-dialog.usage-list.image-preview-alt":"Preview of image",/** Warning message showing when *named* file can't be deleted because it is in use */"asset-source.delete-dialog.usage-list.warning-file-is-in-use_named":"{{filename}} cannot be deleted because it's being used. In order to delete this file, you first need to remove all uses of it.",/** Warning message showing when *unnamed* file can't be deleted because it is in use */"asset-source.delete-dialog.usage-list.warning-file-is-in-use_unnamed":"This file cannot be deleted because it's being used. In order to delete it, you first need to remove all uses of it.",/** Warning message showing when *named* image can't be deleted because it is in use */"asset-source.delete-dialog.usage-list.warning-image-is-in-use_named":"{{filename}} cannot be deleted because it's being used. In order to delete this image, you first need to remove all uses of it.",/** Warning message showing when *unnamed* image can't be deleted because it is in use */"asset-source.delete-dialog.usage-list.warning-image-is-in-use_unnamed":"This image cannot be deleted because it's being used. In order to delete it, you first need to remove all uses of it.",/** Text shown when the list of assets only include a specific set of types */"asset-source.dialog.accept-message":"Only showing assets of accepted types: <strong>{{acceptTypes}}</strong>",/** Keys shared between both image asset source and file asset source */ /** Select asset dialog title for files */"asset-source.dialog.default-title_file":"Select file",/** Select asset dialog title for images */"asset-source.dialog.default-title_image":"Select image",/** Select asset dialog load more items */"asset-source.dialog.load-more":"Load more",/** Text shown when selecting a file but there's no files to select from */"asset-source.dialog.no-assets_file":"No files",/** Text shown when selecting an image but there's no images to select from */"asset-source.dialog.no-assets_image":"No images","asset-source.file.asset-list.action.delete.disabled-cannot-delete-current-file":"Cannot delete currently selected file","asset-source.file.asset-list.action.delete.text":"Delete","asset-source.file.asset-list.action.delete.title":"Delete file","asset-source.file.asset-list.action.select-file.title":"Select the file {{filename}}","asset-source.file.asset-list.action.show-usage.title":"Show usage","asset-source.file.asset-list.delete-failed":"File could not be deleted","asset-source.file.asset-list.delete-successful":"File was deleted","asset-source.file.asset-list.header.date-added":"Date added",/** File asset source */"asset-source.file.asset-list.header.filename":"Filename","asset-source.file.asset-list.header.size":"Size","asset-source.file.asset-list.header.type":"Type",/** Text displayed on button or menu invoking the file asset source */"asset-source.file.title":"Uploaded files","asset-source.image.asset-list.delete-failed":"Image could not be deleted",/** Image asset source */"asset-source.image.asset-list.delete-successful":"Image was deleted",/** Text displayed on button or menu invoking the image asset source */"asset-source.image.title":"Uploaded images","asset-source.usage-list.documents-using-file_named_one":"One document is using file <code>{{filename}}</code>","asset-source.usage-list.documents-using-file_named_other":"{{count}} documents are using file <code>{{filename}}</code>",/** Text shown in usage dialog for a file asset when there are zero, one or more documents using the *named* file **/"asset-source.usage-list.documents-using-file_named_zero":"No documents are using file <code>{{filename}}</code>","asset-source.usage-list.documents-using-file_unnamed_one":"One document is using this file","asset-source.usage-list.documents-using-file_unnamed_other":"{{count}} documents are using this file",/** Text shown in usage dialog for a file asset when there are zero, one or more documents using the *unnamed* file **/"asset-source.usage-list.documents-using-file_unnamed_zero":"No documents are using this file","asset-source.usage-list.documents-using-image_named_one":"One document is using image <code>{{filename}}</code>","asset-source.usage-list.documents-using-image_named_other":"{{count}} documents are using image <code>{{filename}}</code>",/** Text shown in usage dialog for an image asset when there are zero, one or more documents using the *named* image **/"asset-source.usage-list.documents-using-image_named_zero":"No documents are using image <code>{{filename}}</code>","asset-source.usage-list.documents-using-image_unnamed_one":"One document is using this image","asset-source.usage-list.documents-using-image_unnamed_other":"{{count}} documents are using this image",/** Text shown in usage dialog for an image asset when there are zero, one or more documents using the *unnamed* image **/"asset-source.usage-list.documents-using-image_unnamed_zero":"No documents are using this image",/** Action message for navigating to next month */"calendar.action.go-to-next-month":"Go to next month",/** Action message for navigating to next year */"calendar.action.go-to-next-year":"Go to next year",/** Action message for navigating to previous month */"calendar.action.go-to-previous-month":"Go to previous month",/** Action message for navigating to previous year */"calendar.action.go-to-previous-year":"Go to previous year",/* Label for navigating the calendar to "today", without _selecting_ today. Short form, eg `Today`, not `Go to today` */"calendar.action.go-to-today":"Today",/* Accessibility label for navigating the calendar to "today", without _selecting_ today */"calendar.action.go-to-today-aria-label":"Go to today",/* Label for navigating the calendar to "tomorrow", without _selecting_ tomorrow. Short form, eg `Tomorrow`, not `Go to tomorrow` */"calendar.action.go-to-tomorrow":"Tomorrow",/* Label for navigating the calendar to "yesterday", without _selecting_ yesterday. Short form, eg `Yesterday`, not `Go to yesterday` */"calendar.action.go-to-yesterday":"Yesterday",/** Label for switch that controls whether or not to include time in given timestamp */"calendar.action.include-time-label":"Include time",/** Action message for selecting the hour */"calendar.action.select-hour":"Select hour",/** Action message for selecting the minute */"calendar.action.select-minute":"Select minute",/** Action message for setting to the current time */"calendar.action.set-to-current-time":"Set to current time",/** Label for selecting an hour preset. Receives a `time` param as a string on hh:mm format and a `date` param as a Date instance denoting the preset date */"calendar.action.set-to-time-preset":"{{time}} on {{date, datetime}}",/** Error message displayed in calendar when entered date is not the correct format */"calendar.error.must-be-in-format":"Must be in the format: {{exampleDate}}",/** Month name for April */"calendar.month-names.april":"April",/** Month name for August */"calendar.month-names.august":"August",/** Month name for December */"calendar.month-names.december":"December",/** Month name for February */"calendar.month-names.february":"February",/** Month name for January */"calendar.month-names.january":"January",/** Month name for July */"calendar.month-names.july":"July",/** Month name for June */"calendar.month-names.june":"June",/** Month name for March */"calendar.month-names.march":"March",/** Month name for May */"calendar.month-names.may":"May",/** Month name for November */"calendar.month-names.november":"November",/** Month name for October */"calendar.month-names.october":"October",/** Month name for September */"calendar.month-names.september":"September",/** Short weekday name for Friday */"calendar.weekday-names.short.friday":"Fri",/** Short weekday name for Monday */"calendar.weekday-names.short.monday":"Mon",/** Short weekday name for Saturdayday */"calendar.weekday-names.short.saturday":"Sat",/** Short weekday name for Sunday */"calendar.weekday-names.short.sunday":"Sun",/** Short weekday name for Thursday */"calendar.weekday-names.short.thursday":"Thu",/** Short weekday name for Tuesday */"calendar.weekday-names.short.tuesday":"Tue",/** Short weekday name for Wednesday */"calendar.weekday-names.short.wednesday":"Wed",/** Label for the close button label in Review Changes pane */"changes.action.close-label":"Close review changes",/** Cancel label for revert button prompt action */"changes.action.revert-all-cancel":"Cancel",/** Revert all confirm label for revert button action - used on prompt button + review changes pane */"changes.action.revert-all-confirm":"Revert all",/** Prompt for reverting all changes in document in Review Changes pane. Includes a count of changes. */"changes.action.revert-all-description":"Are you sure you want to revert all {{count}} changes?",/** Prompt for confirming revert change (singular) label for field change action */"changes.action.revert-changes-confirm-change_one":"Revert change",/** Revert for confirming revert (plural) label for field change action */"changes.action.revert-changes-confirm-change_other":"Revert changes",/** Prompt for reverting changes for a field change */"changes.action.revert-changes-description":"Are you sure you want to revert the changes?",/** Prompt for reverting changes for a group change, eg multiple changes */"changes.action.revert-changes-description_one":"Are you sure you want to revert the change?",/** Label for when the action of the change was to set something that was previously empty, eg a field was given a value, an array item was added, an asset was selected or similar */"changes.added-label":"Added",/** Array diff: An item was added in a given position (`{{position}}`) */"changes.array.item-added-in-position":"Added in position {{position}}","changes.array.item-moved_down_one":"Moved {{count}} position down","changes.array.item-moved_down_other":"Moved {{count}} positions down",/**
   * Array diff: An item was moved within the array.
   * Receives `{{count}}` representing number of positions it moved.
   * Context is the direction of the move, either `up` or `down`.
   */"changes.array.item-moved_up_one":"Moved {{count}} position up","changes.array.item-moved_up_other":"Moved {{count}} positions up",/** Array diff: An item was removed from a given position (`{{position}}`) */"changes.array.item-removed-from-position":"Removed from position {{position}}",/** Accessibility label for the "change bar" shown when there are edits on a field-level */"changes.change-bar.aria-label":"Review changes",/** Label for when the action of the change was _not_ an add/remove, eg a text field changed value, an image was changed from one asset to another or similar */"changes.changed-label":"Changed",/** Label and text for tooltip that indicates the authors of the changes */"changes.changes-by-author":"Changes by",/** Additional text shown in development mode when a diff component crashes during rendering */"changes.error-boundary.developer-info":"Check the developer console for more information",/** Text shown when a diff component crashes during rendering, triggering the error boundary */"changes.error-boundary.title":"Rendering the changes to this field caused an error",/** Error message shown when the value of a field is not the expected one */"changes.error.incorrect-type-message":'Value error: Value is of type "<code>{{actualType}}</code>", expected "<code>{{expectedType}}</code>"',/** File diff: Fallback title for the meta info section when there is no original filename to use  */"changes.file.meta-info-fallback-title":"Untitled",/** Image diff: Text shown in tooltip when hovering hotspot that has changed in diff view */"changes.image.crop-changed":"Crop changed",/** Image diff: Text shown if the previous image asset was deleted (shouldn't theoretically happen) */"changes.image.deleted":"Image deleted",/** Image diff: Text shown if the image failed to be loaded when previewing it */"changes.image.error-loading-image":"Error loading image",/** Image diff: Text shown in tooltip when hovering hotspot that has changed in diff view */"changes.image.hotspot-changed":"Hotspot changed",/** Image diff: Fallback title for the meta info section when there is no original filename to use  */"changes.image.meta-info-fallback-title":"Untitled",/** Image diff: Text shown if no asset has been set for the field (but has metadata changes) */"changes.image.no-asset-set":"Image not set",/** Image diff: Text shown when the from/to state has/had no image */"changes.image.no-image-placeholder":"(no image)",/** Label for the "from" value in the change inspector */"changes.inspector.from-label":"From",/** Label for the "meta" (field path, action etc) information in the change inspector */"changes.inspector.meta-label":"Meta",/** Label for the "to" value in the change inspector */"changes.inspector.to-label":"To",/** Loading author of change in the differences tooltip in the review changes pane */"changes.loading-author":"Loading\u2026",/** Loading changes in Review Changes Pane */"changes.loading-changes":"Loading changes\u2026",/** No Changes description in the Review Changes pane */"changes.no-changes-description":"Edit the document or select an older version in the timeline to see a list of changes appear in this panel.",/** No Changes title in the Review Changes pane */"changes.no-changes-title":"There are no changes",/** Portable Text diff: An annotation was added */"changes.portable-text.annotation_added":"Added annotation",/** Portable Text diff: An annotation was changed */"changes.portable-text.annotation_changed":"Changed annotation",/** Portable Text diff: An annotation was removed */"changes.portable-text.annotation_removed":"Removed annotation",/** Portable Text diff: An annotation was left unchanged */"changes.portable-text.annotation_unchanged":"Unchanged annotation",/** Portable Text diff: A block changed from one style to another (eg `normal` to `h1` or similar) */"changes.portable-text.block-style-changed":'Changed block style from "{{fromStyle}}" to "{{toStyle}}"',/** Portable Text diff: Change formatting of text (setting/unsetting marks, eg bold/italic etc) */"changes.portable-text.changed-formatting":"Changed formatting",/** Portable Text diff: An empty inline object is part of a change */"changes.portable-text.empty-inline-object":"Empty {{inlineObjectType}}",/** Portable Text diff: An empty object is the result of adding/removing an annotation */"changes.portable-text.empty-object-annotation":"Empty {{annotationType}}",/** Portable Text diff: Added a block containing no text (eg empty block) */"changes.portable-text.empty-text_added":"Added empty text",/** Portable Text diff: Changed a block that contained no text (eg empty block) */"changes.portable-text.empty-text_changed":"Changed empty text",/** Portable Text diff: Removed a block containing no text (eg empty block) */"changes.portable-text.empty-text_removed":"Removed empty text",/** Portable Text diff: An inline object was added */"changes.portable-text.inline-object_added":"Added inline object",/** Portable Text diff: An inline object was changed */"changes.portable-text.inline-object_changed":"Changed inline object",/** Portable Text diff: An inline object was removed */"changes.portable-text.inline-object_removed":"Removed inline object",/** Portable Text diff: An inline object was left unchanged */"changes.portable-text.inline-object_unchanged":"Unchanged inline object",/** Portable Text diff: Added a chunk of text */"changes.portable-text.text_added":"Added text",/** Portable Text diff: Removed a chunk of text */"changes.portable-text.text_removed":"Removed text",/** Portable Text diff: Annotation has an unknown schema type */"changes.portable-text.unknown-annotation-schema-type":"Unknown schema type",/** Portable Text diff: Inline object has an unknown schema type */"changes.portable-text.unknown-inline-object-schema-type":"Unknown schema type",/** Label for when the action of the change was a removal, eg a field was cleared, an array item was removed, an asset was deselected or similar */"changes.removed-label":"Removed",/** Title for the Review Changes pane */"changes.title":"Review changes",/** --- Common components --- */ /** Tooltip text for context menu buttons */"common.context-menu-button.tooltip":"Show more",/** Default text for dialog cancel button */"common.dialog.cancel-button.text":"Cancel",/** Default text for dialog confirm button */"common.dialog.confirm-button.text":"Confirm",/** Default text in shared loader text / spinner lockup */"common.loading":"Loading",/** --- Configuration issues --- */ /** Tooltip displayed on configuration issues button */"configuration-issues.button.tooltip":"Found configuration issues",/** The fallback title for an ordering menu item if no localized titles are provided. */"default-menu-item.fallback-title":"Sort by {{title}}",/** Title for the default ordering/SortOrder if no orderings are provided and the caption field is found */"default-orderings.caption":"Sort by Caption",/** Title for the default ordering/SortOrder if no orderings are provided and the description field is found */"default-orderings.description":"Sort by Description",/** Title for the default ordering/SortOrder if no orderings are provided and the header field is found */"default-orderings.header":"Sort by Header",/** Title for the default ordering/SortOrder if no orderings are provided and the heading field is found */"default-orderings.heading":"Sort by Heading",/** Title for the default ordering/SortOrder if no orderings are provided and the label field is found */"default-orderings.label":"Sort by Label",/** Title for the default ordering/SortOrder if no orderings are provided and the name field is found */"default-orderings.name":"Sort by Name",/** Title for the default ordering/SortOrder if no orderings are provided and the title field is found */"default-orderings.title":"Sort by Title",/** Label to show in the document footer indicating the last edited date of the document */"document-status.edited":"Edited {{date}}",/** Label to show in the document footer indicating the document is not published*/"document-status.not-published":"Not published",/** Label to show in the document footer indicating the published date of the document */"document-status.published":"Published {{date}}",/** The value of the <code>_key</code> property must be a unique string. */"form.error.duplicate-keys-alert.details.additional-description":"The value of the <code>_key</code> property must be a unique string.",/** This usually happens when items are created using an API client, and the <code>_key</code> property of each elements has been generated non-uniquely. */"form.error.duplicate-keys-alert.details.description":"This usually happens when items are created using an API client, and the <code>_key</code> property of each elements has been generated non-uniquely.",/** Developer info */"form.error.duplicate-keys-alert.details.title":"Developer info",/** Generate unique keys */"form.error.duplicate-keys-alert.generate-button.text":"Generate unique keys",/** Several items in this list share the same identifier (key). Every item must have an unique identifier. */"form.error.duplicate-keys-alert.summary":"Several items in this list share the same identifier (key). Every item must have an unique identifier.",/** Non-unique keys */"form.error.duplicate-keys-alert.title":"Non-unique keys",/** Error text shown when a field with a given name cannot be found in the schema or is conditionally hidden but explicitly told to render  */"form.error.field-not-found":'Field "{{fieldName}}" not found among members \u2013 verify that it is defined in the schema and that it has not been conditionally hidden.',/** Add missing keys */"form.error.missing-keys-alert.add-button.text":"Add missing keys",/** The value of the <code>_key</code> property must be a unique string. */"form.error.missing-keys-alert.details.additional-description":"The value of the <code>_key</code> property must be a unique string.",/** This usually happens when items are created using an API client, and the <code>_key</code> property has not been included. */"form.error.missing-keys-alert.details.description":"This usually happens when items are created using an API client, and the <code>_key</code> property has not been included.",/** Developer info */"form.error.missing-keys-alert.details.title":"Developer info",/** Some items in the list are missing their keys. This must be fixed in order to edit the list. */"form.error.missing-keys-alert.summary":"Some items in the list are missing their keys. This must be fixed in order to edit the list.",/** Missing keys */"form.error.missing-keys-alert.title":"Missing keys",/** This usually happens when items are created using an API client, or when a custom input component has added invalid data to the list. */"form.error.mixed-array-alert.details.description":"This usually happens when items are created using an API client, or when a custom input component has added invalid data to the list.",/** Developer info */"form.error.mixed-array-alert.details.title":"Developer info",/**  Remove non-object values */"form.error.mixed-array-alert.remove-button.text":"Remove non-object values",/** Some items in this list are not objects. This must be fixed in order to edit the list. */"form.error.mixed-array-alert.summary":"Some items in this list are not objects. This must be fixed in order to edit the list.",/** Invalid list values */"form.error.mixed-array-alert.title":"Invalid list values",/** Error text shown when form is unable to find an array item at a given indexed path */"form.error.no-array-item-at-index":"No array item at index <code>{{index}}</code> found at path <code>{{path}}</code>",/** Error text shown when form is unable to find an array item at a given keyed path */"form.error.no-array-item-at-key":'No array item with `_key` <code>"{{key}}"</code> found at path <code>{{path}}</code>',/** Form field deprecated label */"form.field.deprecated-label":"deprecated",/** Fallback title shown above field if it has no defined title */"form.field.untitled-field-label":"Untitled",/** Fallback title shown above fieldset if it has no defined title */"form.field.untitled-fieldset-label":"Untitled",/** Accessibility label for the icon that indicates the field has a validation error */"form.validation.has-error-aria-label":"Has error",/** Accessibility label for the icon that indicates the field has validation information */"form.validation.has-info-aria-label":"Has information",/** Accessibility label for the icon that indicates the field has a validation warning */"form.validation.has-warning-aria-label":"Has warning",/** Text shown when summarizing validation information, when the field has one or more errors */"form.validation.summary.errors-count_one":"{{count}} error","form.validation.summary.errors-count_other":"{{count}} errors",/** Text shown when summarizing validation information, when the field has one or more warnings */"form.validation.summary.warnings-count_one":"{{count}} warning","form.validation.summary.warnings-count_other":"{{count}} warnings",/** Tooltip for free trial navbar button indicating remaining days */"free-trial.tooltip.days-count_one":"{{count}} day left in trial","free-trial.tooltip.days-count_other":"{{count}} days left in trial",/** Tooltip for free trial navbar button, once trial has ended */"free-trial.tooltip.trial-finished":"Upgrade your project",/**
   * Label for "contact sales" call to action
   * These are titles for fallback links in the event the help & resources endpoint isn't able to be fetched
   */"help-resources.action.contact-sales":"Contact sales",/**
   * Label for "help and support" call to action
   * These are titles for fallback links in the event the help & resources endpoint isn't able to be fetched
   */"help-resources.action.help-and-support":"Help and support",/**
   * Label for "join our community" call to action
   * These are titles for fallback links in the event the help & resources endpoint isn't able to be fetched
   */"help-resources.action.join-our-community":"Join our community",/** Information for what the latest sanity version is */"help-resources.latest-sanity-version":"Latest version is {{latestVersion}}",/** Information for what studio version the current studio is running */"help-resources.studio-version":"Sanity Studio version {{studioVersion}}",/** Title for help and resources menus */"help-resources.title":"Help and resources",/** Text for button to cancel an ongoing upload */"input.files.common.cancel-upload":"Cancel",/** Text for file input button in upload placeholder */"input.files.common.upload-placeholder.file-input-button.text":"Upload",/** Uploading <FileName/> */"input.files.common.upload-progress":"Uploading <FileName/>",/** The referenced document cannot be opened, because the URL failed to be resolved */"input.reference.document-cannot-be-opened.failed-to-resolve-url":"This document cannot be opened (unable to resolve URL to Studio)",/** Label for adding item after a specific array item */"inputs.array.action.add-after":"Add item after",/** Label for adding item before a specific array item */"inputs.array.action.add-before":"Add item before",/** Label for adding array item action when the schema allows for only one schema type */"inputs.array.action.add-item":"Add item",/**
   * Label for adding one array item action when the schema allows for multiple schema types,
   * eg. will prompt the user to select a type once triggered
   */"inputs.array.action.add-item-select-type":"Add item...",/** Array drag handle button tooltip */"inputs.array.action.drag.tooltip":"Drag to re-order",/** Label for duplicating an array item  */"inputs.array.action.duplicate":"Duplicate",/** Label for editing the item of a specific type, eg "Edit Person" */"inputs.array.action.edit":"Edit {{itemTypeTitle}}",/** Label for removing an array item action  */"inputs.array.action.remove":"Remove",/** Label for removing action when an array item has an error  */"inputs.array.action.remove-invalid-item":"Remove",/** Label for viewing the item of a specific type, eg "View Person" */"inputs.array.action.view":"View {{itemTypeTitle}}",/** Error description for the array item tooltip that explains that the current item can still be moved or deleted but not edited since the schema definition is not found */"inputs.array.error.can-delete-but-no-edit-description":"You can still move or delete this item, but it cannot be edited since the schema definition for its type is nowhere to be found.",/** Error label for toast when array could not resolve the initial value */"inputs.array.error.cannot-resolve-initial-value-title":"Unable to resolve initial value for type: {{schemaTypeTitle}}: {{errorMessage}}.",/** Error label for toast when trying to upload one array item of a type that cannot be converted to array */"inputs.array.error.cannot-upload-unable-to-convert_one":"The following item can't be uploaded because there's no known conversion from content type to array item:",/** Error label for toast when trying to upload multiple array items of a type that cannot be converted to array */"inputs.array.error.cannot-upload-unable-to-convert_other":"The following items can't be uploaded because there's no known conversion from content types to array item:",/** Error description for the array item tooltip that explains that the current type item is not valid for the list  */"inputs.array.error.current-schema-not-declare-description":"The current schema does not declare items of type <code>{{typeName}}</code> as valid for this list. This could mean that the type has been removed as a valid item type, or that someone else has added it to their own local schema that is not yet deployed.",/** Error description to show how the item is being represented in the json format */"inputs.array.error.json-representation-description":"JSON representation of this item:",/** Error description for the array item tooltip that explains what the error means with more context */"inputs.array.error.type-is-incompatible-prompt":"Item of type <code>{{typeName}}</code> not valid for this list",/** Error title for when an item type within an array input is incompatible, used in the tooltip */"inputs.array.error.type-is-incompatible-title":"Why is this happening?",/** Error label for unexpected errors in the Array Input */"inputs.array.error.unexpected-error":"Unexpected Error: {{error}}",/** Label for when the array input doesn't have any items */"inputs.array.no-items-label":"No items",/** Label for read only array fields */"inputs.array.read-only-label":"This field is read-only",/** Label for when the array input is resolving the initial value for the item */"inputs.array.resolving-initial-value":"Resolving initial value\u2026",/** Placeholder value for datetime input */"inputs.datetime.placeholder":"e.g. {{example}}",/** Acessibility label for button to open file options menu */"inputs.file.actions-menu.file-options.aria-label":"Open file options menu",/** Browse */"inputs.file.browse-button.text":"Browse",/** Select file */"inputs.file.dialog.title":"Select file",/** Unknown member kind: `{{kind}}` */"inputs.file.error.unknown-member-kind":"Unknown member kind: {{kind}}",/** The value of this field is not a valid file. Resetting this field will let you choose a new file. */"inputs.file.invalid-file-warning.description":"The value of this field is not a valid file. Resetting this field will let you choose a new file.",/** Reset value */"inputs.file.invalid-file-warning.reset-button.text":"Reset value",/** Invalid file value */"inputs.file.invalid-file-warning.title":"Invalid file value",/** Select */"inputs.file.multi-browse-button.text":"Select",/** The upload could not be completed at this time. */"inputs.file.upload-failed.description":"The upload could not be completed at this time.",/** Upload failed */"inputs.file.upload-failed.title":"Upload failed",/** Clear field */"inputs.files.common.actions-menu.clear-field.label":"Clear field",/** Copy URL */"inputs.files.common.actions-menu.copy-url.label":"Copy URL",/** Download */"inputs.files.common.actions-menu.download.label":"Download",/** The URL is copied to the clipboard */"inputs.files.common.actions-menu.notification.url-copied":"The URL is copied to the clipboard",/** Replace */"inputs.files.common.actions-menu.replace.label":"Replace",/** Upload */"inputs.files.common.actions-menu.upload.label":"Upload",/** Drop to upload */"inputs.files.common.drop-message.drop-to-upload":"Drop to upload",/** Drop to upload `{{count}}` file */"inputs.files.common.drop-message.drop-to-upload-multi_one":"Drop to upload {{count}} file",/** Drop to upload `{{count}}` files */"inputs.files.common.drop-message.drop-to-upload-multi_other":"Drop to upload {{count}} files",/** Can't upload this file here */"inputs.files.common.drop-message.drop-to-upload.no-accepted-file-message_one":"Can't upload this file here",/** Can't upload any of these files here */"inputs.files.common.drop-message.drop-to-upload.no-accepted-file-message_other":"Can't upload any of these files here",/** `{{count}}` file can't be uploaded here */"inputs.files.common.drop-message.drop-to-upload.rejected-file-message_one":"{{count}} file can't be uploaded here",/** `{{count}}` files can't be uploaded here */"inputs.files.common.drop-message.drop-to-upload.rejected-file-message_other":"{{count}} files can't be uploaded here",/** Cannot upload `{{count}}` files */"inputs.files.common.placeholder.cannot-upload-some-files_one":"Cannot upload file","inputs.files.common.placeholder.cannot-upload-some-files_other":"Cannot upload {{count}} files",/** Drag or paste type here */"inputs.files.common.placeholder.drag-or-paste-to-upload_file":"Drag or paste file here",/** Drag or paste image here */"inputs.files.common.placeholder.drag-or-paste-to-upload_image":"Drag or paste image here",/** Drop to upload file */"inputs.files.common.placeholder.drop-to-upload_file":"Drop to upload file",/** Drop to upload image */"inputs.files.common.placeholder.drop-to-upload_image":"Drop to upload image",/** Read only */"inputs.files.common.placeholder.read-only":"Read only",/** Can't upload files here */"inputs.files.common.placeholder.upload-not-supported":"Can't upload files here",/** Clear upload */"inputs.files.common.stale-upload-warning.clear":"Clear upload",/** An upload has made no progress for at least `{{staleThresholdMinutes}}` minutes and likely got interrupted. You can safely clear the incomplete upload and try uploading again. */"inputs.files.common.stale-upload-warning.description":"An upload has made no progress for at least {{staleThresholdMinutes}} minutes and likely got interrupted. You can safely clear the incomplete upload and try uploading again.",/** Incomplete upload */"inputs.files.common.stale-upload-warning.title":"Incomplete upload",/** Tooltip text for action to crop image */"inputs.image.actions-menu.crop-image-tooltip":"Crop image",/** Accessibility label for button to open image edit dialog */"inputs.image.actions-menu.edit-details.aria-label":"Open image edit dialog",/** Accessibility label for button to open image options menu */"inputs.image.actions-menu.options.aria-label":"Open image options menu",/** Select */"inputs.image.browse-menu.text":"Select",/** Cannot upload this file here */"inputs.image.drag-overlay.cannot-upload-here":"Cannot upload this file here",/** Drop image to upload */"inputs.image.drag-overlay.drop-to-upload-image":"Drop image to upload",/** This field is read only */"inputs.image.drag-overlay.this-field-is-read-only":"This field is read only",/** Unknown member kind: `{{kind}}` */"inputs.image.error.unknown-member-kind":"Unknown member kind: {{kind}}",/** Edit hotspot and crop */"inputs.image.hotspot-dialog.title":"Edit hotspot and crop",/** The value of this field is not a valid image. Resetting this field will let you choose a new image. */"inputs.image.invalid-image-warning.description":"The value of this field is not a valid image. Resetting this field will let you choose a new image.",/** Reset value */"inputs.image.invalid-image-warning.reset-button.text":"Reset value",/** Invalid image value */"inputs.image.invalid-image-warning.title":"Invalid image value",/** Preview of uploaded image */"inputs.image.preview-uploaded-image":"Preview of uploaded image",/** The upload could not be completed at this time. */"inputs.image.upload-error.description":"The upload could not be completed at this time.",/** Upload failed */"inputs.image.upload-error.title":"Upload failed",/** Adjust the rectangle to crop image. Adjust the circle to specify the area that should always be visible. */"inputs.imagetool.description":"Adjust the rectangle to crop image. Adjust the circle to specify the area that should always be visible.",/** Error: `{{errorMessage}}` */"inputs.imagetool.load-error":"Error: {{errorMessage}}",/** Hotspot & Crop */"inputs.imagetool.title":"Hotspot & Crop",/** Convert to `{{targetType}}` */"inputs.invalid-value.convert-button.text":"Convert to {{targetType}}",/** The current value (<code>`{{actualType}}`</code>) */"inputs.invalid-value.current-type":"The current value (<code>{{actualType}}</code>)",/** The property value is stored as a value type that does not match the expected type. */"inputs.invalid-value.description":"The property value is stored as a value type that does not match the expected type.",/** The value of this property must be of type <code>`{{validType}}`</code> according to the schema. */"inputs.invalid-value.details.description":"The value of this property must be of type <code>{{validType}}</code> according to the schema.",/** Only the following types are valid here according to schema: */"inputs.invalid-value.details.multi-type-description":"Only the following types are valid here according to schema:",/** Mismatching value types typically occur when the schema has recently been changed. */"inputs.invalid-value.details.possible-reason":"Mismatching value types typically occur when the schema has recently been changed.",/** Developer info */"inputs.invalid-value.details.title":"Developer info",/** -- Invalid Value Input -- */ /** Reset value */"inputs.invalid-value.reset-button.text":"Reset value",/** Invalid property value */"inputs.invalid-value.title":"Invalid property value",/** Field groups */"inputs.object.field-group-tabs.aria-label":"Field groups",/** Read-only field description */"inputs.object.unknown-fields.read-only.description":"This field is <strong>read only</strong> according to the document\u2019s schema and cannot be unset. If you want to be able to unset this in Studio, make sure you remove the <code>readOnly</code> field from the enclosing type in the schema.",/** Remove field */"inputs.object.unknown-fields.remove-field-button.text":"Remove field",/** Encountered `{{count}}` fields that are not defined in the schema. */"inputs.object.unknown-fields.warning.description_one":"Encountered a field that is not defined in the schema.","inputs.object.unknown-fields.warning.description_other":"Encountered {{count}} fields that are not defined in the schema.",/** Detailed description of unknown field warning */"inputs.object.unknown-fields.warning.details.description_one":"This field is not defined in the schema, which could mean that the field definition has been removed or that someone else has added it to their own local project and have not deployed their changes yet.","inputs.object.unknown-fields.warning.details.description_other":"These fields are not defined in the document\u2019s schema, which could mean that the field definitions have been removed or that someone else has added them to their own local project and have not deployed their changes yet.",/** Developer info */"inputs.object.unknown-fields.warning.details.title":"Developer info",/** Unknown field found */"inputs.object.unknown-fields.warning.title_one":"Unknown field found","inputs.object.unknown-fields.warning.title_other":"Unknown fields found",/** Collapse the editor to save screen space  */"inputs.portable-text.action.collapse-editor":"Collapse editor",/** Aria label for action to edit an existing annotation */"inputs.portable-text.action.edit-annotation-aria-label":"Edit annotation",/** Expand the editor to give more editing space */"inputs.portable-text.action.expand-editor":"Expand editor",/** Label label for action to insert a block of a given type (`{{typeName}}`) */"inputs.portable-text.action.insert-block":"Insert {{typeName}}",/** Accessibility label for action to insert a block of a given type (`{{typeName}}`) */"inputs.portable-text.action.insert-block-aria-label":"Insert {{typeName}} (block)",/** Label for action to insert an inline object of a given type (`{{typeName}}`) */"inputs.portable-text.action.insert-inline-object":"Insert {{typeName}}",/** Accessibility label for action to insert an inline object of a given type (`{{typeName}}`) */"inputs.portable-text.action.insert-inline-object-aria-label":"Insert {{typeName}} (inline)",/** Aria label for action to remove an annotation */"inputs.portable-text.action.remove-annotation-aria-label":"Remove annotation",/** Label for activate on focus with context of click and not focused */"inputs.portable-text.activate-on-focus-message_click":"Click to activate",/** Label for activate on focus with context of click and focused */"inputs.portable-text.activate-on-focus-message_click-focused":"Click or press space to activate",/** Label for activate on focus with context of tap and not focused */"inputs.portable-text.activate-on-focus-message_tap":"Tap to activate",/**Aria label for the annotation object */"inputs.portable-text.annotation-aria-label":"Annotation object",/** Title for dialog that allows editing an annotation */"inputs.portable-text.annotation-editor.title":"Edit {{schemaType}}",/** Title of the default "link" annotation */"inputs.portable-text.annotation.link":"Link",/**Aria label for the block object */"inputs.portable-text.block.aria-label":"Block object",/** Label for action to edit a block item, in the case where it is editable */"inputs.portable-text.block.edit":"Edit",/** Accessibility label for the button that opens the actions menu on blocks */"inputs.portable-text.block.open-menu-aria-label":"Open menu",/** Label for action to open a reference, in the case of block-level reference types */"inputs.portable-text.block.open-reference":"Open reference",/** Label for action to remove a block item */"inputs.portable-text.block.remove":"Remove",/** Label for action to view a block item, in the case where it is read-only and thus cannot be edited */"inputs.portable-text.block.view":"View",/** Title of the "code" decorator */"inputs.portable-text.decorator.code":"Code",/** Title of the "em" (emphasis) decorator */"inputs.portable-text.decorator.emphasis":"Italic",/** Title of the "strike-through" decorator */"inputs.portable-text.decorator.strike-through":"Strike",/** Title of the "strong" decorator */"inputs.portable-text.decorator.strong":"Strong",/** Title of the "underline" decorator */"inputs.portable-text.decorator.underline":"Underline",/** Placeholder text for when the editor is empty */"inputs.portable-text.empty-placeholder":"Empty",/**Aria label for the block object */"inputs.portable-text.inline-block.aria-label":"Inline object",/** Label for action to edit an inline object item */"inputs.portable-text.inline-object.edit":"Edit object",/** Aria label for icon for action to edit an inline object item */"inputs.portable-text.inline-object.edit-aria-label":"Edit object",/** Label for action to remove an inline object item */"inputs.portable-text.inline-object.remove":"Remove object",/** Aria label for icon for action to remove an inline object item */"inputs.portable-text.inline-object.remove-aria-label":"Remove object",/** Disclaimer text shown on invalid Portable Text value, when an action is available to unblock the user, but it is not guaranteed to be safe */"inputs.portable-text.invalid-value.action-disclaimer":"NOTE: It\u2019s generally safe to perform the action above, but if you are in doubt, get in touch with those responsible for configuring your studio.",/** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` has a child with key `{{childKey}}` of type `{{childType}}` which is not allowed by the schema definition */"inputs.portable-text.invalid-value.disallowed-child-type.action":"Remove the object",/** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` has a child with key `{{childKey}}` of type `{{childType}}` which is not allowed by the schema definition */"inputs.portable-text.invalid-value.disallowed-child-type.description":"Child with key {{childKey}} of block with key <code>{{key}}</code> is of type <code>{{childType}}</code>, which is not allowed by the schema.",/** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` has a type (`{{typeName}}`) that is not an allowed block type for this field */"inputs.portable-text.invalid-value.disallowed-type.action":"Remove the block",/** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` has a type (`{{typeName}}`) that is not an allowed block type for this field */"inputs.portable-text.invalid-value.disallowed-type.description":"Block with key <code>{{key}}</code> is of type <code>{{typeName}}</code>, which is not allowed by the schema.",/** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` contains no children */"inputs.portable-text.invalid-value.empty-children.action":"Insert empty text span",/** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` contains no children */"inputs.portable-text.invalid-value.empty-children.description":"Text block with key <code>{{key}}</code> has no text spans.",/** Label for the button to ignore invalid values in the Portable Text editor */"inputs.portable-text.invalid-value.ignore-button.text":"Ignore",/** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` has a `_type` property that is set to `block`, but the block type defined in schema has a different name (`{{expectedTypeName}}`) */"inputs.portable-text.invalid-value.incorrect-block-type.action":"Use type <code>{{expectedTypeName}}</code>",/** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` has a `_type` property that is set to `block`, but the block type defined in schema has a different name (`{{expectedTypeName}}`) */"inputs.portable-text.invalid-value.incorrect-block-type.description":"Block with key <code>{{key}}</code> has an invalid type name. According to the schema, it should be <code>{{expectedTypeName}}</code>.",/** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` has a span with key `{{childKey}}` that has a missing or invalid `text` property */"inputs.portable-text.invalid-value.invalid-span-text.action":"Set empty text value",/** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` has a span with key `{{childKey}}` that has a missing or invalid `text` property */"inputs.portable-text.invalid-value.invalid-span-text.description":"Span with key {{childKey}} of block with key <code>{{key}}</code> has a missing or invalid <code>text</code> property.",/** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` is missing a `_type` property, but seems to be a block of type `{{expectedTypeName}}` */"inputs.portable-text.invalid-value.missing-block-type.action":"Use type <code>{{expectedTypeName}}</code>",/** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` is missing a `_type` property, but seems to be a block of type `{{expectedTypeName}}` */"inputs.portable-text.invalid-value.missing-block-type.description":"Block with key <code>{{key}}</code> is missing a type name. According to the schema, it should be <code>{{expectedTypeName}}</code>.",/** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` has a child at `{{index}}` which is missing `_key` property */"inputs.portable-text.invalid-value.missing-child-key.action":"Assign random key",/** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` has a child at `{{index}}` which is missing `_key` property */"inputs.portable-text.invalid-value.missing-child-key.description":"Child at index <code>{{index}}</code> of block with key <code>{{key}}</code> is missing <code>_key</code> property.",/** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` has a child with key `{{childKey}}` which is missing a `_type` property */"inputs.portable-text.invalid-value.missing-child-type.action":"Remove the object",/** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` has a child with key `{{childKey}}` which is missing a `_type` property */"inputs.portable-text.invalid-value.missing-child-type.description":"Child with key {{childKey}} of block with key <code>{{key}}</code> is missing <code>_type</code> property.",/** Action presented when the Portable Text field value is invalid, when child at `{{index}}` is missing the required `_key` property */"inputs.portable-text.invalid-value.missing-key.action":"Assign random key",/** Text explaining that the Portable Text field value is invalid, when child at `{{index}}` is missing the required `_key` property */"inputs.portable-text.invalid-value.missing-key.description":"Block at index <code>{{index}}</code> is missing required <code>_key</code> property.",/** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` has a missing or invalid `children` property */"inputs.portable-text.invalid-value.missing-or-invalid-children.action":"Remove the block",/** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` has a missing or invalid `children` property */"inputs.portable-text.invalid-value.missing-or-invalid-children.description":"Text block with key <code>{{key}}</code> has an invalid or missing `children` property.",/** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` has a missing or invalid `markDefs` property */"inputs.portable-text.invalid-value.missing-or-invalid-markdefs.action":"Add property",/** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` has a missing or invalid `markDefs` property */"inputs.portable-text.invalid-value.missing-or-invalid-markdefs.description":"Text block with key <code>{{key}}</code> has an invalid or missing `markDefs` property.",/** Action presented when the Portable Text field value is invalid, when child with key `{{key}}` is missing a `_type` property  */"inputs.portable-text.invalid-value.missing-type.action":"Remove the block",/** Text explaining that the Portable Text field value is invalid, when child with key `{{key}}` is missing a `_type` property  */"inputs.portable-text.invalid-value.missing-type.description":"Block with key <code>{{key}}</code> is missing a type name.",/** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` contains a non-object child at index `{{index}}` */"inputs.portable-text.invalid-value.non-object-child.action":"Remove the item",/** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` contains a non-object child at index `{{index}}` */"inputs.portable-text.invalid-value.non-object-child.description":"Child at index <code>{{index}}</code> of block with key <code>{{key}}</code> is not an object.",/** Action presented when the Portable Text field value is invalid, when the Portable Text field is not an array, or the array is empty */"inputs.portable-text.invalid-value.not-an-array.action":"Unset the value",/** Text explaining that the Portable Text field value is invalid, when the Portable Text field is not an array, or the array is empty */"inputs.portable-text.invalid-value.not-an-array.description":"Value must be an array of Portable Text blocks, or undefined.",/** Action presented when the Portable Text field value is invalid, when child at `{{index}}` is not an object */"inputs.portable-text.invalid-value.not-an-object.action":"Remove item",/** Text explaining that the Portable Text field value is invalid, when child at `{{index}}` is not an object */"inputs.portable-text.invalid-value.not-an-object.description":"Item at <code>{{index}}</code> is not an object,.",/** Action presented when the Portable Text field value is invalid, when block with key `{{key}}` contains marks (`{{orphanedMarks}}`) that are not supported by the current schema */"inputs.portable-text.invalid-value.orphaned-marks.action":"Remove disallowed marks",/** Text explaining that the Portable Text field value is invalid, when block with key `{{key}}` contains marks (`{{orphanedMarks}}`) that are not supported by the current schema */"inputs.portable-text.invalid-value.orphaned-marks.description":"Text block with key <code>{{key}}</code> contains marks <code>({{orphanedMarks, list}})</code> that are not allowed by the schema.",/** Title for the alert indicating that the Portable Text field has an invalid value */"inputs.portable-text.invalid-value.title":"Invalid Portable Text value",/** Title of "bulleted" list type */"inputs.portable-text.list-type.bullet":"Bulleted list",/** Title of numbered list type */"inputs.portable-text.list-type.number":"Numbered list",/** Title of the "h1" block style */"inputs.portable-text.style.h1":"Heading 1",/** Title of the "h2" block style */"inputs.portable-text.style.h2":"Heading 2",/** Title of the "h3" block style */"inputs.portable-text.style.h3":"Heading 3",/** Title of the "h4" block style */"inputs.portable-text.style.h4":"Heading 4",/** Title of the "h5" block style */"inputs.portable-text.style.h5":"Heading 5",/** Title of the "h6" block style */"inputs.portable-text.style.h6":"Heading 6",/** Title shown when multiple blocks of varying styles is selected */"inputs.portable-text.style.multiple":"Multiple",/** Title of fallback when no style is given for a block */"inputs.portable-text.style.none":"No style",/** Title of the "normal" block style */"inputs.portable-text.style.normal":"Normal",/** Title of the "quote" block style */"inputs.portable-text.style.quote":"Quote",/** Label for action to clear the current value of the reference field */"inputs.reference.action.clear":"Clear",/** Label for action to create a new document from the reference input */"inputs.reference.action.create-new-document":"Create",/** Label for action to create a new document from the reference input, when there are multiple templates or document types to choose from */"inputs.reference.action.create-new-document-select":"Create\u2026",/** Label for action to duplicate the current item to a new item (used within arrays) */"inputs.reference.action.duplicate":"Duplicate",/** Label for action that opens the referenced document in a new tab */"inputs.reference.action.open-in-new-tab":"Open in new tab",/** Label for action to remove the reference from an array */"inputs.reference.action.remove":"Remove",/** Label for action to replace the current value of the field */"inputs.reference.action.replace":"Replace",/** Label for action to cancel a previously initiated replace action  */"inputs.reference.action.replace-cancel":"Cancel replace",/** The cross-dataset reference field currently has a reference, but the feature has been disabled since it was created. This explains what can/cannot be done in its current state. */"inputs.reference.cross-dataset.feature-disabled-actions":"You can still clear this field's existing reference, but it cannot be changed to a different document as long as the feature is disabled.",/** A cross-dataset reference field exists but the feature has been disabled. A <DocumentationLink> component is available. */"inputs.reference.cross-dataset.feature-disabled-description":"This feature has been disabled. Read how to enable it in <DocumentationLink>the documentation</DocumentationLink>.",/** Title for a warning telling the user that the current project does not have the "cross dataset references" feature */"inputs.reference.cross-dataset.feature-unavailable-title":"Unavailable feature: Cross dataset reference",/** The cross-dataset reference points to a document with an invalid type  */"inputs.reference.cross-dataset.invalid-type":"The referenced document is of invalid type ({{typeName}}) <JsonValue/>",/** The referenced document will open in a new tab (due to external studio) */"inputs.reference.document-opens-in-new-tab":"This document opens in a new tab",/** Error title for when the document is unavailable (for any possible reason) */"inputs.reference.error.document-unavailable-title":"Document unavailable",/** Error title for when the referenced document failed to be loaded */"inputs.reference.error.failed-to-load-document-title":"Failed to load referenced document",/** Error title for when the reference search returned a document that is not an allowed type for the field */"inputs.reference.error.invalid-search-result-type-title":'Search returned a type that\'s not valid for this reference: "{{returnedType}}"',/** Error description for when the document referenced is not one of the types declared as allowed target types in schema */"inputs.reference.error.invalid-type-description":"Referenced document (<code>{{documentId}}</code>) is of type <code>{{actualType}}</code>. According to the schema, referenced documents can only be of type <AllowedTypes />.",/** Error title for when the document referenced is not one of the types declared as allowed target types in schema */"inputs.reference.error.invalid-type-title":"Document of invalid type",/** Error description for when the user does not have permissions to read the referenced document */"inputs.reference.error.missing-read-permissions-description":"The referenced document could not be accessed due to insufficient permissions",/** Error title for when the user does not have permissions to read the referenced document */"inputs.reference.error.missing-read-permissions-title":"Insufficient permissions",/** Error description for when the current reference value points to a document that does not exist (on weak references) */"inputs.reference.error.nonexistent-document-description":"The referenced document does not exist (ID: <code>{{documentId}}</code>). You can either remove the reference or replace it with another document.",/** Error title for when the current reference value points to a document that does not exist (on weak references) */"inputs.reference.error.nonexistent-document-title":"Not found",/** Label for button that clears the reference when it points to a document that does not exist (on weak references) */"inputs.reference.error.nonexistent-document.clear-button-label":"Clear",/** Error title for when the search for a reference failed. Note that the message sent by the backend may not be localized. */"inputs.reference.error.search-failed-title":"Reference search failed",/** Alternative text for the image shown in cross-dataset reference input */"inputs.reference.image-preview-alt-text":"Image preview of referenced document",/** Description for alert shown when a reference in a live-edit document is marked as being weak, the referenced document exists, AND the reference is supposed to be have been strengthened on publish */"inputs.reference.incomplete-reference.finalize-action-description":"<strong>{{referencedDocument}}</strong> is published and this reference should now be finalized.",/** Title for alert shown when a reference in a live-edit document is marked as being weak, the referenced document exists, AND the reference is supposed to be have been strengthened on publish */"inputs.reference.incomplete-reference.finalize-action-title":"Finalize reference",/** Description for alert shown when a reference in a live-edit document points to a document that exists and has been published, but the reference is still marked as weak */"inputs.reference.incomplete-reference.strengthen-action-description":"<strong>{{referencedDocument}}</strong> is published and this reference should now be converted to a strong reference.",/** Title for alert shown when a reference in a live-edit document points to a document that exists and has been published, but the reference is still marked as weak */"inputs.reference.incomplete-reference.strengthen-action-title":"Convert to strong reference",/** Label for button that triggers the action that strengthen a reference */"inputs.reference.incomplete-reference.strengthen-button-label":"Convert to strong reference",/** Label for button that triggers a retry attempt for reference metadata  */"inputs.reference.metadata-error.retry-button-label":"Retry",/** Title for alert shown when reference metadata fails to be loaded */"inputs.reference.metadata-error.title":"Unable to load reference metadata",/** Message shown when no documents were found that matched the given search string */"inputs.reference.no-results-for-query":"No results for <strong>\u201C{{searchTerm}}\u201D</strong>",/** Text for tooltip showing when a document was edited, using relative time (eg "how long ago was it edited?") */"inputs.reference.preview.edited-at-time":"Edited <RelativeTime/>",/** Accessibility label for icon indicating that document does _not_ have any unpublished changes */"inputs.reference.preview.has-no-unpublished-changes-aria-label":"No unpublished edits",/** Accessibility label for icon indicating that document has unpublished changes */"inputs.reference.preview.has-unpublished-changes-aria-label":"Edited",/** Accessibility label for icon indicating that document does _not_ have a published version */"inputs.reference.preview.is-not-published-aria-label":"Not published",/** Accessibility label for icon indicating that document has a published version */"inputs.reference.preview.is-published-aria-label":"Published",/** Text for tooltip indicating that a document has no unpublished edits */"inputs.reference.preview.no-unpublished-edits":"No unpublished edits",/** Text for tooltip indicating that a document has not yet been published */"inputs.reference.preview.not-published":"Not published",/** Text for tooltip showing when a document was published, using relative time (eg "how long ago was it published?") */"inputs.reference.preview.published-at-time":"Published <RelativeTime/>",/** The referenced document no longer exist and might have been deleted (for weak references) */"inputs.reference.referenced-document-does-not-exist":"The referenced document no longer exist and might have been deleted (document ID: <code>{{documentId}}</code>).",/** The referenced document could not be displayed to the user because of insufficient permissions */"inputs.reference.referenced-document-insufficient-permissions":"The referenced document could not be accessed due to insufficient permissions",/** Label for when the reference input is resolving the initial value for an item */"inputs.reference.resolving-initial-value":"Resolving initial value\u2026",/** Placeholder shown in a reference input with no current value */"inputs.reference.search-placeholder":"Type to search",/** Explanation of the consequences of leaving the reference as strong instead of weak */"inputs.reference.strength-mismatch.is-strong-consquences":"It will not be possible to delete the reference document without first removing this reference or converting it to weak.",/** Description for alert shown when a reference is supposed to be weak, but the actual value is strong */"inputs.reference.strength-mismatch.is-strong-description":"This reference is <em>strong</em>, but according to the current schema it should be <em>weak</em>.",/** Explanation of the consequences of leaving the reference as weak instead of strong */"inputs.reference.strength-mismatch.is-weak-consquences":"This makes it possible to delete the referenced document without first deleting this reference, leaving this field referencing a nonexisting document.",/** Description for alert shown when a reference is supposed to be strong, but the actual value is weak */"inputs.reference.strength-mismatch.is-weak-description":"This reference is <em>weak</em>, but according to the current schema it should be <em>strong</em>.",/** Label for button that triggers the action that strengthens a reference on strength mismatch */"inputs.reference.strength-mismatch.strengthen-button-label":"Convert to strong reference",/** Title for alert shown when a reference is supposed to be weak/strong, but the actual value is the opposite of what it is supposed to be */"inputs.reference.strength-mismatch.title":"Reference strength mismatch",/** Label for button that triggers the action that weakens a reference on strength mismatch */"inputs.reference.strength-mismatch.weaken-button-label":"Convert to weak reference",/** Action message for generating the slug */"inputs.slug.action.generate":"Generate",/** Loading message for when the input is actively generating a slug */"inputs.slug.action.generating":"Generating\u2026",/** Error message for when the source to generate a slug from is missing */"inputs.slug.error.missing-source":"Source is missing. Check source on type {{schemaType}} in schema",/** Placeholder for an empty tag input */"inputs.tags.placeholder":"Enter tag and press ENTER\u2026",/** Placeholder for an empty tag input on touch devices */"inputs.tags.placeholder_touch":"Enter tag\u2026",/** Convert to `{{targetType}}` */"inputs.untyped-value.convert-button.text":"Convert to {{targetType}}",/** Encountered an object value without a <code>_type</code> property. */"inputs.untyped-value.description":"Encountered an object value without a <code>_type</code> property.",/** Either remove the <code>name</code> property of the object declaration, or set <code>_type</code> property on items. */"inputs.untyped-value.details.description":"Either remove the <code>name</code> property of the object declaration, or set <code>_type</code> property on items.",/** Current value (<code>object</code>): */"inputs.untyped-value.details.json-dump-prefix":"Current value (<code>object</code>):",/** The following types are valid here according to schema: */"inputs.untyped-value.details.multi-type-description":"The following types are valid here according to schema:",/** Developer info */"inputs.untyped-value.details.title":"Developer info",/** Property value missing <code>_type</code> */"inputs.untyped-value.title":"Property value missing <code>_type</code>",/** Unset value */"inputs.untyped-value.unset-item-button.text":"Unset value",/** The fallback explanation if no context is provided */"insufficient-permissions-message.not-authorized-explanation":"You do not have permission to access this feature.",/** The explanation when unable to create any document at all */"insufficient-permissions-message.not-authorized-explanation_create-any-document":"You do not have permission to create a document.",/** The explanation when unable to create a particular document */"insufficient-permissions-message.not-authorized-explanation_create-document":"You do not have permission to create this document.",/** The explanation when unable to create a particular type of document */"insufficient-permissions-message.not-authorized-explanation_create-document-type":"You do not have permission to create this kind of document.",/** The explanation when unable to create a new reference in a document */"insufficient-permissions-message.not-authorized-explanation_create-new-reference":"You do not have permission to create a new reference.",/** The explanation when unable to delete a particular document */"insufficient-permissions-message.not-authorized-explanation_delete-document":"You do not have permission to delete this document.",/** The explanation when unable to discard changes in a particular document */"insufficient-permissions-message.not-authorized-explanation_discard-changes":"You do not have permission to discard changes in this document.",/** The explanation when unable to duplicate a particular document */"insufficient-permissions-message.not-authorized-explanation_duplicate-document":"You do not have permission to duplicate this document.",/** The explanation when unable to publish a particular document */"insufficient-permissions-message.not-authorized-explanation_publish-document":"You do not have permission to publish this document.",/** The explanation when unable to unpublish a particular document */"insufficient-permissions-message.not-authorized-explanation_unpublish-document":"You do not have permission to unpublish this document.",/** Appears after the not-authorized message. Lists the current roles. */"insufficient-permissions-message.roles":"Your roles: <Roles/>",/** The title for the insufficient permissions message component */"insufficient-permissions-message.title":"Insufficient permissions",/** Unexpected error: `{{error}}` */"member-field-error.unexpected-error":"Unexpected error: {{error}}",/** Button label for "Create new document" button */"new-document.button":"Create",/**
   * Tooltip message displayed when hovering/activating the "Create new document" action,
   * when there are templates/types available for creation
   */"new-document.create-new-document-label":"New document\u2026",/** Placeholder for the "filter" input within the new document menu */"new-document.filter-placeholder":"Filter",/** Loading indicator text within the new document menu */"new-document.loading":"Loading\u2026",/** Accessibility label for the list displaying options in the new document menu */"new-document.new-document-aria-label":"New document",/** Message for when there are no document type options in the new document menu */"new-document.no-document-types-found":"No document types found",/**
   * Tooltip message displayed when hovering/activating the "Create new document" action,
   * when there are no templates/types to create from
   */"new-document.no-document-types-label":"No document types",/** Message for when no results are found for a specific search query in the new document menu */"new-document.no-results":"No results for <strong>{{searchQuery}}</strong>",/** Aria label for the button that opens the "Create new document" popover/dialog */"new-document.open-dialog-aria-label":"Create new document",/** Title for "Create new document" dialog */"new-document.title":"Create new document",/** Label for action to manage members of the current studio project */"presence.action.manage-members":"Manage members",/** Accessibility label for presence menu button */"presence.aria-label":"Global presence",/** Message description for when no one else is currently present */"presence.no-one-else-description":"Invite people to the project to see their online status.",/** Message title for when no one else is currently present */"presence.no-one-else-title":"No one else is here",/** Message for when a user is not in a document (displayed in the global presence menu) */"presence.not-in-a-document":"Not in a document",/** Tooltip content text for presence menu button */"presence.tooltip-content":"Who is here",/** Fallback title shown when a preview does not provide a title */"preview.default.title-fallback":"Untitled",/** Fallback preview value for types that have "no value" (eg null, undefined) */"preview.fallback.no-value":"(no value)",/** Alternative text for image being shown while image is being uploaded, in previews */"preview.image.file-is-being-uploaded.alt-text":"The image currently being uploaded",/* Relative time, just now */"relative-time.just-now":"just now",/** Accessibility label to open search action when the search would go fullscreen (eg on narrower screens) */"search.action-open-aria-label":"Open search",/** Action label for adding a search filter */"search.action.add-filter":"Add filter",/** Action label for clearing search filters */"search.action.clear-filters":"Clear filters",/** Label for action to clear recent searches */"search.action.clear-recent-searches":"Clear recent searches",/** Accessibility label for action to clear all currently applied document type filters */"search.action.clear-type-filters-aria-label":"Clear checked filters",/** Label for action to clear all currently applied document type filters */"search.action.clear-type-filters-label":"Clear",/** Accessibility label for when the search is full screen (on narrow screens) and you want to close the search */"search.action.close-search-aria-label":"Close search",/** Accessibility label for filtering by document type */"search.action.filter-by-document-type-aria-label":"Filter by document type",/** Accessibility action label for removing an already applied search filter */"search.action.remove-filter-aria-label":"Remove filter",/**
   * Text displayed when either no document type(s) have been selected, or we need a fallback,
   * eg "Search for all types".
   */"search.action.search-all-types":"Search all documents",/**
   * Text displayed when we are able to determine one or more document types that will be used for
   * searching, and can fit within the space assigned by the design.
   */"search.action.search-specific-types":"Search for {{types, list}}",/**
   * Text displayed when we are able to determine one or more document types that will be used for
   * searching, but cannot list them all within the space assigned by the design, so we need an
   * additional "and X more" suffix. Allows using pluralization suffixes, eg `_one`, `_other` etc.
   */"search.action.search-specific-types-truncated":"Search for {{types, list}} +{{count}} more",/** Dialog title for action to select an asset of unknown type */"search.action.select-asset":"Select asset",/** Dialog title for action to select a file asset */"search.action.select-asset_file":"Select file",/** Dialog title for action to select an image asset */"search.action.select-asset_image":"Select image",/** Accessibility label for when the search is full screen (on narrow screens) and you want to hide filters */"search.action.toggle-filters-aria-label_hide":"Hide filters",/** Accessibility label for when the search is full screen (on narrow screens) and you want to show filters */"search.action.toggle-filters-aria-label_show":"Show filters",/** Label for when the search is full screen (on narrow screens) and you want to hide filters */"search.action.toggle-filters-label_hide":"Hide filters",/** Label for when the search is full screen (on narrow screens) and you want to show filters */"search.action.toggle-filters-label_show":"Show filters",/** Tooltip text for the global search button */"search.button.tooltip":"Search",/**
   * A list of provided types (use `list` formatter preferably).
   */"search.document-type-list":"{{types, list}}",/**
   * In the context of a list of document types - no filtering selection has been done,
   * thus the default is "all types".
   */"search.document-type-list-all-types":"All types",/**
   * A list of provided types that has been truncated - more types are included but not displayed,
   * thus we need to indicate that there are more. Allows using pluralization suffixes,
   * eg `_one`, `_other` etc.
   */"search.document-type-list-truncated":"{{types, list}} +{{count}} more",/** Accessibility label for list displaying the available document types */"search.document-types-aria-label":"Document types",/** Label for when no document types matching the filter are found */"search.document-types-no-matches-found":"No matches for {{filter}}",/** Description for error when a filter cannot be displayed, describes that you should check the schema */"search.error.display-filter-description":"This may indicate invalid options defined in your schema.",/** Title for error when a filter cannot be displayed (mainly a developer-oriented error) */"search.error.display-filter-title":"An error occurred whilst displaying this filter.",/** Description for error when no valid asset source is found, describes that you should check the the current studio config */"search.error.no-valid-asset-source-check-config-description":"Please ensure it's enabled in your studio configuration file.",/** Description for error when no valid asset source is found, describes that only the default asset is supported */"search.error.no-valid-asset-source-only-default-description":"Currently, only the default asset source is supported.",/** Title for error when no valid asset sources found */"search.error.no-valid-asset-source-title":"No valid asset sources found.",/** Helpful description for when search returned an error that we are not able to describe in detail */"search.error.unspecified-error-help-description":"Please try again or check your connection",/** Title label for when search returned an error that we are not able to describe in detail */"search.error.unspecified-error-title":"Something went wrong while searching",/**
   * Label for "All fields", a label that appears above the list of available fields when filtering.
   * If one or more document type has been chosen as filter, this label is replaced with a group of
   * fields per selected document type
   */"search.filter-all-fields-header":"All fields",/** Label for the action of changing from one file to a different file in asset search filter */"search.filter-asset-change_file":"Change file",/** Label for the action of changing from one image to a different image in asset search filter */"search.filter-asset-change_image":"Change image",/** Label for the action of clearing the currently selected asset in an image/file filter */"search.filter-asset-clear":"Clear",/** Label for the action of selecting a file in asset search filter */"search.filter-asset-select_file":"Select file",/** Label for the action of selecting an image in asset search filter */"search.filter-asset-select_image":"Select image",/** Label for boolean filter - false */"search.filter-boolean-false":"False",/** Label for boolean filter - true */"search.filter-boolean-true":"True",/** Accessibility label for list that lets you filter fields by title, when adding a new filter in search */"search.filter-by-title-aria-label":"Filter by title",/** Accessibility label for date filter input */"search.filter-date-aria-label":"Date",/** Accessibility label for selecting end date on the date range search filter */"search.filter-date-range-end-date-aria-label":"End date",/** Accessibility label for selecting start date on the date range search filter */"search.filter-date-range-start-date-aria-label":"Start date",/** Accessibility label for selecting the unit (day/month/year) when adding "X days ago" search filter */"search.filter-date-unit-aria-label":"Select unit",/**
   * Label for "Days"/"Months"/"Years" when selecting it as unit in "X days ago" search filter.
   * Capitalized, as it would be listed in a dropdown.
   */"search.filter-date-unit_days":"Days","search.filter-date-unit_months":"Months","search.filter-date-unit_years":"Years",/** Accessibility label for the input value (days/months/years) when adding "X days ago" search filter */"search.filter-date-value-aria-label":"Unit value",/** Label for "field description" shown in tooltip when navigating list of possible fields to filter */"search.filter-field-tooltip-description":"Field description",/** Label for "field name" shown in tooltip when navigating list of possible fields to filter */"search.filter-field-tooltip-name":"Field name",/** Label for "Used in document types", a list of the document types a field appears in. Shown in tooltip when navigating list of possible fields to filter */"search.filter-field-tooltip-used-in-document-types":"Used in document types",/** Label for when no fields/filters are found for the given term */"search.filter-no-matches-found":"No matches for {{filter}}",/** Placeholder value for maximum numeric value filter */"search.filter-number-max-value-placeholder":"Max value",/** Placeholder value for minimum numeric value filter */"search.filter-number-min-value-placeholder":"Min value",/** Placeholder value for the number filter */"search.filter-number-value-placeholder":"Value",/** Placeholder for the "Filter" input, when narrowing possible fields/filters */"search.filter-placeholder":"Filter",/** Label for the action of clearing the currently selected document in a reference filter */"search.filter-reference-clear":"Clear",/**
   * Label for "shared fields", a label that appears above a list of fields that all filtered types
   * have in common, when adding a new filter. For instance, if "book" and "employee" both have a
   * "title" field, this field would be listed under "shared fields".
   * */"search.filter-shared-fields-header":"Shared fields",/** Placeholder value for the string filter */"search.filter-string-value-placeholder":"Value",/** Label/placeholder prompting user to select one of the predefined, allowed values for a string field */"search.filter-string-value-select-predefined-value":"Select\u2026",/** Accessibility label for the "Filters" list, that is shown when using "Add filter" in search (singular) */"search.filters-aria-label_one":"Filter",/** Accessibility label for the "Filters" list, that is shown when using "Add filter" in search (plural) */"search.filters-aria-label_other":"Filters",/** Label for instructions on how to use the search - displayed when no recent searches are available */"search.instructions":"Use <ControlsIcon/> to refine your search",/** Helpful description for when no search results are found */"search.no-results-help-description":"Try another keyword or adjust your filters",/** Title label for when no search results are found */"search.no-results-title":"No results found",/**
   * Individual search operators.
   *
   * The `name` variant is the form we use when the user is building a query, and selecting from a
   * list of available operators for a field. Keep in mind that since the user knows what the field
   * represents, we do not need to contextualize too much, and that the user may not be a developer
   * eg prefer "quantity is" over "array has length". Additionally, (if applicable in language) use
   * lowercased names.
   *
   * The `description` variant is the form shown once the filter has enough information to apply,
   * and is shown in the list of applied filters. It is passed components that _should_ be used to
   * compose the filter string, and to format them correctly:
   *
   * `<Field/>` - eg "Bird species", "Category", "Date of birth"
   * `<Operator>operator text</Operator>` - eg "has ", "includes", "is"
   * `<Value>{{value}}</Value>` - eg "Hawk", "Sparrow", "Eagle"
   *
   * Where applicable, a `count` is passed, allowing you to pluralize where needed, by using
   * suffixes such as `_zero`, `_one`, `_other` etc.
   *
   * Prefer (reasonable) brevity since many filters may be applied. For instance:
   * `<Field/> has  <Value/>` may be better than
   * `<Field/> has less than or equal to <Value/>`
   **/ /* Array should have a count the given filter value */"search.operator.array-count-equal.description_one":"<Field/> <Operator>has</Operator> <Value>{{count}} item</Value>","search.operator.array-count-equal.description_other":"<Field/> <Operator>has</Operator> <Value>{{count}} items</Value>","search.operator.array-count-equal.name":"quantity is",/* Array should have a count greater than given filter value */"search.operator.array-count-gt.description_one":"<Field/> <Operator>has ></Operator> <Value>{{count}} item</Value>","search.operator.array-count-gt.description_other":"<Field/> <Operator>has ></Operator> <Value>{{count}} items</Value>","search.operator.array-count-gt.name":"quantity greater than",/* Array should have a count greater than or equal to the given filter value */"search.operator.array-count-gte.description_one":"<Field/> <Operator>has \u2265</Operator> <Value>{{count}} item</Value>","search.operator.array-count-gte.description_other":"<Field/> <Operator>has \u2265</Operator> <Value>{{count}} items</Value>","search.operator.array-count-gte.name":"quantity greater than or equal to",/* Array should have a count less than given filter value */"search.operator.array-count-lt.description_one":"<Field/> <Operator>has <</Operator> <Value>{{count}} item</Value>","search.operator.array-count-lt.description_other":"<Field/> <Operator>has <</Operator> <Value>{{count}} items</Value>","search.operator.array-count-lt.name":"quantity less than",/* Array should have a count less than or equal to the given filter value */"search.operator.array-count-lte.description_one":"<Field/> <Operator>has \u2264</Operator> <Value>{{count}} item</Value>","search.operator.array-count-lte.description_other":"<Field/> <Operator>has \u2264</Operator> <Value>{{count}} items</Value>","search.operator.array-count-lte.name":"quantity less than or equal to",/* Array should have a count that is not equal to the given filter value */"search.operator.array-count-not-equal.description_one":"<Field/> <Operator>does not have</Operator> <Value>{{count}} item</Value>","search.operator.array-count-not-equal.description_other":"<Field/> <Operator>does not have</Operator> <Value>{{count}} items</Value>","search.operator.array-count-not-equal.name":"quantity is not",/**
   * Array should have a count within the range of given filter values.
   * Gets passed `{{from}}` and `{{to}}` values.
   **/"search.operator.array-count-range.description":"<Field/> <Operator>has between</Operator> <Value>{{from}} \u2192 {{to}} items</Value>","search.operator.array-count-range.name":"quantity is between",/* Array should include the given value */"search.operator.array-list-includes.description":"<Field/> <Operator>includes</Operator> <Value>{{value}}</Value>","search.operator.array-list-includes.name":"includes",/* Array should not include the given value */"search.operator.array-list-not-includes.description":"<Field/> <Operator>does not include</Operator> <Value>{{value}}</Value>","search.operator.array-list-not-includes.name":"does not include",/* Array should include the given reference */"search.operator.array-reference-includes.description":"<Field/> <Operator>includes</Operator> <Value>{{value}}</Value>","search.operator.array-reference-includes.name":"includes",/* Array should not include the given reference */"search.operator.array-reference-not-includes.description":"<Field/> <Operator>does not include</Operator> <Value>{{value}}</Value>","search.operator.array-reference-not-includes.name":"does not include",/* Asset (file) should be the selected asset */"search.operator.asset-file-equal.description":"<Field/> <Operator>is</Operator> <Value>{{value}}</Value>","search.operator.asset-file-equal.name":"is",/* Asset (file) should not be the selected asset */"search.operator.asset-file-not-equal.description":"<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>","search.operator.asset-file-not-equal.name":"is not",/* Asset (image) should be the selected asset */"search.operator.asset-image-equal.description":"<Field/> <Operator>is</Operator> <Value>{{value}}</Value>","search.operator.asset-image-equal.name":"is",/* Asset (image) should not be the selected asset */"search.operator.asset-image-not-equal.description":"<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>","search.operator.asset-image-not-equal.name":"is not",/**
   * Boolean value should be the given filter value (true/false).
   * Context passed is `true` and `false`, allowing for more specific translations:
   * - `search.operator.boolean-equal.description_true`
   * - `search.operator.boolean-equal.description_false`
   */"search.operator.boolean-equal.description":"<Field/> <Operator>is</Operator> <Value>{{value}}</Value>","search.operator.boolean-equal.name":"is",/* Date should be after (later than) given filter value */"search.operator.date-after.description":"<Field/> <Operator>is after</Operator> <Value>{{value}}</Value>","search.operator.date-after.name":"after",/* Date should be before (earlier than) given filter value */"search.operator.date-before.description":"<Field/> <Operator>is before</Operator> <Value>{{value}}</Value>","search.operator.date-before.name":"before",/* Date should be the given filter value */"search.operator.date-equal.description":"<Field/> <Operator>is</Operator> <Value>{{value}}</Value>","search.operator.date-equal.name":"is",/* Date should be within the given filter value range (eg "within the last X days") */"search.operator.date-last.description":"<Field/> <Operator>is in the last</Operator> <Value>{{value}}</Value>","search.operator.date-last.name":"last",/* Date should not be the given filter value */"search.operator.date-not-equal.description":"<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>","search.operator.date-not-equal.name":"is not",/* Date should be within the range of given filter values */"search.operator.date-range.description":"<Field/> <Operator>is between</Operator> <Value/>","search.operator.date-range.name":"is between",/* Date and time should be after (later than) given filter value */"search.operator.date-time-after.description":"<Field/> <Operator>is after</Operator> <Value>{{value}}</Value>","search.operator.date-time-after.name":"after",/* Date and time should be before (earlier than) given filter value */"search.operator.date-time-before.description":"<Field/> <Operator>is before</Operator> <Value>{{value}}</Value>","search.operator.date-time-before.name":"before",/* Date and time should be the given filter value */"search.operator.date-time-equal.description":"<Field/> <Operator>is</Operator> <Value>{{value}}</Value>","search.operator.date-time-equal.name":"is",/* Date and time should be within the given filter value range (eg "within the last X days") */"search.operator.date-time-last.description":"<Field/> <Operator>is in the last</Operator> <Value>{{value}}</Value>","search.operator.date-time-last.name":"last",/* Date and time should not be the given filter value */"search.operator.date-time-not-equal.description":"<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>","search.operator.date-time-not-equal.name":"is not",/* Date and time should be within the range of given filter values */"search.operator.date-time-range.description":"<Field/> <Operator>is between</Operator> <Value/>","search.operator.date-time-range.name":"is between",/* Value should be defined */"search.operator.defined.description":"<Field/> <Operator>is</Operator> <Value>not empty</Value>","search.operator.defined.name":"not empty",/* Value should not be defined */"search.operator.not-defined.description":"<Field/> <Operator>is</Operator> <Value>empty</Value>","search.operator.not-defined.name":"empty",/* Number should be the given filter value */"search.operator.number-equal.description":"<Field/> <Operator>is</Operator> <Value>{{value}}</Value>","search.operator.number-equal.name":"is",/* Number should be greater than given filter value */"search.operator.number-gt.description":"<Field/> <Operator>></Operator> <Value>{{value}}</Value>","search.operator.number-gt.name":"greater than",/* Number should be greater than or the given filter value */"search.operator.number-gte.description":"<Field/> <Operator>\u2265</Operator> <Value>{{value}}</Value>","search.operator.number-gte.name":"greater than or equal to",/* Number should be less than given filter value */"search.operator.number-lt.description":"<Field/> <Operator><</Operator> <Value>{{value}}</Value>","search.operator.number-lt.name":"less than",/* Number should be less than or the given filter value */"search.operator.number-lte.description":"<Field/> <Operator>\u2264</Operator> <Value>{{value}}</Value>","search.operator.number-lte.name":"less than or equal to",/* Number should not be the given filter value */"search.operator.number-not-equal.description":"<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>","search.operator.number-not-equal.name":"is not",/* Number should be within the range of given filter values */"search.operator.number-range.description":"<Field/> <Operator>is between</Operator> <Value>{{from}} \u2192 {{to}}</Value>","search.operator.number-range.name":"is between",/* Portable Text should contain the given filter value */"search.operator.portable-text-contains.description":"<Field/> <Operator>contains</Operator> <Value>{{value}}</Value>","search.operator.portable-text-contains.name":"contains",/* Portable Text should be the given filter value */"search.operator.portable-text-equal.description":"<Field/> <Operator>is</Operator> <Value>{{value}}</Value>","search.operator.portable-text-equal.name":"is",/* Portable Text should not contain the given filter value */"search.operator.portable-text-not-contains.description":"<Field/> <Operator>does not contain</Operator> <Value>{{value}}</Value>","search.operator.portable-text-not-contains.name":"does not contain",/* Portable Text should not be the given filter value */"search.operator.portable-text-not-equal.description":"<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>","search.operator.portable-text-not-equal.name":"is not",/* References the given asset (file) */"search.operator.reference-asset-file.description":"<Field/> <Operator>\u2192</Operator> <Value>{{value}}</Value>","search.operator.reference-asset-file.name":"file",/* References the given asset (image) */"search.operator.reference-asset-image.description":"<Field/> <Operator>\u2192</Operator> <Value>{{value}}</Value>","search.operator.reference-asset-image.name":"image",/* References the given document */"search.operator.reference-document.description":"<Field/> <Operator>\u2192</Operator> <Value>{{value}}</Value>","search.operator.reference-document.name":"document",/* Reference should be the given document */"search.operator.reference-equal.description":"<Field/> <Operator>is</Operator> <Value>{{value}}</Value>","search.operator.reference-equal.name":"is",/* Reference should not be the given document */"search.operator.reference-not-equal.description":"<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>","search.operator.reference-not-equal.name":"is not",/* Slug contains the given value */"search.operator.slug-contains.description":"<Field/> <Operator>contains</Operator> <Value>{{value}}</Value>","search.operator.slug-contains.name":"contains",/* Slug equals the given filter value */"search.operator.slug-equal.description":"<Field/> <Operator>is</Operator> <Value>{{value}}</Value>","search.operator.slug-equal.name":"is",/* Slug does not contain the given value */"search.operator.slug-not-contains.description":"<Field/> <Operator>does not contain</Operator> <Value>{{value}}</Value>","search.operator.slug-not-contains.name":"does not contain",/* Slug does not equal the given filter value */"search.operator.slug-not-equal.description":"<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>","search.operator.slug-not-equal.name":"is not",/* String contains the given filter value */"search.operator.string-contains.description":"<Field/> <Operator>contains</Operator> <Value>{{value}}</Value>","search.operator.string-contains.name":"contains",/* String equals the given filter value */"search.operator.string-equal.description":"<Field/> <Operator>is</Operator> <Value>{{value}}</Value>","search.operator.string-equal.name":"is",/* String equals one of the predefined allowed values */"search.operator.string-list-equal.description":"<Field/> <Operator>is</Operator> <Value>{{value}}</Value>","search.operator.string-list-equal.name":"is",/* String does not equal one of the predefined allowed values */"search.operator.string-list-not-equal.description":"<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>","search.operator.string-list-not-equal.name":"is not",/* String does not contain the given filter value */"search.operator.string-not-contains.description":"<Field/> <Operator>does not contain</Operator> <Value>{{value}}</Value>","search.operator.string-not-contains.name":"does not contain",/* String does not equal the given filter value */"search.operator.string-not-equal.description":"<Field/> <Operator>is not</Operator> <Value>{{value}}</Value>","search.operator.string-not-equal.name":"is not",/** Label for the "Best match" search ordering type */"search.ordering.best-match-label":"Best match",/** Label for the "Created: Oldest first" search ordering type */"search.ordering.created-ascending-label":"Created: Oldest first",/** Label for the "Created: Newest first" search ordering type */"search.ordering.created-descending-label":"Created: Newest first",/** Label for the "Updated: Oldest first" search ordering type */"search.ordering.updated-ascending-label":"Updated: Oldest first",/** Label for the "Updated: Newest first" search ordering type */"search.ordering.updated-descending-label":"Updated: Newest first",/** Placeholder text for the global search input field */"search.placeholder":"Search",/** Accessibility label for the recent searches section, shown when no valid search terms has been given */"search.recent-searches-aria-label":"Recent searches",/** Label/heading shown for the recent searches section */"search.recent-searches-label":"Recent searches",/** Accessibility label for the search results section, shown when the user has typed valid terms */"search.search-results-aria-label":"Search results",/** Accessibility label for the navbar status button */"status-button.aria-label":"Configuration status",/** Description for error when the timeline for the given document can't be loaded */"timeline.error.load-document-changes-description":"Document history transactions have not been affected.",/** Title for error when the timeline for the given document can't be loaded */"timeline.error.load-document-changes-title":"An error occurred whilst retrieving document changes.",/** Error description for when the document doesn't have history */"timeline.error.no-document-history-description":"When changing the content of the document, the document versions will appear in this menu.",/** Error title for when the document doesn't have history */"timeline.error.no-document-history-title":"No document history",/** Error prompt when revision cannot be loaded */"timeline.error.unable-to-load-revision":"Unable to load revision",/** Label for when the timeline item is the latest in the history */"timeline.latest":"Latest",/** Label for latest version for timeline menu dropdown */"timeline.latest-version":"Latest version",/** The aria-label for the list of revisions in the timeline */"timeline.list.aria-label":"Document revisions",/** Label for loading history */"timeline.loading-history":"Loading history\u2026",/** Label shown in review changes timeline when a document has been created */"timeline.operation.created":"Created",/** Label shown in review changes timeline when a document was initially created */"timeline.operation.created-initial":"Created",/** Label shown in review changes timeline when a document was initially created, with a timestamp */"timeline.operation.created-initial_timestamp":"Created: {{timestamp, datetime}}",/** Label shown in review changes timeline when a document has been created, with a timestamp */"timeline.operation.created_timestamp":"Created: {{timestamp, datetime}}",/** Label shown in review changes timeline when a document has been deleted */"timeline.operation.deleted":"Deleted",/** Label shown in review changes timeline when a document has been deleted, with a timestamp */"timeline.operation.deleted_timestamp":"Deleted: {{timestamp, datetime}}",/** Label shown in review changes timeline when a draft has been discarded */"timeline.operation.draft-discarded":"Discarded draft",/** Label shown in review changes timeline when a draft has been discarded, with a timestamp */"timeline.operation.draft-discarded_timestamp":"Discarded draft: {{timestamp, datetime}}",/** Label shown in review changes timeline when a draft has been edited */"timeline.operation.edited-draft":"Edited",/** Label shown in review changes timeline when a draft has been edited, with a timestamp */"timeline.operation.edited-draft_timestamp":"Edited: {{timestamp, datetime}}",/** Label shown in review changes timeline when a document has been edited live */"timeline.operation.edited-live":"Live edited",/** Label shown in review changes timeline when a document has been edited live, with a timestamp */"timeline.operation.edited-live_timestamp":"Live edited: {{timestamp, datetime}}",/** Label shown in review changes timeline when a document was published */"timeline.operation.published":"Published",/** Label shown in review changes timeline when a document was published, with a timestamp */"timeline.operation.published_timestamp":"Published: {{timestamp, datetime}}",/** Label shown in review changes timeline when a document was unpublished */"timeline.operation.unpublished":"Unpublished",/** Label shown in review changes timeline when a document was unpublished, with a timestamp */"timeline.operation.unpublished_timestamp":"Unpublished: {{timestamp, datetime}}",/**
   * Label for determining since which version the changes for timeline menu dropdown are showing.
   * Receives the time label as a parameter (`timestamp`).
   */"timeline.since":"Since: {{timestamp, datetime}}",/** Label for missing change version for timeline menu dropdown are showing */"timeline.since-version-missing":"Since: unknown version",/**Aria label for the action buttons in the PTE toolbar */"toolbar.portable-text.action-button-aria-label":"{{action}}",/** Label for the button showed after trial ended */"user-menu.action.free-trial-finished":"Upgrade from free",/** Label for button showing the free trial days left */"user-menu.action.free-trial_one":"{{count}} day left in trial","user-menu.action.free-trial_other":"{{count}} days left in trial",/** Label for action to invite members to the current sanity project */"user-menu.action.invite-members":"Invite members",/** Accessibility label for action to invite members to the current sanity project */"user-menu.action.invite-members-aria-label":"Invite members",/** Label for action to manage the current sanity project */"user-menu.action.manage-project":"Manage project",/** Accessibility label for the action to manage the current project */"user-menu.action.manage-project-aria-label":"Manage project",/** Tooltip helper text when portable text annotation is disabled for empty block*/"user-menu.action.portable-text.annotation-disabled_empty-block":"Cannot apply {{name}} to empty block",/** Tooltip helper text when portable text annotation is disabled for multiple blocks */"user-menu.action.portable-text.annotation-disabled_multiple-blocks":"Cannot apply {{name}} to multiple blocks",/** Label for action to sign out of the current sanity project */"user-menu.action.sign-out":"Sign out",/** Title for appearance section for the current studio (dark / light / system scheme) */"user-menu.appearance-title":"Appearance",/** Label for close menu button for user menu */"user-menu.close-menu":"Close menu",/** Description for using the "dark theme" in the appearance user menu */"user-menu.color-scheme.dark-description":"Use dark appearance",/** Title for using the "dark theme" in the appearance user menu */"user-menu.color-scheme.dark-title":"Dark",/** Description for using the "light theme" in the appearance user menu */"user-menu.color-scheme.light-description":"Use light appearance",/** Title for using the "light theme" in the appearance user menu */"user-menu.color-scheme.light-title":"Light",/** Description for using "system apparence" in the appearance user menu */"user-menu.color-scheme.system-description":"Use system appearance",/** Title for using system apparence in the appearance user menu */"user-menu.color-scheme.system-title":"System",/** Title for locale section for the current studio */"user-menu.locale-title":"Language",/** Label for tooltip to show which provider the currently logged in user is using */"user-menu.login-provider":"Signed in with {{providerTitle}}",/** Label for open menu button for user menu */"user-menu.open-menu":"Open menu",/**
   * Label for action to add a workspace (currently a developer-oriented action, as this will
   * lead to the documentation on workspace configuration)
   */"workspaces.action.add-workspace":"Add workspace",/**
   * Label for action to choose a different workspace, in the case where you are not logged in,
   * have selected a workspace, and are faced with the authentication options for the selected
   * workspace. In other words, label for the action shown when you have reconsidered which
   * workspace to authenticate in.
   */"workspaces.action.choose-another-workspace":"Choose another workspace",/** Label for heading that indicates that you can choose your workspace */"workspaces.choose-your-workspace-label":"Choose your workspace",/** Label for the workspace menu */"workspaces.select-workspace-aria-label":"Select workspace",/** Button label for opening the workspace switcher */"workspaces.select-workspace-label":"Select workspace",/** Tooltip for the workspace menu */"workspaces.select-workspace-tooltip":"Select workspace",/** Title for Workplaces dropdown menu */"workspaces.title":"Workspaces"});const studioDefaultLocaleResources=defineLocaleResourceBundle({locale:"en-US",namespace:studioLocaleNamespace,resources:studioLocaleStrings});const validationLocaleStrings=defineLocalesResources("validation",{/** Array must have exactly "$wantedLength" items, but has more/less */"array.exact-length":"Must have exactly {{wantedLength}} items",/** Portable Text array must have exactly "$wantedLength" blocks, but has more/less */"array.exact-length_blocks":"Must have exactly {{wantedLength}} blocks",/** Array item is a duplicate, but array wants only unique items */"array.item-duplicate":"Can't be a duplicate",/** Array has more than the maximum of "$maxLength" items */"array.maximum-length":"Must have at most {{maxLength}} items",/** Portable Text array has more than the maximum of "$maxLength" items */"array.maximum-length_blocks":"Must have at most {{maxLength}} blocks",/** Array has less than the minimum of "$minLength" items */"array.minimum-length":"Must have at least {{minLength}} items",/** Portable Text array has less than the minimum of "$minLength" blocks */"array.minimum-length_blocks":"Must have at least {{minLength}} blocks",/** Date is not valid or not in the correct format (ISO-8601) */"date.invalid-format":"Must be a valid ISO-8601 formatted date string",/** Date is later than the given maximum date "$maxDate" */"date.maximum":"Must be at or before {{maxDate}}",/** Date is earlier than the given minimum date "$minDate" */"date.minimum":"Must be at or after {{minDate}}",/** A value of incorrect type is found, eg found `number` instead of `string` */"generic.incorrect-type":'Expected type "{{expectedType}}", got "{{actualType}}"',/** Value is not one of the values specifically allowed */"generic.not-allowed":"Value did not match any allowed values",/** Value "$givenValue" is not one of the values specifically allowed */"generic.not-allowed_hint":'Value "{{hint}}" did not match any allowed values',/** A value is expected, but none is provided */"generic.required":"Required",/** Number is less than the given minimum threshold value "$threshold" */"number.greater-than":"Must be greater than {{threshold}}",/** Number is greater than the given maximum threshold value "$threshold" */"number.less-than":"Must be less than {{threshold}}",/** Number is higher than the given maximum value "$maxNumber" */"number.maximum":"Must be lower than or equal to {{maxNumber}}",/** Number has more precision (decimals) than the allowed "$limit" */"number.maximum-precision":"Max precision is {{limit}}",/** Number is lower than the given minimum value "$minNumber" */"number.minimum":"Must be greater than or equal to {{minNumber}}",/** Number is not an integer ("whole number") */"number.non-integer":"Must be an integer",/** Object is missing a reference to an asset document in its `asset` field */"object.asset-required":"Asset is required",/** Object is missing a reference to a file asset document in its `asset` field */"object.asset-required_file":"File is required",/** Object is missing a reference to an image asset document in its `asset` field */"object.asset-required_image":"Image is required",/** Object is not a reference to a document (eg `{_ref: 'documentId'}`) */"object.not-reference":"Must be a reference to a document",/** Object references a document which is not published */"object.reference-not-published":"Referenced document must be published",/** Accessibility label for closing the validation panel */"panel.close-button-aria-label":"Close validation",/** Message shown when the validation panel is opened but there are no errors/warnings */"panel.no-errors-message":"No validation errors",/** Title for the actual "Validation" panel/feature */"panel.title":"Validation",/** Slug is an object, but is missing a `current` string property */"slug.missing-current":"Slug must have a value",/** Slug is not an object (eg `{current: 'some-slug'}`) */"slug.not-object":"Slug must be an object",/** Slug is already in use somewhere else, but needs to be unique */"slug.not-unique":"Slug is already in use",/** String is not a valid email address */"string.email":"Must be a valid email address",/** String has a different character length than the exact number "$wantedLength" */"string.exact-length":"Must be exactly {{wantedLength}} characters long",/** String contains characters that are not in lowercase  */"string.lowercase":"Must be all lowercase characters",/** String is longer than the limit of "$maxLength" characters */"string.maximum-length":"Must be at most {{maxLength}} characters long",/** String is shorter than the limit of "$minLength" characters */"string.minimum-length":"Must be at least {{minLength}} characters long",/** String does not match the given regular expression, but should */"string.regex-does-not-match":'Does not match "{{name}}"-pattern',/** String matches the given regular expression, but should not */"string.regex-match":'Should not match "{{name}}"-pattern',/** String contains characters that are not in uppercase */"string.uppercase":"Must be all uppercase characters",/** String contains a protocol/scheme that is not allowed, eg (`ftp`, `mailto`) */"string.url.disallowed-scheme":"Does not match allowed protocols/schemes",/** String contains a URL with a username or password specified before the host */"string.url.includes-credentials":"Username/password not allowed",/** String is not a valid URL */"string.url.invalid":"Not a valid URL",/** String is not an absolute URL (eg it is missing a protocol/host) */"string.url.not-absolute":"Relative URLs are not allowed",/** String is not a relative URL (eg it contains a protocol/host) */"string.url.not-relative":"Only relative URLs are allowed"});const validationLocaleResources=defineLocaleResourceBundle({locale:"en-US",namespace:validationLocaleNamespace,resources:validationLocaleStrings});const usEnglishLocale=defineLocale({id:"en-US",title:"English (US)",bundles:[studioDefaultLocaleResources,validationLocaleResources],weekInfo:{firstDay:7,// Sunday
weekend:[6,7],// Saturday, Sunday
minimalDays:1}});const defaultLocale=usEnglishLocale;const supportsLocalStorage=(()=>{const key="__tmp_supports_local_storage";try{if(typeof localStorage==="undefined"){return false;}localStorage.setItem(key,"---");localStorage.removeItem(key);return true;}catch(err){return false;}})();const LOCAL_STORAGE_PREFIX="sanity-locale";function getPreferredLocale(projectId,sourceId){if(!supportsLocalStorage){return void 0;}const locale=localStorage.getItem(getItemKey$1(projectId,sourceId));return locale!=null?locale:void 0;}function storePreferredLocale(projectId,sourceId,locale){if(!supportsLocalStorage){return;}localStorage.setItem(getItemKey$1(projectId,sourceId),locale);}function getItemKey$1(projectId,sourceId){return[LOCAL_STORAGE_PREFIX,projectId,sourceId].join(":");}function LocaleProvider(props){const{projectId,name:sourceId,i18n:{locales},__internal:{i18next}}=useSource();return/* @__PURE__ */jsxRuntime.jsx(LocaleProviderBase,{...props,projectId,sourceId,locales,i18next});}function LocaleProviderBase(_ref23){let{projectId,sourceId,locales,i18next,children}=_ref23;const subscribe=React.useCallback(callback=>{i18next.on("languageChanged",callback);return()=>i18next.off("languageChanged",callback);},[i18next]);const currentLocale=React.useSyncExternalStore(subscribe,()=>locales.find(candidate=>i18next.language===candidate.id)||defaultLocale);const context=React.useMemo(()=>({locales,currentLocale,__internal:{i18next},changeLocale:async newLocale=>{storePreferredLocale(projectId,sourceId,newLocale);await i18next.changeLanguage(newLocale);}}),[currentLocale,i18next,locales,projectId,sourceId]);return/* @__PURE__ */jsxRuntime.jsx(React.Suspense,{fallback:/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{}),children:/* @__PURE__ */jsxRuntime.jsx(reactI18next.I18nextProvider,{i18n:i18next,children:/* @__PURE__ */jsxRuntime.jsx(LocaleContext.Provider,{value:context,children},currentLocale.id)})});}function useGetI18nText(input){const items=Array.isArray(input)?input:[input];const stableNamespaces=JSON.stringify(items.flatMap(item=>(item==null?void 0:item.i18n)?Object.values(item.i18n).map(_ref24=>{let{ns}=_ref24;return ns;}):[]).filter(isNonNullable$2).sort());const namespaces=React.useMemo(()=>JSON.parse(stableNamespaces),[stableNamespaces]);const{t}=useTranslation(namespaces);return React.useCallback(function getI18nText(node){const{i18n}=node;if(!i18n)return node;return new Proxy(node,{get:(target,property)=>{const defaultValue=target[property];if(typeof property==="string"&&property in i18n){const{key,ns}=i18n[property];return t(key,{ns,// `defaultValue` is a special key in the i18next `t` API that
// allows us to provide a fallback value if no translation is found
// using the given key and namespace. if the value on the node
// is a string, then we'll use that as the fallback value
...(typeof defaultValue==="string"&&{defaultValue})});}return defaultValue;}});},[t]);}function useI18nText(node){const namespaces=React.useMemo(()=>{if(!node.i18n)return[];return Array.from(new Set(Object.values(node.i18n).map(_ref25=>{let{ns}=_ref25;return ns;}))).sort();},[node.i18n]);const{t}=useTranslation(namespaces);return React.useMemo(()=>{const{i18n}=node;if(!i18n)return node;return new Proxy(node,{get:(target,property)=>{const defaultValue=target[property];if(typeof property==="string"&&property in i18n){const{key,ns}=i18n[property];return t(key,{ns,// `defaultValue` is a special key in the i18next `t` API that
// allows us to provide a fallback value if no translation is found
// using the given key and namespace. if the value on the node
// is a string, then we'll use that as the fallback value
...(typeof defaultValue==="string"&&{defaultValue})});}return defaultValue;}});},[node,t]);}function useCurrentLocale(){return useLocale().currentLocale;}function useLocale(){const context=React.useContext(LocaleContext);if(!context){throw new Error("Sanity LocaleContext value missing. Is this hook being used outside LocaleContext.Provider?");}return context;}const OPEN_TAG_RE=/^<(?<tag>[^\s\d<][^/?><]+)\/?>/;const CLOSE_TAG_RE=/<\/(?<tag>[^>]+)>/;const SELF_CLOSING_RE=/<[^>]+\/>/;const VALID_COMPONENT_NAME_RE=/^[A-Z][A-Za-z0-9]+$/;const VALID_HTML_TAG_NAME_RE=/^[a-z]+$/;const TEMPLATE_RE=/{{\s*?([^}]+)\s*?}}/g;function simpleParser(input){const tokens=[];let text="";let openTag="";let remainder=input;while(remainder.length>0){if(!openTag&&remainder[0]==="<"){const match=matchOpenTag(remainder);if(match){const tagName=match.groups.tag;validateTagName(tagName);if(text){tokens.push(...textTokenWithInterpolation(text));text="";}if(isSelfClosing(match[0])){tokens.push({type:"tagOpen",selfClosing:true,name:tagName});}else{tokens.push({type:"tagOpen",name:tagName});openTag=tagName;}remainder=remainder.substring(match[0].length);}else{text+=remainder[0];remainder=remainder.substring(1);}}else if(openTag&&remainder[0]==="<"&&remainder[1]!=="<"){const match=matchCloseTag(remainder);if(match){const tagName=match.groups.tag;if(remainder[1]!=="/"){throw new Error("Expected closing tag for <".concat(openTag,">, but found new opening tag <").concat(tagName,">. Nested tags is not supported."));}if(tagName!==openTag){throw new Error("Expected closing tag for <".concat(openTag,">, but found closing tag </").concat(tagName,"> instead. Make sure each opening tag has a matching closing tag."));}if(text){tokens.push(...textTokenWithInterpolation(text));text="";}tokens.push({type:"tagClose",name:tagName});openTag="";remainder=remainder.substring(match[0].length);}else{text+=remainder[0];remainder=remainder.substring(1);}}else{text+=remainder[0];remainder=remainder.substring(1);}}if(openTag){throw new Error("No matching closing tag for <".concat(openTag,'> found. Either make it self closing (e.g. "<').concat(openTag,'/>") or close it (e.g "<').concat(openTag,">...</").concat(openTag,'>").'));}if(text){tokens.push(...textTokenWithInterpolation(text));}return tokens;}function textTokenWithInterpolation(text){const tokens=[];const interpolations=text.matchAll(TEMPLATE_RE);let lastIndex=0;for(const match of interpolations){if(typeof match.index==="undefined"){continue;}const pre=text.slice(lastIndex,match.index);if(pre.length>0){tokens.push({type:"text",text:pre});}tokens.push(parseInterpolation(match[0]));lastIndex+=pre.length+match[0].length;}if(lastIndex<text.length){tokens.push({type:"text",text:text.slice(lastIndex)});}return tokens;}function parseInterpolation(interpolation){const variable=interpolation.replace(/^\{\{|\}\}$/g,"").trim();if(variable.includes(",")){throw new Error('Interpolations with formatters are not supported when using <Translate>. Found "'.concat(variable,'". Utilize "useTranslation" instead, or format the values passed to <Translate> ahead of time.'));}return{type:"interpolation",variable};}function isSelfClosing(tag){return SELF_CLOSING_RE.test(tag);}function matchOpenTag(input){return input.match(OPEN_TAG_RE);}function matchCloseTag(input){return input.match(CLOSE_TAG_RE);}function validateTagName(tagName){const isValidComponentName=VALID_COMPONENT_NAME_RE.test(tagName);if(isValidComponentName){return;}const isValidHtmlTagName=VALID_HTML_TAG_NAME_RE.test(tagName);if(isValidHtmlTagName){return;}throw new Error(tagName.trim()===tagName?'Invalid tag "<'.concat(tagName,'>". Tag names must be lowercase HTML tags or start with an uppercase letter and can only include letters and numbers.'):'Invalid tag "<'.concat(tagName,'>". No whitespace allowed in tags.'));}const COMPONENT_NAME_RE=/^[A-Z]/;const RECOGNIZED_HTML_TAGS=["abbr","address","cite","code","del","em","ins","kbd","q","samp","strong","sub","sup"];function Translate(props){const translated=props.t(props.i18nKey,{context:props.context,skipInterpolation:true,count:props.values&&"count"in props.values&&typeof props.values.count==="number"?props.values.count:void 0});const tokens=React.useMemo(()=>simpleParser(translated),[translated]);return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:render(tokens,props.values,props.components||{})});}function render(tokens,values,componentMap){const[head,...tail]=tokens;if(!head){return null;}if(head.type==="interpolation"){return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[!values||typeof values[head.variable]==="undefined"?"{{".concat(head.variable,"}}"):values[head.variable],render(tail,values,componentMap)]});}if(head.type==="text"){return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[head.text,render(tail,values,componentMap)]});}if(head.type==="tagOpen"&&head.selfClosing){const Component=componentMap[head.name];if(!Component){throw new Error("Component not found: ".concat(head.name));}return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(Component,{}),render(tail,values,componentMap)]});}if(head.type==="tagOpen"&&!head.selfClosing){const nextCloseIdx=tail.findIndex(token=>token.type==="tagClose");const nextClose=tail[nextCloseIdx];if(nextClose){if(head.name!==nextClose.name){throw new Error("Nested tags is not allowed");}}const Component=componentMap[head.name];if(!Component&&COMPONENT_NAME_RE.test(head.name)){throw new Error("Component not defined: ".concat(head.name));}if(!Component&&!RECOGNIZED_HTML_TAGS.includes(head.name)){throw new Error('HTML tag "'.concat(head.name,'" is not allowed'));}const children=tail.slice(0,nextCloseIdx);const remaining=tail.slice(nextCloseIdx+1);return Component?/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(Component,{children:render(children,values,componentMap)}),render(remaining,values,componentMap)]}):/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[React.createElement(head.name,{},render(children,values,componentMap)),render(remaining,values,componentMap)]});}return null;}const DEFAULT_STUDIO_CLIENT_OPTIONS={apiVersion:"2023-11-13"};function getSizeDiff(prev,next){if(!prev||!next){return 0;}const increase=next-prev;const pct=Math.round(increase/prev*100);return pct;}function getHumanFriendlyBytes(bytes,format){if(bytes<1e3){return format(bytes,"byte");}if(bytes<1e3*1e3){return format(bytes/1e3,"kilobyte");}if(bytes<1e3*1e3*1e3){return format(bytes/(1e3*1e3),"megabyte");}if(bytes<1e3*1e3*1e3*1e3){return format(bytes/(1e3*1e3*1e3),"gigabyte");}return format(bytes/(1e3*1e3*1e3*1e3),"terabyte");}const tryParse=(val,defValue)=>{try{return JSON.parse(val);}catch(err){console.warn("Failed to parse settings: ".concat(err.message));return defValue;}};const get$1=(key,defValue)=>{const val=localStorage.getItem(key);return rxjs.of(val===null?defValue:tryParse(val,defValue));};const set$2=(key,nextValue)=>{if(typeof nextValue==="undefined"||nextValue===null){localStorage.removeItem(key);}else{localStorage.setItem(key,JSON.stringify(nextValue));}return rxjs.of(nextValue);};const localStorageBackend={get:get$1,set:set$2};const DB=/* @__PURE__ */Object.create(null);const get=(key,defValue)=>rxjs.of(key in DB?DB[key]:defValue);const set$1=(key,nextValue)=>{if(typeof nextValue==="undefined"||nextValue===null){delete DB[key];}else{DB[key]=nextValue;}return rxjs.of(nextValue);};const memoryBackend={get,set:set$1};function resolveBackend(){return supportsLocalStorage?localStorageBackend:memoryBackend;}function createKeyValueStore(){const storageBackend=resolveBackend();const setKey$=new rxjs.Subject();const updates$=setKey$.pipe(operators.switchMap(event=>storageBackend.set(event.key,event.value).pipe(operators.map(nextValue=>({key:event.key,value:nextValue})))));const getKey=(key,defaultValue)=>{return rxjs.merge(storageBackend.get(key,defaultValue),updates$.pipe(operators.filter(update=>update.key===key),operators.map(update=>update.value)));};const setKey=(key,value)=>{setKey$.next({key,value});};return{getKey,setKey};}class CorsOriginError extends Error{constructor(_ref26){let{projectId}=_ref26;super("CorsOriginError");this.projectId=projectId;}}const memStore={};function setItem(key,value){if(supportsLocalStorage){localStorage[key]=value;}else{memStore[key]=value;}}function getItem(key){return supportsLocalStorage?localStorage[key]:memStore[key];}function removeItem(key){if(supportsLocalStorage){localStorage.removeItem(key);}else{delete memStore[key];}}function createBroadcastChannel(namespace){const storageEvents$=typeof window==="undefined"?rxjs.of():rxjs.fromEvent(window,"storage");const storageKey="__studio_local_storage_messaging_".concat(namespace);const broadcastedMessages$=new rxjs.Subject();const messages$=rxjs.merge(broadcastedMessages$,storageEvents$.pipe(operators.filter(event=>event.key===storageKey),operators.map(event=>event.newValue),operators.filter(isNonNullable$2),operators.map(newValue=>JSON.parse(newValue)))).pipe(// this is important to ensure all new subscribers get a message on subscribe
operators.shareReplay(1));function broadcast(message){try{setItem(storageKey,JSON.stringify(message));removeItem(storageKey);broadcastedMessages$.next(message);}catch(err){}}return{messages:messages$,broadcast};}var __freeze$2r=Object.freeze;var __defProp$2r=Object.defineProperty;var __template$2r=(cooked,raw)=>__freeze$2r(__defProp$2r(cooked,"raw",{value:__freeze$2r(raw||cooked.slice())}));var _a$2s,_b$13;const GithubRootSvg=styled__default.default.svg(_ref27=>{let{theme}=_ref27;const{fg}=theme.sanity.color.base;return styled.css(_a$2s||(_a$2s=__template$2r(["\n    fill: ",";\n  "])),fg);});const CustomImage=styled__default.default.img(_b$13||(_b$13=__template$2r(["\n  height: 19px;\n  width: 19px;\n  object-fit: contain;\n"])));const GithubLogo=()=>/* @__PURE__ */jsxRuntime.jsx(GithubRootSvg,{width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 438.55 438.55",children:/* @__PURE__ */jsxRuntime.jsx("path",{d:"M409.13 114.57a218.32 218.32 0 0 0-79.8-79.8Q278.94 5.36 219.27 5.36T109.21 34.77a218.29 218.29 0 0 0-79.8 79.8Q0 165 0 224.63q0 71.67 41.83 128.91t108.06 79.23q7.71 1.43 11.42-2a11.17 11.17 0 0 0 3.69-8.57q0-.86-.14-15.42t-.14-25.41l-6.57 1.14a83.77 83.77 0 0 1-15.85 1 120.73 120.73 0 0 1-19.84-2 44.34 44.34 0 0 1-19.11-8.51 36.23 36.23 0 0 1-12.56-17.6l-2.86-6.57a71.34 71.34 0 0 0-9-14.56q-6.14-8-12.42-10.85l-2-1.43a21 21 0 0 1-3.71-3.43 15.66 15.66 0 0 1-2.57-4q-.86-2 1.43-3.29C61.2 310.42 64 310 68 310l5.71.85q5.71 1.14 14.13 6.85a46.08 46.08 0 0 1 13.85 14.84q6.57 11.71 15.85 17.85t18.7 6.14a81.19 81.19 0 0 0 16.27-1.42 56.78 56.78 0 0 0 12.85-4.29q2.57-19.14 14-29.41a195.49 195.49 0 0 1-29.36-5.13 116.52 116.52 0 0 1-26.83-11.14 76.86 76.86 0 0 1-23-19.13q-9.14-11.42-15-30t-5.8-42.81q0-34.55 22.56-58.82-10.57-26 2-58.24 8.28-2.57 24.55 3.85t23.84 11q7.57 4.56 12.13 7.71a206.2 206.2 0 0 1 109.64 0l10.85-6.85a153.65 153.65 0 0 1 26.26-12.56q15.13-5.71 23.13-3.14 12.84 32.26 2.28 58.24 22.55 24.27 22.56 58.82 0 24.27-5.85 43t-15.12 30a79.82 79.82 0 0 1-23.13 19 116.74 116.74 0 0 1-26.84 11.14 195.29 195.29 0 0 1-29.23 5.07q14.8 12.84 14.81 40.58v60.2a11.37 11.37 0 0 0 3.57 8.56q3.57 3.42 11.28 2 66.24-22 108.07-79.23t41.83-128.91q-.03-59.62-29.43-110.05z"})});const GoogleLogo=()=>/* @__PURE__ */jsxRuntime.jsxs("svg",{width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",children:[/* @__PURE__ */jsxRuntime.jsx("path",{d:"M11 24a13 13 0 0 1 .66-4.08l-7.4-5.66a22.18 22.18 0 0 0 0 19.49l7.4-5.67A13 13 0 0 1 11 24z",fill:"#fbbc05"}),/* @__PURE__ */jsxRuntime.jsx("path",{d:"M24 11a12.72 12.72 0 0 1 8.1 2.9l6.4-6.4a22 22 0 0 0-34.24 6.75l7.4 5.66A13 13 0 0 1 24 11z",fill:"#ea4335"}),/* @__PURE__ */jsxRuntime.jsx("path",{d:"M24 37a13 13 0 0 1-12.34-8.92l-7.4 5.66A21.93 21.93 0 0 0 24 46a21 21 0 0 0 14.33-5.48l-7-5.44A13.59 13.59 0 0 1 24 37zm-12.35-8.93l-7.4 5.67 7.4-5.66z",fill:"#34a853"}),/* @__PURE__ */jsxRuntime.jsx("path",{d:"M44.5 20H24v8.5h11.8a9.91 9.91 0 0 1-4.49 6.58l7 5.44C42.37 36.76 45 31.17 45 24a18.25 18.25 0 0 0-.5-4z",fill:"#4285f4"})]});function CustomLogo(props){const{provider}=props;return provider.logo?/* @__PURE__ */jsxRuntime.jsx(CustomImage,{src:provider.logo,alt:"Logo for ".concat(provider.name)}):void 0;}const providerLogos={google:GoogleLogo,github:GithubLogo// sanity: () => <SanityMonogram data-sanity-icon="" />,
};async function getProviders(_ref28){let{client,mode,providers:customProviders=[]}=_ref28;if(mode==="replace"&&Array.isArray(customProviders)){return customProviders;}const{providers}=await client.request({uri:"/auth/providers"});if(typeof customProviders==="function"){return customProviders(providers);}if(customProviders.length===0){return providers;}if(mode==="replace"){return customProviders;}return providers.filter(official=>customProviders.some(provider=>provider.url!==official.url)).concat(customProviders);}function createHrefForProvider(_ref29){let{loginMethod="dual",projectId,url,basePath}=_ref29;const params=new URLSearchParams();params.set("origin","".concat(window.location.origin).concat(basePath));params.set("projectId",projectId);if(loginMethod==="token"){params.set("withSid","true");}else{params.set("type",loginMethod);}return"".concat(url,"?").concat(params);}function createLoginComponent(_ref30){let{getClient,loginMethod,redirectOnSingle,...providerOptions}=_ref30;const useClient=createHookFromObservableFactory(getClient);function LoginComponent(_ref31){let{projectId,basePath}=_ref31;const[providers,setProviders]=React.useState(null);const[error,setError]=React.useState(null);if(error)throw error;const[client]=useClient();React.useEffect(()=>{if(!client)return;getProviders({client,...providerOptions}).then(setProviders).catch(setError);},[client]);const redirectUrl=redirectOnSingle&&(providers==null?void 0:providers.length)===1&&(providers==null?void 0:providers[0])&&createHrefForProvider({loginMethod,projectId,url:providers[0].url,basePath});const loading=!providers||redirectUrl;React.useEffect(()=>{if(redirectUrl){window.location.href=redirectUrl;}},[redirectUrl]);if(loading){return/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{showText:true});}return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{align:"center",size:1,children:"Choose login provider"}),/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:2,children:providers.map((provider,index)=>/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{as:"a",icon:providerLogos[provider.name]||/* @__PURE__ */jsxRuntime.jsx(CustomLogo,{provider}),href:createHrefForProvider({loginMethod,projectId,url:provider.url,basePath}),mode:"ghost",size:"large",text:provider.title},"".concat(provider.url,"_").concat(index)))})]});}return LoginComponent;}const sidPattern=/sid=([^&]{20,})&?/;function consumeSessionId(){if(typeof window==="undefined"||typeof window.location!=="object"){return null;}const hash=window.location.hash;const[,sidParam]=hash.match(sidPattern)||[];if(!sidParam){return null;}const newHash=hash.replace(sidPattern,"");const newUrl=new URL(window.location.href);newUrl.hash=newHash.length>1?newHash:"";history.replaceState(null,"",newUrl);return sidParam;}let sessionId$1=consumeSessionId();const getSessionId$1=()=>{const id=sessionId$1;if(id){sessionId$1=null;}return id;};function isAuthStore(maybeStore){return isRecord$4(maybeStore)&&"state"in maybeStore&&isRecord$4(maybeStore.state)&&"subscribe"in maybeStore.state&&typeof maybeStore.state.subscribe==="function";}function isCookielessCompatibleLoginMethod(loginMethod){const cookielessCompatibleLoginMethods=["dual","token"];return cookielessCompatibleLoginMethods.includes(loginMethod);}const getStorageKey=projectId=>{if(!projectId)throw new Error("Invalid project id");return"__studio_auth_token_".concat(projectId);};const getToken=projectId=>{try{const item=getItem(getStorageKey(projectId));if(item){const{token}=JSON.parse(item);if(token&&typeof token==="string"){return token;}}}catch(err){console.error(err);}return null;};const clearToken=projectId=>{try{removeItem(getStorageKey(projectId));}catch(err){console.error(err);}};const saveToken=_ref32=>{let{token,projectId}=_ref32;try{setItem(getStorageKey(projectId),JSON.stringify({token,time:(/* @__PURE__ */new Date()).toISOString()}));}catch(err){console.error(err);}};const getCurrentUser=async(client,broadcastToken)=>{var _a;try{const user=await client.request({uri:"/users/me",withCredentials:true,tag:"users.get-current"});return typeof(user==null?void 0:user.id)==="string"?user:null;}catch(err){if(err.statusCode===401){clearToken(client.config().projectId||"");broadcastToken(null);return null;}const invalidCorsConfig=await client.request({uri:"/ping",withCredentials:false,tag:"cors-check"}).then(()=>true,// Request succeeded, so likely the CORS origin is disallowed
()=>false// Request failed, so likely a network error of some kind
);if(invalidCorsConfig){throw new CorsOriginError({projectId:(_a=client.config())==null?void 0:_a.projectId});}if(err.isNetworkError&&!err.message&&err.request&&err.request.url){const host=new URL(err.request.url).host;throw new Error("Unknown network error attempting to reach ".concat(host));}throw err;}};function _createAuthStore(_ref33){let{clientFactory:clientFactoryOption,projectId,dataset,apiHost,loginMethod="dual",...providerOptions}=_ref33;const{broadcast,messages}=createBroadcastChannel("dual_mode_auth_".concat(projectId));const clientFactory=clientFactoryOption!=null?clientFactoryOption:client.createClient;const token$=messages.pipe(operators.startWith(isCookielessCompatibleLoginMethod(loginMethod)?getToken(projectId):null));const hostOptions={};if(apiHost){hostOptions.apiHost=apiHost;}else if(typeof __SANITY_STAGING__!=="undefined"&&__SANITY_STAGING__===true){hostOptions.apiHost="https://api.sanity.work";}const state$=token$.pipe(// // see above
// debounce(() => firstMessage),
operators.map(token=>clientFactory({projectId,dataset,apiVersion:"2021-06-07",useCdn:false,...(token&&{token}),withCredentials:true,requestTagPrefix:"sanity.studio",ignoreBrowserTokenWarning:true,allowReconfigure:false,...hostOptions})),operators.switchMap(client=>rxjs.defer(async()=>{const currentUser=await getCurrentUser(client,broadcast);return{currentUser,client,authenticated:!!currentUser};})),operators.distinctUntilChanged((prev,next)=>// Only notify subscribers if the the currentUser object has changed.
// Using isEqual is OK since the currentUser object being a small data structure.
isEqual__default.default(prev.currentUser,next.currentUser)),operators.shareReplay(1));async function handleCallbackUrl(){const sessionId=getSessionId$1();if(!sessionId){broadcast(loginMethod==="cookie"?null:getToken(projectId));return;}const requestClient=clientFactory({projectId,dataset,useCdn:true,withCredentials:true,apiVersion:"2021-06-07",requestTagPrefix:"sanity.studio",...hostOptions});let currentUser;if(loginMethod==="dual"||loginMethod==="cookie"){currentUser=await getCurrentUser(requestClient,broadcast);}if(currentUser||loginMethod==="cookie"){broadcast(null);return;}const token=await tradeSessionForToken(requestClient,sessionId);broadcast(token!=null?token:null);}async function tradeSessionForToken(client,sessionId){const{token}=await client.request({method:"GET",uri:"/auth/fetch",query:{sid:sessionId},tag:"auth.fetch-token"});saveToken({token,projectId});return token;}async function logout(){var _a;const requestClient=clientFactory({projectId,dataset,useCdn:true,withCredentials:true,token:(_a=getToken(projectId))!=null?_a:void 0,apiVersion:"2021-06-07",requestTagPrefix:"sanity.studio",...hostOptions});clearToken(projectId);await requestClient.request({uri:"/auth/logout",method:"POST"});broadcast(null);}const LoginComponent=createLoginComponent({...providerOptions,getClient:()=>state$.pipe(operators.map(state=>state.client)),loginMethod});return{handleCallbackUrl,token:token$,state:state$,LoginComponent,logout};}function hash(value){if(typeof value!=="object"||value===null)return"".concat(value);return JSON.stringify(Object.fromEntries(Object.entries(value).sort((_ref34,_ref35)=>{let[a]=_ref34;let[b]=_ref35;return a.localeCompare(b,"en");}).map(_ref36=>{let[k,v]=_ref36;return[k,hash(v)];})));}const createAuthStore=memoize__default.default(_createAuthStore,hash);function getProviderTitle(provider){if(provider==="google"){return"Google";}if(provider==="github"){return"GitHub";}if(provider==="sanity"){return"Sanity";}if(provider==null?void 0:provider.startsWith("saml-")){return"SAML/SSO";}return void 0;}function catchWithCount(selector){return input$=>{let errors=[];const errorOp=operators.catchError((err,caught)=>{errors.push(err);return selector(err,errors.length,caught).pipe(errorOp);});return input$.pipe(operators.tap(()=>{errors=[];}),errorOp);};}const onOnline$=typeof window==="undefined"?rxjs.of({}):rxjs.fromEvent(window,"online");const onOffline$=typeof window==="undefined"?rxjs.of({}):rxjs.fromEvent(window,"offline");const expBackoff=retryCount=>Math.pow(2,retryCount)*100;const CONNECTING={type:"connecting"};const _callback=observableCallback.observableCallback();const onRetry$=_callback[0];const onRetry=_callback[1];const createErrorStatus=_ref37=>{let{error,isOffline,attemptNo,retryAt}=_ref37;return{type:"error",error,attemptNo,isOffline,retryAt};};function createConnectionStatusStore(_ref38){let{bifur}=_ref38;const connectionStatus$=rxjs.merge(bifur.heartbeats,onOffline$.pipe(operators.mergeMapTo(rxjs.throwError(new Error("The browser went offline"))))).pipe(operators.map(ts=>({type:"connected",lastHeartbeat:ts})),catchWithCount((error,successiveErrorsCount,caught)=>{const timeUntilRetry=Math.min(1e3*240,expBackoff(successiveErrorsCount));const retryAt=new Date((/* @__PURE__ */new Date()).getTime()+timeUntilRetry);const expiry$=rxjs.timer(retryAt);const isOffline=!navigator.onLine;const initialErrorStatus=createErrorStatus({error,retryAt,isOffline,attemptNo:successiveErrorsCount});const triggerRetry$=rxjs.NEVER.pipe(operators.takeUntil(isOffline?onOnline$:rxjs.merge(expiry$,onOnline$,onRetry$)));return rxjs.concat(rxjs.of(initialErrorStatus),triggerRetry$.pipe(operators.take(1)),caught);}),operators.startWith(CONNECTING));return{connectionStatus$};}function isBlockType(type){if(type.type){return isBlockType(type.type);}return type.name==="block";}function isArrayOfObjectsFieldMember(member){return member.kind==="field"&&member.field.schemaType.jsonType==="array";}const rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;const reKeySegment=/_key\s*==\s*['"](.*)['"]/;function pathToString$1(path){if(!Array.isArray(path)){throw new Error("Path is not an array");}return path.reduce((target,segment,i)=>{if(types.isIndexSegment(segment)){return"".concat(target,"[").concat(segment,"]");}if(types.isKeySegment(segment)&&segment._key){return"".concat(target,'[_key=="').concat(segment._key,'"]');}if(types.isIndexTuple(segment)){const[from,to]=segment;return"".concat(target,"[").concat(from,":").concat(to,"]");}if(typeof segment==="string"){const separator=i===0?"":".";return"".concat(target).concat(separator).concat(segment);}throw new Error("Unsupported path segment `".concat(JSON.stringify(segment),"`"));},"");}function getValueAtPath(rootValue,path){const segment=path[0];if(!segment){return rootValue;}const tail=path.slice(1);if(types.isIndexSegment(segment)){return getValueAtPath(Array.isArray(rootValue)?rootValue[segment]:void 0,tail);}if(types.isKeySegment(segment)){return getValueAtPath(Array.isArray(rootValue)?rootValue.find(item=>item._key===segment._key):void 0,tail);}if(typeof segment==="string"){return getValueAtPath(isRecord$4(rootValue)?rootValue[segment]:void 0,tail);}throw new Error("Unknown segment type ".concat(JSON.stringify(segment)));}function findIndex(array,segment){if(typeof segment!=="number"&&!types.isKeySegment(segment)){return-1;}return typeof segment==="number"?segment:array.findIndex(item=>types.isKeyedObject(item)&&item._key===segment._key);}function stringToPath(path){const segments=path.match(rePropName);if(!segments){throw new Error("Invalid path string");}return segments.map(normalizePathSegment);}function normalizePathSegment(segment){if(types.isIndexSegment(segment)){return normalizeIndexSegment(segment);}if(types.isKeySegment(segment)){return normalizeKeySegment(segment);}if(types.isIndexTuple(segment)){return normalizeIndexTupleSegment(segment);}return segment;}function normalizeIndexSegment(segment){return Number(segment.replace(/[^\d]/g,""));}function normalizeKeySegment(segment){const segments=segment.match(reKeySegment);if(!segments){throw new Error("Invalid key segment");}return{_key:segments[1]};}function normalizeIndexTupleSegment(segment){const[from,to]=segment.split(":").map(seg=>seg===""?seg:Number(seg));return[from,to];}function pathsAreEqual(pathA,pathB){if(pathA.length!==pathB.length){return false;}return pathA.every((segmentA,index)=>{const segmentB=pathB[index];if(types.isKeySegment(segmentA)&&types.isKeySegment(segmentB)){return segmentA._key===segmentB._key;}if(types.isIndexSegment(segmentA)){return Number(segmentA)===Number(segmentB);}if(types.isIndexTuple(segmentA)&&types.isIndexTuple(segmentB)){return segmentA[0]===segmentB[0]&&segmentA[1]===segmentB[1];}return segmentA===segmentB;});}function getItemKey(arrayItem){return types.isKeyedObject(arrayItem)?arrayItem._key:void 0;}function getItemKeySegment(arrayItem){const key=getItemKey(arrayItem);return key?{_key:key}:void 0;}function isEmptyObject$1(item){return typeof item==="object"&&item!==null&&Object.keys(item).length<=0;}function getAnnotationColor(colorManager,annotation){return colorManager.get((annotation==null?void 0:annotation.author)||null);}function getAnnotationAtPath(diff,diffPath){const path=Array.isArray(diffPath)?diffPath:stringToPath(diffPath);return getAnnotationAt(diff,path);}function getDiffAtPath(diff,diffPath){const path=Array.isArray(diffPath)?diffPath:stringToPath(diffPath);return getDiffAt(diff,path);}function getAnnotationAt(diff,path){const diffAt=getDiffAt(diff,path);if(!diffAt){return void 0;}if(diffAt.action==="unchanged"){return void 0;}return diffAt.annotation||void 0;}function getDiffAt(diff,path){let parentPath=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];if(path.length===0){return diff;}const segment=path[0];const tail=path.slice(1);if(types.isIndexTuple(segment)){throw new Error("Index tuples are not supported in diff paths");}if(types.isIndexSegment(segment)||types.isKeySegment(segment)){const location=types.isIndexSegment(segment)?"at index ".concat(segment):"with key ".concat(segment._key);if(diff.type!=="array"){warn("Failed to get item ".concat(location," at path ").concat(pathToString$1(parentPath)," (not an array)"));return void 0;}const itemDiff=diff.items.find(types.isIndexSegment(segment)?item=>item.toIndex===segment:item=>itemMatchesKey(item,segment));if(!itemDiff){warn("Failed to get item ".concat(location," at path ").concat(pathToString$1(parentPath)," (item missing)"));return void 0;}return getDiffAt(itemDiff.diff,tail,parentPath.concat(segment));}if(diff.type!=="object"){warn("Failed to get property ".concat(segment," at path ").concat(pathToString$1(parentPath)," (not an object)"));return void 0;}const fieldDiff=diff.fields[segment];if(typeof fieldDiff==="undefined"){warn("Failed to get property ".concat(segment," at path ").concat(pathToString$1(parentPath)," (field did not exist)"));return void 0;}return getDiffAt(fieldDiff,tail,parentPath.concat(segment));}function warn(msg){}function itemMatchesKey(item,key){const itemDiff=item.diff;return itemDiff.type!=="object"||!itemDiff.toValue?false:itemDiff.toValue._key===key;}function visitDiff(diff,visitor){let path=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];if(!visitor(diff,path)){return;}if(diff.type==="array"){visitArrayDiff(diff,visitor,path);return;}if(diff.type==="object"){visitObjectDiff(diff,visitor,path);return;}if(diff.type==="string"){visitStringDiff(diff,visitor,path);}}function visitArrayDiff(diff,visitor,path){if(diff.action==="unchanged"){return;}diff.items.forEach(itemDiff=>{var _a;const _key=itemDiff.diff.type==="object"&&((_a=itemDiff.diff.toValue)==null?void 0:_a._key);const segment=_key?{_key}:getItemDiffIndex(itemDiff);visitDiff(itemDiff.diff,visitor,path.concat(segment));});}function visitObjectDiff(diff,visitor,path){if(diff.action==="unchanged"){return;}Object.keys(diff.fields).forEach(fieldName=>{const fieldDiff=diff.fields[fieldName];visitDiff(fieldDiff,visitor,path.concat(fieldName));});}function visitStringDiff(diff,visitor,path){if(diff.action==="unchanged"){return;}diff.segments.forEach(segment=>{visitDiff(segment,visitor,path);});}function getItemDiffIndex(itemDiff){return typeof itemDiff.toIndex==="undefined"?itemDiff.fromIndex||0:itemDiff.toIndex;}const UserColorManagerContext=React.createContext(null);function useUserColorManager(){const userColorManager=React.useContext(UserColorManagerContext);if(!userColorManager){throw new Error("UserColorManager: missing context value");}return userColorManager;}function useUserColor(userId){const manager=useUserColorManager();return reactRx.useMemoObservable(userId?manager.listen(userId):rxjs.empty(),[userId],manager.get(null));}const DEFAULT_CURRENT_USER_HUE="purple";const USER_COLOR_EXCLUDE_HUES=["green","red","gray"];const defaultHues=color.COLOR_HUES.filter(hue=>!USER_COLOR_EXCLUDE_HUES.includes(hue));const getTints=scheme=>{const isDarkScheme=scheme==="dark";return{background:isDarkScheme?"900":"100",border:isDarkScheme?"700":"300",text:isDarkScheme?"200":"700"};};const getDefaultColors=scheme=>{const{background,border,text}=getTints(scheme);return defaultHues.reduce((colors,hue)=>{colors[hue]={name:hue,background:color.hues[hue][background].hex,border:color.hues[hue][border].hex,text:color.hues[hue][text].hex,tints:color.hues[hue]};return colors;},{});};const getAnonymousColor=scheme=>{const{background,border,text}=getTints(scheme);return{name:"gray",background:color.hues.gray[background].hex,border:color.hues.gray[border].hex,text:color.hues.gray[text].hex,tints:color.hues.gray};};function createUserColorManager(options){const{anonymousColor:anonymousColorProp,colors,currentUserColor:currentUserColorProp,scheme}=options;const userColors=colors||getDefaultColors(scheme);const anonymousColor=anonymousColorProp||getAnonymousColor(scheme);const currentUserColor=currentUserColorProp||DEFAULT_CURRENT_USER_HUE;if(!userColors.hasOwnProperty(currentUserColor)){throw new Error("'colors' must contain 'currentUserColor' (".concat(currentUserColor,")"));}const userColorKeys=Object.keys(userColors);const subscriptions=/* @__PURE__ */new Map();const previouslyAssigned=/* @__PURE__ */new Map();const assignedCounts=userColorKeys.reduce((counts,color)=>{counts[color]=0;return counts;},{});const assigned=/* @__PURE__ */new Map();let currentUserId;if(options==null?void 0:options.userStore){options.userStore.me.subscribe(user=>setCurrentUser(user?user.id:null));}return{get,listen};function get(userId){if(!userId){return anonymousColor;}return userColors[getUserHue(userId)];}function getUserHue(userId){if(userId===currentUserId){return currentUserColor;}const assignedHue=assigned.get(userId);if(assignedHue){return assignedHue;}const prevHue=previouslyAssigned.get(userId);if(prevHue&&(assignedCounts[prevHue]===0||!hasUnusedColor())){return assignHue(userId,prevHue);}const preferredHue=getPreferredHue(userId);if(assignedCounts[preferredHue]===0){return assignHue(userId,preferredHue);}return assignHue(userId,getLeastUsedHue(prevHue));}function listen(userId){let subscription=subscriptions.get(userId);if(subscription){return subscription;}const hue=getUserHue(userId);subscription=getObservableColor(userId,hue);subscriptions.set(userId,subscription);return subscription;}function assignHue(userId,hue){assigned.set(userId,hue);previouslyAssigned.set(userId,hue);assignedCounts[hue]++;return hue;}function unassignHue(userId,hue){assigned.delete(userId);assignedCounts[hue]--;}function getUnusedColor(){return userColorKeys.find(colorHue=>assignedCounts[colorHue]===0);}function hasUnusedColor(){return Boolean(getUnusedColor());}function getLeastUsedHue(tieBreakerPreference){let leastUses=Infinity;let leastUsed=[];userColorKeys.forEach(colorHue=>{const uses=assignedCounts[colorHue];if(uses===leastUses){leastUsed.push(colorHue);}else if(uses<leastUses){leastUses=uses;leastUsed=[colorHue];}});return tieBreakerPreference&&leastUsed.includes(tieBreakerPreference)?tieBreakerPreference:leastUsed[0];}function getObservableColor(userId,hue){return new rxjs.Observable(subscriber=>{const userColor=userColors[hue];subscriber.next(userColor);return()=>{subscriptions.delete(userId);unassignHue(userId,hue);};}).pipe(operators.shareReplay({refCount:true}));}function setCurrentUser(userId){currentUserId=userId;assignedCounts[currentUserColor]+=userId?1:-1;}function getPreferredHue(userId){let hash=0;for(let i=0;i<userId.length;i++){hash=(hash<<5)-hash+userId.charCodeAt(i)|0;}return userColorKeys[Math.abs(hash)%userColorKeys.length];}}function UserColorManagerProvider(_ref39){let{children,manager:managerFromProps}=_ref39;const{scheme}=useColorScheme();const manager=React.useMemo(()=>{return managerFromProps||createUserColorManager({scheme});},[managerFromProps,scheme]);return/* @__PURE__ */jsxRuntime.jsx(UserColorManagerContext.Provider,{value:manager,children});}function useAnnotationColor(annotation){const userColorManager=useUserColorManager();return getAnnotationColor(userColorManager,annotation);}function useDiffAnnotationColor(diff){let path=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];const userColorManager=useUserColorManager();const annotation=React.useMemo(()=>getAnnotationAtPath(diff,path),[diff,path]);return React.useMemo(()=>getAnnotationColor(userColorManager,annotation),[annotation,userColorManager]);}function DiffTooltip(props){if(!("diff"in props)){return/* @__PURE__ */jsxRuntime.jsx(DiffTooltipWithAnnotation,{...props});}const{diff,path=[],...restProps}=props;const annotation=getAnnotationAtPath(diff,path);return/* @__PURE__ */jsxRuntime.jsx(DiffTooltipWithAnnotation,{...restProps,annotations:annotation?[annotation]:[]});}function DiffTooltipWithAnnotation(props){const{annotations,children,description,...restProps}=props;const{t}=useTranslation();if(!annotations){return children;}const content=/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:description||t("changes.changed-label")}),/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:2,children:annotations.map((annotation,idx)=>/* @__PURE__ */jsxRuntime.jsx(AnnotationItem,{annotation},idx))})]});return/* @__PURE__ */jsxRuntime.jsx(LegacyLayerProvider,{zOffset:"paneFooter",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content,portal:true,...restProps,children})});}function AnnotationItem(_ref40){let{annotation}=_ref40;const{author,timestamp}=annotation;const[user]=useUser(author);const color=useAnnotationColor(annotation);const timeAgo=useRelativeTime(timestamp,{minimal:true});const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{space:2,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",paddingRight:3,style:{backgroundColor:color.background,color:color.text,borderRadius:"calc(23px / 2)"},children:[/* @__PURE__ */jsxRuntime.jsx(UserAvatar,{user:author}),/* @__PURE__ */jsxRuntime.jsx(ui.Inline,{paddingLeft:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,style:{color:color.text},children:user?user.displayName:t("changes.loading-author")})})]}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"time",muted:true,size:1,dateTime:timestamp,children:timeAgo})]});}var __freeze$2q=Object.freeze;var __defProp$2q=Object.defineProperty;var __template$2q=(cooked,raw)=>__freeze$2q(__defProp$2q(cooked,"raw",{value:__freeze$2q(raw||cooked.slice())}));var _a$2r;const StyledCard$3=styled__default.default(ui.Card)(_a$2r||(_a$2r=__template$2q(["\n  --diff-card-radius: ",";\n  --diff-card-bg-color: ",";\n\n  max-width: 100%;\n  position: relative;\n  border-radius: var(--diff-card-radius);\n\n  &:not(del) {\n    text-decoration: none;\n  }\n\n  &[data-hover] {\n    &::after {\n      content: '';\n      display: block;\n      position: absolute;\n      left: 0;\n      right: 0;\n      bottom: 0;\n    }\n\n    &:hover {\n      border-bottom-left-radius: 0;\n      border-bottom-right-radius: 0;\n\n      &::after {\n        bottom: -3px;\n        border-top: 1px solid var(---diff-card-bg-color);\n        border-bottom: 2px solid currentColor;\n        border-bottom-left-radius: var(--diff-card-radius);\n        border-bottom-right-radius: var(--diff-card-radius);\n      }\n    }\n\n    [data-from-to-layout]:hover & {\n      border-bottom-left-radius: 0;\n      border-bottom-right-radius: 0;\n\n      &::after {\n        bottom: -3px;\n        border-top: 1px solid var(---diff-card-bg-color);\n        border-bottom: 2px solid currentColor;\n        border-bottom-left-radius: var(--diff-card-radius);\n        border-bottom-right-radius: var(--diff-card-radius);\n      }\n    }\n  }\n"])),_ref41=>{let{theme}=_ref41;return ui.rem(theme.sanity.radius[2]);},_ref42=>{let{theme}=_ref42;return theme.sanity.color.card.enabled.bg;});const EMPTY_PATH$1=[];const DiffCard=React.forwardRef(function DiffCard2(props,ref){const{annotation:annotationProp,as="div",children,className,diff,disableHoverEffect,path=EMPTY_PATH$1,style={},tooltip,...restProps}=props;const annotation=React.useMemo(()=>annotationProp||getAnnotationAtPath(diff,path),[annotationProp,diff,path]);const color=useAnnotationColor(annotation);const element=/* @__PURE__ */jsxRuntime.jsx(StyledCard$3,{...restProps,as,className,"data-hover":disableHoverEffect||!annotation?void 0:"",ref,radius:1,style:{...style,backgroundColor:color.background,color:color.text},children});if(tooltip&&annotation){return/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{annotations:[annotation],description:tooltip&&typeof tooltip==="object"&&tooltip.description,children:element});}return element;});var __freeze$2p=Object.freeze;var __defProp$2p=Object.defineProperty;var __template$2p=(cooked,raw)=>__freeze$2p(__defProp$2p(cooked,"raw",{value:__freeze$2p(raw||cooked.slice())}));var _a$2q,_b$12;const RoundedCard$1=styled__default.default.div(_a$2q||(_a$2q=__template$2p(["\n  border-radius: ",";\n  padding: ",";\n"])),_ref43=>{let{theme}=_ref43;return ui.rem(theme.sanity.radius[2]);},_ref44=>{let{theme}=_ref44;return ui.rem(theme.sanity.space[1]);});const AnnotationText=styled__default.default(ui.Text)(_b$12||(_b$12=__template$2p(["\n  &:not([hidden]) {\n    color: inherit;\n  }\n"])));function ChangeTitleSegment(props){const{change,segment}=props;if(typeof segment==="string"){return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{title:segment,size:1,weight:"medium",textOverflow:"ellipsis",children:segment})});}const{hasMoved,fromIndex,toIndex,annotation}=segment;const created=typeof fromIndex==="undefined";const deleted=typeof toIndex==="undefined";if(created){return/* @__PURE__ */jsxRuntime.jsx(CreatedTitleSegment,{annotation,change,toIndex});}if(deleted){return/* @__PURE__ */jsxRuntime.jsx(DeletedTitleSegment,{annotation,fromIndex});}if(hasMoved&&typeof toIndex!=="undefined"&&typeof fromIndex!=="undefined"){return/* @__PURE__ */jsxRuntime.jsx(MovedTitleSegment,{annotation,fromIndex,toIndex});}const readableIndex=(toIndex||0)+1;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:1,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{size:1,weight:"medium",children:["#",readableIndex]})});}function CreatedTitleSegment(props){const{annotation:annotationProp,change,toIndex=0}=props;const{t}=useTranslation();const readableIndex=toIndex+1;const description=t("changes.array.item-added-in-position",{position:readableIndex});const content=/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:["#",readableIndex]});const diffAnnotation=(change==null?void 0:change.diff)?getAnnotationAtPath(change.diff,[]):void 0;const annotation=diffAnnotation||annotationProp;if(annotation){return/* @__PURE__ */jsxRuntime.jsx(DiffCard,{annotation,tooltip:{description},as:RoundedCard$1,children:/* @__PURE__ */jsxRuntime.jsx(AnnotationText,{size:1,weight:"medium",forwardedAs:"ins",style:{textDecoration:"none"},children:content})});}return/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:content});}function DeletedTitleSegment(props){const{annotation,fromIndex=0}=props;const{t}=useTranslation();const readableIndex=fromIndex+1;const description=t("changes.array.item-removed-from-position",{position:readableIndex});return/* @__PURE__ */jsxRuntime.jsx(DiffCard,{annotation:annotation||null,as:RoundedCard$1,tooltip:{description},children:/* @__PURE__ */jsxRuntime.jsxs(AnnotationText,{size:1,weight:"medium",forwardedAs:"del",children:["#",readableIndex]})});}function MovedTitleSegment(props){const{annotation,fromIndex,toIndex}=props;const{t}=useTranslation();const indexDiff=toIndex-fromIndex;const indexSymbol=indexDiff<0?"\u2191":"\u2193";const positions=Math.abs(indexDiff);const direction=indexDiff<0?"up":"down";const description=t("changes.array.item-moved",{count:positions,context:direction});return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:1,children:/* @__PURE__ */jsxRuntime.jsxs(AnnotationText,{size:1,weight:"medium",children:["#",toIndex+1]})}),/* @__PURE__ */jsxRuntime.jsx(DiffCard,{annotation,as:RoundedCard$1,tooltip:{description},children:/* @__PURE__ */jsxRuntime.jsxs(AnnotationText,{size:1,weight:"medium",children:[indexSymbol,Math.abs(indexDiff)]})})]});}function ChangeBreadcrumb(props){const{change,titlePath}=props;return/* @__PURE__ */jsxRuntime.jsx(ui.Breadcrumbs,{maxLength:4,separator:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.ChevronRightIcon,{})}),children:titlePath.map((titleSegment,idx)=>{const showSegment=typeof titleSegment==="string"||!change||change.showIndex;if(!showSegment){return null;}return/* @__PURE__ */jsxRuntime.jsx(ChangeTitleSegment,{change,segment:titleSegment},idx);})});}function isThenable(value){return isRecord$4(value)&&typeof(value==null?void 0:value.then)==="function";}function useCheckCondition(checkProperty,checkPropertyName,context){const{currentUser,document,parent,value}=context;const didWarn=React.useRef(false);return React.useMemo(()=>{let isTrueIsh=false;if(typeof checkProperty==="boolean"||checkProperty===void 0){return checkProperty||false;}try{isTrueIsh=checkProperty({document,parent,value,currentUser});}catch(err){console.error("An error occurred while running the callback from `".concat(checkPropertyName,"`: ").concat(err.message));return false;}if(isThenable(isTrueIsh)&&!didWarn.current){console.warn("The `".concat(checkPropertyName,"` option is either a promise or a promise returning function. Async callbacks for `").concat(checkPropertyName,"` option is not currently supported."));return false;}if(typeof isTrueIsh==="undefined"){console.warn("The `".concat(checkPropertyName,"` option is or returned `undefined`. `").concat(checkPropertyName,"` should return a boolean."));}return isTrueIsh;},[checkProperty,document,parent,value,currentUser,checkPropertyName]);}const useConditionalProperty=props=>{const{checkProperty=false,checkPropertyKey,document,parent,value:valueProp}=props;const value=useUnique(valueProp);const currentUser=useCurrentUser();const isPropertyTruthy=useCheckCondition(checkProperty,checkPropertyKey,{currentUser,document,parent,value});return isPropertyTruthy;};function resolveTypeName(value){return types.isTypedObject(value)?value._type:resolveJSType(value);}function getArrayDiffItemType(diff,schemaType){if(diff.action==="added"){return{toType:resolveArrayMemberType(schemaType,diff.toValue)};}if(diff.action==="changed"){return{fromType:resolveArrayMemberType(schemaType,diff.fromValue),toType:resolveArrayMemberType(schemaType,diff.toValue)};}if(diff.action==="removed"){return{fromType:resolveArrayMemberType(schemaType,diff.fromValue)};}return{toType:resolveArrayMemberType(schemaType,diff.toValue)};}function resolveArrayMemberType(schemaType,value){const typeName=resolveTypeName(value);const declared=schemaType.of.find(candidate=>candidate.name===typeName);if(declared){return declared;}return schemaType.of.length===1?schemaType.of[0]:void 0;}function resolveJSType(val){if(Array.isArray(val)){return"array";}if(val===null){return"null";}return typeof val;}const ANNOTATION_SYMBOLS=[// [startTag, endTag]
["\uF050","\uF051"],["\uF052","\uF053"],["\uF054","\uF055"],["\uF056","\uF057"],["\uF058","\uF059"],["\uF05A","\uF05B"],["\uF05C","\uF05D"],["\uF05F","\uF060"],["\uF061","\uF062"],["\uF063","\uF064"],["\uF065","\uF066"],["\uF067","\uF068"],["\uF069","\uF06A"],["\uF06B","\uF06C"],["\uF06E","\uF06F"],["\uF070","\uF071"],["\uF072","\uF073"],["\uF074","\uF075"],["\uF076","\uF077"],["\uF078","\uF079"],["\uF07A","\uF07B"],["\uF07C","\uF07D"],["\uF07E","\uF07F"],["\uF080","\uF081"],["\uF082","\uF083"],["\uF084","\uF085"],["\uF086","\uF087"],["\uF088","\uF089"],["\uF08A","\uF08B"],["\uF08C","\uF08D"],["\uF08E","\uF08F"]];const CHILD_SYMBOL="\uF0D0";const DECORATOR_SYMBOLS=[// [startTag, endTag]
["\uF000","\uF001"],["\uF002","\uF003"],["\uF004","\uF005"],["\uF006","\uF007"],["\uF008","\uF009"],["\uF00A","\uF00B"],["\uF00C","\uF00D"],["\uF00F","\uF010"],["\uF011","\uF012"],["\uF013","\uF014"],["\uF015","\uF016"],["\uF017","\uF018"],["\uF019","\uF01A"],["\uF01B","\uF01C"],["\uF01E","\uF01F"],["\uF020","\uF021"]];const EMPTY_BLOCK_SYMBOL="\u21B2";const INLINE_SYMBOLS=["\uF090","\uF091","\uF092","\uF093","\uF094","\uF095","\uF096","\uF097","\uF098","\uF099","\uF09A","\uF09B","\uF09C","\uF09D","\uF09E","\uF09F","\uF0A0","\uF0A1","\uF0A2","\uF0A3","\uF0A4","\uF0A5","\uF0A6","\uF0A7","\uF0A8","\uF0A9","\uF0AA","\uF0AB","\uF0AC","\uF0AD","\uF0AE","\uF0AF","\uF0B0","\uF0B1","\uF0B2","\uF0B3","\uF0B4","\uF0B5","\uF0B6","\uF0B7","\uF0B8","\uF0B9","\uF0BA","\uF0BB","\uF0BC","\uF0BD","\uF0BE","\uF0BF"];const TRAILING_SPACE_SYMBOL="\u205F";const SEGMENT_START_SYMBOL="\u2060";function hasPTMemberType(schemaType){return schemaType.of.some(isPTSchemaType);}const startMarkSymbols=DECORATOR_SYMBOLS.map(set=>set[0]).concat(ANNOTATION_SYMBOLS.map(set=>set[0]));const endMarkSymbols=DECORATOR_SYMBOLS.map(set=>set[1]).concat(ANNOTATION_SYMBOLS.map(set=>set[1]));const allSymbols=startMarkSymbols.concat(endMarkSymbols).concat(INLINE_SYMBOLS).concat(CHILD_SYMBOL).concat(SEGMENT_START_SYMBOL);const symbolRegex=new RegExp("".concat(allSymbols.join("|")),"g");const segmentRegex=new RegExp("".concat(allSymbols.join("|"),"|\n"),"g");function isPTSchemaType(schemaType){return schemaType.jsonType==="object"&&schemaType.name==="block";}function isHeader(node){return types.isPortableTextTextBlock(node)&&!!node.style&&["h1","h2","h3","h4","h5","h6"].includes(node.style);}function findChildDiff(diff,child){const childrenDiff=diff.fields.children;return childrenDiff.items.filter(item=>item.diff.isChanged&&(item.diff.toValue===child||item.diff.fromValue===child)).map(item=>item.diff).map(childDiff=>childDiff)[0];}function getChildSchemaType(fields,child){const childrenField=fields.find(f=>f.name==="children");const cSchemaType=childrenField&&childrenField.type&&childrenField.type.jsonType==="array"&&childrenField.type.of.find(type=>type.name===child._type)||void 0;return cSchemaType;}function getDecorators(spanSchemaType){if(spanSchemaType.decorators){return orderBy__default.default(spanSchemaType.decorators,["value"],["asc"]);}return[];}function isDecorator(name,schemaType){return getDecorators(schemaType).some(dec=>dec.value===name);}function blockToSymbolizedText(diff,block,decoratorMap,annotationMap,inlineMap){if(!block){return"";}return block.children.map(child=>{var _a;let returned=types.isPortableTextSpan(child)?(_a=child.text)==null?void 0:_a.replace(symbolRegex,""):"";if(types.isPortableTextSpan(child)){const spanDiff=findSpanDiffFromChild(diff,child);const textDiff=spanDiff==null?void 0:spanDiff.fields.text;if(textDiff&&textDiff.toValue===child.text&&textDiff.type==="string"&&textDiff.action!=="unchanged"){returned=textDiff.segments.filter(seg=>seg.action!=="removed").map(seg=>seg.text.replace(symbolRegex,"")).join(SEGMENT_START_SYMBOL);}if(child.marks){child.marks.forEach(mark=>{const _isDecorator=!!decoratorMap[mark];if(_isDecorator){returned="".concat(decoratorMap[mark][0]).concat(returned).concat(decoratorMap[mark][1]);}else if(annotationMap[mark]){returned="".concat(annotationMap[mark][0]).concat(returned).concat(annotationMap[mark][1]);}});}}else{returned=inlineMap[child._key];}return"".concat(CHILD_SYMBOL).concat(returned);}).join("");}function createPortableTextDiff(diff,schemaType){const displayValue=diff.action==="removed"?diff.fromValue:diff.toValue;const _diff={...diff,origin:diff,displayValue};if(displayValue){const annotationMap={};const decoratorMap={};const inlineMap={};const spanSchemaType=getChildSchemaType(schemaType.fields,{_key:"bogus",_type:"span"});if(spanSchemaType){getDecorators(spanSchemaType).forEach((dec,index)=>{decoratorMap[dec.value]=DECORATOR_SYMBOLS[index];});}const allMarkDefs=getAllMarkDefs(_diff.origin);allMarkDefs.forEach((markDef,index)=>{annotationMap[markDef._key]=ANNOTATION_SYMBOLS[index];});const inlines=getInlineObjects(_diff.origin);inlines.forEach((inline,index)=>{inlineMap[inline._key]=INLINE_SYMBOLS[index];});const fromText=blockToSymbolizedText(_diff.origin,_diff.fromValue,decoratorMap,annotationMap,inlineMap);const toText=blockToSymbolizedText(_diff.origin,_diff.toValue,decoratorMap,annotationMap,inlineMap);const toPseudoValue={...displayValue,children:[{_type:"span",_key:"pseudoSpanKey",text:toText,marks:[]}]};const fromPseudoValue={displayValue,children:[{_type:"span",_key:"pseudoSpanKey",text:fromText,marks:[]}]};const pseudoDiff={origin:diff,action:"changed",type:"object",displayValue:toPseudoValue,fromValue:fromPseudoValue,toValue:toPseudoValue,isChanged:true,fields:{children:{action:"changed",type:"array",isChanged:true,items:[{diff:{action:"changed",type:"object",isChanged:true,fields:{text:{type:"string",action:"changed",isChanged:true,fromValue:fromText,toValue:toText,segments:buildSegments(fromText,toText).map(seg=>({...seg,...(_diff.action!=="unchanged"&&_diff.annotation?{annotation:_diff.annotation}:{})}))}},fromValue:fromPseudoValue.children[0],toValue:toPseudoValue.children[0]},annotation:null,fromIndex:0,toIndex:0,hasMoved:false}],fromValue:fromPseudoValue.children,toValue:toPseudoValue.children}}};return pseudoDiff;}throw new Error("Can not display this diff");}function buildSegments(fromInput,toInput){const segments=[];const dmpDiffs=diffMatchPatch$1.cleanupEfficiency(diffMatchPatch$1.makeDiff(fromInput,toInput));let fromIdx=0;let toIdx=0;for(const[op,text]of dmpDiffs){switch(op){case diffMatchPatch$1.DIFF_EQUAL:segments.push({type:"stringSegment",action:"unchanged",text});fromIdx+=text.length;toIdx+=text.length;break;case diffMatchPatch$1.DIFF_DELETE:segments.push({type:"stringSegment",action:"removed",text:fromInput.substring(fromIdx,fromIdx+text.length),annotation:null});fromIdx+=text.length;break;case diffMatchPatch$1.DIFF_INSERT:segments.push({type:"stringSegment",action:"added",text:toInput.substring(toIdx,toIdx+text.length),annotation:null});toIdx+=text.length;break;}}return flatten__default.default(segments.map(seg=>{const newSegments=[];if(seg.text.length>1){const markMatches=[...seg.text.matchAll(segmentRegex)];let lastIndex=-1;markMatches.forEach(match=>{const index=match.index||0;if(index>lastIndex){newSegments.push({...seg,text:seg.text.substring(lastIndex+1,index)});newSegments.push({...seg,text:match[0]});}if(match===markMatches[markMatches.length-1]){newSegments.push({...seg,text:seg.text.substring(index+1)});}lastIndex=index;});if(markMatches.length===0){newSegments.push(seg);}}else{newSegments.push(seg);}return newSegments;}));}function getInlineObjects(diff){const allChildren=[...(diff.toValue?diff.toValue.children.filter(cld=>cld._type!=="span"):[])];const previousChildren=diff.fromValue?diff.fromValue.children.filter(cld=>cld._type!=="span"):[];previousChildren.forEach(oCld=>{if(!allChildren.some(cld=>oCld._key===cld._key)){allChildren.push(oCld);}});return orderBy__default.default(allChildren,["_key"],["asc"]);}function findSpanDiffFromChild(diff,child){const candidate=diff.fields.children&&diff.fields.children.action!=="unchanged"&&diff.fields.children.type==="array"&&diff.fields.children.items.find(item=>item.diff&&item.diff.type==="object"&&(item.diff.action==="removed"?item.diff.fromValue&&item.diff.fromValue._key===child._key:(item.diff.toValue&&item.diff.toValue._key)===child._key));if(candidate){return candidate.diff;}return void 0;}function findAnnotationDiff(diff,markDefKey){var _a;return diff.fields.markDefs&&diff.fields.markDefs.isChanged&&diff.fields.markDefs.type==="array"&&((_a=diff.fields.markDefs.items.find(item=>item.diff&&item.diff.type==="object"&&(item.diff.toValue&&item.diff.toValue._key&&item.diff.toValue._key===markDefKey||item.diff.fromValue&&item.diff.fromValue._key&&item.diff.fromValue._key===markDefKey)))==null?void 0:_a.diff)||void 0;}function isEmptyObject(object){return object&&isEqual__default.default(Object.keys(object),["_key","_type"])||false;}function escapeRegExp(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");}function getAllMarkDefs(diff){const allDefs=[...(diff.toValue&&diff.toValue.markDefs?diff.toValue.markDefs:[])];const oldDefs=diff.fromValue&&diff.fromValue.markDefs?diff.fromValue.markDefs:[];oldDefs.forEach(oDef=>{if(!allDefs.some(def=>oDef._key===def._key)){allDefs.push(oDef);}});return orderBy__default.default(allDefs,["_key"],["asc"]);}function getPrintableType(value){const nativeType=typeof value;if(nativeType==="object"){if(value===null)return"null";if(Array.isArray(value))return"array";if(value instanceof Object&&value.constructor.name!=="Object"){return value.constructor.name;}}return nativeType;}function getValueError(value,schemaType){const{jsonType}=schemaType;const valueType=Array.isArray(value)?"array":typeof value;if(value===null||valueType==="undefined"){return void 0;}if(valueType!==jsonType){return{messageKey:"changes.error.incorrect-type-message",value,expectedType:jsonType,actualType:getPrintableType(value)};}if(isObjectType(schemaType)&&isObjectValue(value)){for(const field of schemaType.fields){const fieldError=getValueError(value[field.name],field.type);if(fieldError){return fieldError;}}}return void 0;}function isObjectType(schemaType){return schemaType.jsonType==="object";}function isObjectValue(value){return value!==null&&!Array.isArray(value)&&typeof value==="object";}function noop$2(){}function isFieldChange(change){return change.type==="field";}function isGroupChange(change){return change.type==="group";}function isAddedItemDiff(item){return item.diff.action==="added";}function isRemovedItemDiff(item){return item.diff.action==="removed";}function isUnchangedDiff(diff){return diff.action==="unchanged";}const diffResolvers=[];function Checkbox(_ref45){let{checked,color}=_ref45;return/* @__PURE__ */jsxRuntime.jsxs("svg",{width:"17",height:"17",viewBox:"0 0 17 17",xmlns:"http://www.w3.org/2000/svg",fill:color==null?void 0:color.background,children:[/* @__PURE__ */jsxRuntime.jsx("rect",{x:"0",y:"0",width:"17",height:"17",rx:"2.5"}),typeof checked==="undefined"&&/* @__PURE__ */jsxRuntime.jsx("path",{d:"M4.07996 8.5H12.92",stroke:color==null?void 0:color.text,strokeWidth:"2"}),checked&&/* @__PURE__ */jsxRuntime.jsx("path",{d:"M3.5 8L7 11.5L13.5 5",stroke:color==null?void 0:color.text,strokeWidth:"2"})]});}function Switch(_ref46){let{checked,color}=_ref46;return/* @__PURE__ */jsxRuntime.jsxs("svg",{width:"38",height:"22",viewBox:"0 0 38 22",xmlns:"http://www.w3.org/2000/svg",children:[/* @__PURE__ */jsxRuntime.jsx("rect",{width:"38",height:"22",rx:"11",fill:checked?color==null?void 0:color.border:color==null?void 0:color.background}),typeof checked==="undefined"&&/* @__PURE__ */jsxRuntime.jsx("rect",{x:"11",y:"3",width:"16",height:"16",rx:"8",fill:"white"}),checked&&/* @__PURE__ */jsxRuntime.jsx("rect",{x:"18",y:"3",width:"16",height:"16",rx:"8",fill:"white"}),typeof checked==="boolean"&&!checked&&/* @__PURE__ */jsxRuntime.jsx("rect",{x:"4",y:"3",width:"16",height:"16",rx:"8",fill:"white"})]});}const BooleanFieldDiff=_ref47=>{let{diff,schemaType}=_ref47;const{fromValue,toValue}=diff;const{title,options}=schemaType;const Preview=(options==null?void 0:options.layout)==="checkbox"?Checkbox:Switch;const userColor=useDiffAnnotationColor(diff,[]);const showToValue=toValue!==void 0&&toValue!==null;return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{diff,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(Preview,{checked:fromValue,color:userColor}),showToValue&&/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginX:2,children:/* @__PURE__ */jsxRuntime.jsx(FromToArrow,{})}),/* @__PURE__ */jsxRuntime.jsx(Preview,{checked:toValue,color:userColor})]})]})}),showToValue&&title&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:title})})]});};var __freeze$2o=Object.freeze;var __defProp$2o=Object.defineProperty;var __template$2o=(cooked,raw)=>__freeze$2o(__defProp$2o(cooked,"raw",{value:__freeze$2o(raw||cooked.slice())}));var _a$2p;const DatetimeWrapper=styled__default.default.div(_a$2p||(_a$2p=__template$2o(["\n  display: inline-block;\n  word-wrap: break-word;\n"])));const DatetimePreview=function DatetimePreview2(_ref48){let{value,schemaType}=_ref48;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{as:DatetimeWrapper,paddingX:2,paddingY:1,children:formatDateTime(value,schemaType)});};function formatDateTime(value,schemaType){const{options,name}=schemaType;const dateFormat=(options==null?void 0:options.dateFormat)||legacyDateFormat__namespace.DEFAULT_DATE_FORMAT;const timeFormat=(options==null?void 0:options.timeFormat)||legacyDateFormat__namespace.DEFAULT_TIME_FORMAT;return legacyDateFormat__namespace.format(new Date(value),name==="date"?dateFormat:"".concat(dateFormat," ").concat(timeFormat));}const DatetimeFieldDiff=_ref49=>{let{diff,schemaType}=_ref49;return/* @__PURE__ */jsxRuntime.jsx(DiffFromTo,{align:"center",diff,layout:"grid",previewComponent:DatetimePreview,schemaType});};const DocumentChangeContext=React.createContext(null);function useDocumentChange(){const documentChange=React.useContext(DocumentChangeContext);if(!documentChange){throw new Error("DocumentChange: missing context value");}return documentChange;}function useRefValue(refId){const[value,setValue]=React.useState(void 0);const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);React.useEffect(()=>{if(!refId){return void 0;}const subscription=client.observable.getDocument(refId).subscribe(setValue);return()=>{subscription.unsubscribe();};},[client,refId]);return refId?value:void 0;}var __freeze$2n=Object.freeze;var __defProp$2n=Object.defineProperty;var __template$2n=(cooked,raw)=>__freeze$2n(__defProp$2n(cooked,"raw",{value:__freeze$2n(raw||cooked.slice())}));var _a$2o;const SizeDiff=styled__default.default.div(_a$2o||(_a$2o=__template$2n(["\n  ","\n  &:not([hidden]) {\n    display: inline-block;\n  }\n\n  [data-number='positive'] {\n    color: var(--size-diff-positive);\n  }\n\n  [data-number='negative'] {\n    color: var(--size-diff-negative);\n  }\n"])),_ref50=>{let{theme}=_ref50;return"\n    --size-diff-positive: ".concat(theme.sanity.color.solid.positive.enabled.bg,";\n    --size-diff-negative: ").concat(theme.sanity.color.solid.critical.enabled.bg,";\n  ");});const FileFieldDiff=_ref51=>{let{diff,schemaType}=_ref51;const{fromValue,toValue,fields}=diff;const fromAsset=fromValue==null?void 0:fromValue.asset;const toAsset=toValue==null?void 0:toValue.asset;const{t}=useTranslation();const prev=useRefValue(fromAsset==null?void 0:fromAsset._ref);const next=useRefValue(toAsset==null?void 0:toAsset._ref);const formatUnit=useUnitFormatter({unitDisplay:"short",maximumFractionDigits:2});const changedFields=Object.entries(fields).filter(_ref52=>{let[name,field]=_ref52;return field.isChanged&&name!=="_type";}).map(_ref53=>{let[name]=_ref53;return name;});const didAssetChange=changedFields.includes("asset");const nestedFields=schemaType.fields.filter(field=>field.name!=="asset"&&changedFields.includes(field.name)).map(field=>field.name);const pctDiff=getSizeDiff(prev==null?void 0:prev.size,next==null?void 0:next.size);const prevSize=(prev==null?void 0:prev.size)&&getHumanFriendlyBytes(prev.size,formatUnit);const nextSize=(next==null?void 0:next.size)&&getHumanFriendlyBytes(next.size,formatUnit);const cardStyles=React.useMemo(()=>({display:"block",flex:1}),[]);const from=prev&&/* @__PURE__ */jsxRuntime.jsx(DiffCard,{as:"del",diff,path:"asset._ref",style:cardStyles,children:/* @__PURE__ */jsxRuntime.jsx(MetaInfo,{title:prev.originalFilename||t("changes.file.meta-info-fallback-title"),icon:icons.DocumentIcon,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:0,style:{color:"inherit"},children:prevSize})})});const to=next&&/* @__PURE__ */jsxRuntime.jsx(DiffCard,{as:"ins",diff,path:"asset._ref",style:cardStyles,children:/* @__PURE__ */jsxRuntime.jsx(MetaInfo,{title:next.originalFilename||t("changes.file.meta-info-fallback-title"),icon:icons.DocumentIcon,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:0,style:{color:"inherit"},children:nextSize}),pctDiff!==0&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{radius:2,padding:1,as:SizeDiff,marginLeft:2,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{size:0,"data-number":pctDiff>0?"positive":"negative",children:[pctDiff>0?"+":"-",pctDiff,"%"]})})]})})});const FileAssetChange=/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[from&&!to&&/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{diff,path:"asset._ref",description:t("changes.removed-label"),children:from}),from&&to&&/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{diff,path:"asset._ref",children:/* @__PURE__ */jsxRuntime.jsx(FromTo,{from,layout:"grid",to})}),!from&&to&&/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{diff,path:"asset._ref",description:t("changes.added-label"),children:to})]});return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[didAssetChange&&FileAssetChange,nestedFields.length>0&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:didAssetChange?4:3,children:/* @__PURE__ */jsxRuntime.jsx(ChangeList,{diff,schemaType,fields:nestedFields})})]});};function hexToRgba(hex,opacity){const rgba=(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex)||[]).slice(1).map(num=>parseInt(num,16)).concat(opacity);return"rgba(".concat(rgba.join(", "),")");}function simpleHash(str){let hash=0;if(str.length==0){return hash.toString();}for(let i=0;i<str.length;i++){const char=str.charCodeAt(i);hash=(hash<<5)-hash+char;hash&=hash;}return hash.toString();}function getDeviceDpr(){const base=Math.ceil(window.devicePixelRatio||1);return Math.min(3,Math.max(1,base));}function HotspotCropSVG(props){const{crop,diff,hash,hotspot,width=100,height=100,...restProps}=props;const{t}=useTranslation();const cropColor=useDiffAnnotationColor(diff,"crop");const hotspotColor=useDiffAnnotationColor(diff,"hotspot");return/* @__PURE__ */jsxRuntime.jsxs("svg",{...restProps,fill:"none",width,height,viewBox:"0 0 ".concat(width," ").concat(height),children:[/* @__PURE__ */jsxRuntime.jsx("defs",{children:crop&&hotspot&&/* @__PURE__ */jsxRuntime.jsxs("mask",{id:"mask-hotspot-".concat(hash),children:[/* @__PURE__ */jsxRuntime.jsx("rect",{x:0,y:0,width,height,fill:"#fff"}),/* @__PURE__ */jsxRuntime.jsx(HotspotSVG,{hotspot,fill:"#000",offset:1,width,height,stroke:"#000",strokeWidth:3})]})}),crop&&/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{diff,path:"crop",description:t("changes.image.crop-changed"),children:/* @__PURE__ */jsxRuntime.jsx("g",{children:/* @__PURE__ */jsxRuntime.jsx(CropSVG,{crop,fill:hexToRgba(cropColor.border,0.25),mask:hotspot?"url(#mask-hotspot-".concat(hash,")"):void 0,stroke:cropColor.border,strokeWidth:1,width,height})})}),hotspot&&/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{diff,path:"hotspot",description:t("changes.image.crop-changed"),children:/* @__PURE__ */jsxRuntime.jsx("g",{children:/* @__PURE__ */jsxRuntime.jsx(HotspotSVG,{hotspot,fill:hexToRgba(hotspotColor.border,0.25),stroke:hotspotColor.border,strokeWidth:1,width,height})})})]});}function CropSVG(_ref54){let{crop,width,height,...restProps}=_ref54;const rectProps={x:crop.left*width,y:crop.top*height,width:(1-crop.right-crop.left)*width,height:(1-crop.bottom-crop.top)*height};return/* @__PURE__ */jsxRuntime.jsx("rect",{...restProps,...rectProps,style:{vectorEffect:"non-scaling-stroke"}});}function HotspotSVG(_ref55){let{hotspot,offset=0,width,height,...restProps}=_ref55;const ellipseProps={cx:hotspot.x*width,cy:hotspot.y*height,rx:hotspot.width/2*width+offset,ry:hotspot.height/2*height+offset};return/* @__PURE__ */jsxRuntime.jsx("ellipse",{...restProps,...ellipseProps,style:{vectorEffect:"non-scaling-stroke"}});}var __freeze$2m=Object.freeze;var __defProp$2m=Object.defineProperty;var __template$2m=(cooked,raw)=>__freeze$2m(__defProp$2m(cooked,"raw",{value:__freeze$2m(raw||cooked.slice())}));var _a$2n,_b$11,_c$y;const ASSET_FIELDS=["originalFilename"];const NoImagePreview=()=>{const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{flex:1,tone:"transparent",padding:4,radius:2,height:"stretch",children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",justify:"center",height:"fill",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,children:t("changes.image.no-image-placeholder")})})});};const ImageWrapper=styled__default.default.div(_a$2n||(_a$2n=__template$2m(["\n  height: 100%;\n  max-height: 190px;\n  position: relative;\n\n  /* Ideally the checkerboard component currently in the form builder should be made available and used here */\n  background-color: ",";\n  background-image: linear-gradient(45deg, "," 25%, transparent 25%),\n    linear-gradient(-45deg, "," 25%, transparent 25%),\n    linear-gradient(45deg, transparent 75%, "," 75%),\n    linear-gradient(-45deg, transparent 75%, "," 75%);\n  background-size: 16px 16px;\n  background-position:\n    0 0,\n    0 8px,\n    8px -8px,\n    -8px 0;\n\n  &::after {\n    content: '';\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    box-shadow: inset 0 0 0 1px var(--card-border-color);\n    pointer-events: none;\n  }\n\n  &[data-changed] {\n    opacity: 0.45;\n  }\n"])),color.hues.gray[100].hex,color.hues.gray[50].hex,color.hues.gray[50].hex,color.hues.gray[50].hex,color.hues.gray[50].hex);const Image$5=styled__default.default.img(_b$11||(_b$11=__template$2m(["\n  display: block;\n  flex: 1;\n  min-height: 0;\n  object-fit: contain;\n  width: 100%;\n  height: 100%;\n\n  &[data-action='removed'] {\n    opacity: 0.45;\n  }\n"])));const HotspotDiff=styled__default.default.div(_c$y||(_c$y=__template$2m(["\n  svg {\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n  }\n"])));function ImagePreview$2(props){var _a2,_b2,_c2,_d;const{id,action,diff,hotspot,crop,is}=props;const{t}=useTranslation();const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const[imageError,setImageError]=React.useState();const{value:asset}=useDocumentValues(id,ASSET_FIELDS);const dimensions=assetUtils.getImageDimensions(id);const imageBuilder=React.useMemo(()=>imageUrlBuilder__default.default(client),[client]);const assetIsDeleted=asset===null;const title=asset&&asset.originalFilename;const imageSource=imageBuilder.image(id).height(190).dpr(getDeviceDpr()).fit("max");const assetChanged=((_b2=(_a2=diff.fromValue)==null?void 0:_a2.asset)==null?void 0:_b2._ref)!==((_d=(_c2=diff.toValue)==null?void 0:_c2.asset)==null?void 0:_d._ref);let printAction;if(action&&action!=="changed"){printAction=t(action==="added"?"changes.added-label":"changes.removed-label");}const metaAction=action==="changed"?void 0:action;return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{direction:"column",height:"fill",flex:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,padding:2,paddingBottom:0,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{as:ImageWrapper,direction:"column","data-changed":is==="from"&&assetChanged?"":void 0,"data-error":imageError?"":void 0,children:[!assetIsDeleted&&!imageError&&/* @__PURE__ */jsxRuntime.jsx(Image$5,{src:imageSource.toString()||"",alt:title,"data-action":metaAction,onError:setImageError,width:dimensions.width,height:dimensions.height}),(assetIsDeleted||imageError)&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingY:5,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,align:"center",children:t(assetIsDeleted?"changes.image.deleted":"changes.image.error-loading-image")})}),/* @__PURE__ */jsxRuntime.jsx(HotspotDiff,{children:/* @__PURE__ */jsxRuntime.jsx(HotspotCropSVG,{crop:crop&&!assetUtils.isDefaultCrop(crop)?crop:void 0,diff,hash:simpleHash("".concat(imageSource.toString()||"","-").concat(is)),hotspot:hotspot&&!assetUtils.isDefaultHotspot(hotspot)?hotspot:void 0,width:dimensions.width,height:dimensions.height})})]})}),/* @__PURE__ */jsxRuntime.jsx(MetaInfo,{title:title||t("changes.image.meta-info-fallback-title"),icon:icons.ImageIcon,markRemoved:assetChanged&&is==="from",children:printAction?/* @__PURE__ */jsxRuntime.jsx("div",{children:printAction}):/* @__PURE__ */jsxRuntime.jsxs("div",{children:[dimensions.width," \xD7 ",dimensions.height]})})]});}const IMAGE_META_FIELDS=["crop","hotspot"];const BASE_IMAGE_FIELDS=["asset",...IMAGE_META_FIELDS];const CARD_STYLES={flex:1};const ImageFieldDiff=_ref56=>{let{diff,schemaType}=_ref56;var _a,_b;const{t}=useTranslation();const{fromValue,toValue,fields,isChanged}=diff;const fromRef=(_a=fromValue==null?void 0:fromValue.asset)==null?void 0:_a._ref;const toRef=(_b=toValue==null?void 0:toValue.asset)==null?void 0:_b._ref;const assetAnnotation=getAnnotationAtPath(diff,["asset","_ref"]);const changedFields=Object.keys(fields).filter(name=>fields[name].isChanged&&name!=="_type");const nestedFields=schemaType.fields.filter(field=>!BASE_IMAGE_FIELDS.includes(field.name)&&changedFields.includes(field.name)).map(field=>field.name);let assetAction="changed";if(!fromRef&&toRef){assetAction="added";}else if(!toRef&&fromRef){assetAction="removed";}const didAssetChange=changedFields.includes("asset");const didCropChange=changedFields.includes("crop");const didHotspotChange=changedFields.includes("hotspot");const didMetaChange=didCropChange||didHotspotChange;const showImageDiff=didAssetChange||didMetaChange;const showMetaChange=didMetaChange&&!didAssetChange;const from=fromValue&&fromRef?/* @__PURE__ */jsxRuntime.jsx(DiffCard,{annotation:assetAnnotation,style:CARD_STYLES,children:/* @__PURE__ */jsxRuntime.jsx(ImagePreview$2,{is:"from",id:fromRef,diff,action:assetAction,hotspot:showMetaChange&&didHotspotChange?fromValue.hotspot:void 0,crop:showMetaChange&&didCropChange?fromValue.crop:void 0})}):/* @__PURE__ */jsxRuntime.jsx(NoImagePreview,{});const to=toValue&&toRef?/* @__PURE__ */jsxRuntime.jsx(DiffCard,{annotation:assetAnnotation,style:CARD_STYLES,children:/* @__PURE__ */jsxRuntime.jsx(ImagePreview$2,{is:"to",id:toRef,diff,hotspot:showMetaChange&&didHotspotChange?toValue.hotspot:void 0,crop:showMetaChange&&didCropChange?toValue.crop:void 0})}):/* @__PURE__ */jsxRuntime.jsx(NoImagePreview,{});if(!from&&!to){return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:4,radius:2,tone:"transparent",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,align:"center",children:t("changes.image.no-asset-set")})});}if(!isChanged){return toRef?/* @__PURE__ */jsxRuntime.jsx(DiffCard,{annotation:assetAnnotation,style:CARD_STYLES,children:/* @__PURE__ */jsxRuntime.jsx(ImagePreview$2,{id:toRef,is:"to",diff})}):null;}const imageDiff=/* @__PURE__ */jsxRuntime.jsx(FromTo,{align:"center",from,layout:"grid",to});return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[showImageDiff&&(didAssetChange?/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{annotations:assetAnnotation?[assetAnnotation]:[],description:getChangeDescription(assetAction,t),children:imageDiff}):imageDiff),nestedFields.length>0&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:showImageDiff?4:3,children:/* @__PURE__ */jsxRuntime.jsx(ChangeList,{diff,schemaType,fields:nestedFields})})]});};function getChangeDescription(action,t){switch(action){case"changed":return t("changes.changed-label");case"added":return t("changes.added-label");case"removed":return t("changes.removed-label");default:return"Unknown change";}}var __freeze$2l=Object.freeze;var __defProp$2l=Object.defineProperty;var __template$2l=(cooked,raw)=>__freeze$2l(__defProp$2l(cooked,"raw",{value:__freeze$2l(raw||cooked.slice())}));var _a$2m;const NumberWrapper=styled__default.default.div(_a$2m||(_a$2m=__template$2l(["\n  display: inline-block;\n  word-break: break-all;\n"])));const NumberPreview=props=>{const{value}=props;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{as:NumberWrapper,paddingX:2,paddingY:1,children:value});};const NumberFieldDiff=_ref57=>{let{diff,schemaType}=_ref57;return/* @__PURE__ */jsxRuntime.jsx(DiffFromTo,{diff,schemaType,previewComponent:NumberPreview,layout:"inline"});};var __freeze$2k=Object.freeze;var __defProp$2k=Object.defineProperty;var __template$2k=(cooked,raw)=>__freeze$2k(__defProp$2k(cooked,"raw",{value:__freeze$2k(raw||cooked.slice())}));var _a$2l,_b$10,_c$x,_d$k;const InlineBox=styled__default.default(ui.Box)(_a$2l||(_a$2l=__template$2k(["\n  &:not([hidden]) {\n    display: inline;\n    align-items: center;\n\n    &[data-changed] {\n      cursor: pointer;\n    }\n  }\n"])));const InlineText=styled__default.default(ui.Text)(_b$10||(_b$10=__template$2k(["\n  &:not([hidden]) {\n    display: inline;\n    color: inherit;\n  }\n"])));const PreviewContainer$1=styled__default.default(ui.Box)(_c$x||(_c$x=__template$2k(["\n  &:not([hidden]) {\n    display: inline-flex;\n    align-items: center;\n\n    ",' [data-ui="Text"] {\n      opacity: 0.5;\n    }\n  }\n'])),InlineBox);const PopoverContainer$1=styled__default.default(ui.Box)(_d$k||(_d$k=__template$2k(["\n  min-width: 160px;\n  max-height: 40vh;\n  overflow-y: auto;\n"])));var __freeze$2j=Object.freeze;var __defProp$2j=Object.defineProperty;var __template$2j=(cooked,raw)=>__freeze$2j(__defProp$2j(cooked,"raw",{value:__freeze$2j(raw||cooked.slice())}));var _a$2k;const AnnotationWrapper=styled__default.default.div(_a$2k||(_a$2k=__template$2j(["\n  text-decoration: none;\n  display: inline;\n  position: relative;\n  border: 0;\n  padding: 0;\n  border-bottom: 2px dotted currentColor;\n  box-shadow: inset 0 0 0 1px var(--card-border-color);\n  white-space: nowrap;\n  align-items: center;\n  background-color: color(var(--card-fg-color) a(10%));\n\n  &[data-changed] {\n    cursor: pointer;\n  }\n\n  &[data-removed] {\n    text-decoration: line-through;\n  }\n\n  &:hover "," {\n    opacity: 1;\n  }\n"])),PreviewContainer$1);function Annotation$1(_ref58){let{children,diff,object,schemaType,path,...restProps}=_ref58;const{t}=useTranslation();if(!schemaType){return/* @__PURE__ */jsxRuntime.jsx(AnnotationWrapper,{...restProps,children:t("changes.portable-text.unknown-annotation-schema-type")});}if(diff&&diff.action!=="unchanged"){return/* @__PURE__ */jsxRuntime.jsx(AnnnotationWithDiff,{...restProps,diff,object,schemaType,path,children});}return/* @__PURE__ */jsxRuntime.jsx(AnnotationWrapper,{children});}function AnnnotationWithDiff(_ref59){let{diff,children,object,schemaType,path,...restProps}=_ref59;const{onSetFocus}=React.useContext(ConnectorContext);const{path:fullPath}=React.useContext(DiffContext);const[popoverElement,setPopoverElement]=React.useState(null);const{t}=useTranslation();const color=useDiffAnnotationColor(diff,[]);const style=React.useMemo(()=>color?{background:color.background,color:color.text}:{},[color]);const isRemoved=diff.action==="removed";const[open,setOpen]=React.useState(false);const emptyObject=object&&isEmptyObject(object);const markDefPath=React.useMemo(()=>[path[0]].concat(["markDefs",{_key:object._key}]),[object._key,path]);const prefix=React.useMemo(()=>fullPath.slice(0,fullPath.findIndex(seg=>types.isKeySegment(seg)&&seg._key===object._key)),[fullPath,object._key]);const annotationPath=React.useMemo(()=>prefix.concat(path),[path,prefix]);const myPath=React.useMemo(()=>prefix.concat(markDefPath),[markDefPath,prefix]);const myValue="field-".concat(PathUtils.toString(myPath));const values=useReportedValues$1();const isEditing=React.useMemo(()=>values.filter(_ref60=>{let[p]=_ref60;return p.startsWith(myValue);}).length>0,[myValue,values]);React.useEffect(()=>{if(!open&&isEditing){setOpen(true);onSetFocus(myPath);}},[isEditing,myPath,onSetFocus,open]);const handleOpenPopup=React.useCallback(event=>{event.stopPropagation();setOpen(true);if(!isRemoved){event.preventDefault();onSetFocus(annotationPath);setTimeout(()=>onSetFocus(myPath),10);}},[annotationPath,isRemoved,myPath,onSetFocus]);const handleClickOutside=React.useCallback(()=>{if(!isEditing){setOpen(false);}},[isEditing]);ui.useClickOutside(handleClickOutside,[popoverElement]);const annotation=diff.action!=="unchanged"&&diff.annotation||null;const annotations=React.useMemo(()=>annotation?[annotation]:[],[annotation]);const popoverContent=/* @__PURE__ */jsxRuntime.jsx(DiffContext.Provider,{value:{path:myPath},children:/* @__PURE__ */jsxRuntime.jsx(PopoverContainer$1,{padding:3,children:/* @__PURE__ */jsxRuntime.jsxs("div",{children:[emptyObject&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:t("changes.portable-text.empty-object-annotation",{annotationType:schemaType.title||schemaType.name})}),!emptyObject&&/* @__PURE__ */jsxRuntime.jsx(ChangeList,{diff,schemaType})]})})});return/* @__PURE__ */jsxRuntime.jsx(AnnotationWrapper,{...restProps,onClick:handleOpenPopup,style,"data-changed":"","data-removed":diff.action==="removed"?"":void 0,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{content:popoverContent,open,ref:setPopoverElement,portal:true,children:/* @__PURE__ */jsxRuntime.jsx(PreviewContainer$1,{paddingLeft:1,children:/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{annotations,description:t("changes.portable-text.annotation",{context:diff.action}),children:/* @__PURE__ */jsxRuntime.jsxs(InlineBox,{style:{display:"inline-flex"},children:[/* @__PURE__ */jsxRuntime.jsx("span",{children}),/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",paddingX:1,children:/* @__PURE__ */jsxRuntime.jsx(InlineText,{size:0,children:/* @__PURE__ */jsxRuntime.jsx(icons.ChevronDownIcon,{})})})]})})})})});}var __freeze$2i=Object.freeze;var __defProp$2i=Object.defineProperty;var __template$2i=(cooked,raw)=>__freeze$2i(__defProp$2i(cooked,"raw",{value:__freeze$2i(raw||cooked.slice())}));var _a$2j;const Quote=styled__default.default.blockquote(_a$2j||(_a$2j=__template$2i(["\n  margin: 0;\n"])));function Blockquote(_ref61){let{children}=_ref61;return/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(Quote,{children})});}var __freeze$2h=Object.freeze;var __defProp$2h=Object.defineProperty;var __template$2h=(cooked,raw)=>__freeze$2h(__defProp$2h(cooked,"raw",{value:__freeze$2h(raw||cooked.slice())}));var _a$2i;const headingSizes={h1:2,h2:1,h3:0,h4:0,h5:0,h6:0};const StyledHeading=styled__default.default(ui.Heading)(_a$2i||(_a$2i=__template$2h(["\n  &:not([hidden]) {\n    display: inline;\n    text-transform: none;\n    margin: 0;\n\n    &::before,\n    &::after {\n      content: unset;\n    }\n  }\n"])));function Header$1(_ref62){let{style,children}=_ref62;return/* @__PURE__ */jsxRuntime.jsx(StyledHeading,{size:headingSizes[style],children});}var __freeze$2g=Object.freeze;var __defProp$2g=Object.defineProperty;var __template$2g=(cooked,raw)=>__freeze$2g(__defProp$2g(cooked,"raw",{value:__freeze$2g(raw||cooked.slice())}));var _a$2h;const StyledParagraph=styled__default.default.div(_a$2h||(_a$2h=__template$2g(["\n  text-transform: none;\n  white-space: wrap;\n  overflow-wrap: break-word;\n  margin: 0;\n"])));function Paragraph(_ref63){let{children}=_ref63;return/* @__PURE__ */jsxRuntime.jsx(StyledParagraph,{children});}const EMPTY_PATH=[];function Block(props){var _a,_b,_c;const{diff,block,children}=props;const color=useDiffAnnotationColor(diff,EMPTY_PATH);const{path:fullPath}=React.useContext(DiffContext);const{onSetFocus}=React.useContext(ConnectorContext);const{t}=useTranslation();const isRemoved=diff.action==="removed";let returned=children;const handleClick=React.useCallback(event=>{event.stopPropagation();if(!isRemoved){onSetFocus(fullPath);}},[fullPath,isRemoved,onSetFocus]);if(block.style==="blockquote"){returned=/* @__PURE__ */jsxRuntime.jsx(Blockquote,{children:returned});}else if(block.style&&isHeader(block)){returned=/* @__PURE__ */jsxRuntime.jsx(Header$1,{style:block.style,children:returned});}else{returned=/* @__PURE__ */jsxRuntime.jsx(Paragraph,{children:returned});}let fromStyle;if(diff.origin.action==="changed"&&diff.origin.fields.style&&diff.origin.fields.style.action==="changed"&&diff.origin.fields.style.annotation){fromStyle=(_b=(_a=diff==null?void 0:diff.origin)==null?void 0:_a.fromValue)==null?void 0:_b.style;const style=color?{background:color.background,color:color.text}:{};returned=/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:3,border:true,radius:2,style:{borderStyle:"dotted"},"diff-block-action":diff.action,"data-block-note":"changed_from_style_".concat(fromStyle||"undefined"),children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{annotations:[(_c=diff.origin.fields.style)==null?void 0:_c.annotation],diff:diff.origin.fields.style,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:0,children:t("changes.portable-text.block-style-changed",{fromStyle,toStyle:block.style})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{style,children:returned})]})});}return/* @__PURE__ */jsxRuntime.jsx("div",{onClick:handleClick,"data-diff-block-action":diff.action,"data-block-note":"changed_from_style_".concat(fromStyle||"undefined"),children:returned});}var __freeze$2f=Object.freeze;var __defProp$2f=Object.defineProperty;var __template$2f=(cooked,raw)=>__freeze$2f(__defProp$2f(cooked,"raw",{value:__freeze$2f(raw||cooked.slice())}));var _a$2g;const DecoratorWrapper=styled__default.default.span(_a$2g||(_a$2g=__template$2f(["\n  display: inline;\n  ","\n"])),_ref64=>{let{theme,decoration}=_ref64;switch(decoration){case"strong":return"font-weight: bold;";case"em":return"font-style: italic;";case"underline":return"text-decoration: underline;";case"overline":return"text-decoration: overline;";case"strike-through":return"text-decoration: line-through;";case"code":return"\n          font-family: ".concat(theme.sanity.fonts.code.family,";\n          background: ").concat(theme.sanity.color.muted.default.enabled.bg,";\n        ");default:return"";}});function Decorator$1(_ref65){let{mark,children}=_ref65;return/* @__PURE__ */jsxRuntime.jsx(DecoratorWrapper,{decoration:mark,children});}var __freeze$2e=Object.freeze;var __defProp$2e=Object.defineProperty;var __template$2e=(cooked,raw)=>__freeze$2e(__defProp$2e(cooked,"raw",{value:__freeze$2e(raw||cooked.slice())}));var _a$2f;const InlineObjectWrapper=styled__default.default(ui.Card)(_a$2f||(_a$2f=__template$2e(["\n  &:not([hidden]) {\n    display: inline;\n    cursor: pointer;\n    white-space: nowrap;\n    align-items: center;\n\n    &[data-removed] {\n      text-decoration: line-through;\n    }\n\n    "," {\n      display: inline-flex;\n    }\n  }\n"])),InlineBox);function InlineObject$1(_ref66){let{diff,object,schemaType,...restProps}=_ref66;const{t}=useTranslation();if(!schemaType){return/* @__PURE__ */jsxRuntime.jsx(InlineObjectWrapper,{...restProps,border:true,radius:1,children:t("changes.portable-text.unknown-inline-object-schema-type",{schemaType:object._type})});}if(diff){return/* @__PURE__ */jsxRuntime.jsx(InlineObjectWithDiff,{...restProps,diff,object,schemaType});}return/* @__PURE__ */jsxRuntime.jsx(InlineObjectWrapper,{children:/* @__PURE__ */jsxRuntime.jsx(Preview,{schemaType,value:object,layout:"inline"})});}function InlineObjectWithDiff(_ref67){let{diff,object,path,schemaType,...restProps}=_ref67;const{path:fullPath}=React.useContext(DiffContext);const{onSetFocus}=React.useContext(ConnectorContext);const{t}=useTranslation();const color=useDiffAnnotationColor(diff,[]);const style=React.useMemo(()=>color?{background:color.background,color:color.text}:{},[color]);const[open,setOpen]=React.useState(false);const emptyObject=object&&isEmptyObject(object);const isRemoved=diff.action==="removed";const prefix=fullPath.slice(0,fullPath.findIndex(seg=>types.isKeySegment(seg)&&seg._key===object._key));const myPath=prefix.concat(path);const myValue="field-".concat(PathUtils.toString(myPath));const values=useReportedValues$1();const isEditing=values.filter(_ref68=>{let[p]=_ref68;return p.startsWith(myValue);}).length>0;const focusPath=fullPath.slice(0,-1).concat(path).concat([PathUtils.FOCUS_TERMINATOR]);React.useEffect(()=>{if(isEditing){setOpen(true);onSetFocus(focusPath);}},[focusPath,isEditing,onSetFocus]);const handleOpenPopup=React.useCallback(event=>{event.stopPropagation();setOpen(true);if(!isRemoved){onSetFocus(focusPath);return;}event.preventDefault();},[focusPath,isRemoved,onSetFocus]);const handleClose=React.useCallback(()=>{setOpen(false);},[]);const popoverContent=/* @__PURE__ */jsxRuntime.jsx(DiffContext.Provider,{value:{path:myPath},children:/* @__PURE__ */jsxRuntime.jsx(PopoverContent$1,{diff,emptyObject,onClose:handleClose,schemaType})});const annotation=diff.action!=="unchanged"&&diff.annotation||null;const annotations=annotation?[annotation]:[];return/* @__PURE__ */jsxRuntime.jsx(InlineObjectWrapper,{...restProps,onClick:handleOpenPopup,style,"data-removed":diff.action==="removed"?"":void 0,border:true,radius:2,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{content:popoverContent,open,portal:true,children:/* @__PURE__ */jsxRuntime.jsx(PreviewContainer$1,{children:/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{annotations,description:t("changes.portable-text.inline-object",{context:diff.action}),children:/* @__PURE__ */jsxRuntime.jsxs(InlineBox,{children:[/* @__PURE__ */jsxRuntime.jsx(Preview,{schemaType,value:object,layout:"inline"}),/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",paddingX:1,children:/* @__PURE__ */jsxRuntime.jsx(InlineText,{size:0,children:/* @__PURE__ */jsxRuntime.jsx(icons.ChevronDownIcon,{})})})]})})})})});}function PopoverContent$1(_ref69){let{diff,emptyObject,onClose,schemaType}=_ref69;const{t}=useTranslation();const[popoverElement,setPopoverElement]=React.useState(null);ui.useClickOutside(onClose,[popoverElement]);return/* @__PURE__ */jsxRuntime.jsxs(PopoverContainer$1,{ref:setPopoverElement,padding:3,children:[emptyObject&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:t("changes.portable-text.empty-inline-object",{inlineObjectType:schemaType.title||schemaType.name})}),!emptyObject&&/* @__PURE__ */jsxRuntime.jsx(ChangeList,{diff,schemaType})]});}function Text(_ref70){let{diff,childDiff,children,path,segment,...restProps}=_ref70;const diffWithFallback=diff||childDiff;const hasChanged=diffWithFallback&&diffWithFallback.action!=="unchanged"&&segment.action!=="unchanged";if(hasChanged){return/* @__PURE__ */jsxRuntime.jsx(TextWithDiff,{...restProps,childDiff,diff,segment,path,children});}return/* @__PURE__ */jsxRuntime.jsx(InlineBox,{children});}function TextWithDiff(_ref71){let{diff,childDiff,children,path,segment,...restProps}=_ref71;const{onSetFocus}=React.useContext(ConnectorContext);const{path:fullPath}=React.useContext(DiffContext);const spanSegment=React.useMemo(()=>path.slice(-2,1)[0],[path]);const{t}=useTranslation();const isRemoved=diff&&diff.action==="removed";const prefix=fullPath.slice(0,fullPath.findIndex(seg=>types.isKeySegment(seg)&&types.isKeySegment(spanSegment)&&seg._key===spanSegment._key));const focusPath=prefix.concat(path);const handleClick=React.useCallback(event=>{event.stopPropagation();if(!isRemoved){event.preventDefault();onSetFocus(focusPath);}},[focusPath,isRemoved,onSetFocus]);const realSeg=diff&&diff.segments.find(rSeg=>rSeg.text===segment.text);const diffWithFallback=realSeg||diff||childDiff;const annotation=diffWithFallback&&diffWithFallback.action!=="unchanged"&&diffWithFallback.annotation||null;const diffCard=annotation&&segment.action!=="unchanged"?/* @__PURE__ */jsxRuntime.jsx(DiffCard,{annotation,as:segment.action==="removed"?"del":"ins",tooltip:{description:t("changes.portable-text.text",{context:segment.action})},children}):null;return/* @__PURE__ */jsxRuntime.jsx(InlineBox,{...restProps,onClick:handleClick,"data-changed":"",children:/* @__PURE__ */jsxRuntime.jsx("span",{children:/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:diffCard||children})})});}const decoratorSymbolsStart=DECORATOR_SYMBOLS.map(set=>set[0]);const decoratorSymbolsEnd=DECORATOR_SYMBOLS.map(set=>set[1]);const annotationSymbolsStart=ANNOTATION_SYMBOLS.map(set=>set[0]);const annotationSymbolsEnd=ANNOTATION_SYMBOLS.map(set=>set[1]);const allSymbolsStart=decoratorSymbolsStart.concat(annotationSymbolsStart);const allSymbolsEnd=decoratorSymbolsEnd.concat(annotationSymbolsEnd);const allDecoratorSymbols=decoratorSymbolsStart.concat(decoratorSymbolsEnd);const markRegex=new RegExp("".concat(allDecoratorSymbols.concat(allSymbolsEnd).join("|")),"g");function PortableText(props){const{diff,schemaType}=props;const block=diff.origin.toValue||diff.origin.fromValue;const{t}=useTranslation();const inlineObjects=React.useMemo(()=>diff.origin.toValue?getInlineObjects(diff.origin):[],[diff.origin]);const renderChild=React.useCallback(ptDiffChild=>{const spanSchemaType=getChildSchemaType(schemaType.fields,ptDiffChild);let decoratorTypes=[];if(spanSchemaType){decoratorTypes=getDecorators(spanSchemaType);const childrenDiff=diff.fields.children;const segments=childrenDiff.items[0].diff&&childrenDiff.items[0].diff.type==="object"&&childrenDiff.items[0].diff.fields.text.type==="string"&&childrenDiff.items[0].diff.fields.text.segments||[];const returnedChildren=[];const annotationSegments={};if(isEmptyTextChange(block,diff)&&(diff.origin.action==="added"||diff.origin.action==="removed")){const textDiff=findChildDiff(diff.origin,block.children[0])||diff.origin;if(textDiff&&textDiff.action!=="unchanged"){return/* @__PURE__ */jsxRuntime.jsx(DiffCard,{annotation:textDiff.annotation,as:textDiff.action==="removed"?"del":"ins",tooltip:{description:t("changes.portable-text.empty-text",{context:textDiff.action})},children:/* @__PURE__ */jsxRuntime.jsx("span",{children:EMPTY_BLOCK_SYMBOL})},"empty-block-".concat(block._key));}}let childToIndex=-1;let segIndex=-1;const activeAnnotations=[];let endedAnnotation;const allMarkDefs=getAllMarkDefs(diff.origin);segments.forEach(seg=>{var _a,_b,_c;segIndex++;const isInline=INLINE_SYMBOLS.includes(seg.text);const isMarkStart=allSymbolsStart.includes(seg.text);const isMarkEnd=allSymbolsEnd.includes(seg.text);const isChildStart=seg.text===CHILD_SYMBOL;const isRemoved=seg.action==="removed";if(isChildStart){if(!isRemoved){childToIndex++;}}else if(isMarkStart||isMarkEnd){if(isMarkStart&&annotationSymbolsStart.includes(seg.text)){const object=allMarkDefs[annotationSymbolsStart.indexOf(seg.text)];if(object){activeAnnotations.push({mark:object._key,symbols:[seg.text,annotationSymbolsEnd[annotationSymbolsStart.indexOf(seg.text)]],object});}}if(isMarkEnd&&annotationSymbolsEnd.includes(seg.text)){endedAnnotation=activeAnnotations.pop();}}else if(isInline){const indexOfSymbol=INLINE_SYMBOLS.findIndex(sym=>sym===seg.text);const key=(_a=inlineObjects[indexOfSymbol])==null?void 0:_a._key;const originChild=inlineObjects[indexOfSymbol];if(key){const objectSchemaType=getChildSchemaType(schemaType.fields,originChild);const objectDiff=findChildDiff(diff.origin,originChild);returnedChildren.push(/* @__PURE__ */jsxRuntime.jsx(InlineObject$1,{object:originChild,path:[{_key:block._key},"children",{_key:originChild._key}],diff:objectDiff,schemaType:objectSchemaType},"inline-object-".concat(originChild._key)));}}else if(seg.text){const getChildFromFromValue=()=>{var _a2;return(_a2=diff.origin.fromValue)==null?void 0:_a2.children.find(cld=>cld.text&&cld.text.match(escapeRegExp(seg.text)));};const child=block.children[childToIndex]||getChildFromFromValue();const childDiff=child&&findSpanDiffFromChild(diff.origin,child);if(!child){throw new Error("Could not find child");}const textDiff=((_b=childDiff==null?void 0:childDiff.fields)==null?void 0:_b.text)?(_c=childDiff==null?void 0:childDiff.fields)==null?void 0:_c.text:void 0;const text=/* @__PURE__ */jsxRuntime.jsx(Text,{diff:textDiff,path:[{_key:block._key},"children",{_key:child._key}],childDiff,segment:seg,children:renderTextSegment({diff,child,decoratorTypes,seg,segIndex,spanSchemaType,t})},"text-".concat(child._key,"-").concat(segIndex));if(activeAnnotations.length>0){activeAnnotations.forEach(active=>{annotationSegments[active.mark]=annotationSegments[active.mark]||[];annotationSegments[active.mark].push(text);});}if(endedAnnotation){const key="annotation-".concat(endedAnnotation.object._key);const lastChild=returnedChildren[returnedChildren.length-1];if(lastChild&&lastChild.key!==key){const annotationDiff=findAnnotationDiff(diff.origin,endedAnnotation.mark);const objectSchemaType=endedAnnotation&&spanSchemaType.annotations&&spanSchemaType.annotations.find(type=>endedAnnotation&&endedAnnotation.object&&type.name===endedAnnotation.object._type);returnedChildren.push(/* @__PURE__ */jsxRuntime.jsx(Annotation$1,{object:endedAnnotation.object,diff:annotationDiff,path:[{_key:block._key},"children",{_key:child._key}],schemaType:objectSchemaType,children:/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:annotationSegments[endedAnnotation.mark]})},key));}endedAnnotation=void 0;}if(activeAnnotations.length===0){returnedChildren.push(text);}}});return React.createElement("div",{key:block._key},...returnedChildren);}throw new Error("'span' schemaType not found");},[block,diff,inlineObjects,schemaType,t]);return/* @__PURE__ */jsxRuntime.jsx(Block,{block:diff.displayValue,diff,children:/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:(diff.displayValue.children||[]).map(child=>renderChild(child))})});}function renderTextSegment(_ref72){let{diff,child,decoratorTypes,seg,segIndex,spanSchemaType,t}=_ref72;if(seg.text==="\n"){return/* @__PURE__ */jsxRuntime.jsx("br",{});}let children=/* @__PURE__ */jsxRuntime.jsx("span",{children:seg.text.replace(/ /g,TRAILING_SPACE_SYMBOL)},"text-".concat(segIndex));const spanDiff=child&&findSpanDiffFromChild(diff.origin,child);const activeMarks=types.isPortableTextSpan(child)?child.marks||[]:[];if(spanDiff){children=renderDecorators({activeMarks,decoratorTypes,diff,children,seg,segIndex,spanDiff,spanSchemaType,t});}if(activeMarks&&activeMarks.length>0){activeMarks.forEach(mark=>{if(isDecorator(mark,spanSchemaType)){children=// eslint-disable-next-line react/no-array-index-key
/* @__PURE__ */jsxRuntime.jsx(Decorator$1,{mark,children},"decorator-".concat(mark,"-").concat(child._key,"-").concat(segIndex));}});}return children;}function renderDecorators(_ref73){let{activeMarks,decoratorTypes,diff,children,seg,segIndex,spanDiff,spanSchemaType,t}=_ref73;var _a;let returned=/* @__PURE__ */jsxRuntime.jsx("span",{children},"text-segment-".concat(segIndex));const fromPtDiffText=diff.origin.fromValue&&diff.fromValue&&diff.fromValue.children[0].text||"";const indirectMarksAnnotation=spanDiff&&spanDiff.action!=="unchanged"&&spanDiff.annotation||void 0;const marksDiff=(_a=spanDiff==null?void 0:spanDiff.fields)==null?void 0:_a.marks;const marksAnnotation=marksDiff&&marksDiff.action!=="unchanged"&&marksDiff.annotation||indirectMarksAnnotation;let marksChanged=[];const ptDiffChildren=fromPtDiffText.split(CHILD_SYMBOL).filter(text=>!!text).join("");const ptDiffMatchString=ptDiffChildren;const controlString=ptDiffMatchString.substring(0,ptDiffMatchString.indexOf(seg.text)+seg.text.length);const toTest=controlString.substring(0,controlString.indexOf(seg.text));const marks=[];const matches=[...toTest.matchAll(markRegex)];matches.forEach(match=>{var _a2;const sym=match[0];const set=DECORATOR_SYMBOLS.concat(ANNOTATION_SYMBOLS).find(aSet=>aSet.indexOf(sym)>-1);if(set){const isMarkStart=sym===set[0];const mark=((_a2=decoratorTypes[isMarkStart?decoratorSymbolsStart.indexOf(sym):decoratorSymbolsEnd.indexOf(sym)])==null?void 0:_a2.value)||sym;const notClosed=toTest.lastIndexOf(sym)>toTest.lastIndexOf(set[1]);if(notClosed){marks.push(mark);}}});marksChanged=xor__default.default(activeMarks,uniq__default.default(marks));if(marksAnnotation&&marksChanged.length>0&&marksChanged.some(m=>isDecorator(m,spanSchemaType))){returned=/* @__PURE__ */jsxRuntime.jsx(DiffCard,{annotation:marksAnnotation,as:"ins",tooltip:{description:t("changes.portable-text.changed-formatting")},children:returned},"diffcard-annotation-".concat(segIndex,"-").concat(marksChanged.join("-")));}return returned;}function isEmptyTextChange(block,diff){return block.children.length===1&&block.children[0]._type==="span"&&typeof block.children[0].text==="string"&&block.children[0].text===""&&diff.origin.action!=="unchanged";}const PTDiff=props=>{const{diff,schemaType}=props;const ptDiff=React.useMemo(()=>createPortableTextDiff(diff,schemaType),[diff,schemaType]);return/* @__PURE__ */jsxRuntime.jsx("div",{"data-diff-action":diff.action,children:/* @__PURE__ */jsxRuntime.jsx(PortableText,{diff:ptDiff,schemaType})});};var __freeze$2d=Object.freeze;var __defProp$2d=Object.defineProperty;var __template$2d=(cooked,raw)=>__freeze$2d(__defProp$2d(cooked,"raw",{value:__freeze$2d(raw||cooked.slice())}));var _a$2e;const ReferenceWrapper=styled__default.default.div(_a$2e||(_a$2e=__template$2d(["\n  word-wrap: break-word;\n"])));const ReferencePreview$1=_ref74=>{let{value,schemaType}=_ref74;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{as:ReferenceWrapper,padding:2,children:/* @__PURE__ */jsxRuntime.jsx(Preview,{schemaType,value,layout:"default"})});};const ReferenceFieldDiff=_ref75=>{let{diff,schemaType}=_ref75;return/* @__PURE__ */jsxRuntime.jsx(DiffFromTo,{align:"center",diff,layout:"grid",path:"_ref",previewComponent:ReferencePreview$1,schemaType});};var __freeze$2c=Object.freeze;var __defProp$2c=Object.defineProperty;var __template$2c=(cooked,raw)=>__freeze$2c(__defProp$2c(cooked,"raw",{value:__freeze$2c(raw||cooked.slice())}));var _a$2d;const StringWrapper$1=styled__default.default.div(_a$2d||(_a$2d=__template$2c(["\n  display: inline-block;\n  word-break: break-all;\n  white-space: pre-wrap;\n"])));const StringPreview=props=>{const{value}=props;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{as:StringWrapper$1,paddingX:2,paddingY:1,children:value});};var __freeze$2b=Object.freeze;var __defProp$2b=Object.defineProperty;var __template$2b=(cooked,raw)=>__freeze$2b(__defProp$2b(cooked,"raw",{value:__freeze$2b(raw||cooked.slice())}));var _a$2c;const StringWrapper=styled__default.default.div(_a$2c||(_a$2c=__template$2b(["\n  white-space: pre-wrap;\n  word-wrap: break-word;\n"])));const StringFieldDiff=_ref76=>{let{diff,schemaType}=_ref76;const{options}=schemaType;if(options==null?void 0:options.list){return/* @__PURE__ */jsxRuntime.jsx(DiffFromTo,{diff,previewComponent:StringPreview,schemaType});}return/* @__PURE__ */jsxRuntime.jsx(StringWrapper,{children:/* @__PURE__ */jsxRuntime.jsx(DiffString,{diff})});};const defaultComponents={block:PTDiff,boolean:{component:BooleanFieldDiff,showHeader:false},date:DatetimeFieldDiff,datetime:DatetimeFieldDiff,file:FileFieldDiff,image:ImageFieldDiff,number:NumberFieldDiff,reference:ReferenceFieldDiff,string:StringFieldDiff};function resolveDiffComponent(type,parentSchemaType){var _a;let itType=type;while(itType){const resolved=((_a=itType==null?void 0:itType.components)==null?void 0:_a.diff)||tryResolve(itType,parentSchemaType)||defaultComponents[itType.name];if(resolved){return resolved;}itType=itType.type;}const isDateType=["date","datetime"].includes(type.name);const defaultComponentKey=isDateType?type.name:type.jsonType;return defaultComponents[defaultComponentKey];}function tryResolve(schemaType,parentSchemaType){const resolvers=diffResolvers;let resolved;for(const resolver of resolvers){if(typeof resolver!=="function"){console.error("Diff component resolver is not a function: ",resolver);continue;}resolved=resolver({schemaType,parentSchemaType});if(resolved){return resolved;}}return void 0;}function buildChangeList(schemaType,diff){let path=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];let titlePath=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];let context=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};const diffComponent=resolveDiffComponent(schemaType,context.parentSchema);if(!diffComponent){if(schemaType.jsonType==="object"&&diff.type==="object"){return buildObjectChangeList(schemaType,diff,path,titlePath,context);}if(schemaType.jsonType==="array"&&diff.type==="array"){return buildArrayChangeList(schemaType,diff,path,titlePath);}}return getFieldChange(schemaType,diff,path,titlePath,context);}function buildObjectChangeList(schemaType,diff){let path=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];let titlePath=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];let diffContext=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};const changes=[];const childContext={...diffContext,parentSchema:schemaType};const fieldSets=schemaType.fieldsets||schemaType.fields.map(field=>({single:true,field}));for(const fieldSet of fieldSets){if(fieldSet.single){changes.push(...buildFieldChange(fieldSet.field,diff,path,titlePath,childContext));}else{changes.push(...buildFieldsetChangeList(fieldSet,diff,path,titlePath,childContext));}}if(changes.length<2){return changes;}return[{type:"group",key:pathToString$1(path)||"root",path,titlePath,changes:reduceTitlePaths(changes,titlePath.length),schemaType}];}function buildFieldChange(field,diff,path,titlePath){let diffContext=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};const{fieldFilter,...context}=diffContext;const fieldDiff=diff.fields[field.name];if(!fieldDiff||!fieldDiff.isChanged||fieldFilter&&!fieldFilter.includes(field.name)){return[];}const fieldPath=path.concat([field.name]);const fieldTitlePath=titlePath.concat([field.type.title||field.name]);return buildChangeList(field.type,fieldDiff,fieldPath,fieldTitlePath,context);}function buildFieldsetChangeList(fieldSet,diff,path,titlePath){let diffContext=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};const{fields,name,title,readOnly,hidden}=fieldSet;const{fieldFilter,...context}=diffContext;const fieldSetHidden=hidden;const fieldsetReadOnly=readOnly;const fieldSetTitlePath=titlePath.concat([title||name]);const changes=[];for(const field of fields){const fieldDiff=diff.fields[field.name];if(!fieldDiff||!fieldDiff.isChanged||fieldFilter&&!fieldFilter.includes(field.name)){continue;}const fieldPath=path.concat([field.name]);const fieldTitlePath=fieldSetTitlePath.concat([field.type.title||field.name]);changes.push(...buildChangeList({readOnly:fieldsetReadOnly,hidden:fieldSetHidden,...field.type},fieldDiff,fieldPath,fieldTitlePath,context));}if(changes.length<2){return changes;}return[{type:"group",key:pathToString$1(path)||"root",fieldsetName:name,path,titlePath:fieldSetTitlePath,changes:reduceTitlePaths(changes,fieldSetTitlePath.length),readOnly:fieldsetReadOnly,hidden:fieldSetHidden}];}function buildArrayChangeList(schemaType,diff){let path=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];let titlePath=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];const changedOrMoved=diff.items.filter(item=>item.hasMoved&&item.fromIndex!==item.toIndex||item.diff.action!=="unchanged");if(changedOrMoved.length===0){return[];}const isPortableText=hasPTMemberType(schemaType);const list=[];const changes=changedOrMoved.reduce((acc,itemDiff)=>{const memberTypes=getArrayDiffItemType(itemDiff.diff,schemaType);const memberType=memberTypes.toType||memberTypes.fromType;if(!memberType){console.warn("Could not determine schema type for item at %s",pathToString$1(path));return acc;}const segment=getItemKeySegment(itemDiff.diff.fromValue)||getItemKeySegment(itemDiff.diff.toValue)||diff.items.indexOf(itemDiff);const itemPath=path.concat(segment);const itemContext={itemDiff,parentDiff:diff,parentSchema:schemaType};const itemTitlePath=titlePath.concat({hasMoved:itemDiff.hasMoved,toIndex:itemDiff.toIndex,fromIndex:itemDiff.fromIndex,annotation:itemDiff.diff.action==="unchanged"?itemDiff.annotation:itemDiff.diff.annotation});const attachItemDiff=change=>{if(change.type==="field"&&pathsAreEqual(itemPath,change.path)){change.itemDiff=itemDiff;}return change;};const children=buildChangeList(memberType,itemDiff.diff,itemPath,itemTitlePath,itemContext).map(attachItemDiff);if(isPortableText){children.filter(isFieldChange).forEach((field,index,siblings)=>{field.showHeader=siblings.length===1;field.showIndex=itemDiff.fromIndex!==itemDiff.toIndex&&itemDiff.hasMoved;});}if(children.length===0){acc.push(...getFieldChange(memberType,itemDiff.diff,itemPath,itemTitlePath,itemContext));}else{acc.push(...children);}return acc;},list);if(changes.length>1){return[{type:"group",key:pathToString$1(path)||"root",path,titlePath,changes:reduceTitlePaths(changes,titlePath.length),schemaType}];}return changes;}function getFieldChange(schemaType,diff,path,titlePath){let{itemDiff,parentDiff,parentSchema}=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};const{fromValue,toValue,type}=diff;if(type==="array"&&isEmpty(fromValue)&&isEmpty(toValue)){return[];}let error;if(typeof fromValue!=="undefined"){error=getValueError(fromValue,schemaType);}if(!error&&typeof toValue!=="undefined"){error=getValueError(toValue,schemaType);}let showHeader=true;let component;const diffComponent=resolveDiffComponent(schemaType,parentSchema);if(diffComponent&&typeof diffComponent==="function"){component=diffComponent;}else if(diffComponent){component=diffComponent.component;showHeader=typeof diffComponent.showHeader==="undefined"?showHeader:diffComponent.showHeader;}return[{type:"field",diff,path,error,itemDiff,parentDiff,titlePath,schemaType,showHeader,showIndex:true,key:pathToString$1(path)||"root",diffComponent:error?void 0:component,parentSchema}];}function reduceTitlePaths(changes){let byLength=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return changes.map(change=>{change.titlePath=change.titlePath.slice(byLength);return change;});}function isEmpty(item){return Array.isArray(item)&&item.length===0||item===null||typeof item==="undefined";}const isAddedAction=change=>{return change.type==="field"&&change.diff.action==="added";};const flattenChangeNode=changeNode=>{if(changeNode.type!=="group"){return[changeNode];}const newSubChanges=[];changeNode.changes.forEach(cChange=>{newSubChanges.push(...flattenChangeNode(cChange));});return newSubChanges;};const isSubpathOf=(subPath,parentPath)=>{if(parentPath.length>=subPath.length){return false;}for(let i=0;i<parentPath.length;i++){if(parentPath[i]!==subPath[i]){return false;}}return true;};const pathSegmentOfCorrectType=(item,child)=>{const nextItem=item[child];const key=getItemKey(nextItem);if(key){return{_key:key};}const isArray=Array.isArray(item);if(isArray){return parseInt(child,10);}return child;};const diffOptions={diffMatchPatch:{enabled:false,lengthThresholdAbsolute:30,lengthThresholdRelative:1.2}};function undoChange(change,rootDiff,documentOperations){if(!rootDiff){return;}const patches=[];if(change.type==="group"){const allChanges=flattenChangeNode(change);const unsetChanges=allChanges.filter(isAddedAction);allChanges.filter(child=>!isAddedAction(child)).forEach(child=>undoChange(child,rootDiff,documentOperations));patches.push(...buildUnsetPatches(rootDiff,unsetChanges.map(unsetChange=>unsetChange.path).reverse()));}else if(change.diff.action==="added"){patches.push(...buildUnsetPatches(rootDiff,[change.path]));}else if(change.type==="field"&&change.itemDiff&&change.parentDiff&&change.parentDiff.type==="array"&&change.itemDiff.hasMoved){patches.push(...buildMovePatches(change.itemDiff,change.parentDiff,change.path));}else{patches.push(...buildUndoPatches(change.diff,rootDiff,change.path));}documentOperations.patch.execute(patches);}function buildUnsetPatch(rootDiff,path,concurrentUnsetPaths){const previousValue=rootDiff.toValue;return furthestEmptyAncestor(previousValue,path,concurrentUnsetPaths);}function buildUnsetPatches(rootDiff,paths){const patches=[];for(let i=0;i<paths.length;i++){const unsetByEarlierPatch=patches.some(patch=>isSubpathOf(paths[i],patch));if(unsetByEarlierPatch){continue;}patches.push(buildUnsetPatch(rootDiff,paths[i],paths));}return[{unset:[...new Set(patches.map(pathToString$1))]}];}function furthestEmptyAncestor(previousValue,currentPath){let ignorePaths=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];let initialPath=arguments.length>3?arguments[3]:undefined;if(currentPath.length<=0){if(!initialPath){throw new Error("Root has no ancestor");}return initialPath;}const ancestorPath=currentPath.slice(0,-1);const ancestorValue=getValueAtPath(previousValue,ancestorPath);const updatedIgnorePaths=[ancestorPath,/*
     * We can filter out all the subpaths from under this ancestor
     * because since we ignore it higher up in the tree it doesn't
     * matter anymore what the values of subpaths are.
     */...ignorePaths.filter(path=>!isSubpathOf(path,ancestorPath))];return isStub(ancestorValue,ancestorPath,ignorePaths)?furthestEmptyAncestor(previousValue,ancestorPath,updatedIgnorePaths,initialPath):currentPath;}function buildMovePatches(itemDiff,parentDiff,path){const basePath=path.slice(0,-1);const{parentValue,fromIndex,fromValue}=getFromItem(parentDiff,itemDiff);let insertLocation;if(fromIndex===0){insertLocation={before:pathToString$1([...basePath,0])};}else{const prevIndex=fromIndex-1;const prevItemKey=getItemKeySegment(parentValue[prevIndex]);const prevSegment=prevItemKey||prevIndex;insertLocation={after:pathToString$1([...basePath,prevSegment])};}return[{unset:[pathToString$1(path)]},{insert:{...insertLocation,items:[fromValue]}}];}function buildUndoPatches(diff,rootDiff,path){const patches=sanityDiffPatch.diffItem(diff.toValue,diff.fromValue,diffOptions,path);const inserts=patches.filter(patch=>patch.op==="insert").map(_ref77=>{let{after,items}=_ref77;return{insert:{after:pathToString$1(after),items}};});const unsets=patches.filter(patch=>patch.op==="unset").reduce((acc,patch)=>acc.concat(pathToString$1(patch.path)),[]);const stubbedPaths=/* @__PURE__ */new Set();const stubs=[];let hasSets=false;const sets=patches.filter(patch=>patch.op==="set").reduce((acc,patch)=>{hasSets=true;stubs.push(...getParentStubs(patch.path,rootDiff,stubbedPaths));acc[pathToString$1(patch.path)]=patch.value;return acc;},{});return[...stubs,...inserts,...(unsets.length>0?[{unset:unsets}]:[]),...(hasSets?[{set:sets}]:[])];}function getParentStubs(path,rootDiff,stubbed){const value=rootDiff.fromValue;const nextValue=rootDiff.toValue;const stubs=[];for(let i=1;i<=path.length;i++){const subPath=path.slice(0,i);const pathStr=pathToString$1(subPath);if(stubbed.has(pathStr)){continue;}const nextSegment=path[i];const nextIsArrayElement=types.isKeySegment(nextSegment)||types.isIndexSegment(nextSegment);const itemValue=getValueAtPath(value,subPath);const stub=getStubValue(itemValue);if(nextIsArrayElement&&Array.isArray(itemValue)&&!getValueAtPath(nextValue,path.slice(0,i+1))){const indexAtPrev=findIndex(itemValue,nextSegment);const prevItem=itemValue[indexAtPrev-1];const nextItem=getValueAtPath(value,subPath.concat(nextSegment));const prevSeg=types.isKeyedObject(prevItem)?{_key:prevItem._key}:indexAtPrev-1;const after=pathToString$1(subPath.concat(indexAtPrev<1?0:prevSeg));stubs.push({setIfMissing:{[pathStr]:[]}});stubs.push({insert:{after,items:[getStubValue(nextItem)]}});i++;continue;}if(typeof stub==="undefined"){continue;}stubbed.add(pathStr);stubs.push({setIfMissing:{[pathStr]:stub}});}return stubs;}function onlyContainsStubs(item,path,ignorePaths){if(!isRecord$4(item)||!Array.isArray(item)){return false;}for(const child in item){if(!Object.prototype.hasOwnProperty.call(item,child)){continue;}if(child==="_type"||child==="_key"){continue;}const nextPath=[...path,pathSegmentOfCorrectType(item,child)];if(!isStub(item[child],nextPath,ignorePaths)){return false;}}return true;}function isStub(item,path,ignorePaths){const isIgnoredPath=ignorePaths==null?void 0:ignorePaths.some(ignorePath=>pathToString$1(ignorePath)===pathToString$1(path));const isEmptyArray=Array.isArray(item)&&item.length<=0;return isIgnoredPath||item===void 0||item===null||isEmptyArray||isEmptyObject$1(item)||onlyContainsStubs(item,path,ignorePaths);}function getStubValue(item){if(Array.isArray(item)){return[];}if(typeof item!=="object"||item===null){return void 0;}const props={};if(types.isKeyedObject(item)){props._key=item._key;}if(types.isTypedObject(item)){props._type=item._type;}return props;}function getFromItem(parentDiff,itemDiff){if(parentDiff.fromValue&&typeof itemDiff.fromIndex==="number"){const fromValue=parentDiff.fromValue[itemDiff.fromIndex];return{parentValue:parentDiff.fromValue,fromIndex:itemDiff.fromIndex,fromValue};}throw new Error("Failed to find item at index ".concat(itemDiff.fromIndex));}const DiffContext=React.createContext({path:[]});var __freeze$2a=Object.freeze;var __defProp$2a=Object.defineProperty;var __template$2a=(cooked,raw)=>__freeze$2a(__defProp$2a(cooked,"raw",{value:__freeze$2a(raw||cooked.slice())}));var _a$2b;const ChangeListWrapper$1=styled__default.default.div(_a$2b||(_a$2b=__template$2a(["\n  display: grid;\n  grid-template-columns: minmax(0, 1fr);\n"])));const isDev=process.env.NODE_ENV!=="production";const isProd=!isDev;class DiffErrorBoundary extends React.Component{constructor(){super(...arguments);this.state={};}static getDerivedStateFromError(error){return{error};}// eslint-disable-next-line class-methods-use-this
componentDidCatch(error){console.error("Error rendering diff component: ");console.error(error);}render(){const{t}=this.props;const{error}=this.state;if(!error){return this.props.children;}return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:3,radius:2,tone:"critical",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.ErrorOutlineIcon,{})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{paddingLeft:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"h3",size:1,weight:"medium",children:t("changes.error-boundary.title")}),isDev&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",size:1,children:t("changes.error-boundary.developer-info")})})]})]})});}}const arrowComponents={down:icons.ArrowDownIcon,right:icons.ArrowRightIcon};function FromToArrow(props){const{direction="right",...restProps}=props;const arrowComponent=arrowComponents[direction];return/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,...restProps,children:React.createElement(arrowComponent)});}var __freeze$29=Object.freeze;var __defProp$29=Object.defineProperty;var __template$29=(cooked,raw)=>__freeze$29(__defProp$29(cooked,"raw",{value:__freeze$29(raw||cooked.slice())}));var _a$2a,_b$$;const CodeWrapper$1=styled__default.default.pre(_a$2a||(_a$2a=__template$29(["\n  overflow-x: auto;\n  position: relative;\n"])));const Meta=styled__default.default.div(_b$$||(_b$$=__template$29(["\n  position: absolute;\n  top: 0;\n  right: 0;\n"])));function DiffInspectWrapper(props){const{children,as,change,...restProps}=props;const isHovering=React.useRef(false);const[isInspecting,setIsInspecting]=React.useState(false);const toggleInspect=React.useCallback(()=>setIsInspecting(state=>!state),[setIsInspecting]);const handleMouseEnter=React.useCallback(()=>isHovering.current=true,[]);const handleMouseLeave=React.useCallback(()=>isHovering.current=false,[isHovering]);React.useEffect(()=>{function onKeyDown(evt){const{metaKey,key}=evt;if(metaKey&&key==="i"&&isHovering.current){toggleInspect();}}window.addEventListener("keydown",onKeyDown,false);return()=>window.removeEventListener("keydown",onKeyDown,false);},[toggleInspect]);return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{as,onMouseEnter:handleMouseEnter,onMouseLeave:handleMouseLeave,...restProps,children:isInspecting?/* @__PURE__ */jsxRuntime.jsx(DiffInspector,{change}):children});}const MetaLabel=_ref78=>{let{title}=_ref78;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:3,display:"inline-block",as:Meta,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:title})});};function DiffInspector(_ref79){let{change}=_ref79;var _a2,_b2,_c;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{padding:3,tone:"transparent",as:CodeWrapper$1,radius:1,children:[/* @__PURE__ */jsxRuntime.jsx(MetaLabel,{title:t("changes.inspector.meta-label")}),/* @__PURE__ */jsxRuntime.jsx(ui.Code,{language:"json",size:1,children:printMeta({path:pathToString$1(change.path),fromIndex:(_a2=change.itemDiff)==null?void 0:_a2.fromIndex,toIndex:(_b2=change.itemDiff)==null?void 0:_b2.toIndex,hasMoved:(_c=change.itemDiff)==null?void 0:_c.hasMoved,action:change.diff.action,isChanged:change.diff.isChanged})})]}),/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{as:CodeWrapper$1,tone:"critical",padding:3,radius:1,children:[/* @__PURE__ */jsxRuntime.jsx(MetaLabel,{title:t("changes.inspector.from-label")}),/* @__PURE__ */jsxRuntime.jsx(ui.Code,{language:"json",size:1,children:jsonify(change.diff.fromValue)})]}),/* @__PURE__ */jsxRuntime.jsx(ui.Card,{children:/* @__PURE__ */jsxRuntime.jsx(FromToArrow,{direction:"down",align:"center"})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{as:CodeWrapper$1,tone:"positive",padding:3,radius:1,children:[/* @__PURE__ */jsxRuntime.jsx(MetaLabel,{title:t("changes.inspector.to-label")}),/* @__PURE__ */jsxRuntime.jsx(ui.Code,{language:"json",size:1,children:jsonify(change.diff.toValue)})]})]});}function jsonify(value){if(typeof value==="undefined"){return"undefined";}return JSON.stringify(value,null,2);}function printMeta(keys){const lines=[];Object.entries(keys).forEach(_ref80=>{let[key,value]=_ref80;if(typeof value!=="undefined"&&value!==null){lines.push("".concat(key,": ").concat(value));}});return lines.join("\n");}function useChangeVerb(diff){const{t}=useTranslation();const hadPrevValue=hasValue(diff.fromValue);const hasNextValue=hasValue(diff.toValue);if(!hadPrevValue&&hasNextValue){return t("changes.added-label");}if(!hasNextValue&&hadPrevValue){return t("changes.removed-label");}return t("changes.changed-label");}function hasValue(value){return value!==null&&typeof value!=="undefined"&&value!=="";}const INLINE_COLUMN_STYLES={flexShrink:0};const BLOCK_COLUMN_STYLES={alignItems:"stretch"};const FLEX_ALIGN={top:"flex-start",center:"center",bottom:"flex-end",default:"flex-start"};const FromTo=React.forwardRef(function FromTo2(props,ref){const{align="top",layout="inline",from,to,style,...restProps}=props;const theme=ui.useTheme();const Layout=layout==="inline"?ui.Flex:ui.Grid;const layoutStyles=React.useMemo(()=>({...style,...(layout==="inline"?{maxWidth:"100%",display:"inline-flex"}:{gridTemplateColumns:"minmax(0, 1fr) ".concat(ui.rem(theme.sanity.space[5])," minmax(0, 1fr)")})}),[layout,style,theme]);const columnStyles=layout==="inline"?INLINE_COLUMN_STYLES:BLOCK_COLUMN_STYLES;return/* @__PURE__ */jsxRuntime.jsxs(Layout,{...restProps,ref,style:layoutStyles,"data-from-to-layout":true,children:[from&&/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:FLEX_ALIGN[align],style:columnStyles,children:from}),/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",justify:"center",padding:2,children:/* @__PURE__ */jsxRuntime.jsx(FromToArrow,{})})]}),/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:FLEX_ALIGN[align],style:columnStyles,children:to})]});});const cardStyles={flex:1,minWidth:0,display:"block",whiteSpace:"break-spaces"};function DiffFromTo(props){const{align,cardClassName,diff,layout,path,previewComponent,schemaType}=props;const{action}=diff;const changeVerb=useChangeVerb(diff);if(action==="unchanged"){return/* @__PURE__ */jsxRuntime.jsx(DiffCard,{className:cardClassName,style:cardStyles,children:React.createElement(previewComponent,{schemaType,value:diff.toValue})});}const from=diff.fromValue!==void 0&&diff.fromValue!==null&&/* @__PURE__ */jsxRuntime.jsx(DiffCard,{as:"del",className:cardClassName,diff,path,style:cardStyles,children:React.createElement(previewComponent,{schemaType,value:diff.fromValue})});const to=diff.toValue!==void 0&&diff.toValue!==null&&/* @__PURE__ */jsxRuntime.jsx(DiffCard,{as:"ins",className:cardClassName,diff,path,style:cardStyles,children:React.createElement(previewComponent,{schemaType,value:diff.toValue})});if(from&&!to){return/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{description:changeVerb,diff,path,children:from});}if(!from&&to){return/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{description:changeVerb,diff,path,children:to});}return/* @__PURE__ */jsxRuntime.jsx(DiffTooltip,{description:changeVerb,diff,path,children:/* @__PURE__ */jsxRuntime.jsx(FromTo,{align,from,layout,to})});}const FallbackPreview=_ref81=>{let{value,schemaType}=_ref81;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(Preview,{schemaType,value,layout:"default"})});};const FallbackDiff=props=>{const{diff,schemaType}=props;return/* @__PURE__ */jsxRuntime.jsx(DiffFromTo,{diff,schemaType,previewComponent:FallbackPreview,layout:"grid"});};var __freeze$28=Object.freeze;var __defProp$28=Object.defineProperty;var __template$28=(cooked,raw)=>__freeze$28(__defProp$28(cooked,"raw",{value:__freeze$28(raw||cooked.slice())}));var _a$29,_b$_;const FieldChangeContainer=styled__default.default.div(_a$29||(_a$29=__template$28(["\n  --field-change-error: ",";\n  &[data-revert-all-changes-hover] [data-revert-all-hover]::before {\n    border-left: 2px solid var(--field-change-error);\n  }\n"])),_ref82=>{let{theme}=_ref82;return theme.sanity.color.solid.critical.enabled.bg;});const DiffBorder=styled__default.default.div(_b$_||(_b$_=__template$28(["\n  --field-change-error: ",";\n  --diff-inspect-padding-xsmall: ",";\n  --diff-inspect-padding-small: ",";\n\n  position: relative;\n  padding: var(--diff-inspect-padding-xsmall) 0 var(--diff-inspect-padding-xsmall)\n    var(--diff-inspect-padding-small);\n\n  &::before {\n    content: '';\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    border-left: 1px solid var(--card-border-color);\n  }\n\n  &[data-error]:hover::before,\n  &[data-revert-field-hover]:hover::before {\n    border-left: 2px solid var(--field-change-error);\n  }\n"])),_ref83=>{let{theme}=_ref83;return theme.sanity.color.solid.critical.enabled.bg;},_ref84=>{let{theme}=_ref84;return ui.rem(theme.sanity.space[1]);},_ref85=>{let{theme}=_ref85;return ui.rem(theme.sanity.space[2]);});var __freeze$27=Object.freeze;var __defProp$27=Object.defineProperty;var __template$27=(cooked,raw)=>__freeze$27(__defProp$27(cooked,"raw",{value:__freeze$27(raw||cooked.slice())}));var _a$28;const Root$r=styled__default.default(TooltipDelayGroupProvider.Button)(_a$28||(_a$28=__template$27(["\n  [data-ui='Text'] {\n    font-weight: normal;\n  }\n\n  div[data-ui='Box'] {\n    display: none;\n  }\n\n  &:not([data-disabled='true']):hover,\n  &:not([data-disabled='true']):focus {\n    --card-fg-color: ",";\n    --card-bg-color: transparent;\n    --card-border-color: transparent;\n\n    div[data-ui='Box'] {\n      display: block;\n    }\n  }\n"])),_ref86=>{let{theme}=_ref86;return theme.sanity.color.solid.critical.enabled.bg;});const RevertChangesButton=React.forwardRef(function RevertChangesButton2(props,ref){const{selected,changeCount,...restProps}=props;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(Root$r,{icon:icons.RevertIcon,selected,text:t("changes.action.revert-changes-confirm-change",{count:changeCount}),mode:"bleed",ref,tooltipProps:null,...restProps});});function ValueError(_ref87){let{error}=_ref87;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{tone:"critical",padding:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"flex-start",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:/* @__PURE__ */jsxRuntime.jsx(icons.ErrorOutlineIcon,{})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,paddingLeft:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,as:"p",children:t(error.messageKey,{expectedType:error.expectedType,actualType:error.actualType})})})]})});}function FieldChange(props){var _a;const{change,hidden,readOnly}=props;const DiffComponent=change.diffComponent||FallbackDiff;const{documentId,schemaType,rootDiff,isComparingCurrent,FieldWrapper=React.Fragment}=useDocumentChange();const ops=useDocumentOperation(documentId,schemaType.name);const[confirmRevertOpen,setConfirmRevertOpen]=React.useState(false);const[revertHovered,setRevertHovered]=React.useState(false);const[revertButtonElement,setRevertButtonElement]=React.useState(null);const{t}=useTranslation();const[permissions,isPermissionsLoading]=useDocumentPairPermissions({id:documentId,type:schemaType.name,permission:"update"});const handleRevertChanges=React.useCallback(()=>{undoChange(change,rootDiff,ops);},[change,rootDiff,ops]);const handleRevertChangesConfirm=React.useCallback(()=>{setConfirmRevertOpen(true);},[]);const closeRevertChangesConfirmDialog=React.useCallback(()=>{setConfirmRevertOpen(false);},[]);const handleRevertButtonMouseEnter=React.useCallback(()=>{setRevertHovered(true);},[]);const handleRevertButtonMouseLeave=React.useCallback(()=>{setRevertHovered(false);},[]);const handleClickOutside=React.useCallback(()=>setConfirmRevertOpen(false),[]);ui.useClickOutside(handleClickOutside,[revertButtonElement]);const isArray=((_a=change.parentSchema)==null?void 0:_a.jsonType)==="array";const fieldPath=isArray?change.path.slice(0,-1):change.path;const content=React.useMemo(()=>hidden?null:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:1,as:FieldChangeContainer,children:[change.showHeader&&/* @__PURE__ */jsxRuntime.jsx(ChangeBreadcrumb,{change,titlePath:change.titlePath}),/* @__PURE__ */jsxRuntime.jsx(FieldWrapper,{path:fieldPath,hasHover:revertHovered,children:/* @__PURE__ */jsxRuntime.jsxs(DiffInspectWrapper,{change,as:DiffBorder,"data-revert-field-hover":revertHovered?"":void 0,"data-error":change.error?"":void 0,"data-revert-all-hover":true,children:[change.error?/* @__PURE__ */jsxRuntime.jsx(ValueError,{error:change.error}):/* @__PURE__ */jsxRuntime.jsx(DiffErrorBoundary,{t,children:/* @__PURE__ */jsxRuntime.jsx(DiffContext.Provider,{value:{path:change.path},children:/* @__PURE__ */jsxRuntime.jsx(DiffComponent,{diff:change.diff,schemaType:change.schemaType})})}),isComparingCurrent&&!isPermissionsLoading&&(permissions==null?void 0:permissions.granted)&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{content:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingY:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:t("changes.action.revert-changes-description",{count:1})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:3,justify:"flex-end",children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",onClick:closeRevertChangesConfirmDialog,text:t("changes.action.revert-all-cancel")}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{tone:"critical",onClick:handleRevertChanges,text:t("changes.action.revert-changes-confirm-change",{count:1})})]})]}),open:confirmRevertOpen,padding:3,portal:true,placement:"left",ref:setRevertButtonElement,children:/* @__PURE__ */jsxRuntime.jsx(RevertChangesButton,{changeCount:1,onClick:handleRevertChangesConfirm,onMouseEnter:handleRevertButtonMouseEnter,onMouseLeave:handleRevertButtonMouseLeave,selected:confirmRevertOpen,disabled:readOnly,"data-testid":"single-change-revert-button-".concat(change==null?void 0:change.key)})})]})})]}),[change,closeRevertChangesConfirmDialog,confirmRevertOpen,DiffComponent,fieldPath,FieldWrapper,handleRevertButtonMouseEnter,handleRevertButtonMouseLeave,handleRevertChanges,handleRevertChangesConfirm,hidden,isComparingCurrent,isPermissionsLoading,permissions==null?void 0:permissions.granted,readOnly,revertHovered,t]);return content;}function useHover(){const ref=React.useRef(null);const[value,setValue]=React.useState(false);React.useEffect(()=>{const node=ref.current;if(!node){return()=>void 0;}const handleMouseOver=()=>setValue(true);const handleMouseOut=()=>setValue(false);node.addEventListener("mouseover",handleMouseOver);node.addEventListener("mouseout",handleMouseOut);return()=>{node.removeEventListener("mouseover",handleMouseOver);node.removeEventListener("mouseout",handleMouseOut);};},[]);return[ref,value];}var __freeze$26=Object.freeze;var __defProp$26=Object.defineProperty;var __template$26=(cooked,raw)=>__freeze$26(__defProp$26(cooked,"raw",{value:__freeze$26(raw||cooked.slice())}));var _a$27,_b$Z;const ChangeListWrapper=styled__default.default.div(_a$27||(_a$27=__template$26(["\n  display: grid;\n  grid-template-columns: minmax(0, 1fr);\n"])));const GroupChangeContainer=styled__default.default.div(_b$Z||(_b$Z=__template$26(["\n  --field-change-error: ",";\n  --diff-inspect-padding-xsmall: ",";\n  --diff-inspect-padding-small: ",";\n\n  position: relative;\n  padding: var(--diff-inspect-padding-xsmall) var(--diff-inspect-padding-small);\n\n  &::before {\n    content: '';\n    display: block;\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    border-left: 1px solid var(--card-border-color);\n  }\n\n  &[data-error]:hover::before,\n  &[data-revert-group-hover]:hover::before,\n  &[data-revert-all-groups-hover]::before {\n    border-left: 2px solid var(--field-change-error);\n  }\n"])),_ref88=>{let{theme}=_ref88;return theme.sanity.color.solid.critical.enabled.bg;},_ref89=>{let{theme}=_ref89;return ui.rem(theme.sanity.space[1]);},_ref90=>{let{theme}=_ref90;return ui.rem(theme.sanity.space[2]);});function GroupChange(props){const{change:group,readOnly,hidden,...restProps}=props;const{titlePath,changes,path:groupPath}=group;const{path:diffPath}=React.useContext(DiffContext);const{documentId,schemaType,FieldWrapper,rootDiff,isComparingCurrent}=useDocumentChange();const{t}=useTranslation();const isPortableText=changes.every(change=>isFieldChange(change)&&isPTSchemaType(change.schemaType));const isNestedInDiff=pathsAreEqual(diffPath,groupPath);const[revertButtonRef,isRevertButtonHovered]=useHover();const docOperations=useDocumentOperation(documentId,schemaType.name);const[confirmRevertOpen,setConfirmRevertOpen]=React.useState(false);const[revertPopoverElement,setRevertPopoverElement]=React.useState(null);const[permissions,isPermissionsLoading]=useDocumentPairPermissions({id:documentId,type:schemaType.name,permission:"update"});const handleRevertChanges=React.useCallback(()=>undoChange(group,rootDiff,docOperations),[group,rootDiff,docOperations]);const handleRevertChangesConfirm=React.useCallback(()=>{setConfirmRevertOpen(true);},[]);const closeRevertChangesConfirmDialog=React.useCallback(()=>{setConfirmRevertOpen(false);},[]);ui.useClickOutside(()=>setConfirmRevertOpen(false),[revertPopoverElement]);const content=React.useMemo(()=>hidden?null:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:1,as:GroupChangeContainer,"data-revert-group-hover":isRevertButtonHovered?"":void 0,"data-portable-text":isPortableText?"":void 0,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:ChangeListWrapper,space:5,children:changes.map(change=>/* @__PURE__ */jsxRuntime.jsx(ChangeResolver,{change,readOnly,hidden},change.key))}),isComparingCurrent&&!isPermissionsLoading&&(permissions==null?void 0:permissions.granted)&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{content:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingY:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:t("changes.action.revert-changes-description",{count:changes.length})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:3,justify:"flex-end",children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",onClick:closeRevertChangesConfirmDialog,text:t("changes.action.revert-all-cancel")}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{tone:"critical",onClick:handleRevertChanges,text:t("changes.action.revert-changes-confirm-change",{count:1})})]})]}),padding:3,portal:true,placement:"left",open:confirmRevertOpen,ref:setRevertPopoverElement,children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(RevertChangesButton,{changeCount:changes.length,onClick:handleRevertChangesConfirm,ref:revertButtonRef,selected:confirmRevertOpen,disabled:readOnly,"data-testid":"group-change-revert-button-".concat(group.fieldsetName)})})})]}),[changes,closeRevertChangesConfirmDialog,confirmRevertOpen,group.fieldsetName,handleRevertChanges,handleRevertChangesConfirm,hidden,isComparingCurrent,isPermissionsLoading,isPortableText,isRevertButtonHovered,permissions==null?void 0:permissions.granted,readOnly,revertButtonRef,t]);return hidden?null:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:1,...restProps,children:[/* @__PURE__ */jsxRuntime.jsx(ChangeBreadcrumb,{titlePath}),isNestedInDiff||!FieldWrapper?content:/* @__PURE__ */jsxRuntime.jsx(FieldWrapper,{hasHover:isRevertButtonHovered,path:group.path,children:content})]});}function ChangeResolver(props){var _a,_b;const{change,hidden,readOnly}=props;const{value}=useDocumentChange();const isHidden=useConditionalProperty({// @todo: is parent missing here?
document:value,checkProperty:hidden||((_a=change.schemaType)==null?void 0:_a.hidden),checkPropertyKey:"hidden",value:change.type==="field"?change.diff.toValue:void 0});const isReadOnly=useConditionalProperty({// @todo: is parent missing here?
document:value,checkProperty:readOnly||((_b=change.schemaType)==null?void 0:_b.readOnly),checkPropertyKey:"readOnly",value:change.type==="field"?change.diff.toValue:void 0});if(isHidden)return null;if(change.type==="field"){return/* @__PURE__ */jsxRuntime.jsx(FieldChange,{change,readOnly:isReadOnly});}if(change.type==="group"){return/* @__PURE__ */jsxRuntime.jsx(GroupChange,{change,"data-testid":"group-change-".concat(change.fieldsetName),readOnly:isReadOnly});}return(// eslint-disable-next-line i18next/no-literal-string
/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{children:["Unknown change type: ",/* @__PURE__ */jsxRuntime.jsx("code",{children:change.type||"undefined"})]}));}function NoChanges(){const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",as:"h3",children:t("changes.no-changes-title")}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",size:1,muted:true,children:t("changes.no-changes-description")})]});}function ChangeList(_ref91){let{diff,fields,schemaType}=_ref91;const{documentId,isComparingCurrent,value}=useDocumentChange();const docOperations=useDocumentOperation(documentId,schemaType.name);const{path}=React.useContext(DiffContext);const isRoot=path.length===0;const[confirmRevertAllOpen,setConfirmRevertAllOpen]=React.useState(false);const[confirmRevertAllHover,setConfirmRevertAllHover]=React.useState(false);const{t}=useTranslation();const isReadOnly=useConditionalProperty({document:value,value:void 0,checkProperty:schemaType.readOnly,checkPropertyKey:"readOnly"});if(schemaType.jsonType!=="object"){throw new Error("Only object schema types are allowed in ChangeList");}const[permissions,isPermissionsLoading]=useDocumentPairPermissions({id:documentId,type:schemaType.name,permission:"update"});const allChanges=React.useMemo(()=>buildObjectChangeList(schemaType,diff,path,[],{fieldFilter:fields}),[schemaType,fields,path,diff]);const changes=React.useMemo(()=>fields&&fields.length===0?[]:maybeFlatten(allChanges),[allChanges,fields]);const rootChange=allChanges[0];const revertAllChanges=React.useCallback(()=>{undoChange(rootChange,diff,docOperations);setConfirmRevertAllOpen(false);},[rootChange,diff,docOperations]);const handleRevertAllChangesClick=React.useCallback(()=>{setConfirmRevertAllOpen(true);},[]);const handleRevertAllChangesMouseEnter=React.useCallback(()=>{setConfirmRevertAllHover(true);},[]);const handleRevertAllChangesMouseLeave=React.useCallback(()=>{setConfirmRevertAllHover(false);},[]);const closeRevertAllChangesConfirmDialog=React.useCallback(()=>{setConfirmRevertAllOpen(false);},[]);const[revertAllContainerElement,setRevertAllContainerElement]=React.useState(null);const handleClickOutside=React.useCallback(()=>setConfirmRevertAllOpen(false),[]);ui.useClickOutside(handleClickOutside,[revertAllContainerElement]);if(changes.length===0){return isRoot?/* @__PURE__ */jsxRuntime.jsx(NoChanges,{}):null;}const showFooter=isRoot&&changes.length>1;return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:5,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:ChangeListWrapper$1,space:5,children:changes.map(change=>/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(ChangeResolver,{change,"data-revert-all-changes-hover":confirmRevertAllHover?"":void 0,readOnly:isReadOnly||(change==null?void 0:change.readOnly),hidden:change==null?void 0:change.hidden},change.key)},change.key))}),showFooter&&isComparingCurrent&&!isPermissionsLoading&&(permissions==null?void 0:permissions.granted)&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{content:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingY:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:t("changes.action.revert-all-description",{count:changes.length})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:3,justify:"flex-end",children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",text:t("changes.action.revert-all-cancel"),onClick:closeRevertAllChangesConfirmDialog}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{tone:"critical",text:t("changes.action.revert-all-confirm"),onClick:revertAllChanges})]})]}),open:confirmRevertAllOpen,padding:3,placement:"left",portal:true,ref:setRevertAllContainerElement,children:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{tone:"critical",mode:"ghost",text:t("changes.action.revert-all-confirm"),icon:icons.RevertIcon,onClick:handleRevertAllChangesClick,onMouseEnter:handleRevertAllChangesMouseEnter,onMouseLeave:handleRevertAllChangesMouseLeave,disabled:isReadOnly,size:"large"})})})]})});}function maybeFlatten(changes){return changes.length===1&&changes[0].type==="group"&&changes[0].path.length===0?changes[0].changes:changes;}var __freeze$25=Object.freeze;var __defProp$25=Object.defineProperty;var __template$25=(cooked,raw)=>__freeze$25(__defProp$25(cooked,"raw",{value:__freeze$25(raw||cooked.slice())}));var _a$26,_b$Y;const RoundedCard=styled__default.default.span(_a$26||(_a$26=__template$25(["\n  border-radius: ",";\n"])),_ref92=>{let{theme}=_ref92;return ui.rem(theme.sanity.radius[1]);});const ChangeSegment=styled__default.default(ui.Text)(_b$Y||(_b$Y=__template$25(["\n  &:not([hidden]) {\n    display: inline;\n    line-height: calc(1.25em + 2px);\n  }\n\n  &:hover {\n    background-color: none !important;\n    background-image: linear-gradient(\n      to bottom,\n      var(--card-bg-color) 0,\n      var(--card-bg-color) 33.333%,\n      currentColor 33.333%,\n      currentColor 100%\n    );\n    background-size: 1px 3px;\n    background-repeat: repeat-x;\n    background-position-y: bottom;\n    padding-bottom: 3px;\n    box-shadow: 0 0 0 1px var(--card-bg-color);\n    z-index: 1;\n  }\n"])));function DiffStringSegment(props){const{segment}=props;const{text}=segment;const{t}=useTranslation();if(segment.action==="added"){return/* @__PURE__ */jsxRuntime.jsx(DiffCard,{annotation:segment.annotation,disableHoverEffect:true,tooltip:{description:t("changes.added-label")},as:RoundedCard,children:/* @__PURE__ */jsxRuntime.jsx(ChangeSegment,{as:"ins",style:{textDecoration:"none"},children:text})});}if(segment.action==="removed"){return/* @__PURE__ */jsxRuntime.jsx(DiffCard,{annotation:segment.annotation,as:RoundedCard,disableHoverEffect:true,tooltip:{description:t("changes.removed-label")},children:/* @__PURE__ */jsxRuntime.jsx(ChangeSegment,{as:"del",children:text})});}return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{as:"span",radius:2,style:{display:"inline"},children:text});}function DiffString(props){const{diff}=props;return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:(diff.segments||[]).map((segment,segmentIndex)=>/* @__PURE__ */jsxRuntime.jsx(DiffStringSegment,{segment},segmentIndex))});}var __freeze$24=Object.freeze;var __defProp$24=Object.defineProperty;var __template$24=(cooked,raw)=>__freeze$24(__defProp$24(cooked,"raw",{value:__freeze$24(raw||cooked.slice())}));var _a$25;const MetaText=styled__default.default(ui.Text)(_a$25||(_a$25=__template$24(["\n  color: inherit;\n"])));function MetaInfo(props){const{title,action,icon,children,markRemoved}=props;return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{padding:2,align:"center",children:[icon&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(MetaText,{size:4,forwardedAs:markRemoved?"del":"div",children:React.createElement(icon)})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,paddingLeft:2,children:[/* @__PURE__ */jsxRuntime.jsx(MetaText,{size:1,weight:"medium",forwardedAs:markRemoved?"del":"h3",textOverflow:"ellipsis",children:title}),action&&/* @__PURE__ */jsxRuntime.jsx("div",{children:action}),/* @__PURE__ */jsxRuntime.jsx(MetaText,{size:0,textOverflow:"ellipsis",children})]})]});}var __freeze$23=Object.freeze;var __defProp$23=Object.defineProperty;var __template$23=(cooked,raw)=>__freeze$23(__defProp$23(cooked,"raw",{value:__freeze$23(raw||cooked.slice())}));var _a$24;const SlugWrapper=styled__default.default.div(_a$24||(_a$24=__template$23(["\n  display: inline-block;\n  word-break: break-all;\n  white-space: pre-wrap;\n"])));const SlugPreview=props=>{const{value}=props;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{as:SlugWrapper,paddingX:2,paddingY:1,children:value.current});};function immutableReconcile(previous,next){return _immutableReconcile(previous,next,/* @__PURE__ */new WeakSet());}function _immutableReconcile(previous,next,parents){if(previous===next)return previous;if(parents.has(next)){return next;}if(previous==null||next==null)return next;const prevType=typeof previous;const nextType=typeof next;if(prevType!==nextType)return next;if(Array.isArray(next)){parents.add(next);let allEqual=previous.length===next.length;const result=[];for(let index=0;index<next.length;index++){const nextItem=_immutableReconcile(previous[index],next[index],parents);if(nextItem!==previous[index]){allEqual=false;}result[index]=nextItem;}parents.delete(next);return allEqual?previous:result;}if(typeof next==="object"){parents.add(next);const nextKeys=Object.keys(next);let allEqual=Object.keys(previous).length===nextKeys.length;const result={};for(const key of nextKeys){const nextValue=_immutableReconcile(previous[key],next[key],parents);if(nextValue!==previous[key]){allEqual=false;}result[key]=nextValue;}parents.delete(next);return allEqual?previous:result;}return next;}const PresenceContext=React.createContext([]);function PresenceProvider(props){return/* @__PURE__ */jsxRuntime.jsx(PresenceContext.Provider,{value:props.presence,children:props.children});}function useFormFieldPresence(){const ctx=React.useContext(PresenceContext);if(!ctx){throw new Error("Form context not provided");}return ctx;}function useChildPresence(path,inclusive){const presence=useFormFieldPresence();const prev=React.useRef(presence);const next=immutableReconcile(prev.current,presence.filter(item=>PathUtils.startsWith(path,item.path)&&(inclusive||!PathUtils.isEqual(path,item.path))));prev.current=next;return next;}const FormBuilderContext=React.createContext(null);function useFormBuilder(){const formBuilder=React.useContext(FormBuilderContext);if(!formBuilder){throw new Error("FormBuilder: missing context value");}return formBuilder;}var __freeze$22=Object.freeze;var __defProp$22=Object.defineProperty;var __template$22=(cooked,raw)=>__freeze$22(__defProp$22(cooked,"raw",{value:__freeze$22(raw||cooked.slice())}));var _a$23;const getIcon=level=>{if(level==="error"){return/* @__PURE__ */jsxRuntime.jsx(icons.ErrorOutlineIcon,{});}if(level==="warning"){return/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{});}return/* @__PURE__ */jsxRuntime.jsx(icons.InfoOutlineIcon,{});};const IconText=styled__default.default(ui.Text)(_ref93=>{let{theme}=_ref93;return styled.css(_a$23||(_a$23=__template$22(["\n    &[data-info] {\n      color: ",";\n    }\n\n    &[data-warning] {\n      color: ",";\n    }\n\n    &[data-error] {\n      color: ",";\n    }\n  "])),theme.sanity.color.muted.primary.enabled.fg,theme.sanity.color.muted.caution.enabled.fg,theme.sanity.color.muted.critical.enabled.fg);});function DefaultMarkers(props){const{markers,validation,renderCustomMarkers}=props;const{CustomMarkers}=useFormBuilder().__internal.components;if(markers.length===0&&validation.length===0){return null;}return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:1,children:[validation.length>0&&validation.map((_ref94,index)=>{let{message,level}=_ref94;return(// eslint-disable-next-line react/no-array-index-key
/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginRight:2,marginBottom:index+1===validation.length?0:2,children:/* @__PURE__ */jsxRuntime.jsx(IconText,{size:1,"data-error":level==="error"?"":void 0,"data-warning":level==="warning"?"":void 0,"data-info":level==="info"?"":void 0,children:getIcon(level)})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:message||"Error"})})]},"validationItem-".concat(index)));}),markers.length>0&&/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{marginTop:validation.length>0?3:0,children:[renderCustomMarkers&&renderCustomMarkers(markers),!renderCustomMarkers&&/* @__PURE__ */jsxRuntime.jsx(CustomMarkers,{markers})]})]});}function debugRender(style){return void 0;}const ValidationContext=React.createContext([]);function ValidationProvider(props){return/* @__PURE__ */jsxRuntime.jsx(ValidationContext.Provider,{value:props.validation,children:props.children});}function useValidationMarkers(){const ctx=React.useContext(ValidationContext);if(!ctx){throw new Error("Form context not provided");}return ctx;}function useChildValidation(path){let inclusive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;const validation=useValidationMarkers();return React.useMemo(()=>validation.filter(item=>PathUtils.startsWith(path,item.path)&&(inclusive||!PathUtils.isEqual(path,item.path))).map(marker=>({message:marker.message,level:marker.level,path:marker.path})),[inclusive,path,validation]);}const NONEXISTENT_PATH=["@@_NONEXISTENT_PATH_@@"];function useMemberValidation(member){const prev=React.useRef(null);const memberValidation=(member==null?void 0:member.validation)&&member.validation.length>0?member.validation:EMPTY_ARRAY$9;const childValidation=useChildValidation((member==null?void 0:member.path)||NONEXISTENT_PATH);const validation=React.useMemo(()=>(member==null?void 0:member.schemaType)&&isBlockType(member==null?void 0:member.schemaType)?memberValidation:memberValidation.concat(childValidation),[childValidation,member,memberValidation]);const[hasError,hasWarning,hasInfo]=React.useMemo(()=>[validation.filter(v=>v.level==="error").length>0,validation.filter(v=>v.level==="warning").length>0,validation.filter(v=>v.level==="info").length>0],[validation]);const reconciled=immutableReconcile(prev.current,validation);prev.current=reconciled;return React.useMemo(()=>{return{validation:reconciled,hasError,hasWarning,hasInfo};},[reconciled,hasError,hasWarning,hasInfo]);}const PortableTextMarkersContext=React.createContext([]);function PortableTextMarkersProvider(props){return/* @__PURE__ */jsxRuntime.jsx(PortableTextMarkersContext.Provider,{value:props.markers,children:props.children});}function usePortableTextMarkers(path){const ctx=React.useContext(PortableTextMarkersContext);if(!ctx){throw new Error("Form context not provided");}const markers=React.useMemo(()=>ctx.filter(m=>PathUtils.isEqual(m.path,path)),[ctx,path]);return markers;}const POPOVER_PROPS$4={placement:"right",fallbackPlacements:["top","bottom"]};function FieldActionMenuGroup(props){const{group}=props;const{title}=useI18nText(group);if(group.expanded){return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:2,paddingTop:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:title})}),group.children.map((item,idx)=>{var _a;return/* @__PURE__ */jsxRuntime.jsx(FieldActionMenuNode,{action:item,isFirst:idx===0,prevIsGroup:((_a=group.children[idx-1])==null?void 0:_a.type)==="group"},idx);})]});}return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuGroup,{icon:group.icon,popover:POPOVER_PROPS$4,text:title,tone:group.tone,children:group.children.map((item,idx)=>{var _a;return/* @__PURE__ */jsxRuntime.jsx(FieldActionMenuNode,{action:item,isFirst:idx===0,prevIsGroup:((_a=group.children[idx-1])==null?void 0:_a.type)==="group"},idx);})});}function FieldActionMenuItem(props){const{action}=props;const{title}=useI18nText(action);const handleClick=React.useCallback(()=>{action.onAction();},[action]);const disabledTooltipContent=typeof action.disabled==="object"&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:action.disabled.reason});return/* @__PURE__ */jsxRuntime.jsx(TooltipOfDisabled,{content:disabledTooltipContent,placement:"left",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{disabled:Boolean(action.disabled),icon:action.icon,iconRight:action.iconRight||(action.selected?icons.CheckmarkIcon:void 0),onClick:handleClick,pressed:action.selected,text:title,tone:action.tone})});}function FieldActionMenuNode(props){const{action,isFirst,prevIsGroup}=props;if(action.type==="divider"){return/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{});}if(action.type==="group"){return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[!isFirst&&/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{}),/* @__PURE__ */jsxRuntime.jsx(FieldActionMenuGroup,{group:action})]});}return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[prevIsGroup&&/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{}),/* @__PURE__ */jsxRuntime.jsx(FieldActionMenuItem,{action})]});}const STATUS_BUTTON_TOOLTIP_PROPS={placement:"top"};function renderAsButton(node){return"renderAsButton"in node&&node.renderAsButton;}const FieldActionMenu=React.memo(function FieldActionMenu2(props){const{nodes,onMenuOpenChange}=props;const[open,setOpen]=React.useState(false);const handleOpen=React.useCallback(()=>{onMenuOpenChange(true);setOpen(true);},[onMenuOpenChange]);const handleClose=React.useCallback(()=>{onMenuOpenChange(false);setOpen(false);},[onMenuOpenChange]);const buttonNodes=React.useMemo(()=>nodes.filter(renderAsButton),[nodes]);const menuNodesProp=React.useMemo(()=>nodes.filter(node=>!renderAsButton(node)),[nodes]);const menuNodes=React.useMemo(()=>{const len=menuNodesProp.length;if(len===0||len>1)return menuNodesProp;const node=menuNodesProp[0];if(node.type==="group"){return[{...node,expanded:true}];}return menuNodesProp;},[menuNodesProp]);const rootNodes=React.useMemo(()=>[...(menuNodes.length?[{type:"group",children:menuNodes,icon:icons.EllipsisHorizontalIcon,title:"Field actions"}]:[]),...buttonNodes],[buttonNodes,menuNodes]);return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:rootNodes.map((node,idx)=>/* @__PURE__ */jsxRuntime.jsx(RootFieldActionMenuNode,{node,onOpen:handleOpen,onClose:handleClose,open},idx))});});const RootFieldActionMenuNode=React.memo(function RootFieldActionMenuNode2(props){const{node,onOpen,onClose,open}=props;if(node.type==="divider"){return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderLeft:true,flex:"none"});}if(node.type==="action"){return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:node.icon,mode:"bleed",onClick:node.onAction,tooltipProps:{...STATUS_BUTTON_TOOLTIP_PROPS,content:node.title}});}return/* @__PURE__ */jsxRuntime.jsx(RootFieldActionMenuGroup,{node,onOpen,onClose,open});});const ROOT_MENU_BUTTON_POPOVER_PROPS={constrainSize:true,placement:"right",portal:true,fallbackPlacements:["top","bottom"]};function RootFieldActionMenuGroup(props){const{node,onOpen,onClose,open}=props;const{title}=useI18nText(node);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:node.icon,label:open?void 0:title,mode:"bleed",tooltipProps:{...STATUS_BUTTON_TOOLTIP_PROPS,content:node.title}}),id:React.useId(),menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:node.children.map((action,idx)=>{var _a;return/* @__PURE__ */jsxRuntime.jsx(FieldActionMenuNode,{action,isFirst:idx===0,prevIsGroup:((_a=node.children[idx-1])==null?void 0:_a.type)==="group"},idx);})}),onOpen,onClose,popover:ROOT_MENU_BUTTON_POPOVER_PROPS});}const HoveredFieldContext=React.createContext({hoveredStack:[],onMouseEnter:()=>void 0,onMouseLeave:()=>void 0});function useHoveredField(){return React.useContext(HoveredFieldContext);}const FieldActionsContext=React.createContext({actions:[],focused:false,hovered:false,onMouseEnter:()=>void 0,onMouseLeave:()=>void 0});function FieldActionsProvider(props){const{actions,children,path,focused}=props;const{onMouseEnter:onFieldMouseEnter,onMouseLeave:onFieldMouseLeave}=useHoveredField();const hoveredPath=useHoveredField().hoveredStack[0];const hovered=supportsTouch||(hoveredPath?pathToString$1(path)===hoveredPath:false);const handleMouseEnter=React.useCallback(()=>{onFieldMouseEnter(path);},[onFieldMouseEnter,path]);const handleMouseLeave=React.useCallback(()=>{onFieldMouseLeave(path);},[onFieldMouseLeave,path]);const context=React.useMemo(()=>({actions,focused,hovered,onMouseEnter:handleMouseEnter,onMouseLeave:handleMouseLeave}),[actions,focused,handleMouseEnter,handleMouseLeave,hovered]);return/* @__PURE__ */jsxRuntime.jsx(FieldActionsContext.Provider,{value:context,children});}function filterActions(actions){return actions.filter(Boolean).filter(node=>{if("hidden"in node)return node.hidden!==true;return true;}).map(node=>{if(node.type==="group"){return{...node,children:filterActions(node.children)};}return node;});}const FieldActionsResolver=React.memo(function FieldActions(props){const{actions,documentId,documentType,onActions,path,schemaType}=props;const len=actions.length;const lenRef=React.useRef(len);const[fieldActions,setFieldActions]=React.useState(()=>Array.from(new Array(len)));const fieldActionsRef=React.useRef(fieldActions);const setFieldAction=React.useCallback((index,node)=>{setFieldActions(prev=>{const next=[...prev];next[index]=node;return next;});},[]);React.useEffect(()=>{if(fieldActionsRef.current!==fieldActions){fieldActionsRef.current=fieldActions;onActions(filterActions(fieldActions));}},[fieldActions,onActions]);React.useEffect(()=>{if(lenRef.current!==len){const newFieldActions=Array.from(new Array(len));for(let i=0;i<len;i++){newFieldActions[i]=fieldActionsRef.current[i];}lenRef.current=len;setFieldActions(newFieldActions);fieldActionsRef.current=newFieldActions;}},[len]);return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:actions.map((a,aIdx)=>/* @__PURE__ */jsxRuntime.jsx(FieldAction,{action:a,index:aIdx,documentId,documentType,path,schemaType,setFieldAction},aIdx))});});const FieldAction=React.memo(function FieldAction2(props){const{action,documentId,documentType,index,path,schemaType,setFieldAction}=props;const node=useUnique(action.useAction({documentId,documentType,path,schemaType}));React.useEffect(()=>{setFieldAction(index,node);},[index,node,setFieldAction]);return null;});function useFieldActions(){return React.useContext(FieldActionsContext);}const FormFieldPresenceContext=React.createContext([]);var __freeze$21=Object.freeze;var __defProp$21=Object.defineProperty;var __template$21=(cooked,raw)=>__freeze$21(__defProp$21(cooked,"raw",{value:__freeze$21(raw||cooked.slice())}));var _a$22;const PRESENCE_MENU_POPOVER_PROPS={portal:true};const AvatarStackBox=styled__default.default.div(props=>{const{space}=theme.getTheme_v2(props.theme);return styled.css(_a$22||(_a$22=__template$21(["\n    margin: ","px;\n  "])),0-space[1]);});const getTooltipText=presence=>{if(presence.length===1){return"".concat(presence[0].user.displayName," is editing this document");}if(presence.length>1){return"".concat(presence.length," people are editing this document right now");}return void 0;};function DocumentPreviewPresence(props){const{presence}=props;const uniqueUsers=React.useMemo(()=>Array.from(new Set(presence.map(a=>a.user.id))).map(id=>{return presence.find(a=>a.user.id===id);}).filter(isNonNullable$2),[presence]);const tooltipContent=React.useMemo(()=>getTooltipText(uniqueUsers),[uniqueUsers]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:tooltipContent,...PRESENCE_MENU_POPOVER_PROPS,children:/* @__PURE__ */jsxRuntime.jsx(AvatarStackBox,{children:/* @__PURE__ */jsxRuntime.jsx(ui.AvatarStack,{maxLength:2,"aria-label":getTooltipText(uniqueUsers),size:0,children:uniqueUsers.map(item=>/* @__PURE__ */jsxRuntime.jsx(UserAvatar,{size:0,user:item.user},item.user.id))})})});}const symbols=/[^\p{Alpha}\p{White_Space}]/gu;const whitespace=new RegExp("\\p{White_Space}+","u");const LEGACY_TO_UI_AVATAR_SIZES={small:0,medium:1,large:2};function nameToInitials(fullName){const namesArray=fullName.replace(symbols,"").split(whitespace);if(namesArray.length===1){return"".concat(namesArray[0].charAt(0)).toUpperCase();}return"".concat(namesArray[0].charAt(0)).concat(namesArray[namesArray.length-1].charAt(0));}function UserAvatar(props){const{user,...restProps}=props;if(isRecord$4(user)){if(restProps.withTooltip){return/* @__PURE__ */jsxRuntime.jsx(TooltipUserAvatar,{...restProps,user});}return/* @__PURE__ */jsxRuntime.jsx(StaticUserAvatar,{...restProps,user});}return/* @__PURE__ */jsxRuntime.jsx(UserAvatarLoader,{...props,user});}function TooltipUserAvatar(props){const{user:{displayName}}=props;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:displayName,placement:"top",portal:true,children:/* @__PURE__ */jsxRuntime.jsx("div",{style:{display:"inline-block"},children:/* @__PURE__ */jsxRuntime.jsx(StaticUserAvatar,{...props})})});}const StaticUserAvatar=React.forwardRef(function StaticUserAvatar2(props,ref){const{user,animateArrowFrom,position,size,status,tone,...restProps}=props;const[imageLoadError,setImageLoadError]=React.useState(null);const userColor=useUserColor(user.id);const imageUrl=imageLoadError?void 0:user==null?void 0:user.imageUrl;return/* @__PURE__ */jsxRuntime.jsx(ui.Avatar,{__unstable_hideInnerStroke:true,animateArrowFrom,arrowPosition:position,color:userColor.name,"data-legacy-tone":tone,initials:(user==null?void 0:user.displayName)&&nameToInitials(user.displayName),src:imageUrl,onImageLoadError:setImageLoadError,ref,size:typeof size==="string"?LEGACY_TO_UI_AVATAR_SIZES[size]:size,status,title:user==null?void 0:user.displayName,...restProps});});function UserAvatarLoader(_ref95){let{user,...loadedProps}=_ref95;const[value]=useUser(user);if(!value){return null;}return/* @__PURE__ */jsxRuntime.jsx(UserAvatar,{...loadedProps,user:value});}const MAX_AVATARS_DOCK=3;const DEFAULT_MAX_AVATARS_FIELDS=3;const AVATAR_DISTANCE=-4;const AVATAR_SIZE=25;const AVATAR_ARROW_HEIGHT=4;const INTERSECTION_THRESHOLDS=[0,0.25,0.75,1];const INTERSECTION_ELEMENT_PADDING=23;const SNAP_TO_DOCK_DISTANCE_TOP=8;const SNAP_TO_DOCK_DISTANCE_BOTTOM=8;const SLIDE_RIGHT_THRESHOLD_TOP=20;const SLIDE_RIGHT_THRESHOLD_BOTTOM=20;const DEBUG=false;var __freeze$20=Object.freeze;var __defProp$20=Object.defineProperty;var __template$20=(cooked,raw)=>__freeze$20(__defProp$20(cooked,"raw",{value:__freeze$20(raw||cooked.slice())}));var _a$21,_b$X;const FlexWrapper$1=styled__default.default(ui.Flex)(_a$21||(_a$21=__template$20(["\n  & > div:first-child {\n    flex: 1;\n    min-width: 0;\n  }\n"])));const InnerBox=styled__default.default(ui.Flex)(_b$X||(_b$X=__template$20(["\n  height: ","px;\n  min-width: 23px;\n  vertical-align: top;\n"])),AVATAR_SIZE);const{Tracker,useReporter,useReportedValues}=createTrackerScope();function PresenceTooltip(props){const{children,items}=props;const content=React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{sizing:"border",children:items.map(item=>/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:2,children:[/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(UserAvatar,{user:item.user,status:"online"})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:item.user.displayName})]},item.user.id))}),[items]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content,placement:"top",portal:"documentScrollElement",children});}const splitRight=(array,max)=>{const indexFromMax=array.length>max?max-1:max;const idx=Math.max(0,array.length-indexFromMax);return[array.slice(0,idx),array.slice(idx)];};function calcAvatarStackWidth(len){return-AVATAR_DISTANCE+(AVATAR_SIZE+AVATAR_DISTANCE)*len;}const FieldPresenceInner=React.memo(function FieldPresenceInner2(_ref96){let{presence,position="inside",animateArrowFrom="inside",maxAvatars=DEFAULT_MAX_AVATARS_FIELDS,stack=true}=_ref96;const uniquePresence=uniqBy__default.default(presence||[],item=>item.user.id);const sorted=sortBy__default.default(uniquePresence,_presence=>_presence.lastActiveAt);const[hidden,visible]=stack?splitRight(sorted,maxAvatars):[[],sorted];const avatars=[...visible.reverse().map(_visible=>({key:_visible.user.id,element:/* @__PURE__ */jsxRuntime.jsx(UserAvatar,{animateArrowFrom,position,status:"online",user:_visible.user})})),hidden.length>=2?{key:"counter",element:/* @__PURE__ */jsxRuntime.jsx(ui.AvatarCounter,{count:hidden.length})}:null].filter(Boolean);return/* @__PURE__ */jsxRuntime.jsxs(FlexWrapper$1,{children:[/* @__PURE__ */jsxRuntime.jsx("div",{}),/* @__PURE__ */jsxRuntime.jsx(InnerBox,{direction:"row-reverse",children:avatars.map((av,i)=>av&&/* @__PURE__ */jsxRuntime.jsx("div",{style:{position:"absolute",transform:"translate3d(".concat(-i*(AVATAR_SIZE+AVATAR_DISTANCE),"px, 0px, 0px)"),transitionProperty:"transform",transitionDuration:"200ms",transitionTimingFunction:"cubic-bezier(0.85, 0, 0.15, 1)",zIndex:100-i},children:av.element},av.key))})]});});function FieldPresenceWithOverlay(props){const contextPresence=React.useContext(FormFieldPresenceContext);const{presence=contextPresence,maxAvatars=DEFAULT_MAX_AVATARS_FIELDS}=props;const ref=React.useRef(null);useReporter(React.useId(),()=>({presence,element:ref.current,maxAvatars}));const uniquePresence=React.useMemo(()=>uniqBy__default.default(presence||[],item=>item.user.id),[presence]);return/* @__PURE__ */jsxRuntime.jsx(PresenceTooltip,{items:uniquePresence,children:/* @__PURE__ */jsxRuntime.jsx(FlexWrapper$1,{ref,style:{minHeight:AVATAR_SIZE,minWidth:AVATAR_SIZE}})});}function FieldPresenceWithoutOverlay(props){const contextPresence=React.useContext(FormFieldPresenceContext);const{presence=contextPresence,maxAvatars=DEFAULT_MAX_AVATARS_FIELDS}=props;if(!presence.length){return null;}return/* @__PURE__ */jsxRuntime.jsx(FieldPresenceInner,{presence,maxAvatars});}const FieldPresence=FieldPresenceWithOverlay;const createIntersectionObserver=options=>{const entries$=new rxjs.Subject();const intersectionObserver=new IntersectionObserver(entries=>{entries.forEach(entry=>{entries$.next(entry);});},options);return{observe:element=>{return new rxjs.Observable(subscriber=>{const subscription=entries$.pipe(operators.filter(entry=>entry.target===element)).subscribe(subscriber);intersectionObserver.observe(element);return()=>{subscription.unsubscribe();intersectionObserver.unobserve(element);};});}};};const WithIntersection=props=>{const{onIntersection,io,id,...rest}=props;const element=React.useRef(null);React.useEffect(()=>{const el=element.current;if(!el)return void 0;const subscription=io.observe(el).pipe(operators.tap(entry=>onIntersection(id,entry))).subscribe();return()=>subscription.unsubscribe();},[io,id,onIntersection]);return/* @__PURE__ */jsxRuntime.jsx("div",{ref:element,...rest});};var __freeze$1$=Object.freeze;var __defProp$1$=Object.defineProperty;var __template$1$=(cooked,raw)=>__freeze$1$(__defProp$1$(cooked,"raw",{value:__freeze$1$(raw||cooked.slice())}));var _a$20,_b$W,_c$w,_d$j,_e$b,_f$8,_g$6;const RootWrapper=styled__default.default.div(_a$20||(_a$20=__template$1$(["\n  position: relative;\n"])));const OverlayWrapper=styled__default.default.div(_b$W||(_b$W=__template$1$(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  pointer-events: none;\n  z-index: 13;\n"])));const RegionWrapper=styled.css(_c$w||(_c$w=__template$1$(["\n  overflow: hidden;\n  overflow: clip;\n  pointer-events: none;\n  position: absolute;\n"])));const TopRegionWrapper=styled__default.default(WithIntersection)(_ref97=>{let{$debug,margins}=_ref97;return styled.css(_d$j||(_d$j=__template$1$(["\n    ","\n\n    z-index: 100;\n    position: sticky;\n    height: 1px;\n    top: ",";\n    background-color: ",";\n  "])),RegionWrapper,margins?"".concat(margins[0]-1,"px"):void 0,$debug?"red":"none");});const MiddleRegionWrapper=styled__default.default(WithIntersection)(_ref98=>{let{$debug}=_ref98;return styled.css(_f$8||(_f$8=__template$1$(["\n    ","\n\n    visibility: none;\n\n    ","\n  "])),RegionWrapper,$debug&&styled.css(_e$b||(_e$b=__template$1$(["\n      background: rgba(255, 0, 0, 0.25);\n      outline: 1px solid #00b;\n      visibility: visible;\n    "]))));});const BottomRegionWrapper=styled__default.default(WithIntersection)(_ref99=>{let{$debug}=_ref99;return styled.css(_g$6||(_g$6=__template$1$(["\n    ","\n\n    position: sticky;\n    bottom: -1px;\n    height: 1px;\n    background-color: ",";\n  "])),RegionWrapper,$debug?"blue":"transparent");});const toPx=num=>"".concat(num,"px");const negate=num=>0-num;const RegionsWithIntersections=React.forwardRef(function RegionsWithIntersections2(props,ref){const{regions,render,children,margins:marginsProp}=props;const overlayRef=React.useRef(null);const margins=React.useMemo(()=>marginsProp,[JSON.stringify(marginsProp)]);const io=React.useMemo(()=>createIntersectionObserver({rootMargin:margins.map(negate).map(toPx).join(" "),threshold:INTERSECTION_THRESHOLDS}),[margins]);const[intersections,setIntersections]=React.useState({});const onIntersection=React.useCallback((id,entry)=>{setIntersections(current=>({...current,[id]:entry}));},[]);const top=intersections["::top"];const bottom=intersections["::bottom"];const regionsWithIntersectionDetails=React.useMemo(()=>top&&bottom?regions.filter(region=>{var _a;return((_a=region.presence)==null?void 0:_a.length)>0;}).map(region=>{const intersection=intersections[region.id];if(!intersection){return null;}const{bottom:boundsBottom,top:boundsTop}=intersection.boundingClientRect;const aboveTop=intersection.boundingClientRect.top<top.boundingClientRect.bottom;const belowBottom=intersection.boundingClientRect.top<bottom.boundingClientRect.top;const distanceTop=intersection.isIntersecting?boundsTop-(intersection.intersectionRect.top-INTERSECTION_ELEMENT_PADDING):aboveTop?-top.boundingClientRect.bottom:bottom.boundingClientRect.top;const distanceBottom=intersection.isIntersecting?-(boundsBottom-(intersection.intersectionRect.bottom+INTERSECTION_ELEMENT_PADDING)):belowBottom?bottom.boundingClientRect.top:-top.boundingClientRect.bottom;const position=// eslint-disable-next-line no-nested-ternary
distanceTop<=SNAP_TO_DOCK_DISTANCE_TOP?"top":distanceBottom<=SNAP_TO_DOCK_DISTANCE_BOTTOM?"bottom":"inside";return{distanceTop,distanceBottom,region,position};}).filter(Boolean):[],[bottom,intersections,regions,top]);return/* @__PURE__ */jsxRuntime.jsxs(RootWrapper,{ref,children:[/* @__PURE__ */jsxRuntime.jsx(TopRegionWrapper,{$debug:DEBUG,io,id:"::top",onIntersection,margins}),/* @__PURE__ */jsxRuntime.jsx("div",{children}),/* @__PURE__ */jsxRuntime.jsx(OverlayWrapper,{ref:overlayRef,children:overlayRef.current&&render(regionsWithIntersectionDetails,overlayRef.current.offsetWidth)}),regions.map(region=>{const forceWidth=region.rect.width===0;return/* @__PURE__ */jsxRuntime.jsx(MiddleRegionWrapper,{$debug:DEBUG,io,onIntersection,id:region.id,style:{width:forceWidth?1:region.rect.width,left:region.rect.left-(forceWidth?1:0),top:region.rect.top-INTERSECTION_ELEMENT_PADDING,height:region.rect.height+INTERSECTION_ELEMENT_PADDING*2}},region.id);}),/* @__PURE__ */jsxRuntime.jsx(BottomRegionWrapper,{$debug:DEBUG,id:"::bottom",io,onIntersection})]});});const ITEM_TRANSITION={transitionProperty:"transform",transitionDuration:"200ms",transitionTimingFunction:"cubic-bezier(0.85, 0, 0.15, 1)"};const bottom=rect=>rect.top+rect.height;function withSpacerHeight(regionsWithIntersectionDetails){return regionsWithIntersectionDetails.map((withIntersection,idx,_regionsWithIntersectionDetails)=>{var _a;const prevRect=(_a=_regionsWithIntersectionDetails[idx-1])==null?void 0:_a.region.rect;const prevBottom=prevRect?bottom(prevRect):0;return{...withIntersection,spacerHeight:withIntersection.region.rect.top-prevBottom};});}const orderByTop=regionsWithIntersectionDetails=>orderBy__default.default(regionsWithIntersectionDetails,withIntersection=>withIntersection.region.rect.top);const plus=(a,b)=>a+b;const sum=array=>array.reduce(plus,0);function group(regionsWithIntersectionDetails){const regionsWithSpacerHeight=withSpacerHeight(orderByTop(regionsWithIntersectionDetails));const grouped={top:[],inside:[],bottom:[],...groupBy__default.default(regionsWithSpacerHeight,_withSpacerHeight=>_withSpacerHeight.position)};return{top:orderByTop(grouped.top).map((withIntersection,i,grp)=>({...withIntersection,indent:grp.slice(i+1).reduce((w,_withIntersection)=>w+_withIntersection.region.rect.width,0)})),inside:orderByTop(grouped.inside).map(withIntersection=>({...withIntersection,indent:0})),bottom:orderByTop(grouped.bottom).map((withIntersection,i,grp)=>({...withIntersection,indent:grp.slice(0,i).reduce((w,_withIntersection)=>w+_withIntersection.region.rect.width,0)}))};}const Spacer=_ref100=>{let{height,...rest}=_ref100;return/* @__PURE__ */jsxRuntime.jsx("div",{style:{height:Math.max(0,height),...(rest==null?void 0:rest.style)}});};const DEFAULT_MARGINS$1=[0,0,0,0];const getOffsetsTo=(source,target)=>{let el=source;let top=-el.scrollTop;let left=0;while(el&&el!==target){top+=el.offsetTop-el.scrollTop;left+=el.offsetLeft;el=el.offsetParent instanceof HTMLElement?el.offsetParent:null;}return{top,left};};function getRelativeRect(element,parent){return{...getOffsetsTo(element,parent),width:element.offsetWidth,height:element.offsetHeight};}function regionsWithComputedRects(regions,parent){return regions.map(_ref101=>{let[id,region]=_ref101;return{...region,id,rect:getRelativeRect(region.element,parent)};});}function StickyOverlay(props){const{children,margins=DEFAULT_MARGINS$1}=props;const reportedValues=useReportedValues();const ref=React.useRef(null);const regions=React.useMemo(()=>ref.current?regionsWithComputedRects(reportedValues,ref.current):EMPTY_ARRAY$8,[reportedValues]);const renderCallback=React.useCallback((regionsWithIntersectionDetails,containerWidth)=>{const grouped=group(regionsWithIntersectionDetails.filter(item=>item.region.presence.length>0));const topSpacing=sum(grouped.top.map(n=>n.region.rect.height+n.spacerHeight));const bottomSpacing=sum([...grouped.inside,...grouped.bottom].map(n=>n.region.rect.height+n.spacerHeight));const counts=grouped.inside.reduce((_counts,withIntersection)=>{const{distanceTop,distanceBottom}=withIntersection;const nearTop=distanceTop<=SLIDE_RIGHT_THRESHOLD_TOP;const nearBottom=distanceBottom<=SLIDE_RIGHT_THRESHOLD_BOTTOM;return{nearTop:_counts.nearTop+(nearTop?withIntersection.region.presence.length:0),nearBottom:_counts.nearBottom+(nearBottom?withIntersection.region.presence.length:0)};},{nearTop:0,nearBottom:0});return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(PresenceDock,{closeCount:counts.nearTop,margins,position:"top",regionsWithIntersectionDetails:grouped.top}),/* @__PURE__ */jsxRuntime.jsx(Spacer,{height:topSpacing}),/* @__PURE__ */jsxRuntime.jsx(PresenceInside,{containerWidth,regionsWithIntersectionDetails:grouped.inside}),/* @__PURE__ */jsxRuntime.jsx(Spacer,{height:bottomSpacing}),/* @__PURE__ */jsxRuntime.jsx(PresenceDock,{closeCount:counts.nearBottom,margins,position:"bottom",regionsWithIntersectionDetails:grouped.bottom})]});},[margins]);return/* @__PURE__ */jsxRuntime.jsx(RegionsWithIntersections,{ref,margins,regions,render:renderCallback,children});}const EMPTY_ARRAY$8=[];const PresenceDock=React.memo(function PresenceDock2(props){const{closeCount,margins,position,regionsWithIntersectionDetails}=props;const dir=position==="top"?1:-1;const allPresenceItems=React.useMemo(()=>{if(!regionsWithIntersectionDetails.length){return EMPTY_ARRAY$8;}return flatten__default.default(sortBy__default.default(regionsWithIntersectionDetails,r=>r.region.rect.top*dir).map(withIntersection=>withIntersection.region.presence||EMPTY_ARRAY$8));},[dir,regionsWithIntersectionDetails]);const[topMargin,rightMargin,bottomMargin,leftMargin]=margins;const leftOffset=(leftMargin||0)+(allPresenceItems.length>0?-closeCount*(AVATAR_SIZE+AVATAR_DISTANCE):0)-rightMargin;const margin=position==="top"?topMargin:bottomMargin;const style=React.useMemo(()=>({zIndex:2,position:"sticky",display:"flex",flexDirection:"column",alignItems:"flex-end",...ITEM_TRANSITION,transform:"translate3d(".concat(leftOffset,"px, 0px, 0px)"),top:AVATAR_ARROW_HEIGHT+1+margin,bottom:AVATAR_ARROW_HEIGHT+1+margin}),[leftOffset,margin]);return/* @__PURE__ */jsxRuntime.jsx("div",{"data-dock":position,style,children:/* @__PURE__ */jsxRuntime.jsx(FieldPresenceInner,{position,maxAvatars:MAX_AVATARS_DOCK,presence:allPresenceItems})},"sticky-".concat(position));});function PresenceInside(props){const{regionsWithIntersectionDetails,containerWidth}=props;return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:regionsWithIntersectionDetails.map(withIntersection=>{const originalLeft=withIntersection.region.rect.left;const{distanceTop,distanceBottom}=withIntersection;const nearTop=distanceTop<=SLIDE_RIGHT_THRESHOLD_TOP;const nearBottom=distanceBottom<=SLIDE_RIGHT_THRESHOLD_BOTTOM;const diffRight=containerWidth-originalLeft-withIntersection.region.rect.width;const{presence,maxAvatars}=withIntersection.region;return/* @__PURE__ */jsxRuntime.jsx(React.Fragment,{children:/* @__PURE__ */jsxRuntime.jsx("div",{style:{zIndex:2,position:"absolute",...ITEM_TRANSITION,left:originalLeft,transform:"translate3d(".concat(nearTop||nearBottom?diffRight:0,"px, 0px, 0px)"),height:withIntersection.region.rect.height,top:withIntersection.region.rect.top},children:/* @__PURE__ */jsxRuntime.jsx(DebugValue,{value:()=>"\u2912".concat(distanceTop," | ").concat(distanceBottom,"\u2913"),children:/* @__PURE__ */jsxRuntime.jsx(FieldPresenceInner,{stack:!nearTop&&!nearBottom,position:nearTop?"top":nearBottom?"bottom":"inside",maxAvatars,presence})})})},withIntersection.region.id);})});}const PassThrough=props=>props.children;const DebugValue=PassThrough;const DEFAULT_MARGINS=[0,0,0,0];function OverlayEnabled(_ref102){let{children,margins}=_ref102;return/* @__PURE__ */jsxRuntime.jsx(Tracker,{children:/* @__PURE__ */jsxRuntime.jsx(StickyOverlay,{margins:margins||DEFAULT_MARGINS,children})});}function OverlayDisabled(props){return props.children;}const PresenceOverlay=OverlayEnabled;var __freeze$1_=Object.freeze;var __defProp$1_=Object.defineProperty;var __template$1_=(cooked,raw)=>__freeze$1_(__defProp$1_(cooked,"raw",{value:__freeze$1_(raw||cooked.slice())}));var _a$1$,_b$V,_c$v,_d$i,_e$a;const Root$q=styled__default.default(ui.Flex)(_ref103=>{let{theme,$floatingCardWidth,$slotWidth,$floatingCardVisible}=_ref103;const{space}=theme.sanity;return styled.css(_a$1$||(_a$1$=__template$1_(["\n    /* Prevent buttons from taking up extra vertical space */\n    line-height: 1;\n    width: 100%;\n    /* For floating actions menu */\n    position: relative;\n\n    [data-ui='PresenceBox'] {\n      position: absolute;\n      bottom: 0;\n      right: ","px;\n    }\n    @media (hover: hover) {\n      // If hover is supported, we hide the floating card by default, so only add space for it when it's visible.\n      [data-ui='PresenceBox'] {\n        position: absolute;\n        bottom: 0;\n        right: ","px;\n      }\n    }\n  "])),$slotWidth+$floatingCardWidth+space[1],$slotWidth+($floatingCardVisible?$floatingCardWidth:0)+space[1]);});const ContentBox=styled__default.default(ui.Box)(_ref104=>{let{theme,$presenceMaxWidth}=_ref104;const{space}=theme.sanity;return styled.css(_b$V||(_b$V=__template$1_(["\n    max-width: calc(100% - ","px);\n    min-width: 75%;\n  "])),$presenceMaxWidth+space[1]);});const SlotBox=styled__default.default(ui.Box)(_ref105=>{let{theme,$right,$fieldActionsVisible}=_ref105;const{space}=theme.sanity;const right=$fieldActionsVisible?$right+space[1]:$right;return styled.css(_c$v||(_c$v=__template$1_(["\n    position: absolute;\n    bottom: 0;\n    right: ","px;\n  "])),right);});const FieldActionsFloatingCard=styled__default.default(ui.Card)(_d$i||(_d$i=__template$1_(["\n  align-items: center;\n  bottom: 0;\n  position: absolute;\n  right: 0;\n  transition: opacity 150ms ease;\n  line-height: 1;\n\n  @media (hover: hover) {\n    // If hover is supported, we hide the floating card by default\n    // and only show it when it has focus within or when the field is hovered or focused.\n    opacity: 0;\n    pointer-events: none;\n\n    [data-ui='FieldActionsFlex'] {\n      opacity: 0;\n    }\n\n    &[data-actions-visible='false']:not(:focus-within) {\n      // Remove the shadow when the field actions are not visible\n      box-shadow: none;\n\n      // Since the field actions always will be present in the DOM (to make them focusable) \u2013\n      // they will always affect the width of the floating card, even when they are not visible.\n      // Therefore, we remove the background of the floating card when the field actions are not visible.\n      background: transparent;\n    }\n\n    // Remove the shadow when the field has comments but no actions\n    &[data-has-comments='true']:not([data-has-actions='true']) {\n      box-shadow: none;\n    }\n\n    // Show the floating card when it has focus within (ie when field actions are focused).\n    &:focus-within {\n      opacity: 1;\n      pointer-events: auto;\n      width: max-content;\n\n      [data-ui='FieldActionsFlex'] {\n        opacity: 1;\n        pointer-events: auto;\n        width: max-content;\n      }\n    }\n  }\n\n  &[data-visible='true'] {\n    opacity: 1;\n    pointer-events: auto;\n    width: max-content;\n  }\n\n  &[data-actions-visible='true'] {\n    [data-ui='FieldActionsFlex'] {\n      opacity: 1;\n      pointer-events: auto;\n      width: max-content;\n    }\n  }\n"])));const FieldActionsFlex=styled__default.default(ui.Flex)(_e$a||(_e$a=__template$1_(["\n  gap: inherit;\n  transition: opacity 150ms ease;\n"])));const MAX_AVATARS=4;function FormFieldBaseHeader(props){const{__internal_comments:comments,__internal_slot:slot,actions,content,fieldFocused,fieldHovered,presence}=props;const[focused,setFocused]=React.useState(false);const[menuOpen,setMenuOpen]=React.useState(false);const[floatingCardElement,setFloatingCardElement]=React.useState(null);const[floatingCardWidth,setFloatingCardWidth]=React.useState(0);const[slotElement,setSlotElement]=React.useState(null);const[slotWidth,setSlotWidth]=React.useState(0);const{hasComments=false,button:commentButton=null,isAddingComment=false}=comments||{};const hasActions=actions&&actions.length>0;const showFieldActions=fieldFocused||fieldHovered||menuOpen||isAddingComment;const hasCommentsButtonOrActions=(comments==null?void 0:comments.button)||hasActions;const shouldShowFloatingCard=focused||showFieldActions||hasComments;const handleSetFloatingCardElementWidth=React.useCallback(()=>{if(floatingCardElement){const{width}=floatingCardElement.getBoundingClientRect();setFloatingCardWidth(width||0);}},[floatingCardElement]);const handleFocusCapture=React.useCallback(()=>{handleSetFloatingCardElementWidth();setFocused(true);},[handleSetFloatingCardElementWidth]);const handleBlurCapture=React.useCallback(()=>{handleSetFloatingCardElementWidth();setFocused(false);},[handleSetFloatingCardElementWidth]);React.useEffect(()=>{handleSetFloatingCardElementWidth();},[handleSetFloatingCardElementWidth,showFieldActions]);React.useEffect(()=>{if(slotElement){const{width}=slotElement.getBoundingClientRect();setSlotWidth(width||0);}},[slotElement]);const slotEl=React.useMemo(()=>{if(!slot)return null;return/* @__PURE__ */jsxRuntime.jsx(SlotBox,{$fieldActionsVisible:Boolean(showFieldActions),$right:floatingCardWidth,ref:setSlotElement,children:slot});},[floatingCardWidth,showFieldActions,slot]);return/* @__PURE__ */jsxRuntime.jsxs(Root$q,{align:"flex-end",justify:"space-between",$floatingCardVisible:shouldShowFloatingCard,$floatingCardWidth:floatingCardWidth,$slotWidth:slotWidth,children:[/* @__PURE__ */jsxRuntime.jsx(ContentBox,{flex:1,paddingY:2,$presenceMaxWidth:calcAvatarStackWidth(MAX_AVATARS),children:content}),presence&&presence.length>0&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{"data-ui":"PresenceBox",flex:"none",children:/* @__PURE__ */jsxRuntime.jsx(FieldPresence,{maxAvatars:MAX_AVATARS,presence})}),slotEl,(hasCommentsButtonOrActions||hasComments)&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.TooltipDelayGroupProvider,{children:/* @__PURE__ */jsxRuntime.jsxs(FieldActionsFloatingCard,{"data-actions-visible":showFieldActions?"true":"false","data-has-actions":hasActions?"true":"false","data-has-comments":hasComments?"true":"false","data-visible":shouldShowFloatingCard?"true":"false",display:"flex",onBlurCapture:handleBlurCapture,onFocusCapture:handleFocusCapture,ref:setFloatingCardElement,sizing:"border",children:[hasActions&&/* @__PURE__ */jsxRuntime.jsx(FieldActionsFlex,{align:"center","data-ui":"FieldActionsFlex",children:/* @__PURE__ */jsxRuntime.jsx(FieldActionMenu,{nodes:actions,onMenuOpenChange:setMenuOpen})}),commentButton]})})]});}function createDescriptionId(id,description){if(!description||!id)return void 0;return"desc_".concat(id);}var __freeze$1Z=Object.freeze;var __defProp$1Z=Object.defineProperty;var __template$1Z=(cooked,raw)=>__freeze$1Z(__defProp$1Z(cooked,"raw",{value:__freeze$1Z(raw||cooked.slice())}));var _a$1_;const EMPTY_ARRAY$7=[];const VALIDATION_ICONS={error:ValidationErrorIcon,warning:ValidationWarningIcon,info:ValidationInfoIcon};const StyledStack=styled__default.default(ui.Stack)(_a$1_||(_a$1_=__template$1Z(["\n  max-width: 200px;\n"])));const StatusText=styled__default.default(ui.Text)(_ref106=>{let{$status}=_ref106;if($status==="error"){return{"--card-icon-color":"var(--card-badge-critical-icon-color)"};}if($status==="warning"){return{"--card-icon-color":"var(--card-badge-caution-icon-color)"};}if($status==="info"){return{"--card-icon-color":"var(--card-badge-primary-icon-color)"};}return{};});function FormFieldValidationStatus(props){const{validation=EMPTY_ARRAY$7,__unstable_showSummary:showSummary,fontSize,placement}=props;const hasErrors=validation.some(v=>v.level==="error");const hasWarnings=validation.some(v=>v.level==="warning");const status=hasErrors?"error":hasWarnings?"warning":"info";const StatusIcon=VALIDATION_ICONS[status];return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:/* @__PURE__ */jsxRuntime.jsxs(StyledStack,{space:3,children:[showSummary&&/* @__PURE__ */jsxRuntime.jsx(FormFieldValidationSummary,{validation}),!showSummary&&/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:validation.map((item,itemIndex)=>// eslint-disable-next-line react/no-array-index-key
/* @__PURE__ */jsxRuntime.jsx(FormFieldValidationStatusItem,{validation:item},itemIndex))})]}),portal:true,placement,fallbackPlacements:["bottom","right","left"],children:/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(StatusText,{$status:status,size:fontSize,weight:"medium",children:StatusIcon&&/* @__PURE__ */jsxRuntime.jsx(StatusIcon,{})})})});}function FormFieldValidationStatusItem(props){const{validation}=props;const StatusIcon=VALIDATION_ICONS[validation.level];return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginRight:2,children:/* @__PURE__ */jsxRuntime.jsx(StatusText,{$status:validation.level,size:1,children:StatusIcon&&/* @__PURE__ */jsxRuntime.jsx(StatusIcon,{})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:validation.message})})]});}function FormFieldValidationSummary(_ref107){let{validation}=_ref107;const{t}=useTranslation();const listFormatter=useListFormat();const errorCount=validation.reduce((count,item)=>item.level==="error"?count+1:count,0);const warningCount=validation.reduce((count,item)=>item.level==="warning"?count+1:count,0);const hasErrors=errorCount>0;const hasWarnings=warningCount>0;if(!hasErrors&&!hasWarnings){return null;}const errorText=hasErrors&&t("form.validation.summary.errors-count",{count:errorCount});const warningText=hasWarnings&&t("form.validation.summary.warnings-count",{count:warningCount});return errorText&&warningText?/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:listFormatter.format([errorText,warningText])}):/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:errorText||warningText});}function ValidationErrorIcon(){const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(icons.ErrorOutlineIcon,{"data-testid":"input-validation-icon-error","aria-label":t("form.validation.has-error-aria-label"),"aria-hidden":true,role:"presentation"});}function ValidationWarningIcon(){const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{"data-testid":"input-validation-icon-warning","aria-label":t("form.validation.has-warning-aria-label"),"aria-hidden":true,role:"presentation"});}function ValidationInfoIcon(){const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(icons.InfoOutlineIcon,{"data-testid":"input-validation-icon-info","aria-label":t("form.validation.has-info-aria-label"),"aria-hidden":true,role:"presentation"});}var __freeze$1Y=Object.freeze;var __defProp$1Y=Object.defineProperty;var __template$1Y=(cooked,raw)=>__freeze$1Y(__defProp$1Y(cooked,"raw",{value:__freeze$1Y(raw||cooked.slice())}));var _a$1Z;const LabelSuffix=styled__default.default(ui.Flex)(_a$1Z||(_a$1Z=__template$1Y(["\n  /*\n   * Prevent the block size of appended elements (such as the deprecated field badge) affecting\n   * the intrinsic block size of the label.\n   */\n  contain: size;\n"])));const EMPTY_ARRAY$6=[];const FormFieldHeaderText=React.memo(function FormFieldHeaderText2(props){const{description,inputId,title,deprecated,validation=EMPTY_ARRAY$6}=props;const{t}=useTranslation();const hasValidations=validation.length>0;const hasLabelSuffix=deprecated||hasValidations;return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",paddingY:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"label",htmlFor:inputId,weight:"medium",size:1,children:title||/* @__PURE__ */jsxRuntime.jsx("span",{style:{color:"var(--card-muted-fg-color)"},children:t("form.field.untitled-field-label")})}),hasLabelSuffix&&/* @__PURE__ */jsxRuntime.jsxs(LabelSuffix,{align:"center",flex:1,children:[deprecated&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Badge,{"data-testid":"deprecated-badge-".concat(title),tone:"caution",children:t("form.field.deprecated-label")})}),hasValidations&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:2,children:/* @__PURE__ */jsxRuntime.jsx(FormFieldValidationStatus,{fontSize:1,placement:"top",validation})})]})]}),deprecated&&/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{"data-testid":"deprecated-message-".concat(title),tone:"caution",size:1,children:deprecated.reason}),description&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,id:createDescriptionId(inputId,description),children:description})]});});const EMPTY_ARRAY$5=[];const FormField=React.memo(function FormField2(props){const{__unstable_headerActions:actions=EMPTY_ARRAY$5,__unstable_presence:presence=EMPTY_ARRAY$5,__internal_slot:slot=null,__internal_comments:comments,children,description,inputId,level,title,validation,deprecated,...restProps}=props;const{focused,hovered,onMouseEnter,onMouseLeave}=useFieldActions();return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{...restProps,"data-level":level,onMouseEnter,onMouseLeave,space:2,children:[title&&/* @__PURE__ */jsxRuntime.jsx(FormFieldBaseHeader,{__internal_comments:comments,__internal_slot:slot,actions,fieldFocused:Boolean(focused),fieldHovered:hovered,presence,content:/* @__PURE__ */jsxRuntime.jsx(FormFieldHeaderText,{description,inputId,title,validation,deprecated})}),/* @__PURE__ */jsxRuntime.jsx("div",{children})]});});var __freeze$1X=Object.freeze;var __defProp$1X=Object.defineProperty;var __template$1X=(cooked,raw)=>__freeze$1X(__defProp$1X(cooked,"raw",{value:__freeze$1X(raw||cooked.slice())}));var _a$1Y,_b$U,_c$u;const Root$p=styled__default.default.legend(_a$1Y||(_a$1Y=__template$1X(["\n  /* See: https://thatemil.com/blog/2015/01/03/reset-your-fieldset/ */\n  padding: 0;\n  display: table;\n"])));const ToggleButton=styled__default.default(ui.Flex).attrs({forwardedAs:"button"})(props=>{const{theme}=props;const{focusRing,radius}=theme.sanity;const{base}=theme.sanity.color;return styled.css(_b$U||(_b$U=__template$1X(["\n    appearance: none;\n    border: 0;\n    background: none;\n    color: inherit;\n    -webkit-font-smoothing: inherit;\n    font: inherit;\n    outline: none;\n    border-radius: ",";\n    position: relative;\n\n    &:not([hidden]) {\n      display: flex;\n    }\n\n    &:focus {\n      box-shadow: ",";\n    }\n\n    &:focus:not(:focus-visible) {\n      box-shadow: none;\n    }\n\n    /* Added to increase the hit area of the collapsible fieldset */\n    &::after {\n      content: '';\n      position: absolute;\n      top: -10px;\n      right: -10px;\n      bottom: -10px;\n      left: -10px;\n    }\n  "])),ui.rem(radius[2]),focusRingStyle$2({base,focusRing}));});const ToggleIconBox=styled__default.default(ui.Box)(_c$u||(_c$u=__template$1X(["\n  width: 9px;\n  height: 9px;\n  margin-right: 3px;\n\n  & svg {\n    transition: transform 100ms;\n  }\n"])));const FormFieldSetLegend=React.memo(function FormFieldSetLegend2(props){const{collapsed,collapsible,onClick,title}=props;const{t}=useTranslation();const text=/* @__PURE__ */jsxRuntime.jsx(ui.Text,{weight:"medium",size:1,children:title||/* @__PURE__ */jsxRuntime.jsx("span",{style:{color:"var(--card-muted-fg-color)"},children:t("form.field.untitled-fieldset-label")})});if(!collapsible){return/* @__PURE__ */jsxRuntime.jsx(Root$p,{children:text});}return/* @__PURE__ */jsxRuntime.jsx(Root$p,{children:/* @__PURE__ */jsxRuntime.jsxs(ToggleButton,{type:"button",onClick,children:[/* @__PURE__ */jsxRuntime.jsx(ToggleIconBox,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.ToggleArrowRightIcon,{style:{transform:"rotate(".concat(collapsed?"0":"90deg",") translate3d(0, 0, 0)")}})})}),text]})});});var __freeze$1W=Object.freeze;var __defProp$1W=Object.defineProperty;var __template$1W=(cooked,raw)=>__freeze$1W(__defProp$1W(cooked,"raw",{value:__freeze$1W(raw||cooked.slice())}));var _a$1X,_b$T;function getChildren(children){return typeof children==="function"?children():children;}const Root$o=styled__default.default(ui.Stack).attrs({forwardedAs:"fieldset"})(_a$1X||(_a$1X=__template$1W(["\n  border: none;\n\n  /* See: https://thatemil.com/blog/2015/01/03/reset-your-fieldset/ */\n  body:not(:-moz-handler-blocked) & {\n    display: table-cell;\n  }\n"])));const Content$1=styled__default.default(ui.Box)(props=>{const{$borderLeft,theme}=props;const{focusRing}=theme.sanity;const{base}=theme.sanity.color;return styled.css(_b$T||(_b$T=__template$1W(["\n    outline: none;\n    border-left: ",";\n\n    &:focus {\n      box-shadow: ",";\n    }\n\n    &:focus:not(:focus-visible) {\n      box-shadow: none;\n    }\n  "])),$borderLeft?"1px solid var(--card-border-color)":void 0,focusRingStyle$2({base,focusRing:{...focusRing,offset:2}}));});const EMPTY_ARRAY$4=[];const FormFieldSet=React.forwardRef(function FormFieldSet2(props,ref){const{__internal_comments:comments,__internal_slot:slot=null,__unstable_headerActions:actions=EMPTY_ARRAY$4,__unstable_presence:presence=EMPTY_ARRAY$4,children,collapsed,collapsible,columns,description,level=0,onCollapse,onExpand,onFocus,tabIndex,title,validation=EMPTY_ARRAY$4,inputId,deprecated,...restProps}=props;const{focused,hovered,onMouseEnter,onMouseLeave}=useFieldActions();const hasValidationMarkers=validation.length>0;const forwardedRef=ui.useForwardedRef(ref);const{t}=useTranslation();const handleFocus=React.useCallback(event=>{const element=forwardedRef.current;if(element===event.target){if(onFocus)onFocus(event);}},[forwardedRef,onFocus]);const handleToggle=React.useCallback(()=>collapsed?onExpand==null?void 0:onExpand():onCollapse==null?void 0:onCollapse(),[collapsed,onCollapse,onExpand]);const content=React.useMemo(()=>{if(collapsed){return null;}return/* @__PURE__ */jsxRuntime.jsx(AlignedBottomGrid$1,{columns,gapX:4,gapY:5,children:getChildren(children)});},[children,collapsed,columns]);return/* @__PURE__ */jsxRuntime.jsxs(Root$o,{"data-level":level,...restProps,onMouseEnter,onMouseLeave,space:2,children:[/* @__PURE__ */jsxRuntime.jsx(FormFieldBaseHeader,{__internal_comments:comments,__internal_slot:slot,actions,fieldFocused:Boolean(focused),fieldHovered:hovered,presence,content:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(FormFieldSetLegend,{collapsed:Boolean(collapsed),collapsible,onClick:collapsible?handleToggle:void 0,title}),deprecated&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Badge,{"data-testid":"deprecated-badge-".concat(title),tone:"caution",children:t("form.field.deprecated-label")})}),hasValidationMarkers&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:2,children:/* @__PURE__ */jsxRuntime.jsx(FormFieldValidationStatus,{fontSize:1,placement:"top",validation})})]}),deprecated&&/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{"data-testid":"deprecated-message-".concat(title),tone:"caution",size:1,children:deprecated.reason}),description&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,id:createDescriptionId(inputId,description),children:description})]})}),/* @__PURE__ */jsxRuntime.jsx(Content$1,{$borderLeft:level>0,hidden:collapsed,paddingLeft:level===0?0:3,onFocus:typeof tabIndex==="number"&&tabIndex>-1?handleFocus:void 0,ref:forwardedRef,tabIndex,children:!collapsed&&content})]});});var __freeze$1V=Object.freeze;var __defProp$1V=Object.defineProperty;var __template$1V=(cooked,raw)=>__freeze$1V(__defProp$1V(cooked,"raw",{value:__freeze$1V(raw||cooked.slice())}));var _a$1W;const Root$n=styled__default.default.div(_a$1W||(_a$1W=__template$1V(["\n  display: flex;\n  justify-content: flex-end;\n  box-sizing: border-box;\n  min-height: var(--avatar-height);\n  width: 77px;\n  margin-left: var(--small-padding);\n\n  &[data-max-avatars='1'] {\n    max-width: 23px;\n  }\n\n  &[data-position='top'] {\n    align-self: flex-start;\n  }\n\n  &[data-position='bottom'] {\n    align-self: flex-end;\n  }\n"])));function FormFieldStatus(_ref108){let{children,maxAvatars,position="bottom"}=_ref108;return/* @__PURE__ */jsxRuntime.jsx(Root$n,{"data-max-avatars":maxAvatars,"data-position":position,children});}function usePrevious(value,initial){const ref=React.useRef(initial||null);React.useEffect(()=>{ref.current=value;},[value]);return ref.current;}function useDidUpdate(current,didUpdate){let compare=arguments.length>2&&arguments[2]!==undefined?arguments[2]:shallowEquals__default.default;const previous=usePrevious(current);React.useEffect(()=>{if(!compare(previous,current)){didUpdate(previous,current);}},[didUpdate,current,previous,compare]);}const SANITY_PATCH_TYPE=Symbol.for("sanity.patch");function setIfMissing(value){let path=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return{patchType:SANITY_PATCH_TYPE,type:"setIfMissing",path,value};}function insert(items,position){let path=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];return{patchType:SANITY_PATCH_TYPE,type:"insert",path,position,items};}function set(value){let path=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return{patchType:SANITY_PATCH_TYPE,type:"set",path,value};}function unset(){let path=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return{patchType:SANITY_PATCH_TYPE,type:"unset",path};}function diffMatchPatch(value){let path=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return{patchType:SANITY_PATCH_TYPE,type:"diffMatchPatch",path,value};}function inc(){let amount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;let path=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return{patchType:SANITY_PATCH_TYPE,type:"inc",path,value:amount};}function dec(){let amount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;let path=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return{patchType:SANITY_PATCH_TYPE,type:"dec",path,value:amount};}function prefixPath(patch,segment){return{...patch,path:[segment,...patch.path]};}class PatchEvent{static from(input){if(input instanceof PatchEvent){return input;}return new PatchEvent(Array.isArray(input)?flatten__default.default(input):[input]);}constructor(patches){this.patches=patches;}prepend(){for(var _len=arguments.length,patches=new Array(_len),_key2=0;_key2<_len;_key2++){patches[_key2]=arguments[_key2];}return PatchEvent.from([...flatten__default.default(patches),...this.patches]);}append(){for(var _len2=arguments.length,patches=new Array(_len2),_key3=0;_key3<_len2;_key3++){patches[_key3]=arguments[_key3];}return PatchEvent.from([...this.patches,...flatten__default.default(patches)]);}prefixAll(segment){return PatchEvent.from(this.patches.map(patch=>prefixPath(patch,segment)));}}const IGNORE_KEYS=["_key","_type","_weak"];function isEmptyItem(value){return Object.keys(value).every(key=>IGNORE_KEYS.includes(key));}const FormCallbacksContext=React.createContext(null);const FormCallbacksProvider=React.memo(function FormCallbacksProvider2(props){const ref=React.useRef(props);ref.current=props;const transformPatches=React.useCallback(patches=>{var _a,_b,_c;return(_c=(_b=(_a=ref.current)==null?void 0:_a.transformPatches)==null?void 0:_b.call(_a,patches))!=null?_c:[];},[ref]);const onChange=React.useCallback(patchEvent=>{ref.current.onChange(patchEvent);},[]);const onPathFocus=React.useCallback(path=>{ref.current.onPathFocus(path);},[]);const onPathBlur=React.useCallback(path=>{ref.current.onPathBlur(path);},[]);const onPathOpen=React.useCallback(path=>{ref.current.onPathOpen(path);},[]);const onSetPathCollapsed=React.useCallback((path,collapsed)=>{ref.current.onSetPathCollapsed(path,collapsed);},[]);const onSetFieldSetCollapsed=React.useCallback((path,collapsed)=>{ref.current.onSetFieldSetCollapsed(path,collapsed);},[]);const onFieldGroupSelect=React.useCallback((path,fieldGroupName)=>{ref.current.onFieldGroupSelect(path,fieldGroupName);},[]);const contextValue=React.useMemo(()=>({transformPatches,onChange,onPathFocus,onPathBlur,onPathOpen,onSetPathCollapsed,onSetFieldSetCollapsed,onFieldGroupSelect}),[onChange,onFieldGroupSelect,onPathBlur,onPathFocus,onPathOpen,onSetFieldSetCollapsed,onSetPathCollapsed,transformPatches]);return/* @__PURE__ */jsxRuntime.jsx(FormCallbacksContext.Provider,{value:contextValue,children:props.children});});function useFormCallbacks(){const ctx=React.useContext(FormCallbacksContext);if(!ctx){throw new Error("Form context not provided");}return ctx;}function createProtoValue(type){if(types.isObjectSchemaType(type)){return type.name==="object"?{}:{_type:type.name};}if(types.isArraySchemaType(type)){return[];}if(type.jsonType==="string"){return"";}if(type.jsonType==="number"){return 0;}if(type.jsonType==="boolean"){return false;}return void 0;}function whatwgRNG(){let length=arguments.length>0&&arguments[0]!==undefined?arguments[0]:16;const rnds8=new Uint8Array(length);getRandomValues__default.default(rnds8);return rnds8;}const getByteHexTable=/* @__PURE__ */(()=>{let table;return()=>{if(table){return table;}table=[];for(let i=0;i<256;++i){table[i]=(i+256).toString(16).substring(1);}return table;};})();function randomKey(length){const table=getByteHexTable();return whatwgRNG(length).reduce((str,n)=>str+table[n],"").slice(0,length);}function hasKey(item){return item._key!==void 0;}function ensureKey(item){return hasKey(item)?item:{...item,_key:randomKey(12)};}const getMemberTypeOfItem$2=(schemaType,item)=>{const itemTypeName=content.resolveTypeName(item);return schemaType.of.find(memberType=>memberType.name===itemTypeName);};function assign(values,path){return Object.entries(values).map(_ref109=>{let[key,value]=_ref109;return set(value,[...path,key]);});}function resolveInitialArrayValues(items,schemaType,resolver){return rxjs.from(items).pipe(operators.mergeMap(item=>{const itemPathSegment={_key:item._key};return rxjs.of(getMemberTypeOfItem$2(schemaType,item)).pipe(operators.mergeMap(memberType=>memberType?rxjs.of(memberType):rxjs.EMPTY),operators.mergeMap(memberType=>{if(!isEmptyItem(item)||!resolver){return rxjs.EMPTY;}return rxjs.concat(rxjs.of({type:"patch",patches:[set(true,[itemPathSegment,"_resolvingInitialValue"])]}),rxjs.defer(()=>resolver(memberType,item)).pipe(operators.filter(isNonNullable$2),operators.map(initial=>({type:"patch",patches:assign(initial,[itemPathSegment])})),operators.catchError(error=>rxjs.of({type:"error",error,item,schemaType:memberType}))),rxjs.of({type:"patch",patches:[unset([itemPathSegment,"_resolvingInitialValue"])]}));}));}));}function ArrayOfObjectsItem(props){const focusRef=React.useRef();const{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview}=props;const{t}=useTranslation();const{onPathBlur,onPathFocus,onChange,onPathOpen,onSetPathCollapsed,onSetFieldSetCollapsed,onFieldGroupSelect}=useFormCallbacks();const resolveInitialValue=useResolveInitialValueForType();useDidUpdate(member.item.focused,(hadFocus,hasFocus)=>{var _a;if(!hadFocus&&hasFocus){(_a=focusRef.current)==null?void 0:_a.focus();}});const onRemove=React.useCallback(()=>{onChange(PatchEvent.from([unset([{_key:member.key}])]));},[member.key,onChange]);const handleOpenItem=React.useCallback(path=>{onPathOpen(path);onSetPathCollapsed(path,false);},[onPathOpen,onSetPathCollapsed]);const toast=ui.useToast();const handleInsert=React.useCallback(event=>{if(event.items.length===0){throw new Error("Insert event should include at least one item");}const itemsWithKeys=event.items.map(item=>ensureKey(item));onChange(PatchEvent.from([insert(itemsWithKeys,event.position,[{_key:member.key}])]));const focusItemKey=itemsWithKeys[0]._key;const parentPath=member.item.path.slice(0,-1);const itemPath=[...parentPath,{_key:focusItemKey}];onPathFocus(itemPath);const shouldOpen=event.open!==false;if(event.skipInitialValue){if(shouldOpen){handleOpenItem(itemPath);}}else{resolveInitialArrayValues(itemsWithKeys,member.parentSchemaType,resolveInitialValue).pipe(operators.tap(result=>{if(result.type==="patch"){onChange(PatchEvent.from(result.patches));}else{toast.push({title:t("inputs.array.error.cannot-resolve-initial-value-title"),description:t("inputs.array.error.cannot-resolve-initial-value-description",{schemaTypeTitle:result.schemaType.title,errorMessage:result.error.message}),status:"error"});}})).subscribe({complete:()=>{if(shouldOpen){handleOpenItem(itemPath);}}});}},[handleOpenItem,member.item.path,member.key,member.parentSchemaType,onChange,onPathFocus,resolveInitialValue,toast,t]);const handleBlur=React.useCallback(()=>{onPathBlur(member.item.path);},[member.item.path,onPathBlur]);const handleFocus=React.useCallback(()=>{onPathFocus(member.item.path);},[member.item.path,onPathFocus]);const handleFocusChildPath=React.useCallback(path=>{onPathFocus(member.item.path.concat(path));},[member.item.path,onPathFocus]);const handleChange=React.useCallback(event=>{onChange(PatchEvent.from(event).prepend(setIfMissing(createProtoValue(member.item.schemaType))).prefixAll({_key:member.key}));},[onChange,member.item.schemaType,member.key]);const handleCollapse=React.useCallback(()=>{onSetPathCollapsed(member.item.path,true);},[onSetPathCollapsed,member.item.path]);const handleExpand=React.useCallback(()=>{onSetPathCollapsed(member.item.path,false);},[onSetPathCollapsed,member.item.path]);const handleCollapseField=React.useCallback(fieldName=>{onSetPathCollapsed(member.item.path.concat(fieldName),true);},[onSetPathCollapsed,member.item.path]);const handleExpandField=React.useCallback(fieldName=>{onSetPathCollapsed(member.item.path.concat(fieldName),false);},[onSetPathCollapsed,member.item.path]);const handleCloseField=React.useCallback(()=>{onPathOpen(member.item.path);},[onPathOpen,member.item.path]);const handleOpenField=React.useCallback(fieldName=>{onPathOpen(member.item.path.concat(fieldName));},[onPathOpen,member.item.path]);const handleExpandFieldSet=React.useCallback(fieldsetName=>{onSetFieldSetCollapsed(member.item.path.concat(fieldsetName),false);},[onSetFieldSetCollapsed,member.item.path]);const handleCollapseFieldSet=React.useCallback(fieldsetName=>{onSetFieldSetCollapsed(member.item.path.concat(fieldsetName),true);},[onSetFieldSetCollapsed,member.item.path]);const handleOpen=React.useCallback(()=>{onPathOpen(member.item.path);},[onPathOpen,member.item.path]);const isEmptyValue=!member.item.value||isEmptyItem(member.item.value);const handleClose=React.useCallback(()=>{if(isEmptyValue){onRemove();}const parentPath=member.item.path.slice(0,-1);onPathOpen(parentPath);onPathFocus(parentPath);},[isEmptyValue,onPathOpen,member.item.path,onPathFocus,onRemove]);const handleSelectFieldGroup=React.useCallback(groupName=>{onFieldGroupSelect(member.item.path,groupName);},[onFieldGroupSelect,member.item.path]);const elementProps=React.useMemo(()=>({onBlur:handleBlur,onFocus:handleFocus,id:member.item.id,ref:focusRef,"aria-describedby":createDescriptionId(member.item.id,member.item.schemaType.description)}),[handleBlur,handleFocus,member.item.id,member.item.schemaType.description]);const inputProps=React.useMemo(()=>{return{changed:member.item.changed,focusPath:member.item.focusPath,focused:member.item.focused,groups:member.item.groups,id:member.item.id,level:member.item.level,members:member.item.members,onChange:handleChange,onFieldClose:handleCloseField,onFieldCollapse:handleCollapseField,onFieldSetCollapse:handleCollapseFieldSet,onFieldExpand:handleExpandField,onFieldSetExpand:handleExpandFieldSet,onFieldGroupSelect:handleSelectFieldGroup,onPathFocus:handleFocusChildPath,onFieldOpen:handleOpenField,path:member.item.path,presence:member.item.presence,readOnly:member.item.readOnly,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType:member.item.schemaType,validation:member.item.validation,value:member.item.value,elementProps};},[elementProps,handleChange,handleCloseField,handleCollapseField,handleCollapseFieldSet,handleExpandField,handleExpandFieldSet,handleFocusChildPath,handleOpenField,handleSelectFieldGroup,member.item.changed,member.item.focusPath,member.item.focused,member.item.groups,member.item.id,member.item.level,member.item.members,member.item.path,member.item.presence,member.item.readOnly,member.item.schemaType,member.item.validation,member.item.value,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview]);const renderedInput=React.useMemo(()=>renderInput(inputProps),[inputProps,renderInput]);const itemProps=React.useMemo(()=>{return{key:member.key,index:member.index,level:member.item.level,value:member.item.value,title:member.item.schemaType.title,description:member.item.schemaType.description,collapsible:member.collapsible,collapsed:member.collapsed,schemaType:member.item.schemaType,parentSchemaType:member.parentSchemaType,onInsert:handleInsert,onRemove,presence:member.item.presence,validation:member.item.validation,open:member.open,onOpen:handleOpen,onClose:handleClose,onExpand:handleExpand,onCollapse:handleCollapse,readOnly:member.item.readOnly,focused:member.item.focused,onFocus:handleFocus,onBlur:handleBlur,inputId:member.item.id,path:member.item.path,children:renderedInput,changed:member.item.changed,inputProps};},[member.key,member.index,member.item.level,member.item.value,member.item.schemaType,member.parentSchemaType,member.item.presence,member.item.validation,member.item.readOnly,member.item.focused,member.item.id,member.item.path,member.item.changed,member.collapsible,member.collapsed,member.open,handleInsert,onRemove,handleOpen,handleClose,handleExpand,handleCollapse,handleFocus,handleBlur,renderedInput,inputProps]);return/* @__PURE__ */jsxRuntime.jsx(FormCallbacksProvider,{onFieldGroupSelect,onChange:handleChange,onPathOpen,onSetFieldSetCollapsed,onSetPathCollapsed,onPathBlur,onPathFocus,children:React.useMemo(()=>renderItem(itemProps),[itemProps,renderItem])});}var __freeze$1U=Object.freeze;var __defProp$1U=Object.defineProperty;var __template$1U=(cooked,raw)=>__freeze$1U(__defProp$1U(cooked,"raw",{value:__freeze$1U(raw||cooked.slice())}));var _a$1V;const PopoverCard$2=styled__default.default(ui.Card)(_a$1V||(_a$1V=__template$1U(["\n  max-width: ","px;\n"])),_ref110=>{let{theme}=_ref110;return theme.sanity.container[1];});function IncompatibleItemType$2(props){const{value,onFocus,vertical,...rest}=props;const[showDetails,setShowDetails]=React.useState(false);const[popoverRef,setPopoverRef]=React.useState(null);const{t}=useTranslation();ui.useClickOutside(()=>setShowDetails(false),[popoverRef]);const handleKeyDown=React.useCallback(e=>{if(e.key==="Escape"||e.key==="Tab"){setShowDetails(false);}},[]);const handleShowDetails=React.useCallback(()=>{setShowDetails(v=>!v);},[]);const typeName=content.resolveTypeName(value);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{open:showDetails,ref:setPopoverRef,onKeyDown:handleKeyDown,portal:true,constrainSize:true,tone:"default",content:/* @__PURE__ */jsxRuntime.jsx(PopoverCard$2,{margin:1,padding:3,onKeyDown:handleKeyDown,tabIndex:0,overflow:"auto",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{weight:"medium",children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.array.error.type-is-incompatible-prompt",values:{typeName}})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:t("inputs.array.error.type-is-incompatible-title")}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.array.error.current-schema-not-declare-description",values:{typeName}})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{size:1,children:[/* @__PURE__ */jsxRuntime.jsx(icons.BulbOutlineIcon,{})," ",t("inputs.array.error.can-delete-but-no-edit-description")]})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:t("inputs.array.error.json-representation-description")}),/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:2,overflow:"auto",border:true,children:/* @__PURE__ */jsxRuntime.jsx(ui.Code,{size:1,as:"pre",language:"json",children:JSON.stringify(value,null,2)})})]})]})}),children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{as:"button",type:"button",radius:2,tone:"inherit",paddingX:2,paddingY:3,flex:1,onFocus,onClick:handleShowDetails,onKeyDown:handleKeyDown,__unstable_focusRing:true,...rest,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginRight:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:/* @__PURE__ */jsxRuntime.jsx(icons.UnknownIcon,{})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,textOverflow:"ellipsis",children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.array.error.type-is-incompatible-prompt",values:{typeName}})})})]})})});}function MemberItemError(props){const{member}=props;const{t}=useTranslation();if(member.error.type==="INVALID_ITEM_TYPE"){return/* @__PURE__ */jsxRuntime.jsx(IncompatibleItemType$2,{value:member.error.value});}return/* @__PURE__ */jsxRuntime.jsx("div",{children:t("inputs.array.error.unexpected-error",{error:member.error.type})});}function getEmptyValue(type){switch(type.jsonType){case"string":{return"";}case"number":{return-0;}case"boolean":{return false;}default:throw new Error('Unable to create value from type "'.concat(type.jsonType,'"'));}}function resolveNativeNumberInputValue(schemaType,value,localValue){if(types.isNumberSchemaType(schemaType)&&typeof localValue==="string"&&Number(localValue)===value){return localValue;}return String(value!=null?value:"");}function ArrayOfPrimitivesItem(props){const focusRef=React.useRef();const{member,renderItem,renderInput}=props;const[localValue,setLocalValue]=React.useState();const{onPathBlur,onPathFocus,onChange}=useFormCallbacks();useDidUpdate(member.item.focused,(hadFocus,hasFocus)=>{var _a;if(!hadFocus&&hasFocus){(_a=focusRef.current)==null?void 0:_a.focus();}});const handleBlur=React.useCallback(event=>{onPathBlur(member.item.path);},[member.item.path,onPathBlur]);const handleFocus=React.useCallback(event=>{onPathFocus(member.item.path);},[member.item.path,onPathFocus]);const handleChange=React.useCallback(event=>{onChange(PatchEvent.from(event).prefixAll(member.index));},[onChange,member.index]);const handleNativeChange=React.useCallback(event=>{let inputValue=event.currentTarget.value;if(types.isNumberSchemaType(member.item.schemaType)){inputValue=event.currentTarget.valueAsNumber;if(inputValue>Number.MAX_SAFE_INTEGER||inputValue<Number.MIN_SAFE_INTEGER){return;}}else if(types.isBooleanSchemaType(member.item.schemaType)){inputValue=event.currentTarget.checked;}const hasEmptyValue=inputValue===""||typeof inputValue==="number"&&isNaN(inputValue);if(types.isNumberSchemaType(member.item.schemaType)){setLocalValue(hasEmptyValue?void 0:event.currentTarget.value);}handleChange(set(hasEmptyValue?// Map direct unset patches to empty value instead in order to not *remove* elements as the user clears out the value
// note: this creates the rather curious case where the input renders 0 when you try to clear it.
getEmptyValue(member.item.schemaType):inputValue));},[handleChange,member.item.schemaType]);const elementProps=React.useMemo(()=>({onBlur:handleBlur,onFocus:handleFocus,id:member.item.id,ref:focusRef,onChange:handleNativeChange,value:resolveNativeInputValue(member.item.schemaType,member.item.value,localValue),readOnly:Boolean(member.item.readOnly),placeholder:member.item.schemaType.placeholder,"aria-describedby":createDescriptionId(member.item.id,member.item.schemaType.description)}),[handleBlur,handleFocus,handleNativeChange,member.item.id,member.item.readOnly,member.item.schemaType,member.item.value,localValue]);const inputProps=React.useMemo(()=>{return{changed:member.item.changed,level:member.item.level,value:member.item.value,readOnly:member.item.readOnly,schemaType:member.item.schemaType,id:member.item.id,path:member.item.path,focused:member.item.focused,onChange:handleChange,validation:member.item.validation,presence:member.item.presence,elementProps};},[member.item.changed,member.item.level,member.item.value,member.item.readOnly,member.item.schemaType,member.item.id,member.item.path,member.item.focused,member.item.validation,member.item.presence,handleChange,elementProps]);const renderedInput=React.useMemo(()=>renderInput(inputProps),[inputProps,renderInput]);const onRemove=React.useCallback(()=>{onChange(PatchEvent.from([unset([member.index])]));},[member.index,onChange]);const onInsert=React.useCallback(event=>{onChange(PatchEvent.from([insert(event.items,event.position,[member.index])]));},[member.index,onChange]);const itemProps=React.useMemo(()=>{return{key:member.key,index:member.index,level:member.item.level,value:member.item.value,title:member.item.schemaType.title,description:member.item.schemaType.description,schemaType:member.item.schemaType,parentSchemaType:member.parentSchemaType,onInsert,onRemove,presence:member.item.presence,validation:member.item.validation,readOnly:member.item.readOnly,focused:member.item.focused,onFocus:handleFocus,onBlur:handleBlur,inputId:member.item.id,path:member.item.path,children:renderedInput};},[member.key,member.index,member.item.level,member.item.value,member.item.schemaType,member.item.presence,member.item.validation,member.item.readOnly,member.item.focused,member.item.id,member.item.path,member.parentSchemaType,onInsert,onRemove,handleFocus,handleBlur,renderedInput]);return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:React.useMemo(()=>renderItem(itemProps),[itemProps,renderItem])});}function resolveNativeInputValue(schemaType,value,localValue){if(Object.is(value,-0)){return"";}return resolveNativeNumberInputValue(schemaType,value,localValue);}function createProtoArrayValue(type){if(!types.isObjectSchemaType(type)){throw new Error('Invalid item type: "'.concat(type.type,'". Default array input can only contain objects (for now)'));}return{...createProtoValue(type),_key:content.randomKey(12)};}const BEFORE="before";const AFTER="after";function arrayInsert(array,position,index){if(position!==BEFORE&&position!==AFTER){throw new Error('Invalid position "'.concat(position,'", must be either ').concat(BEFORE," or ").concat(AFTER));}for(var _len3=arguments.length,args=new Array(_len3>3?_len3-3:0),_key4=3;_key4<_len3;_key4++){args[_key4-3]=arguments[_key4];}const items=flatten(...args);if(array.length===0){return items;}const len=array.length;const idx=Math.abs((len+index)%len)%len;const normalizedIdx=position==="after"?idx+1:idx;const copy=array.slice();copy.splice(normalizedIdx,0,...flatten(items));return copy;}function flatten(){for(var _len4=arguments.length,values=new Array(_len4),_key5=0;_key5<_len4;_key5++){values[_key5]=arguments[_key5];}return values.reduce((prev,item)=>prev.concat(item),[]);}const hasOwn=(obj,property)=>Object.prototype.hasOwnProperty.call(obj,property);function move$1(arr,from,to){const nextValue=arr.slice();const val=nextValue[from];nextValue.splice(from,1);nextValue.splice(to,0,val);return nextValue;}function findTargetIndex(array,pathSegment){if(typeof pathSegment==="number"){return pathSegment;}const index=findIndex__default.default(array,pathSegment);return index===-1?false:index;}function _arrayApply(value,patch){const nextValue=value.slice();if(patch.path.length===0){if(patch.type==="setIfMissing"){if(!Array.isArray(patch.value)){throw new Error("Cannot set value of an array to a non-array");}return value===void 0?patch.value:value;}else if(patch.type==="set"){if(!Array.isArray(patch.value)){throw new Error("Cannot set value of an array to a non-array");}return patch.value;}else if(patch.type==="unset"){return void 0;}else if(patch.type==="move"){if(!patch.value||!hasOwn(patch.value,"from")||!hasOwn(patch.value,"to")){throw new Error('Invalid value of \'move\' patch. Expected a value with "from" and "to" indexes, instead got: '.concat(JSON.stringify(patch.value)));}return move$1(nextValue,patch.value.from,patch.value.to);}throw new Error("Invalid array operation: ".concat(patch.type));}const[head,...tail]=patch.path;const index=findTargetIndex(value,head);if(index===false){return nextValue;}if(tail.length===0){if(patch.type==="insert"){const{position,items}=patch;return arrayInsert(value,position,index,items);}else if(patch.type==="unset"){if(typeof index!=="number"){throw new Error('Expected array index to be a number, instead got "'.concat(index,'"'));}nextValue.splice(index,1);return nextValue;}}nextValue[index]=applyPatch(nextValue[index],{...patch,path:tail});return nextValue;}function _objectApply(value,patch){const nextValue=clone__default.default(value);if(patch.path.length===0){if(patch.type==="set"){if(!isObject__default.default(patch.value)){throw new Error("Cannot set value of an object to a non-object");}return patch.value;}else if(patch.type==="unset"){return void 0;}else if(patch.type==="setIfMissing"){return value===void 0?patch.value:value;}throw new Error("Invalid object operation: ".concat(patch.type));}const[head,...tail]=patch.path;if(typeof head!=="string"){throw new Error("Expected field name to be a string, instad got: ".concat(head));}if(tail.length===0&&patch.type==="unset"){return omit__default.default(nextValue,head);}nextValue[head]=applyPatch(nextValue[head],{...patch,path:tail});return nextValue;}const OPERATIONS$1={replace(currentValue,nextValue){return nextValue;},set(currentValue,nextValue){return nextValue;},setIfMissing(currentValue,nextValue){return currentValue===void 0?nextValue:currentValue;},unset(currentValue,nextValue){return void 0;},inc(currentValue,nextValue){return currentValue+nextValue;},dec(currentValue,nextValue){return currentValue-nextValue;}};const SUPPORTED_PATCH_TYPES$1=Object.keys(OPERATIONS$1);function _primitiveApply(value,patch){if(!SUPPORTED_PATCH_TYPES$1.includes(patch.type)){throw new Error('Received patch of unsupported type "'.concat(patch.type,'" for primitives. This is most likely a bug.'));}if(patch.path.length>0){throw new Error('Cannot apply deep operations on primitive values. Received patch with type "'.concat(patch.type,'" and path "').concat(patch.path.map(path=>JSON.stringify(path)).join("."),' that targeted the value "').concat(JSON.stringify(value),'"'));}return OPERATIONS$1[patch.type](value,patch.value);}const OPERATIONS={replace(currentValue,nextValue){return nextValue;},set(currentValue,nextValue){return nextValue;},setIfMissing(currentValue,nextValue){return currentValue===void 0?nextValue:currentValue;},unset(currentValue,nextValue){return void 0;},diffMatchPatch(currentValue,dmpPatch){const[result]=diffMatchPatch$1.applyPatches(diffMatchPatch$1.parsePatch(dmpPatch),currentValue,{allowExceedingIndices:true});return result;}};const SUPPORTED_PATCH_TYPES=Object.keys(OPERATIONS);function _stringApply(value,patch){if(!SUPPORTED_PATCH_TYPES.includes(patch.type)){throw new Error('Received patch of unsupported type: "'.concat(JSON.stringify(patch.type),'" for string. This is most likely a bug.'));}if(patch.path.length>0){throw new Error('Cannot apply deep operations on string values. Received patch with type "'.concat(patch.type,'" and path "').concat(patch.path.join("."),' that targeted the value "').concat(JSON.stringify(value),'"'));}return OPERATIONS[patch.type](value,patch.value);}function applyAll(value,patches){return patches.reduce(applyPatch,value);}function _applyPatch(value,patch){if(Array.isArray(value)){return _arrayApply(value,patch);}if(isString__default.default(value)){return _stringApply(value,patch);}if(isObject__default.default(value)){return _objectApply(value,patch);}return _primitiveApply(value,patch);}function applyPatch(value,patch){const res=_applyPatch(value,patch);return res;}const DocumentFieldActionsContext=React.createContext(null);function DocumentFieldActionsProvider(props){const value=React.useMemo(()=>({actions:props.actions||EMPTY_ARRAY$9}),[props.actions]);return/* @__PURE__ */jsxRuntime.jsx(DocumentFieldActionsContext.Provider,{value,children:props.children});}function useDocumentFieldActions(){const context=React.useContext(DocumentFieldActionsContext);if(!context){throw new Error("useDocumentFieldActions must be used within a DocumentFieldActionsProvider");}return context.actions;}function is$1(typeName,type){return type.name===typeName||Boolean(type.type&&is$1(typeName,type.type));}function accepts(file,acceptedFiles){if(!file||!acceptedFiles){return true;}const acceptedFilesArray=Array.isArray(acceptedFiles)?acceptedFiles:acceptedFiles.split(",");const fileName=file.name||"";const mimeType=(file.type||"").toLowerCase();const baseMimeType=mimeType.replace(/\/.*$/,"");return acceptedFilesArray.some(type=>{const validType=type.trim().toLowerCase();if(validType.charAt(0)==="."){return fileName.toLowerCase().endsWith(validType);}if(validType.endsWith("/*")){return baseMimeType===validType.replace(/\/.*$/,"");}return mimeType===validType;});}const DEFAULT_CONCURRENCY=4;function remove(array,item){const index=array.indexOf(item);if(index>-1){array.splice(index,1);}return array;}function withMaxConcurrency(func){let concurrency=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_CONCURRENCY;const throttler=createThrottler(concurrency);return function(){return rxjs.from(throttler(func(...arguments)));};}function createThrottler(){let concurrency=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DEFAULT_CONCURRENCY;const currentSubscriptions=[];const pendingObservables=[];const ready$=new rxjs.Subject();return request;function request(observable){return new rxjs.Observable(observer=>{if(currentSubscriptions.length>=concurrency){return scheduleAndWait(observable).pipe(operators.mergeMap(request)).subscribe(observer);}const subscription=observable.subscribe(observer);currentSubscriptions.push(subscription);return()=>{remove(currentSubscriptions,subscription);remove(pendingObservables,observable);subscription.unsubscribe();check();};});}function scheduleAndWait(observable){pendingObservables.push(observable);return ready$.asObservable().pipe(operators.first(obs=>obs===observable));}function check(){while(pendingObservables.length>0&&currentSubscriptions.length<concurrency){ready$.next(pendingObservables.shift());}}}const MAX_CONCURRENT_UPLOADS=4;function uploadSanityAsset(client,assetType,file){let options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};const extract=options.metadata;const preserveFilename=options.storeOriginalFilename;const{label,title,description,creditLine,source}=options;return hashFile(file).pipe(operators.catchError(()=>// ignore if hashing fails for some reason
rxjs.of(null)),operators.mergeMap(hash=>// note: the sanity api will still dedupe unique files, but this saves us from uploading the asset file entirely
hash?fetchExisting(client,"sanity.".concat(assetType,"Asset"),hash):rxjs.of(null)),operators.mergeMap(existing=>{if(existing){return rxjs.of({// complete with the existing asset document
type:"complete",id:existing._id,asset:existing});}return client.observable.assets.upload(assetType,file,{tag:"asset.upload",extract,preserveFilename,label,title,description,creditLine,source}).pipe(operators.map(event=>event.type==="response"?{// rewrite to a 'complete' event
type:"complete",id:event.body.document._id,asset:event.body.document}:event));}));}const uploadAsset=withMaxConcurrency(uploadSanityAsset,MAX_CONCURRENT_UPLOADS);const uploadImageAsset=(client,file,options)=>uploadAsset(client,"image",file,options);const uploadFileAsset=(client,file,options)=>uploadAsset(client,"file",file,options);function observeAssetDoc(documentPreviewStore,id){return documentPreviewStore.observePaths({_type:"reference",_ref:id},["originalFilename","url","metadata","label","title","description","creditLine","source","size"]);}function observeImageAsset(documentPreviewStore,id){return observeAssetDoc(documentPreviewStore,id);}function observeFileAsset(documentPreviewStore,id){return observeAssetDoc(documentPreviewStore,id);}function fetchExisting(client,type,hash){return client.observable.fetch("*[_type == $documentType && sha1hash == $hash][0]",{documentType:type,hash},{tag:"asset.find-duplicate"});}function readFile(file){return new rxjs.Observable(subscriber=>{const reader=new FileReader();reader.onload=()=>{subscriber.next(reader.result);subscriber.complete();};reader.onerror=err=>{subscriber.error(err);};reader.readAsArrayBuffer(file);return()=>{reader.abort();};});}function hashFile(file){if(!window.crypto||!window.crypto.subtle||!window.FileReader){return rxjs.of(null);}return readFile(file).pipe(operators.mergeMap(arrayBuffer=>crypto.subtle.digest("SHA-1",arrayBuffer)),operators.map(hexFromBuffer));}function hexFromBuffer(buffer){return Array.prototype.map.call(new Uint8Array(buffer),x=>"00".concat(x.toString(16)).slice(-2)).join("");}const UPLOAD_STATUS_KEY="_upload";const UNSET_UPLOAD_PATCH=unset([UPLOAD_STATUS_KEY]);function createUploadEvent(){let patches=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return{type:"uploadProgress",patches};}const CLEANUP_EVENT=createUploadEvent([UNSET_UPLOAD_PATCH]);function createInitialUploadEvent(file){const now=(/* @__PURE__ */new Date()).toISOString();const value={progress:2,createdAt:now,updatedAt:now,file:{name:file.name,type:file.type}};return createUploadEvent([set(value,[UPLOAD_STATUS_KEY])]);}function uploadFile(client,file,options){const upload$=uploadFileAsset(client,file,options).pipe(operators.map(event=>{if(event.type==="complete"){return createUploadEvent([set({_type:"reference",_ref:event.asset._id},["asset"]),set(100,[UPLOAD_STATUS_KEY,"progress"]),set((/* @__PURE__ */new Date()).toISOString(),[UPLOAD_STATUS_KEY,"updated"])]);}return createUploadEvent([set(event.percent,[UPLOAD_STATUS_KEY,"progress"]),set((/* @__PURE__ */new Date()).toISOString(),[UPLOAD_STATUS_KEY,"updated"])]);}));return rxjs.concat(rxjs.of(createInitialUploadEvent(file)),upload$,rxjs.of(CLEANUP_EVENT));}function rotated(n){return[5,6,7,8].indexOf(n)>-1;}function rotate$1(ctx,options){const x=options.x;const y=options.y;const radians=(options.degrees||0)*(Math.PI/180);ctx==null?void 0:ctx.translate(x,y);ctx==null?void 0:ctx.rotate(radians);ctx==null?void 0:ctx.translate(-x,-y);}function flip(canvas,x,y){const ctx=canvas.getContext("2d");ctx==null?void 0:ctx.translate(x?canvas.width:0,y?canvas.height:0);ctx==null?void 0:ctx.scale(x?-1:1,y?-1:1);}const ORIENTATION_OPS=[{op:"none",degrees:0},{op:"flip-x",degrees:0},{op:"none",degrees:180},{op:"flip-y",degrees:0},{op:"flip-x",degrees:90},{op:"none",degrees:90},{op:"flip-x",degrees:-90},{op:"none",degrees:-90}];const ORIENTATIONS=["top-left","top-right","bottom-right","bottom-left","left-top","right-top","right-bottom","left-bottom"];const DEFAULT_ORIENTATION="top-left";const THUMB_SIZE=120;function _orient(img,orientationNumber){const orientation=ORIENTATION_OPS[orientationNumber-1];const ratio=img.height/img.width;img.width=THUMB_SIZE/ratio;img.height=img.width*ratio;const canvas=document.createElement("canvas");const ctx=canvas.getContext("2d");if(rotated(orientationNumber)){canvas.height=img.width;canvas.width=img.height;}else{canvas.width=img.width;canvas.height=img.height;}if(orientation.op==="flip-x"){flip(canvas,true,false);}if(orientation.op==="flip-y"){flip(canvas,false,true);}if(orientation.degrees){rotate$1(ctx,{degrees:orientation.degrees,x:canvas.width/2,y:canvas.height/2});if(rotated(orientationNumber)){const d=canvas.width-canvas.height;ctx==null?void 0:ctx.translate(d/2,-d/2);}}ctx==null?void 0:ctx.drawImage(img,0,0,img.width,img.height);return canvas;}function orient(image,orientationId){return new rxjs.Observable(observer=>{const orientation=ORIENTATIONS.indexOf(orientationId)+1;const canvas=_orient(image,orientation);observer.next(canvas.toDataURL("image/jpeg",0.1));observer.complete();});}function readFileAsArrayBuffer(file,length){return new rxjs.Observable(observer=>{const reader=new window.FileReader();reader.onerror=err=>observer.error(err);reader.onload=()=>{observer.next(reader.result);observer.complete();};reader.readAsArrayBuffer(length===void 0?file:file.slice(0,length));return()=>reader.abort();});}const SKIP_EXIF_ERROR_RE=/(invalid image format)|(No exif data)/i;const EXIF_BUFFER_LENGTH=128e3;function readExif(file){return rxjs.from(readFileAsArrayBuffer(file,EXIF_BUFFER_LENGTH)).pipe(operators.map(buf=>exif__default.default(buf)),operators.catchError(error=>{if(!SKIP_EXIF_ERROR_RE.test(error.message)){console.warn("Exif read failed, continuing anyway: ".concat(error.message));}return rxjs.of({});}));}function loadImage$1(url){return new rxjs.Observable(observer=>{const image=new window.Image();image.onerror=()=>{observer.error(new Error('Could not load image from url "'.concat(url,'". Image may be of an unsupported format')));};image.onload=()=>{observer.next(image);observer.complete();};image.src=url;return()=>{};});}function rotateImage(file,orientation){return loadImage$1(window.URL.createObjectURL(file)).pipe(operators.mergeMap(image=>orient(image,orientation)));}function uploadImage(client,file,options){const upload$=uploadImageAsset(client,file,options).pipe(operators.filter(event=>event.stage!=="download"),operators.map(event=>({...event,progress:2+event.percent/100*98})),operators.map(event=>{if(event.type==="complete"){return createUploadEvent([set({_type:"reference",_ref:event.asset._id},["asset"]),set(100,[UPLOAD_STATUS_KEY,"progress"]),set((/* @__PURE__ */new Date()).toISOString(),[UPLOAD_STATUS_KEY,"updatedAt"])]);}return createUploadEvent([set(event.percent,[UPLOAD_STATUS_KEY,"progress"]),set((/* @__PURE__ */new Date()).toISOString(),[UPLOAD_STATUS_KEY,"updatedAt"])]);}));const setPreviewUrl$=readExif(file).pipe(operators.mergeMap(exifData=>rotateImage(file,exifData.orientation||DEFAULT_ORIENTATION)),operators.catchError(error=>{console.warn('Image preprocessing failed for "%s" with the error: %s',file.name,error.message);return rxjs.of(null);}),operators.filter(Boolean),operators.map(imageUrl=>createUploadEvent([set(imageUrl,[UPLOAD_STATUS_KEY,"previewImage"])])));return rxjs.concat(rxjs.of(createInitialUploadEvent(file)),rxjs.merge(upload$,setPreviewUrl$),rxjs.of(CLEANUP_EVENT));}const UPLOAD_IMAGE={type:"image",accepts:"image/*",upload:(client,file,type,options)=>uploadImage(client,file,options)};const UPLOAD_FILE={type:"file",accepts:"",upload:(client,file,type,options)=>uploadFile(client,file,options)};const UPLOAD_TEXT={type:"string",accepts:"text/*",upload:(client,file,type,options)=>uploadFile(client,file,options).pipe(operators.map(content=>({type:"uploadProgress",patches:[set(content)]})))// Todo: promote this to a "first-class" form-builder abstraction
// and make it possible to register custom uploaders
};const uploaders=[UPLOAD_IMAGE,UPLOAD_TEXT,UPLOAD_FILE].map((uploader,i)=>({...uploader,priority:i}));function resolveUploader(type,file){return uploaders.find(uploader=>{var _a;return is$1(uploader.type,type)&&accepts(file,uploader.accepts)&&accepts(file,((_a=type.options)==null?void 0:_a.accept)||"");})||null;}function ArrayOfObjectsField(props){const{onPathBlur,onPathFocus,onChange,onSetPathCollapsed,onSetFieldSetCollapsed,onPathOpen,onFieldGroupSelect}=useFormCallbacks();const{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview}=props;const fieldActions=useDocumentFieldActions();const focusRef=React.useRef();const uploadSubscriptions=React.useRef({});useDidUpdate(member.field.focused,(hadFocus,hasFocus)=>{var _a;if(!hadFocus&&hasFocus){(_a=focusRef.current)==null?void 0:_a.focus();}});const handleFocus=React.useCallback(event=>{if(event.currentTarget===event.target&&event.currentTarget===focusRef.current){onPathFocus(member.field.path);}},[member.field.path,onPathFocus]);const handleBlur=React.useCallback(event=>{if(event.currentTarget===event.target&&event.currentTarget===focusRef.current){onPathBlur(member.field.path);}},[member.field.path,onPathBlur]);const valueRef=React.useRef(member.field.value);React.useEffect(()=>{valueRef.current=member.field.value;},[member.field.value]);const handleChange=React.useCallback(event=>{const patches=PatchEvent.from(event).patches;const isRemovingLastItem=patches.some(patch=>patch.type==="unset"&&patch.path.length===1);if(isRemovingLastItem){valueRef.current=applyAll(valueRef.current||[],patches);if(Array.isArray(valueRef.current)&&!valueRef.current.length){onChange(PatchEvent.from(unset([member.name])));return;}}onChange(PatchEvent.from(event).prepend(setIfMissing([])).prefixAll(member.name));},[onChange,member.name,valueRef]);const resolveInitialValue=useResolveInitialValueForType();const toast=ui.useToast();const handleCollapse=React.useCallback(()=>{onSetPathCollapsed(member.field.path,true);},[onSetPathCollapsed,member.field.path]);const handleExpand=React.useCallback(()=>{onSetPathCollapsed(member.field.path,false);},[onSetPathCollapsed,member.field.path]);const handleCollapseItem=React.useCallback(itemKey=>{onSetPathCollapsed(member.field.path.concat({_key:itemKey}),true);},[onSetPathCollapsed,member.field.path]);const handleExpandItem=React.useCallback(itemKey=>{onSetPathCollapsed(member.field.path.concat({_key:itemKey}),false);},[onSetPathCollapsed,member.field.path]);const handleOpenItem=React.useCallback(path=>{onPathOpen(path);onSetPathCollapsed(path,false);},[onPathOpen,onSetPathCollapsed]);const handleCloseItem=React.useCallback(()=>{onPathOpen(member.field.path);onSetPathCollapsed(member.field.path,true);},[onPathOpen,member.field.path,onSetPathCollapsed]);const handleInsert=React.useCallback(event=>{if(event.items.length===0){throw new Error("Insert event should include at least one item");}const itemsWithKeys=event.items.map(item=>ensureKey(item));handleChange(PatchEvent.from([insert(itemsWithKeys,event.position,[event.referenceItem])]));const focusItemKey=itemsWithKeys[0]._key;const itemPath=[...member.field.path,{_key:focusItemKey}];onPathFocus(itemPath);const shouldOpen=event.open!==false;if(event.skipInitialValue){if(shouldOpen){handleOpenItem(itemPath);}}else{resolveInitialArrayValues(itemsWithKeys,member.field.schemaType,resolveInitialValue).pipe(operators.tap(result=>{if(result.type==="patch"){handleChange(result.patches);}else{toast.push({title:"Could not resolve initial value",description:"Unable to resolve initial value for type: ".concat(result.schemaType.title,": ").concat(result.error.message,"."),status:"error"});}})).subscribe({complete:()=>{if(shouldOpen){handleOpenItem(itemPath);}}});}},[handleChange,handleOpenItem,member.field.path,member.field.schemaType,onPathFocus,resolveInitialValue,toast]);const handleMoveItem=React.useCallback(event=>{const value=member.field.value;const item=value==null?void 0:value[event.fromIndex];const refItem=value==null?void 0:value[event.toIndex];if(event.fromIndex===event.toIndex){return;}if(!(item==null?void 0:item._key)||!(refItem==null?void 0:refItem._key)){console.error("Neither the item you are moving nor the item you are moving to have a key. Cannot continue.");return;}handleChange([unset([{_key:item._key}]),insert([item],event.fromIndex>event.toIndex?"before":"after",[{_key:refItem._key}])]);},[handleChange,member.field.value]);const handlePrependItem=React.useCallback(item=>{handleChange([setIfMissing([]),insert([ensureKey(item)],"before",[0])]);},[handleChange]);const handleAppendItem=React.useCallback(item=>{handleChange([setIfMissing([]),insert([ensureKey(item)],"after",[-1])]);},[handleChange]);const handleRemoveItem=React.useCallback(itemKey=>{if(uploadSubscriptions.current[itemKey]){uploadSubscriptions.current[itemKey].unsubscribe();delete uploadSubscriptions.current[itemKey];}handleChange([unset([{_key:itemKey}])]);},[handleChange]);const handleFocusChildPath=React.useCallback(path=>{onPathFocus(member.field.path.concat(path));},[member.field.path,onPathFocus]);const elementProps=React.useMemo(()=>({onBlur:handleBlur,onFocus:handleFocus,id:member.field.id,ref:focusRef,"aria-describedby":createDescriptionId(member.field.id,member.field.schemaType.description)}),[handleBlur,handleFocus,member.field.id,member.field.schemaType.description]);const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const formBuilder=useFormBuilder();const supportsImageUploads=formBuilder.__internal.image.directUploads;const supportsFileUploads=formBuilder.__internal.file.directUploads;const resolveUploader$1=React.useCallback((type,file)=>{if(is$1("image",type)&&!supportsImageUploads){return null;}if(is$1("file",type)&&!supportsFileUploads){return null;}return resolveUploader(type,file);},[supportsFileUploads,supportsImageUploads]);const handleUpload=React.useCallback(_ref111=>{let{file,schemaType,uploader}=_ref111;const item=createProtoArrayValue(schemaType);const key=item._key;handleInsert({items:[item],position:"after",referenceItem:-1,open:false});const events$=uploader.upload(client,file,schemaType).pipe(operators.map(uploadProgressEvent=>PatchEvent.from(uploadProgressEvent.patches||[]).prefixAll({_key:key})),operators.tap(event=>handleChange(event.patches)));uploadSubscriptions.current={...uploadSubscriptions.current,[key]:events$.subscribe()};},[client,handleChange,handleInsert]);const inputProps=React.useMemo(()=>{return{level:member.field.level,members:member.field.members,value:member.field.value,readOnly:member.field.readOnly,schemaType:member.field.schemaType,changed:member.field.changed,id:member.field.id,onItemExpand:handleExpandItem,onItemCollapse:handleCollapseItem,onItemClose:handleCloseItem,onItemOpen:handleOpenItem,focusPath:member.field.focusPath,focused:member.field.focused,path:member.field.path,onChange:handleChange,onInsert:handleInsert,onItemMove:handleMoveItem,onItemRemove:handleRemoveItem,onItemAppend:handleAppendItem,onItemPrepend:handlePrependItem,onPathFocus:handleFocusChildPath,resolveInitialValue,onUpload:handleUpload,resolveUploader:resolveUploader$1,validation:member.field.validation,presence:member.field.presence,renderAnnotation,renderBlock,renderInlineBlock,renderInput,renderField,renderItem,renderPreview,elementProps};},[member.field.level,member.field.members,member.field.value,member.field.readOnly,member.field.schemaType,member.field.changed,member.field.id,member.field.focusPath,member.field.focused,member.field.path,member.field.validation,member.field.presence,handleExpandItem,handleCollapseItem,handleCloseItem,handleOpenItem,handleChange,handleInsert,handleMoveItem,handleRemoveItem,handleAppendItem,handlePrependItem,handleFocusChildPath,resolveInitialValue,handleUpload,resolveUploader$1,renderAnnotation,renderBlock,renderInlineBlock,renderInput,renderField,renderItem,renderPreview,elementProps]);const renderedInput=React.useMemo(()=>renderInput(inputProps),[inputProps,renderInput]);const fieldProps=React.useMemo(()=>{return{actions:fieldActions,name:member.name,index:member.index,level:member.field.level,value:member.field.value,title:member.field.schemaType.title,description:member.field.schemaType.description,collapsible:member.collapsible,collapsed:member.collapsed,changed:member.field.changed,onCollapse:handleCollapse,onExpand:handleExpand,schemaType:member.field.schemaType,inputId:member.field.id,path:member.field.path,presence:member.field.presence,validation:member.field.validation,children:renderedInput,inputProps};},[fieldActions,member.name,member.index,member.field.level,member.field.value,member.field.schemaType,member.field.changed,member.field.id,member.field.path,member.field.presence,member.field.validation,member.collapsible,member.collapsed,handleCollapse,handleExpand,renderedInput,inputProps]);return/* @__PURE__ */jsxRuntime.jsx(FormCallbacksProvider,{onFieldGroupSelect,onChange:handleChange,onSetFieldSetCollapsed,onSetPathCollapsed,onPathOpen,onPathBlur,onPathFocus,children:React.useMemo(()=>renderField(fieldProps),[fieldProps,renderField])});}function readAsText(file,encoding){return new rxjs.Observable(observer=>{const reader=new FileReader();reader.onerror=error=>observer.error(error);reader.onload=()=>{observer.next(reader.result);observer.complete();};reader.readAsText(file,encoding);return()=>{reader.abort();};});}function move(arr,from,to){const copy=arr.slice();const val=copy[from];copy.splice(from,1);copy.splice(to,0,val);return copy;}function insertAfter(index,arr,items){const copy=arr.slice();copy.splice(index+1,0,...items);return copy;}function isStringNumeric(input){return /^\d+$/.test(input);}function convertToSchemaType(line,candidates){let acceptsBooleans=false;let acceptsNumbers=false;let acceptsStrings=false;candidates.forEach(candidate=>{if(types.isBooleanSchemaType(candidate)){acceptsBooleans=true;}if(types.isStringSchemaType(candidate)){acceptsStrings=true;}if(types.isNumberSchemaType(candidate)){acceptsNumbers=true;}});if(acceptsBooleans&&(line==="true"||line==="false"))return line==="true";if(acceptsNumbers&&isStringNumeric(line))return Number(line);return acceptsStrings?line:void 0;}function createPlainTextUploader(itemTypes){return{priority:0,accepts:"text/*",type:"string",upload(client,file){return readAsText(file,"utf-8").pipe(operators.map(textContent=>textContent==null?void 0:textContent.split(/[\n\r]/).map(value=>convertToSchemaType(value,itemTypes)).filter(v=>v!==void 0)),operators.filter(v=>Array.isArray(v)),operators.map(lines=>({type:"uploadProgress",patches:[insert(lines,"after",[-1])]})));}};}function ArrayOfPrimitivesField(props){const{onPathBlur,onPathFocus,onChange,onPathOpen,onSetPathCollapsed,onSetFieldSetCollapsed,onFieldGroupSelect}=useFormCallbacks();const{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview}=props;const fieldActions=useDocumentFieldActions();const focusRef=React.useRef();const uploadSubscriptions=React.useRef();const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);useDidUpdate(member.field.focused,(hadFocus,hasFocus)=>{var _a;if(!hadFocus&&hasFocus){(_a=focusRef.current)==null?void 0:_a.focus();}});const handleFocus=React.useCallback(event=>{if(event.currentTarget===event.target&&event.currentTarget===focusRef.current){onPathFocus(member.field.path);}},[member.field.path,onPathFocus]);const handleBlur=React.useCallback(event=>{if(event.currentTarget===event.target&&event.currentTarget===focusRef.current){onPathBlur(member.field.path);}},[member.field.path,onPathBlur]);const handleChange=React.useCallback(event=>{const patches=PatchEvent.from(event).patches;const isRemovingLastItem=patches.some(patch=>patch.type==="unset"&&patch.path.length===1);if(isRemovingLastItem){const result=applyAll(member.field.value||[],patches);if(Array.isArray(result)&&!result.length){onChange(PatchEvent.from(unset([member.name])));return;}}onChange(PatchEvent.from(event).prepend(setIfMissing([])).prefixAll(member.name));},[onChange,member.name,member.field.value]);const handleSetCollapsed=React.useCallback(collapsed=>{onSetPathCollapsed(member.field.path,collapsed);},[onSetPathCollapsed,member.field.path]);const handleCollapse=React.useCallback(()=>{onSetPathCollapsed(member.field.path,true);},[onSetPathCollapsed,member.field.path]);const handleExpand=React.useCallback(()=>{onSetPathCollapsed(member.field.path,false);},[onSetPathCollapsed,member.field.path]);const setValue=React.useCallback(nextValue=>{handleChange(nextValue.length===0?unset():set(nextValue));},[handleChange]);const handleMoveItem=React.useCallback(event=>{const{value=[]}=member.field;if(event.fromIndex===event.toIndex){return;}setValue(move(value,event.fromIndex,event.toIndex));},[member.field,setValue]);const handleAppend=React.useCallback(itemValue=>{const{value=[]}=member.field;setValue(value.concat(itemValue));},[member.field,setValue]);const handlePrepend=React.useCallback(itemValue=>{const{value=[]}=member.field;setValue([itemValue].concat(value||[]));},[member.field,setValue]);const handleInsert=React.useCallback(event=>{const{value=[]}=member.field;const insertIndex=event.referenceIndex+(event.position==="before"?-1:0);setValue(insertAfter(insertIndex,value,event.items));},[member.field,setValue]);const handleRemoveItem=React.useCallback(index=>{handleChange(unset([index]));},[handleChange]);const handleFocusIndex=React.useCallback(index=>{onPathFocus(member.field.path.concat([index]));},[member.field.path,onPathFocus]);const elementProps=React.useMemo(()=>({onBlur:handleBlur,onFocus:handleFocus,id:member.field.id,ref:focusRef,"aria-describedby":createDescriptionId(member.field.id,member.field.schemaType.description)}),[handleBlur,handleFocus,member.field.id,member.field.schemaType.description]);const plainTextUploader=React.useMemo(()=>createPlainTextUploader(member.field.schemaType.of),[member.field.schemaType.of]);const resolveUploader=React.useCallback((schemaType,file)=>accepts(file,"text/*")?plainTextUploader:null,[plainTextUploader]);const handleUpload=React.useCallback(_ref112=>{let{file,schemaType,uploader}=_ref112;const events$=uploader.upload(client,file,schemaType).pipe(operators.map(uploadProgressEvent=>PatchEvent.from(uploadProgressEvent.patches||[])),operators.tap(event=>handleChange(event.patches)));if(uploadSubscriptions.current){uploadSubscriptions.current.unsubscribe();}uploadSubscriptions.current=events$.subscribe();},[client,handleChange]);const inputProps=React.useMemo(()=>{return{level:member.field.level,members:member.field.members,value:member.field.value,readOnly:member.field.readOnly,onSetCollapsed:handleSetCollapsed,schemaType:member.field.schemaType,changed:member.field.changed,id:member.field.id,elementProps,path:member.field.path,focusPath:member.field.focusPath,focused:member.field.focused,onChange:handleChange,onInsert:handleInsert,onMoveItem:handleMoveItem,onItemRemove:handleRemoveItem,onItemAppend:handleAppend,onItemPrepend:handlePrepend,validation:member.field.validation,presence:member.field.presence,resolveUploader,onUpload:handleUpload,renderAnnotation,renderBlock,renderInlineBlock,renderInput,renderItem,onIndexFocus:handleFocusIndex,renderPreview};},[member.field.level,member.field.members,member.field.value,member.field.readOnly,member.field.schemaType,member.field.changed,member.field.id,member.field.path,member.field.focusPath,member.field.focused,member.field.validation,member.field.presence,handleSetCollapsed,elementProps,handleChange,handleInsert,handleMoveItem,handleRemoveItem,handleAppend,handlePrepend,resolveUploader,handleUpload,renderAnnotation,renderBlock,renderInlineBlock,renderInput,renderItem,handleFocusIndex,renderPreview]);const renderedInput=React.useMemo(()=>renderInput(inputProps),[inputProps,renderInput]);const fieldProps=React.useMemo(()=>{return{actions:fieldActions,name:member.name,index:member.index,level:member.field.level,value:member.field.value,title:member.field.schemaType.title,description:member.field.schemaType.description,collapsible:member.collapsible,collapsed:member.collapsed,onExpand:handleExpand,changed:member.field.changed,onCollapse:handleCollapse,schemaType:member.field.schemaType,inputId:member.field.id,path:member.field.path,presence:member.field.presence,validation:member.field.validation,children:renderedInput,inputProps};},[fieldActions,member.name,member.index,member.field.level,member.field.value,member.field.schemaType,member.field.changed,member.field.id,member.field.path,member.field.presence,member.field.validation,member.collapsible,member.collapsed,handleExpand,handleCollapse,renderedInput,inputProps]);return/* @__PURE__ */jsxRuntime.jsx(FormCallbacksProvider,{onFieldGroupSelect,onChange:handleChange,onPathOpen,onSetFieldSetCollapsed,onSetPathCollapsed,onPathBlur,onPathFocus,children:React.useMemo(()=>renderField(fieldProps),[fieldProps,renderField])});}function isMemberObject(member){return types.isObjectSchemaType(member.field.schemaType);}function isMemberArrayOfPrimitives(member){return types.isArraySchemaType(member.field.schemaType)&&member.field.schemaType.of.every(ofType=>types.isPrimitiveSchemaType(ofType));}function isMemberArrayOfObjects(member){return types.isArraySchemaType(member.field.schemaType)&&member.field.schemaType.of.every(ofType=>types.isObjectSchemaType(ofType));}const ObjectField=function ObjectField2(props){const{onPathBlur,onPathFocus,onChange,onPathOpen,onSetPathCollapsed,onSetFieldSetCollapsed,onFieldGroupSelect}=useFormCallbacks();const{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview}=props;const fieldActions=useDocumentFieldActions();const focusRef=React.useRef();const pendingValue=React.useRef(member.field.value);React.useEffect(()=>{pendingValue.current=member.field.value;},[member.field.value]);useDidUpdate(member.field.focused,(hadFocus,hasFocus)=>{var _a;if(!hadFocus&&hasFocus){(_a=focusRef.current)==null?void 0:_a.focus();}});const handleBlur=React.useCallback(()=>{onPathBlur(member.field.path);},[member.field.path,onPathBlur]);const handleFocus=React.useCallback(()=>{onPathFocus(member.field.path);},[member.field.path,onPathFocus]);const handleFocusChildPath=React.useCallback(path=>{onPathFocus(member.field.path.concat(path));},[member.field.path,onPathFocus]);const handleChange=React.useCallback(event=>{const isRoot=member.field.path.length===0;if(!isRoot){const patches=PatchEvent.from(event).patches;pendingValue.current=applyAll(pendingValue.current||{},patches);if(pendingValue.current&&content.isShallowEmptyObject(pendingValue.current)){onChange(PatchEvent.from(unset([member.name])));return;}}onChange(PatchEvent.from(event).prepend(setIfMissing(createProtoValue(member.field.schemaType))).prefixAll(member.name));},[onChange,member,pendingValue]);const handleCollapse=React.useCallback(()=>{onSetPathCollapsed(member.field.path,true);},[onSetPathCollapsed,member.field.path]);const handleExpand=React.useCallback(()=>{onSetPathCollapsed(member.field.path,false);},[onSetPathCollapsed,member.field.path]);const handleCollapseField=React.useCallback(fieldName=>{onSetPathCollapsed(member.field.path.concat(fieldName),true);},[onSetPathCollapsed,member.field.path]);const handleExpandField=React.useCallback(fieldName=>{onSetPathCollapsed(member.field.path.concat(fieldName),false);},[onSetPathCollapsed,member.field.path]);const handleOpenField=React.useCallback(fieldName=>{onPathOpen(member.field.path.concat(fieldName));},[onPathOpen,member.field.path]);const handleCloseField=React.useCallback(()=>{onPathOpen(member.field.path);},[onPathOpen,member.field.path]);const handleExpandFieldSet=React.useCallback(fieldsetName=>{onSetFieldSetCollapsed(member.field.path.concat(fieldsetName),false);},[onSetFieldSetCollapsed,member.field.path]);const handleCollapseFieldSet=React.useCallback(fieldsetName=>{onSetFieldSetCollapsed(member.field.path.concat(fieldsetName),true);},[onSetFieldSetCollapsed,member.field.path]);const handleOpen=React.useCallback(()=>{onPathOpen(member.field.path);},[onPathOpen,member.field.path]);const handleClose=React.useCallback(()=>{onPathOpen(member.field.path.slice(0,-1));},[onPathOpen,member.field.path]);const handleSelectFieldGroup=React.useCallback(groupName=>{onFieldGroupSelect(member.field.path,groupName);},[onFieldGroupSelect,member.field.path]);const elementProps=React.useMemo(()=>({onBlur:handleBlur,onFocus:handleFocus,id:member.field.id,ref:focusRef,"aria-describedby":createDescriptionId(member.field.id,member.field.schemaType.description)}),[handleBlur,handleFocus,member.field.id,member.field.schemaType.description]);const inputProps=React.useMemo(()=>{return{elementProps,level:member.field.level,members:member.field.members,value:member.field.value,readOnly:member.field.readOnly,validation:member.field.validation,presence:member.field.presence,schemaType:member.field.schemaType,changed:member.field.changed,id:member.field.id,onFieldGroupSelect:handleSelectFieldGroup,onFieldOpen:handleOpenField,onFieldClose:handleCloseField,onFieldCollapse:handleCollapseField,onFieldExpand:handleExpandField,onFieldSetExpand:handleExpandFieldSet,onFieldSetCollapse:handleCollapseFieldSet,onPathFocus:handleFocusChildPath,path:member.field.path,focusPath:member.field.focusPath,focused:member.field.focused,groups:member.field.groups,onChange:handleChange,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview};},[elementProps,member.field.level,member.field.members,member.field.value,member.field.readOnly,member.field.validation,member.field.presence,member.field.schemaType,member.field.changed,member.field.id,member.field.path,member.field.focusPath,member.field.focused,member.field.groups,handleSelectFieldGroup,handleOpenField,handleCloseField,handleCollapseField,handleExpandField,handleExpandFieldSet,handleCollapseFieldSet,handleFocusChildPath,handleChange,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview]);const renderedInput=React.useMemo(()=>renderInput(inputProps),[inputProps,renderInput]);const fieldProps=React.useMemo(()=>{return{actions:fieldActions,name:member.name,index:member.index,level:member.field.level,value:member.field.value,validation:member.field.validation,presence:member.field.presence,title:member.field.schemaType.title,description:member.field.schemaType.description,collapsible:member.collapsible,collapsed:member.collapsed,onCollapse:handleCollapse,onExpand:handleExpand,open:member.open,changed:member.field.changed,onOpen:handleOpen,onClose:handleClose,schemaType:member.field.schemaType,inputId:member.field.id,path:member.field.path,children:renderedInput,inputProps};},[fieldActions,member.name,member.index,member.field.level,member.field.value,member.field.validation,member.field.presence,member.field.schemaType,member.field.changed,member.field.id,member.field.path,member.collapsible,member.collapsed,member.open,handleCollapse,handleExpand,handleOpen,handleClose,renderedInput,inputProps]);return/* @__PURE__ */jsxRuntime.jsx(FormCallbacksProvider,{onFieldGroupSelect,onChange:handleChange,onSetFieldSetCollapsed,onPathOpen,onSetPathCollapsed,onPathBlur,onPathFocus,children:React.useMemo(()=>renderField(fieldProps),[fieldProps,renderField])});};function PrimitiveField$1(props){const{member,renderInput,renderField}=props;const fieldActions=useDocumentFieldActions();const focusRef=React.useRef();const[localValue,setLocalValue]=React.useState();const{onPathBlur,onPathFocus,onChange}=useFormCallbacks();React.useEffect(()=>{var _a;if(member.field.focused){(_a=focusRef.current)==null?void 0:_a.focus();}},[member.field.focused]);const handleBlur=React.useCallback(()=>{onPathBlur(member.field.path);},[member.field.path,onPathBlur]);const handleFocus=React.useCallback(()=>{onPathFocus(member.field.path);},[member.field.path,onPathFocus]);const handleChange=React.useCallback(event=>{onChange(PatchEvent.from(event).prefixAll(member.name));},[onChange,member.name]);const handleNativeChange=React.useCallback(event=>{let inputValue=event.currentTarget.value;if(types.isNumberSchemaType(member.field.schemaType)){inputValue=event.currentTarget.valueAsNumber;if(inputValue>Number.MAX_SAFE_INTEGER||inputValue<Number.MIN_SAFE_INTEGER){return;}}else if(types.isBooleanSchemaType(member.field.schemaType)){inputValue=event.currentTarget.checked;}const hasEmptyValue=inputValue===""||typeof inputValue==="number"&&isNaN(inputValue);if(types.isNumberSchemaType(member.field.schemaType)){setLocalValue(hasEmptyValue?void 0:event.currentTarget.value);}onChange(PatchEvent.from(hasEmptyValue?unset():set(inputValue)).prefixAll(member.name));},[member.name,member.field.schemaType,onChange]);const validationError=React.useMemo(()=>member.field.validation.filter(item=>item.level==="error").map(item=>item.message).join("\n"),[member.field.validation])||void 0;const elementProps=React.useMemo(()=>({onBlur:handleBlur,onFocus:handleFocus,id:member.field.id,ref:focusRef,onChange:handleNativeChange,value:resolveNativeNumberInputValue(member.field.schemaType,member.field.value,localValue),readOnly:Boolean(member.field.readOnly),placeholder:member.field.schemaType.placeholder,"aria-describedby":createDescriptionId(member.field.id,member.field.schemaType.description)}),[handleBlur,handleFocus,handleNativeChange,member.field.id,member.field.readOnly,member.field.schemaType,member.field.value,localValue]);const inputProps=React.useMemo(()=>{return{value:member.field.value,readOnly:member.field.readOnly,schemaType:member.field.schemaType,changed:member.field.changed,id:member.field.id,path:member.field.path,focused:member.field.focused,level:member.field.level,onChange:handleChange,validation:member.field.validation,presence:member.field.presence,validationError,elementProps};},[member.field.value,member.field.readOnly,member.field.schemaType,member.field.changed,member.field.id,member.field.path,member.field.focused,member.field.level,member.field.validation,member.field.presence,handleChange,validationError,elementProps]);const renderedInput=React.useMemo(()=>renderInput(inputProps),[inputProps,renderInput]);const fieldProps=React.useMemo(()=>{return{actions:fieldActions,changed:member.field.changed,children:renderedInput,description:member.field.schemaType.description,index:member.index,inputId:member.field.id,inputProps,level:member.field.level,name:member.name,path:member.field.path,presence:member.field.presence,schemaType:member.field.schemaType,title:member.field.schemaType.title,validation:member.field.validation,value:member.field.value};},[fieldActions,member.field.level,member.field.value,member.field.schemaType,member.field.id,member.field.path,member.field.validation,member.field.presence,member.field.changed,member.name,member.index,renderedInput,inputProps]);return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:renderField(fieldProps)});}const MemberField=React.memo(function MemberField2(props){const{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview}=props;if(isMemberObject(member)){return/* @__PURE__ */jsxRuntime.jsx(ObjectField,{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview});}if(isMemberArrayOfPrimitives(member)){return/* @__PURE__ */jsxRuntime.jsx(ArrayOfPrimitivesField,{member,renderAnnotation,renderBlock,renderField,renderInput,renderInlineBlock,renderItem,renderPreview});}if(isMemberArrayOfObjects(member)){return/* @__PURE__ */jsxRuntime.jsx(ArrayOfObjectsField,{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview});}return/* @__PURE__ */jsxRuntime.jsx(PrimitiveField$1,{member,renderField,renderInput});});var __freeze$1T=Object.freeze;var __defProp$1T=Object.defineProperty;var __template$1T=(cooked,raw)=>__freeze$1T(__defProp$1T(cooked,"raw",{value:__freeze$1T(raw||cooked.slice())}));var _a$1U;const STATUS_TONES$1={warning:"caution",error:"critical"};const SuffixBox=styled__default.default(ui.Box)(_a$1U||(_a$1U=__template$1T(["\n  border-top: 1px solid var(--card-border-color);\n"])));function Alert(props){const{children,status="warning",suffix,title,...rest}=props;return/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{radius:2,tone:STATUS_TONES$1[status],...rest,"data-ui":"Alert",children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{padding:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{size:1,children:[status==="warning"&&/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{}),status==="error"&&/* @__PURE__ */jsxRuntime.jsx(icons.ErrorOutlineIcon,{})]})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{flex:1,marginLeft:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:title}),children&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:3,children})]})]}),suffix&&/* @__PURE__ */jsxRuntime.jsx(SuffixBox,{children:suffix})]});}var __freeze$1S=Object.freeze;var __defProp$1S=Object.defineProperty;var __template$1S=(cooked,raw)=>__freeze$1S(__defProp$1S(cooked,"raw",{value:__freeze$1S(raw||cooked.slice())}));var _a$1T,_b$S,_c$t,_d$h;const HeaderButton=styled__default.default.button(_a$1T||(_a$1T=__template$1S(["\n  display: block;\n  -webkit-font-smoothing: inherit;\n  appearance: none;\n  font: inherit;\n  background: none;\n  width: 100%;\n  text-align: left;\n  border: 0;\n  margin: 0;\n  padding: 0;\n  outline: none;\n"])));const ToggleArrow=styled__default.default(icons.ToggleArrowRightIcon)(_b$S||(_b$S=__template$1S(["\n  transform: ",";\n"])),props=>props.open?"rotate(90deg)":"");const Header=styled__default.default(ui.Flex)(_c$t||(_c$t=__template$1S(["\n  cursor: default;\n"])));const IconBox=styled__default.default(ui.Box)(_d$h||(_d$h=__template$1S(["\n  & > div > svg {\n    transform: rotate(0);\n    transition: transform 100ms;\n  }\n\n  &[data-open] > div > svg {\n    transform: rotate(90deg);\n  }\n"])));function Details(props){const{children,open:openProp,icon,title="Details",...restProps}=props;const[open,setOpen]=React.useState(openProp||false);const handleToggle=React.useCallback(()=>setOpen(v=>!v),[]);React.useEffect(()=>setOpen(openProp||false),[openProp]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{...restProps,children:[/* @__PURE__ */jsxRuntime.jsx(HeaderButton,{type:"button",onClick:handleToggle,children:/* @__PURE__ */jsxRuntime.jsx(Header,{align:"center",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{children:[/* @__PURE__ */jsxRuntime.jsx(IconBox,{"data-open":open?"":void 0,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(ToggleArrow,{open})})}),icon&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:1,children:icon}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,marginLeft:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:title})})]})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{hidden:!open,marginTop:3,children})]});}const TRUTHY_STRINGS=["yes","true","1"];const FALSEY_STRINGS=["false","no","false","0","null"];const BOOL_STRINGS=TRUTHY_STRINGS.concat(FALSEY_STRINGS);const TRUE=()=>true;const has=prop=>val=>val&&val[prop];const is=typeName=>val=>(val&&val._type)===typeName;function toLocalDate(input){const newDate=new Date(input.getTime()+input.getTimezoneOffset()*60*1e3);const offset=input.getTimezoneOffset()/60;const hours=input.getHours();newDate.setHours(hours-offset);return newDate;}function getTZName(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone;}catch(e){}return null;}const converters={string:{number:{test:Number,convert:Number},boolean:{test:value=>BOOL_STRINGS.includes(value.toLowerCase()),convert:value=>TRUTHY_STRINGS.includes(value.toLowerCase())||!FALSEY_STRINGS.includes(value.toLowerCase())},richDate:{test:value=>isValidDate__default.default(value),convert:value=>{return{_type:"richDate",local:toLocalDate(new Date(value)).toJSON(),utc:new Date(value).toJSON(),timezone:getTZName(),offset:(/* @__PURE__ */new Date()).getTimezoneOffset()};}}},date:{richDate:{test:is("date"),convert:value=>Object.assign({},value,{_type:"richDate"})}},richDate:{datetime:{test:has("utc"),convert:value=>value.utc}},number:{string:{test:TRUE,convert:String},boolean:{test:TRUE,convert:Number}},boolean:{string:{test:TRUE,convert:value=>value?"Yes":"No"},number:{test:TRUE,convert:Number}}};function SetMissingTypeButton(_ref113){let{value,targetType,onChange}=_ref113;const itemValue=React.useMemo(()=>({...value,_type:targetType}),[targetType,value]);const handleClick=React.useCallback(()=>onChange(PatchEvent.from(setIfMissing(targetType,["_type"])),itemValue),[itemValue,onChange,targetType]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{onClick:handleClick,text:t("inputs.untyped-value.convert-button.text",{targetType})});}function UnsetItemButton(_ref114){let{value,onChange,validTypes}=_ref114;const itemValue=React.useMemo(()=>({...value,_type:validTypes[0]}),[validTypes,value]);const handleClick=React.useCallback(()=>onChange(PatchEvent.from(unset()),itemValue),[itemValue,onChange]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{onClick:handleClick,tone:"critical",text:t("inputs.untyped-value.unset-item-button.text")});}function UntypedValueInput(_ref115){let{validTypes,value,onChange}=_ref115;const schema=useSchema();const isSingleValidType=validTypes.length===1;const isHoistedType=schema.has(validTypes[0]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(Alert,{status:"warning",title:/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.untyped-value.title"})}),children:/* @__PURE__ */jsxRuntime.jsx(Details,{open:isDev,title:t("inputs.untyped-value.details.title"),children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.untyped-value.description"})}),isSingleValidType&&!isHoistedType&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.untyped-value.details.description"})}),!isSingleValidType&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:t("inputs.untyped-value.details.multi-type-description")}),!isSingleValidType&&/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"ul",space:2,children:validTypes.map(validType=>/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"li",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx("code",{children:validType})},validType))}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"h4",weight:"medium",size:1,children:t("inputs.untyped-value.details.json-dump-prefix")}),/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,overflow:"auto",padding:2,radius:2,tone:"inherit",children:/* @__PURE__ */jsxRuntime.jsx(ui.Code,{language:"json",children:JSON.stringify(value,null,2)})})]}),/* @__PURE__ */jsxRuntime.jsxs(ui.Grid,{columns:[1,2,2],gap:1,children:[isSingleValidType&&/* @__PURE__ */jsxRuntime.jsx(SetMissingTypeButton,{onChange,targetType:validTypes[0],value}),/* @__PURE__ */jsxRuntime.jsx(UnsetItemButton,{onChange,validTypes,value})]})]})})});}function getConverters(value,actualType,validTypes){if(!(actualType in converters)){return[];}return Object.keys(converters[actualType]).filter(targetType=>validTypes.includes(targetType)).map(targetType=>({from:actualType,to:targetType,...converters[actualType][targetType]})).filter(converter=>converter.test(value));}const InvalidValueInput=React.forwardRef((props,ref)=>{const{value,actualType,validTypes,onChange}=props;React.useImperativeHandle(ref,()=>({// @todo
focus:()=>void 0}));const handleClearClick=React.useCallback(()=>{onChange(PatchEvent.from(unset()));},[onChange]);const handleConvertTo=React.useCallback(converted=>{onChange(PatchEvent.from(set(converted)));},[onChange]);const converters=React.useMemo(()=>getConverters(value,actualType,validTypes),[value,actualType,validTypes]);const{t}=useTranslation();if(isPlainObject__default.default(value)&&!("_type"in value)){return/* @__PURE__ */jsxRuntime.jsx(UntypedValueInput,{value,validTypes,onChange});}const suffix=/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{onClick:handleClearClick,tone:"critical",text:t("inputs.invalid-value.reset-button.text")})});return/* @__PURE__ */jsxRuntime.jsxs(Alert,{status:"error",suffix,title:t("inputs.invalid-value.title"),children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:t("inputs.invalid-value.description")}),/* @__PURE__ */jsxRuntime.jsx(Details,{marginTop:4,open:isDev,title:t("inputs.invalid-value.details.title"),children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[validTypes.length===1&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.invalid-value.details.description",values:{validType:validTypes[0]}})}),validTypes.length===1&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:t("inputs.invalid-value.details.possible-reason")}),validTypes.length!==1&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:t("inputs.invalid-value.details.multi-type-description")}),validTypes.length!==1&&/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"ul",space:2,children:validTypes.map(validType=>/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"li",children:/* @__PURE__ */jsxRuntime.jsx("code",{children:validType})},validType))}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{marginTop:2,space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.invalid-value.current-type",values:{actualType}})}),/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,padding:2,radius:2,tone:"inherit",children:/* @__PURE__ */jsxRuntime.jsx(ui.Code,{language:"json",size:1,children:JSON.stringify(value,null,2)})})]}),converters.length>0&&/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:1,children:converters.map(converter=>/* @__PURE__ */jsxRuntime.jsx(ConvertButton,{converter,onConvert:handleConvertTo,value},"".concat(converter.from,"-").concat(converter.to)))})]})})]});});InvalidValueInput.displayName="InvalidValueInput";function ConvertButton(_ref116){let{converter,onConvert,value}=_ref116;const handleClick=React.useCallback(()=>onConvert(converter.convert(value)),[converter,onConvert,value]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{onClick:handleClick,text:t("inputs.invalid-value.convert-button.text",{targetType:converter.to})});}function DuplicateKeysAlert(props){const{error,onChange}=props;const handleFixDuplicateKeys=React.useCallback(()=>{onChange(PatchEvent.from((error.duplicates||[]).map(_ref117=>{let[index,key]=_ref117;return set("".concat(key,"_deduped_").concat(index),[index,"_key"]);})));},[error.duplicates,onChange]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(FormField,{title:error.schemaType.title,description:error.schemaType.description,children:/* @__PURE__ */jsxRuntime.jsxs(Alert,{status:"warning",suffix:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{onClick:handleFixDuplicateKeys,text:t("form.error.duplicate-keys-alert.generate-button.text"),tone:"caution"})}),title:t("form.error.duplicate-keys-alert.title"),children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:t("form.error.duplicate-keys-alert.summary")}),/* @__PURE__ */jsxRuntime.jsx(Details,{marginTop:4,open:isDev,title:t("form.error.duplicate-keys-alert.details.title"),children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"form.error.duplicate-keys-alert.details.description"})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"form.error.duplicate-keys-alert.details.additional-description"})})]})})]})});}function MissingKeysAlert(props){const{error,onChange}=props;const handleFixMissingKeys=React.useCallback(()=>{onChange(PatchEvent.from((error.value||[]).map((val,i)=>setIfMissing(content.randomKey(),[i,"_key"]))));},[error.value,onChange]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(FormField,{title:error.schemaType.title,description:error.schemaType.description,children:/* @__PURE__ */jsxRuntime.jsxs(Alert,{status:"warning",suffix:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{onClick:handleFixMissingKeys,text:t("form.error.missing-keys-alert.add-button.text"),tone:"caution"})}),title:t("form.error.missing-keys-alert.title"),children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:t("form.error.missing-keys-alert.summary")}),/* @__PURE__ */jsxRuntime.jsx(Details,{marginTop:4,open:isDev,title:t("form.error.missing-keys-alert.details.title"),children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"form.error.missing-keys-alert.details.description"})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"form.error.missing-keys-alert.details.additional-description"})})]})})]})});}function MixedArrayAlert(props){const{error,onChange}=props;const handleRemoveNonObjectValues=()=>{const nonObjectIndices=(error.value||[]).flatMap((item,index)=>isPlainObject__default.default(item)?[]:[index]).reverse();const patches=nonObjectIndices.map(index=>unset([index]));onChange(PatchEvent.from(patches));};const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(FormField,{title:error.schemaType.title,description:error.schemaType.description,children:/* @__PURE__ */jsxRuntime.jsxs(Alert,{status:"error",suffix:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{onClick:handleRemoveNonObjectValues,text:t("form.error.mixed-array-alert.remove-button.text"),tone:"critical"})}),title:t("form.error.mixed-array-alert.title"),children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:t("form.error.mixed-array-alert.summary")}),/* @__PURE__ */jsxRuntime.jsx(Details,{marginTop:4,open:isDev,title:t("form.error.mixed-array-alert.details.title"),children:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:t("form.error.mixed-array-alert.details.description")})})})]})});}function MemberFieldError(props){const{member}=props;const{onChange}=useFormCallbacks();const handleChange=React.useCallback(event=>{onChange(PatchEvent.from(event).prefixAll(member.fieldName));},[onChange,member.fieldName]);const{t}=useTranslation();if(member.error.type==="INCOMPATIBLE_TYPE"){return/* @__PURE__ */jsxRuntime.jsx(InvalidValueInput,{value:member.error.value,onChange:handleChange,actualType:member.error.resolvedValueType,validTypes:[member.error.expectedSchemaType.name]});}if(member.error.type==="MISSING_KEYS"){return/* @__PURE__ */jsxRuntime.jsx(MissingKeysAlert,{error:member.error,onChange:handleChange});}if(member.error.type==="DUPLICATE_KEYS"){return/* @__PURE__ */jsxRuntime.jsx(DuplicateKeysAlert,{error:member.error,onChange:handleChange});}if(member.error.type==="MIXED_ARRAY"){return/* @__PURE__ */jsxRuntime.jsx(MixedArrayAlert,{onChange:handleChange,error:member.error});}return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:t("member-field-error.unexpected-error",{error:props.member.error.type})});}const MemberFieldSet=React.memo(function MemberFieldSet2(props){var _a;const{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview}=props;const{onSetFieldSetCollapsed}=useFormCallbacks();const handleCollapse=React.useCallback(()=>{onSetFieldSetCollapsed(member.fieldSet.path,true);},[member.fieldSet.path,onSetFieldSetCollapsed]);const handleExpand=React.useCallback(()=>{onSetFieldSetCollapsed(member.fieldSet.path,false);},[member.fieldSet.path,onSetFieldSetCollapsed]);return/* @__PURE__ */jsxRuntime.jsx(FormFieldSet,{title:member.fieldSet.title||capitalize__default.default(member.fieldSet.name),description:member.fieldSet.description,level:member.fieldSet.level,collapsible:member.fieldSet.collapsible,collapsed:member.fieldSet.collapsed,onCollapse:handleCollapse,onExpand:handleExpand,columns:(_a=member==null?void 0:member.fieldSet)==null?void 0:_a.columns,"data-testid":"fieldset-".concat(member.fieldSet.name),inputId:member.fieldSet.name,children:member.fieldSet.members.map(fieldsetMember=>{if(fieldsetMember.kind==="error"){return/* @__PURE__ */jsxRuntime.jsx(MemberFieldError,{member:fieldsetMember},member.key);}return/* @__PURE__ */jsxRuntime.jsx(MemberField,{member:fieldsetMember,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview},fieldsetMember.key);})});});const ObjectInputMember=React.memo(function ObjectInputMember2(props){const{member,renderAnnotation,renderBlock,renderInput,renderInlineBlock,renderField,renderItem,renderPreview}=props;if(member.kind==="field"){return/* @__PURE__ */jsxRuntime.jsx(MemberField,{member,renderAnnotation,renderBlock,renderInlineBlock,renderInput,renderField,renderItem,renderPreview},member.key);}if(member.kind==="error"){return/* @__PURE__ */jsxRuntime.jsx(MemberFieldError,{member},member.key);}if(member.kind==="fieldSet"){return/* @__PURE__ */jsxRuntime.jsx(MemberFieldSet,{member,renderAnnotation,renderBlock,renderInlineBlock,renderInput,renderField,renderItem,renderPreview},member.key);}console.warn(new Error("Unhandled member kind ".concat(member.kind)));return null;});function ObjectInputMembers(props){const{members,renderAnnotation,renderBlock,renderInput,renderInlineBlock,renderField,renderItem,renderPreview}=props;const renderMembers=React.useMemo(()=>members.map(member=>/* @__PURE__ */jsxRuntime.jsx(ObjectInputMember,{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview},member.key)),[members,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview]);return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:renderMembers});}const ObjectMembers=ObjectInputMembers;function isObjectInputProps$1(inputProps){return types.isObjectSchemaType(inputProps.schemaType);}function isArrayInputProps(inputProps){return types.isArraySchemaType(inputProps.schemaType);}const pass=_ref118=>{let{children}=_ref118;return children;};function hasAbsolutePath(a){return"absolutePath"in a;}const FormInput=React.memo(function FormInput2(props){const absolutePath=React.useMemo(()=>{return hasAbsolutePath(props)?props.absolutePath:props.path.concat(props.relativePath);},[props]);const nullRender=React.useCallback(()=>/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:"Missing destination render function"}),[]);return/* @__PURE__ */jsxRuntime.jsx(FormInputInner,{...props,absolutePath,destinationRenderAnnotation:props.renderAnnotation||nullRender,destinationRenderBlock:props.renderBlock||nullRender,destinationRenderField:props.renderField,destinationRenderInlineBlock:props.renderInlineBlock||nullRender,destinationRenderInput:props.renderInput,destinationRenderItem:props.renderItem,destinationRenderPreview:props.renderPreview});});const FormInputInner=React.memo(function FormInputInner2(props){const{absolutePath,destinationRenderAnnotation,destinationRenderBlock,destinationRenderField,destinationRenderInlineBlock,destinationRenderInput,destinationRenderItem,destinationRenderPreview}=props;const{t}=useTranslation();const renderInput=React.useCallback(inputProps=>{const isDestinationReached=PathUtils.isEqual(inputProps.path,absolutePath)||PathUtils.startsWith(absolutePath,inputProps.path);if(isDestinationReached){return destinationRenderInput(inputProps);}if(!isObjectInputProps$1(inputProps)&&!isArrayInputProps(inputProps)){throw new Error("Expected either object input props or array input props for: ".concat(JSON.stringify(inputProps.path)));}return/* @__PURE__ */jsxRuntime.jsx(FormInputInner2,{...inputProps,absolutePath,destinationRenderAnnotation,destinationRenderBlock,destinationRenderInput,destinationRenderItem,destinationRenderField,destinationRenderInlineBlock,destinationRenderPreview});},[absolutePath,destinationRenderAnnotation,destinationRenderBlock,destinationRenderField,destinationRenderInlineBlock,destinationRenderInput,destinationRenderItem,destinationRenderPreview]);const renderField=React.useCallback(fieldProps=>{const shouldRenderField=PathUtils.startsWith(absolutePath,fieldProps.path)&&(props.includeField||!PathUtils.isEqual(absolutePath,fieldProps.path));return shouldRenderField?destinationRenderField(fieldProps):pass(fieldProps);},[absolutePath,destinationRenderField,props.includeField]);const renderItem=React.useCallback(itemProps=>{const shouldRenderField=PathUtils.startsWith(absolutePath,itemProps.path)&&(props.includeItem||!PathUtils.isEqual(absolutePath,itemProps.path));return shouldRenderField?destinationRenderItem(itemProps):pass(itemProps);},[absolutePath,destinationRenderItem,props.includeItem]);const renderBlock=React.useCallback(blockProps=>{const shouldRenderBlock=PathUtils.startsWith(absolutePath,blockProps.path)&&(props.includeItem||!PathUtils.isEqual(absolutePath,blockProps.path));return shouldRenderBlock?destinationRenderBlock(blockProps):pass(blockProps);},[absolutePath,destinationRenderBlock,props.includeItem]);const renderInlineBlock=React.useCallback(blockProps=>{const shouldRenderInlineBlock=PathUtils.startsWith(absolutePath,blockProps.path)&&(props.includeItem||!PathUtils.isEqual(absolutePath,blockProps.path));return shouldRenderInlineBlock?destinationRenderInlineBlock(blockProps):pass(blockProps);},[absolutePath,destinationRenderInlineBlock,props.includeItem]);const renderAnnotation=React.useCallback(annotationProps=>{const shouldRenderAnnotation=PathUtils.startsWith(absolutePath,annotationProps.path)&&(props.includeItem||!PathUtils.isEqual(absolutePath,annotationProps.path));return shouldRenderAnnotation?destinationRenderAnnotation(annotationProps):pass(annotationProps);},[absolutePath,destinationRenderAnnotation,props.includeItem]);if(isArrayInputProps(props)){const childPath=PathUtils.trimLeft(props.path,absolutePath);const itemMember=props.members.find(member=>member.kind=="item"&&types.isKeySegment(childPath[0])&&member.key===childPath[0]._key);if(!itemMember){const path=pathToString$1(props.path);const relativePath=PathUtils.trimLeft(props.path,absolutePath);if(types.isKeySegment(relativePath[0])){const key=relativePath[0]._key;return/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"form.error.no-array-item-at-key",values:{key,path}})});}const index=types.isIndexSegment(relativePath[0])?relativePath[0]:relativePath[0][0];return/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"form.error.no-array-item-at-index",values:{index,path}})});}if(itemMember.kind==="error"){return/* @__PURE__ */jsxRuntime.jsx(MemberItemError,{member:itemMember});}return/* @__PURE__ */jsxRuntime.jsx(ArrayOfObjectsItem,{member:itemMember,renderAnnotation,renderBlock,renderInput,renderField,renderInlineBlock,renderItem,renderPreview:destinationRenderPreview});}if(isObjectInputProps$1(props)){const childPath=PathUtils.trimLeft(props.path,absolutePath);const fieldMember=props.members.find(member=>member.kind=="field"&&childPath[0]===member.name);if(!fieldMember){const fieldName=typeof childPath[0]==="string"?childPath[0]:JSON.stringify(childPath[0]);return/* @__PURE__ */jsxRuntime.jsx("div",{children:t("form.error.field-not-found",{fieldName})});}return/* @__PURE__ */jsxRuntime.jsx(MemberField,{member:fieldMember,renderAnnotation,renderBlock,renderInput,renderInlineBlock,renderField,renderItem,renderPreview:destinationRenderPreview});}throw new Error("FormInput can only be used with arrays or objects");});const PortableTextMemberItemsContext=React.createContext([]);function PortableTextMemberItemsProvider(props){return/* @__PURE__ */jsxRuntime.jsx(PortableTextMemberItemsContext.Provider,{value:props.memberItems,children:props.children});}function usePortableTextMemberItem(key){const ctx=React.useContext(PortableTextMemberItemsContext);if(!ctx){throw new Error("Form context not provided");}return ctx.find(m=>m.key===key);}function usePortableTextMemberItems(){const ctx=React.useContext(PortableTextMemberItemsContext);if(!ctx){throw new Error("Form context not provided");}return ctx;}function usePortableTextMemberItemsFromProps(props){const portableTextMemberItemsRef=React.useRef([]);reconcilePortableTextMembers({props,ref:portableTextMemberItemsRef});return portableTextMemberItemsRef.current;}const reconcilePortableTextMembers=_ref119=>{let{props,ref}=_ref119;var _a;const result=[];const{members,path,schemaType,renderAnnotation,renderField,renderBlock,renderInput,renderItem,renderInlineBlock,renderPreview}=props;for(const member of members){if(member.kind==="item"){const isObjectBlock=!isBlockType(member.item.schemaType);if(isObjectBlock){result.push({kind:"objectBlock",member,node:member.item});}else{if(member.item.validation.length>0||member.item.changed||((_a=member.item.presence)==null?void 0:_a.length)||member.open||member.item.focusPath.length){result.push({kind:"textBlock",member,node:member.item});}const childrenField=member.item.members.find(f=>f.kind==="field"&&f.name==="children");if(childrenField&&childrenField.kind==="field"&&isMemberArrayOfObjects(childrenField)){for(const child of childrenField.field.members){if(child.kind==="item"&&child.item.schemaType.name!=="span"){result.push({kind:"inlineObject",member:child,node:child.item});}}}const markDefArrayMember=member.item.members.filter(isArrayOfObjectsFieldMember).find(f=>f.name==="markDefs");if(markDefArrayMember){for(const child of markDefArrayMember.field.members){if(child.kind==="item"&&child.item.schemaType.jsonType==="object"){result.push({kind:"annotation",member:child,node:child.item});}}}}}}const items=result.map(item=>{const key=pathToString$1(item.node.path);const existingItem=ref.current.find(refItem=>refItem.key===key);const isObject=item.kind!=="textBlock";let input=null;if(isObject&&item.member!==(existingItem==null?void 0:existingItem.member)||item.node!==(existingItem==null?void 0:existingItem.node)){const inputProps={absolutePath:PathUtils.pathFor(item.node.path),includeField:false,members,path:PathUtils.pathFor(path),renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType};input=/* @__PURE__ */jsxRuntime.jsx(FormInput,{...inputProps});}if(existingItem){existingItem.member=item.member;existingItem.node=item.node;existingItem.input=input||existingItem.input;return existingItem;}return{kind:item.kind,key,member:item.member,node:item.node,elementRef:React.createRef(),input};});ref.current=items;return items;};var __freeze$1R=Object.freeze;var __defProp$1R=Object.defineProperty;var __template$1R=(cooked,raw)=>__freeze$1R(__defProp$1R(cooked,"raw",{value:__freeze$1R(raw||cooked.slice())}));var _a$1S,_b$R;const Root$m=styled__default.default.span(props=>{var _a2,_b2,_c,_d;const{$toneKey="default",theme}=props;return styled.css(_a$1S||(_a$1S=__template$1R(["\n      text-decoration: none;\n      display: inline;\n      background-color: ",";\n      border-bottom: 1px dashed ",";\n      color: ",";\n\n      &[data-link] {\n        border-bottom: 1px solid ",";\n      }\n\n      &[data-custom-markers] {\n        background-color: ",";\n      }\n\n      &[data-warning] {\n        background-color: ",";\n      }\n\n      &[data-error] {\n        background-color: ",";\n      }\n    "])),(_a2=theme.sanity.color.selectable)==null?void 0:_a2[$toneKey].enabled.bg,(_b2=theme.sanity.color.selectable)==null?void 0:_b2[$toneKey].enabled.fg,(_c=theme.sanity.color.selectable)==null?void 0:_c[$toneKey].enabled.fg,(_d=theme.sanity.color.selectable)==null?void 0:_d[$toneKey].enabled.fg,theme.sanity.color.dark?color.hues.purple[950].hex:color.hues.purple[50].hex,theme.sanity.color.muted.caution.hovered.bg,theme.sanity.color.muted.critical.hovered.bg);});const TooltipBox$3=styled__default.default(ui.Box).attrs({forwardedAs:"span"})(_b$R||(_b$R=__template$1R(["\n  max-width: 250px;\n"])));const POPOVER_FALLBACK_PLACEMENTS$2=["top","bottom"];function AnnotationToolbarPopover(props){const{annotationOpen,floatingBoundary,onOpen,onRemove,referenceBoundary,referenceElement,selected,title}=props;const[renderPopover,setRenderPopover]=React.useState(false);const[popoverOpen,setPopoverOpen]=React.useState(false);const[cursorRect,setCursorRect]=React.useState(null);const rangeRef=React.useRef(null);const{sanity}=ui.useTheme();const{t}=useTranslation();const popoverRef=React.useRef(null);const popoverScheme=sanity.color.dark?"light":"dark";const handleOpenPopover=React.useCallback(open=>{setRenderPopover(open);if(open){React.startTransition(()=>{setPopoverOpen(open);});}else{setPopoverOpen(open);}},[]);const cursorElement=React.useMemo(()=>{if(!cursorRect){return null;}return{getBoundingClientRect:()=>{return cursorRect;}};},[cursorRect]);ui.useGlobalKeyDown(React.useCallback(event=>{if(!popoverOpen){return;}if(event.key==="Escape"){handleOpenPopover(false);}},[handleOpenPopover,popoverOpen]));const handleSelectionChange=React.useCallback(()=>{if(annotationOpen){handleOpenPopover(false);setCursorRect(null);return;}const sel=window.getSelection();if(!sel||sel.rangeCount===0)return;const range=sel.getRangeAt(0);const isWithinRoot=referenceElement==null?void 0:referenceElement.contains(range.commonAncestorContainer);if(!isWithinRoot){handleOpenPopover(false);setCursorRect(null);return;}const rect=range==null?void 0:range.getBoundingClientRect();if(rect){setCursorRect(rect);handleOpenPopover(true);}},[annotationOpen,referenceElement,handleOpenPopover]);React.useEffect(()=>{document.addEventListener("selectionchange",handleSelectionChange,{passive:true});return()=>{document.removeEventListener("selectionchange",handleSelectionChange);};},[handleSelectionChange]);const handleEditButtonClicked=React.useCallback(()=>{handleOpenPopover(false);onOpen();},[onOpen,handleOpenPopover]);React.useEffect(()=>{if(!annotationOpen&&selected&&cursorRect){handleOpenPopover(true);}if(annotationOpen){handleOpenPopover(false);}},[annotationOpen,selected,cursorRect,handleOpenPopover]);const handleRemoveButtonClicked=React.useCallback(()=>{handleOpenPopover(false);onRemove();},[onRemove,handleOpenPopover]);const handleScroll=React.useCallback(()=>{if(rangeRef.current){setCursorRect(rangeRef.current.getBoundingClientRect());}},[]);React.useEffect(()=>{const sel=window.getSelection();if(sel&&sel.rangeCount>0){rangeRef.current=sel.getRangeAt(0);}},[popoverOpen]);React.useEffect(()=>{if(popoverOpen&&referenceBoundary){referenceBoundary.addEventListener("scroll",handleScroll);return()=>referenceBoundary.removeEventListener("scroll",handleScroll);}if(!popoverOpen){return void 0;}referenceBoundary==null?void 0:referenceBoundary.addEventListener("scroll",handleScroll);return()=>{referenceBoundary==null?void 0:referenceBoundary.removeEventListener("scroll",handleScroll);};},[popoverOpen,referenceBoundary,handleScroll]);if(!renderPopover){return null;}return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{open:popoverOpen,floatingBoundary,constrainSize:true,content:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:1,"data-testid":"annotation-toolbar-popover",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{weight:"medium",size:1,children:title})}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("inputs.portable-text.action.edit-annotation-aria-label"),icon:icons.EditIcon,mode:"bleed",onClick:handleEditButtonClicked,tabIndex:0,tooltipProps:null}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("inputs.portable-text.action.remove-annotation-aria-label"),icon:icons.TrashIcon,mode:"bleed",onClick:handleRemoveButtonClicked,tabIndex:0,tone:"critical",tooltipProps:null})]})}),fallbackPlacements:POPOVER_FALLBACK_PLACEMENTS$2,placement:"top",portal:true,preventOverflow:true,ref:popoverRef,referenceBoundary,referenceElement:cursorElement,scheme:popoverScheme});}const parseResponsiveWidth=value=>{if(Array.isArray(value)){return value.flatMap(parseResponsiveWidth);}if(typeof value==="number"){return[value];}return value==="auto"?["auto"]:[];};const parseModalType=value=>{return value==="dialog"||value==="popover"?value:void 0;};function _getModalOption(schemaType){var _a;const raw=(_a=schemaType.options)==null?void 0:_a.modal;return typeof raw==="object"&&raw!==null?{type:parseModalType(raw.type),width:parseResponsiveWidth(raw.width)}:void 0;}const VirtualizerScrollInstanceContext=React.createContext(null);function useVirtualizerScrollInstance(){const ref=React.useContext(VirtualizerScrollInstanceContext);if(!ref){throw new Error("VirtualizerScrollInstance: missing context value");}return ref;}function VirtualizerScrollInstanceProvider(props){const{scrollElement,containerElement}=props;return/* @__PURE__ */jsxRuntime.jsx(VirtualizerScrollInstanceContext.Provider,{value:{scrollElement,containerElement},children:props.children});}function DefaultEditDialog(props){const{onClose,children,title,width=1,autoFocus}=props;const dialogId=React.useId();const[contentElement,setContentElement]=React.useState(null);const containerElement=React.useRef(null);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Dialog,{header:title,id:dialogId,onClickOutside:onClose,onClose,portal:"default",width,contentRef:setContentElement,"data-testid":"default-edit-object-dialog",__unstable_autoFocus:autoFocus,children:/* @__PURE__ */jsxRuntime.jsx(PresenceOverlay,{margins:[0,0,1,0],children:/* @__PURE__ */jsxRuntime.jsx(VirtualizerScrollInstanceProvider,{scrollElement:contentElement,containerElement,children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{ref:containerElement,children})})})});}var __freeze$1Q=Object.freeze;var __defProp$1Q=Object.defineProperty;var __template$1Q=(cooked,raw)=>__freeze$1Q(__defProp$1Q(cooked,"raw",{value:__freeze$1Q(raw||cooked.slice())}));var _a$1R,_b$Q,_c$s;const RootPopover=styled__default.default(TooltipDelayGroupProvider.Popover)(_a$1R||(_a$1R=__template$1Q(["\n  & > div {\n    overflow: hidden;\n    overflow: clip;\n  }\n"])));const ContentScrollerBox=styled__default.default(ui.Box)(_b$Q||(_b$Q=__template$1Q(["\n  /* Prevent overflow caused by change indicator */\n  overflow-x: hidden;\n  overflow-y: auto;\n"])));const ContentHeaderBox=styled__default.default(ui.Box)(_c$s||(_c$s=__template$1Q(["\n  box-shadow: 0 1px 0 var(--card-shadow-outline-color);\n  position: relative;\n  z-index: 10;\n  min-height: auto;\n"])));const POPOVER_FALLBACK_PLACEMENTS$1=["top","bottom"];function PopoverEditDialog(props){const{floatingBoundary,referenceBoundary,referenceElement,width=0}=props;const[open,setOpen]=React.useState(false);React.useEffect(()=>{setOpen(true);},[]);return/* @__PURE__ */jsxRuntime.jsx(RootPopover,{content:/* @__PURE__ */jsxRuntime.jsx(Content,{...props}),constrainSize:true,"data-testid":"popover-edit-dialog","data-ui":"PopoverEditDialog",fallbackPlacements:POPOVER_FALLBACK_PLACEMENTS$1,floatingBoundary,open,overflow:"auto",placement:"bottom",portal:"default",preventOverflow:true,referenceBoundary,referenceElement,width});}function Content(props){const{onClose,referenceBoundary,referenceElement,title,autoFocus}=props;ui.useGlobalKeyDown(React.useCallback(event=>{if(event.key==="Escape"){onClose();}},[onClose]));ui.useClickOutside(onClose,referenceElement?[referenceElement]:[],referenceBoundary);const[contentElement,setContentElement]=React.useState(null);const containerElement=React.useRef(null);return/* @__PURE__ */jsxRuntime.jsx(VirtualizerScrollInstanceProvider,{scrollElement:contentElement,containerElement,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{ref:containerElement,direction:"column",height:"fill",children:[/* @__PURE__ */jsxRuntime.jsx(ContentHeaderBox,{flex:"none",padding:1,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,padding:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{weight:"medium",children:title})}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{autoFocus:Boolean(autoFocus),icon:icons.CloseIcon,mode:"bleed",onClick:onClose,tooltipProps:{content:"Close"}})]})}),/* @__PURE__ */jsxRuntime.jsx(ContentScrollerBox,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(PresenceOverlay,{margins:[0,0,1,0],children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:3,ref:setContentElement,children:props.children})})})]})});}function ObjectEditModal(props){const{autoFocus,defaultType,floatingBoundary,onClose,referenceBoundary,referenceElement,schemaType}=props;const{t}=useTranslation();const schemaModalOption=React.useMemo(()=>_getModalOption(schemaType),[schemaType]);const modalType=(schemaModalOption==null?void 0:schemaModalOption.type)||defaultType;const schemaTypeTitle=schemaType.i18nTitleKey?t(schemaType.i18nTitleKey):schemaType.title||schemaType.name;const modalTitle=t("inputs.portable-text.annotation-editor.title",{schemaType:schemaTypeTitle});const handleClose=React.useCallback(()=>{onClose();},[onClose]);const modalWidth=schemaModalOption==null?void 0:schemaModalOption.width;if(modalType==="popover"){return/* @__PURE__ */jsxRuntime.jsx(PopoverEditDialog,{autoFocus,floatingBoundary,onClose:handleClose,referenceBoundary,referenceElement,title:/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:modalTitle}),width:modalWidth,children:props.children});}return/* @__PURE__ */jsxRuntime.jsx(DefaultEditDialog,{onClose:handleClose,title:modalTitle,width:modalWidth,autoFocus,children:props.children});}function Annotation(props){var _a;const{children,editorNodeFocused,floatingBoundary,focused,onItemClose,onItemOpen,onPathFocus,path,readOnly,referenceBoundary,renderAnnotation,renderBlock,renderCustomMarkers,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType,selected,value}=props;const{Markers=DefaultMarkers}=useFormBuilder().__internal.components;const editor=portableTextEditor.usePortableTextEditor();const markDefPath=React.useMemo(()=>path.slice(0,path.length-2).concat(["markDefs",{_key:value._key}]),[path,value._key]);const[spanElement,setSpanElement]=React.useState(null);const spanPath=React.useMemo(()=>path.slice(path.length-3,path.length),[path]);const memberItem=usePortableTextMemberItem(pathToString$1(markDefPath));const{validation}=useMemberValidation(memberItem==null?void 0:memberItem.node);const markers=usePortableTextMarkers(path);const text=React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx("span",{"data-annotation":"",children}),[children]);const onOpen=React.useCallback(()=>{if(memberItem){portableTextEditor.PortableTextEditor.blur(editor);onPathFocus(memberItem.node.focusPath);onItemOpen(memberItem.node.path);}},[editor,memberItem,onItemOpen,onPathFocus]);const onClose=React.useCallback(()=>{onItemClose();const sel=portableTextEditor.PortableTextEditor.getSelection(editor);const focusOffset=(sel==null?void 0:sel.focus.path)&&PathUtils.isEqual(sel.focus.path,spanPath)&&sel.focus.offset;const anchorOffset=(sel==null?void 0:sel.anchor.path)&&PathUtils.isEqual(sel.anchor.path,spanPath)&&sel.anchor.offset;portableTextEditor.PortableTextEditor.select(editor,{anchor:{path:spanPath,offset:anchorOffset||0},focus:{path:spanPath,offset:focusOffset||0}});portableTextEditor.PortableTextEditor.focus(editor);},[editor,spanPath,onItemClose]);const onRemove=React.useCallback(()=>{portableTextEditor.PortableTextEditor.removeAnnotation(editor,schemaType);portableTextEditor.PortableTextEditor.focus(editor);},[editor,schemaType]);const markersToolTip=React.useMemo(()=>validation.length>0||markers.length>0?/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{placement:"bottom",portal:"default",content:/* @__PURE__ */jsxRuntime.jsx(TooltipBox$3,{children:/* @__PURE__ */jsxRuntime.jsx(Markers,{markers,renderCustomMarkers,validation})}),children:text}):void 0,[Markers,markers,renderCustomMarkers,text,validation]);const presence=useChildPresence(path,true);const rootPresence=React.useMemo(()=>presence.filter(p=>PathUtils.isEqual(p.path,path)),[path,presence]);const isOpen=Boolean(memberItem==null?void 0:memberItem.member.open);const input=memberItem==null?void 0:memberItem.input;const nodePath=(memberItem==null?void 0:memberItem.node.path)||EMPTY_ARRAY$9;const referenceElement=spanElement;const componentProps=React.useMemo(()=>({__unstable_floatingBoundary:floatingBoundary,__unstable_referenceBoundary:referenceBoundary,__unstable_referenceElement:referenceElement,__unstable_textElementFocus:editorNodeFocused,// Is there focus on the related text element for this object?
children:input,focused,markers,onClose,onOpen,onPathFocus,onRemove,open:isOpen,parentSchemaType:editor.schemaTypes.block,path:nodePath,presence:rootPresence,readOnly:Boolean(readOnly),renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderPreview,renderItem,renderDefault:DefaultAnnotationComponent,schemaType,selected,textElement:markersToolTip||text,validation,value}),[editor.schemaTypes.block,editorNodeFocused,floatingBoundary,focused,input,isOpen,markers,markersToolTip,nodePath,onClose,onOpen,onPathFocus,onRemove,readOnly,referenceBoundary,referenceElement,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,rootPresence,schemaType,selected,text,validation,value]);const CustomComponent=(_a=schemaType.components)==null?void 0:_a.annotation;const setRef=React.useCallback(elm=>{if(memberItem==null?void 0:memberItem.elementRef){memberItem.elementRef.current=elm;}setSpanElement(elm);},[memberItem]);return React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx("span",{ref:setRef,style:debugRender(),children:CustomComponent?/* @__PURE__ */jsxRuntime.jsx(CustomComponent,{...componentProps}):/* @__PURE__ */jsxRuntime.jsx(DefaultAnnotationComponent,{...componentProps})}),[CustomComponent,componentProps,setRef]);}const DefaultAnnotationComponent=props=>{const{__unstable_floatingBoundary:floatingBoundary,__unstable_referenceBoundary:referenceBoundary,__unstable_referenceElement:referenceElement,children,focused,markers,onClose,onOpen,onRemove,open,readOnly,selected,schemaType,textElement,validation}=props;const isLink=schemaType.name==="link";const hasError=validation.some(v=>v.level==="error");const hasWarning=validation.some(v=>v.level==="warning");const hasMarkers=markers.length>0;const{t}=useTranslation();const toneKey=React.useMemo(()=>{if(hasError){return"critical";}if(hasWarning){return"caution";}if(isLink){return"primary";}return"default";},[isLink,hasError,hasWarning]);return/* @__PURE__ */jsxRuntime.jsxs(Root$m,{$toneKey:toneKey,"aria-label":t("inputs.portable-text.annotation-aria-label"),"data-link":isLink?"":void 0,"data-error":hasError?"":void 0,"data-warning":hasWarning?"":void 0,"data-markers":hasMarkers||void 0,onClick:readOnly?onOpen:void 0,children:[textElement,/* @__PURE__ */jsxRuntime.jsx(AnnotationToolbarPopover,{annotationOpen:open,floatingBoundary,onOpen,onRemove,referenceBoundary,referenceElement,selected,title:schemaType.i18nTitleKey?t(schemaType.i18nTitleKey):schemaType.title||schemaType.name}),open&&/* @__PURE__ */jsxRuntime.jsx(ObjectEditModal,{defaultType:"popover",floatingBoundary,onClose,autoFocus:focused,referenceBoundary,referenceElement,schemaType,children})]});};const Context=React.createContext({});function useReferenceInputOptions(){return React.useContext(Context);}function ReferenceInputOptionsProvider(props){const{children,activePath,EditReferenceLinkComponent,onEditReference,initialValueTemplateItems}=props;const contextValue=React.useMemo(()=>({activePath,EditReferenceLinkComponent,onEditReference,initialValueTemplateItems}),[activePath,EditReferenceLinkComponent,onEditReference,initialValueTemplateItems]);return/* @__PURE__ */jsxRuntime.jsx(Context.Provider,{value:contextValue,children});}const ReviewChangesContext=React.createContext(null);const DocumentIdContext=React.createContext(null);function DocumentIdProvider(props){const value=React.useMemo(()=>({id:props.id}),[props.id]);return/* @__PURE__ */jsxRuntime.jsx(DocumentIdContext.Provider,{value,children:props.children});}function useGivenDocumentId(){const ctx=React.useContext(DocumentIdContext);if(!ctx){throw new Error("useDocumentId must be used within a DocumentIdProvider");}return ctx.id;}function usePublishedId(){return getPublishedId(useGivenDocumentId());}function useScrollIntoViewOnFocusWithin(elementRef,hasFocusWithin){return useDidUpdate(hasFocusWithin,React.useCallback((hadFocus,hasFocus)=>{if(elementRef.current&&!hadFocus&&hasFocus){scrollIntoView__default.default(elementRef.current,{scrollMode:"always"});}},[elementRef]));}var __freeze$1P=Object.freeze;var __defProp$1P=Object.defineProperty;var __template$1P=(cooked,raw)=>__freeze$1P(__defProp$1P(cooked,"raw",{value:__freeze$1P(raw||cooked.slice())}));var _a$1Q;const Root$l=styled__default.default(ui.Text)(_a$1Q||(_a$1Q=__template$1P(["\n  &[data-status='edited'] {\n    --card-icon-color: var(--card-badge-caution-dot-color);\n  }\n  &[data-status='unpublished'] {\n    --card-icon-color: var(--card-badge-default-dot-color);\n    opacity: 0.5 !important;\n  }\n"])));function DocumentStatusIndicator(_ref120){let{draft,published}=_ref120;const $draft=!!draft;const $published=!!published;const status=React.useMemo(()=>{if($draft&&!$published)return"unpublished";return"edited";},[$draft,$published]);if(!$draft&&!$published||!$draft&&$published){return null;}return/* @__PURE__ */jsxRuntime.jsx(Root$l,{"data-status":status,size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.DotIcon,{})});}function ReferencePreview(props){var _a,_b;const{id,layout,preview,refType,renderPreview,showTypeLabel}=props;const documentPresence=useDocumentPresence(id);const previewId=((_a=preview.draft)==null?void 0:_a._id)||((_b=preview.published)==null?void 0:_b._id)||// note: during publish of the referenced document we might have both a missing draft and a missing published version
// this happens because the preview system tries to optimistically re-fetch as soon as it sees a mutation, but
// when publishing, the draft is deleted, and therefore both the draft and the published may be missing for a brief
// moment before the published version appears. In this case, it's safe to fallback to the given id, which is always
// the published id
id;const previewStub=React.useMemo(()=>({_id:previewId,_type:refType.name}),[previewId,refType.name]);const{draft,published}=preview;const previewProps=React.useMemo(()=>({children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingLeft:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{space:3,children:[showTypeLabel&&/* @__PURE__ */jsxRuntime.jsx(ui.Badge,{mode:"outline",children:refType.title}),documentPresence&&documentPresence.length>0&&/* @__PURE__ */jsxRuntime.jsx(DocumentPreviewPresence,{presence:documentPresence}),/* @__PURE__ */jsxRuntime.jsx(DocumentStatusIndicator,{draft:preview.draft,published:preview.published})]})}),layout,schemaType:refType,tooltip:/* @__PURE__ */jsxRuntime.jsx(DocumentStatus,{draft,published}),value:previewStub}),[documentPresence,draft,layout,preview.draft,preview.published,previewStub,published,refType,showTypeLabel]);return renderPreview(previewProps);}function PreviewReferenceValue$1(props){var _a,_b,_c,_d,_e,_f;const{layout="default",referenceInfo,renderPreview,type,value,showTypeLabel}=props;const{t}=useTranslation();if(referenceInfo.isLoading||referenceInfo.error){return/* @__PURE__ */jsxRuntime.jsx(SanityDefaultPreview,{isPlaceholder:true,layout});}if(((_a=referenceInfo.result)==null?void 0:_a.availability.reason)==="NOT_FOUND"&&value._strengthenOnPublish){const refType2=type.to.find(toType=>{var _a2;return toType.name===((_a2=value==null?void 0:value._strengthenOnPublish)==null?void 0:_a2.type);});if(!refType2){return/* @__PURE__ */jsxRuntime.jsx(InvalidType,{documentId:value._ref,actualType:(_b=value._strengthenOnPublish)==null?void 0:_b.type,declaredTypes:type.to.map(toType=>toType.name)});}const stub=((_c=value._strengthenOnPublish)==null?void 0:_c.type)?{_id:value._ref,_type:(_d=value._strengthenOnPublish)==null?void 0:_d.type}:value;return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:renderPreview({layout,schemaType:refType2,value:stub,skipVisibilityCheck:true})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Inline,{space:4,children:showTypeLabel&&/* @__PURE__ */jsxRuntime.jsx(ui.Badge,{mode:"outline",children:refType2.title})})})]});}const availability=referenceInfo.result.availability;const notFound=availability.reason==="NOT_FOUND";const insufficientPermissions=availability.reason==="PERMISSION_DENIED";if(insufficientPermissions||notFound){return/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,paddingY:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,children:t("inputs.reference.error.document-unavailable-title")})})})}),insufficientPermissions||notFound?/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{portal:true,content:notFound?/* @__PURE__ */jsxRuntime.jsx(UnavailableMessage,{title:t("inputs.reference.error.nonexistent-document-title"),icon:icons.HelpCircleIcon,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{i18nKey:"inputs.reference.error.nonexistent-document-description",t,values:{documentId:value._ref}})}):/* @__PURE__ */jsxRuntime.jsx(UnavailableMessage,{title:t("inputs.reference.error.missing-read-permissions-title"),icon:icons.AccessDeniedIcon,children:t("inputs.reference.error.missing-read-permissions-description")}),children:/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{tone:"default",children:/* @__PURE__ */jsxRuntime.jsx(icons.HelpCircleIcon,{})})})}):null]});}const refTypeName=(_e=referenceInfo.result)==null?void 0:_e.type;const refType=type.to.find(toType=>toType.name===refTypeName);if(!refType){return/* @__PURE__ */jsxRuntime.jsx(InvalidType,{documentId:value._ref,actualType:refTypeName||"<unknown>",declaredTypes:type.to.map(toType=>toType.name)});}return/* @__PURE__ */jsxRuntime.jsx(ReferencePreview,{id:value._ref,layout,preview:(_f=referenceInfo.result)==null?void 0:_f.preview,refType,renderPreview,showTypeLabel});}function UnavailableMessage(props){const Icon=props.icon;return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(Icon,{})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{flex:1,marginLeft:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:props.title}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:props.children})})]})]});}function InvalidType(_ref121){let{declaredTypes,documentId,actualType}=_ref121;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",justify:"flex-start",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,paddingY:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,children:t("inputs.reference.error.invalid-type-title")})})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{portal:true,content:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.reference.error.invalid-type-description",values:{documentId,actualType},components:{AllowedTypes:()=>/* @__PURE__ */jsxRuntime.jsx(HumanizedList,{values:declaredTypes})}})})}),children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{tone:"default",children:/* @__PURE__ */jsxRuntime.jsx(icons.HelpCircleIcon,{})})})})})]});}function HumanizedList(props){const listFormat=useListFormat({type:"disjunction"});const parts=listFormat.formatToParts(props.values);return/* @__PURE__ */jsxRuntime.jsx(React.Fragment,{children:parts.map(segment=>segment.type==="element"?/* @__PURE__ */jsxRuntime.jsx("code",{children:segment.value},segment.value):segment.value)});}const STATUS_TONES={warning:"caution",error:"critical",info:"positive"};const STATUS_ICONS={warning:/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{}),error:/* @__PURE__ */jsxRuntime.jsx(icons.ErrorOutlineIcon,{}),info:/* @__PURE__ */jsxRuntime.jsx(icons.InfoOutlineIcon,{})};function AlertStrip(props){const{children,status="warning",title,...rest}=props;return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{radius:2,tone:STATUS_TONES[status],...rest,"data-ui":"Alert",children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{padding:1,children:children&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(Details,{icon:STATUS_ICONS[status],title,children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:3,marginTop:3,children})})})})});}function ReferenceFinalizeAlertStrip(_ref122){let{schemaType,handleRemoveStrengthenOnPublish}=_ref122;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(AlertStrip,{padding:1,title:t(schemaType.weak?"inputs.reference.incomplete-reference.finalize-action-title":"inputs.reference.incomplete-reference.strengthen-action-title"),status:"info","data-testid":"alert-reference-published",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:schemaType.weak?"inputs.reference.incomplete-reference.finalize-action-description":"inputs.reference.incomplete-reference.strengthen-action-description"})}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",onClick:handleRemoveStrengthenOnPublish,size:"large",text:t("inputs.reference.incomplete-reference.strengthen-button-label"),tone:"positive"})]})});}var __freeze$1O=Object.freeze;var __defProp$1O=Object.defineProperty;var __template$1O=(cooked,raw)=>__freeze$1O(__defProp$1O(cooked,"raw",{value:__freeze$1O(raw||cooked.slice())}));var _a$1P;const StyledCard$2=styled__default.default(ui.Card)(_a$1P||(_a$1P=__template$1O(["\n  /* this is a hack to avoid layout jumps while previews are loading\n     there's probably better ways of solving this */\n  min-height: 33px;\n  position: relative;\n\n  /* TextWithTone uses its own logic to set color, and we therefore need */\n  /* to override this logic in order to set the correct color in different states */\n  &[data-selected],\n  &[data-pressed],\n  &:active {\n    [data-ui='TextWithTone'] {\n      color: inherit;\n    }\n  }\n"])));const ReferenceLinkCard=React.forwardRef(function ReferenceLinkCard2(props,ref){const{as,documentId,documentType,...cardProps}=props;const linkProps=documentId&&documentType&&{// this will make @sanity/ui style it as a link
"data-as":"a",// this determines the actual tag inserted into the DOM (either a HTML element or a component)
forwardedAs:as,documentId,documentType};return/* @__PURE__ */jsxRuntime.jsx(StyledCard$2,{...cardProps,...linkProps,"data-ui":"ReferenceLinkCard",ref});});function ReferenceMetadataLoadErrorAlertStrip(_ref123){let{errorMessage,onHandleRetry}=_ref123;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(AlertStrip,{padding:1,title:t("inputs.reference.metadata-error.title"),status:"warning","data-testid":"alert-reference-info-failed",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:errorMessage}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",onClick:onHandleRetry,size:"large",text:t("inputs.reference.metadata-error.retry-button-label"),tone:"primary"})]})});}function ReferenceStrengthMismatchAlertStrip(_ref124){let{actualStrength,handleFixStrengthMismatch}=_ref124;const shouldBe=actualStrength==="weak"?"strong":"weak";const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(AlertStrip,{padding:1,title:t("inputs.reference.strength-mismatch.title"),status:"warning","data-testid":"alert-reference-strength-mismatch",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:actualStrength==="weak"?"inputs.reference.strength-mismatch.is-weak-description":"inputs.reference.strength-mismatch.is-strong-description"})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:t(shouldBe==="weak"?"inputs.reference.strength-mismatch.is-strong-consquences":"inputs.reference.strength-mismatch.is-weak-consquences")}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",onClick:handleFixStrengthMismatch,size:"large",text:t(shouldBe==="weak"?"inputs.reference.strength-mismatch.weaken-button-label":"inputs.reference.strength-mismatch.strengthen-button-label"),tone:"caution"})]})});}const noop$1=()=>void 0;const INITIAL_LOADING_STATE$3={isLoading:true,result:void 0,error:void 0,retry:noop$1};const EMPTY_STATE$1={isLoading:false,result:void 0,error:void 0,retry:noop$1};function useReferenceInfo$1(id,getReferenceInfo){const msgSubject=React.useMemo(()=>new rxjs.Subject(),[]);const msg$=React.useMemo(()=>msgSubject.asObservable(),[msgSubject]);const retry=React.useCallback(()=>{msgSubject.next({type:"retry"});},[msgSubject]);const referenceInfo=reactRx.useMemoObservable(()=>rxjs.concat(rxjs.of(null),msg$).pipe(operators.map(()=>id),operators.concatMap(refId=>refId?getReferenceInfo(refId).pipe(operators.map(result=>{return{isLoading:false,result,error:void 0,retry};}),operators.startWith(INITIAL_LOADING_STATE$3),operators.catchError(err=>{console.error(err);return rxjs.of({isLoading:false,result:void 0,error:err,retry});})):rxjs.of(EMPTY_STATE$1))),[getReferenceInfo,id,msg$,retry],INITIAL_LOADING_STATE$3);const previousId=usePrevious(id,id);if(id&&previousId!==id){return INITIAL_LOADING_STATE$3;}return referenceInfo;}const WorkspaceContext=React.createContext(null);function WorkspaceProvider(_ref125){let{children,workspace}=_ref125;return/* @__PURE__ */jsxRuntime.jsx(WorkspaceContext.Provider,{value:workspace,children});}function useWorkspace(){const workspace=React.useContext(WorkspaceContext);if(!workspace)throw new Error("Workspace: missing context value");return workspace;}const DEFAULT_API_FIELD_DEPTH=0;const INITIAL_LOADING_STATE$2={isLoading:true,settings:{partialIndexSettings:{maxFieldDepth:DEFAULT_API_FIELD_DEPTH}}};function fetchMaxDepth(_ref126){let{client}=_ref126;const{projectId,dataset}=client.config();return client.observable.request({uri:"/projects/".concat(projectId,"/datasets/").concat(dataset,"/settings/indexing"),tag:"search.getPartialIndexSettings"});}const cachedSettings=/* @__PURE__ */new Map();function useSearchMaxFieldDepth(overrideClient){var _a,_b,_c,_d;const isEnabled=(_b=(_a=useWorkspace().search)==null?void 0:_a.unstable_partialIndexing)==null?void 0:_b.enabled;const workspaceClient=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const client=React.useMemo(()=>overrideClient||workspaceClient,[overrideClient,workspaceClient]);const dataset=React.useMemo(()=>client.config().dataset,[client]);if(!isEnabled){cachedSettings.set(dataset,rxjs.of(INITIAL_LOADING_STATE$2.settings));}if(!cachedSettings.has(dataset)){cachedSettings.set(dataset,fetchMaxDepth({client}).pipe(operators.shareReplay()));}const indexSettings=reactRx.useMemoObservable(()=>cachedSettings.get(dataset).pipe(operators.map(settings=>({isLoading:false,settings})),operators.startWith(INITIAL_LOADING_STATE$2),operators.catchError(err=>{console.error(err);return rxjs.of({isLoading:false,enabled:true,settings:{partialIndexSettings:{maxFieldDepth:DEFAULT_API_FIELD_DEPTH}}});})),[dataset],INITIAL_LOADING_STATE$2);const maxFieldDepth=(_d=(_c=indexSettings==null?void 0:indexSettings.settings)==null?void 0:_c.partialIndexSettings)==null?void 0:_d.maxFieldDepth;if(!isFinite__default.default(maxFieldDepth)){return _internal.DEFAULT_MAX_FIELD_DEPTH;}return Math.min(maxFieldDepth,_internal.DEFAULT_MAX_FIELD_DEPTH);}const FormValueContext=React.createContext(null);function FormValueProvider(props){const value=React.useMemo(()=>({value:props.value}),[props.value]);return/* @__PURE__ */jsxRuntime.jsx(FormValueContext.Provider,{value,children:props.children});}function useFormValue(path){const uniquePath=PathUtils.pathFor(path);const ctx=React.useContext(FormValueContext);if(!ctx){throw new Error("useFormValue must be used within a FormValueProvider");}return getValueAtPath(ctx==null?void 0:ctx.value,uniquePath);}const isDocumentType=type=>Boolean(type.type&&type.type.name==="document");const isIgnoredType=type=>type.name.startsWith("sanity.")&&type.name!=="sanity.previewUrlSecret";const getSearchableTypes=schema=>schema.getTypeNames().map(typeName=>schema.get(typeName)).filter(isNonNullable$2).filter(schemaType=>isDocumentType(schemaType)).filter(type=>!isIgnoredType(type));const calculateScore=(searchTerms,value)=>{const{phrases:uniqueSearchPhrases,words:uniqueSearchWords}=partitionAndSanitizeSearchTerms(searchTerms);const[phraseScore,phraseWhy]=calculatePhraseScore(uniqueSearchPhrases,value);const[wordScore,wordWhy]=calculateWordScore(uniqueSearchWords,value);return[phraseScore+wordScore,[wordWhy,phraseWhy].join(", ")];};const stringify=value=>typeof value==="string"?value:JSON.stringify(value);function applyWeights(searchSpec,hits){let terms=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];const specByType=keyBy__default.default(searchSpec,spec=>spec.typeName);return hits.map((hit,index)=>{var _a;const typeSpec=specByType[hit._type];const stories=(_a=typeSpec.paths||[])==null?void 0:_a.map((pathSpec,idx)=>{const value=stringify(hit["w".concat(idx)]);if(!value){return{path:pathSpec.path,score:0,why:"No match"};}const[score,why]=calculateScore(terms,value);return{path:pathSpec.path,score:score*pathSpec.weight,why:"".concat(why," (*").concat(pathSpec.weight,")")};});const totalScore=stories.reduce((acc,rank)=>acc+rank.score,0);return{hit,resultIndex:hits.length-index,score:totalScore,stories};});}function calculatePhraseScore(uniqueSearchPhrases,value){const sanitizedValue=value.toLowerCase().trim();let fieldScore=0;let matchCount=0;uniqueSearchPhrases.forEach(term=>{if(sanitizedValue.includes(term)){fieldScore+=term.length/sanitizedValue.length;matchCount+=term.length;}});return fieldScore===1?[1,"[Phrase] Exact match"]:[fieldScore/2,"[Phrase] Matched ".concat(matchCount," of ").concat(sanitizedValue.length," characters")];}function calculateWordScore(uniqueSearchTerms,value){const uniqueValueTerms=uniq__default.default(compact__default.default(words__default.default(toLower__default.default(value))));const matches=intersection__default.default(uniqueSearchTerms,uniqueValueTerms);const all=union__default.default(uniqueValueTerms,uniqueSearchTerms);const fieldScore=matches.length/all.length;return fieldScore===1?[1,"[Word] Exact match"]:[fieldScore/2,"[Word] Matched ".concat(matches.length," of ").concat(all.length," terms: [").concat(matches.join(", "),"]")];}function partitionAndSanitizeSearchTerms(searchTerms){const uniqueSearchTerms=uniq__default.default(searchTerms.map(toLower__default.default));const[searchPhrases,searchWords]=partition__default.default(uniqueSearchTerms,term=>/^".*"$/.test(term));return{phrases:uniq__default.default(searchPhrases).map(toLower__default.default).map(stripWrappingQuotes),//
words:uniq__default.default(searchWords.map(toLower__default.default))};}function stripWrappingQuotes(str){return str.replace(/^"(.*)"$/,"$1");}const SPECIAL_CHARS=/([^!@#$%^&*(),\\/?";:{}|[\]+<>\s-])+/g;const STRIP_EDGE_CHARS=/(^[.]+)|([.]+$)/;function tokenize(string){return(string.match(SPECIAL_CHARS)||[]).map(token=>token.replace(STRIP_EDGE_CHARS,""));}const FINDABILITY_MVI=4;const DEFAULT_LIMIT=1e3;const combinePaths=flow__default.default([flatten__default.default,union__default.default,compact__default.default]);function createSearchSpecs(types,optimizeIndexedPaths){let hasIndexedPaths=false;const specs=types.map(type=>({typeName:type.name,paths:type.__experimental_search.map(config=>{const path=config.path.map(p=>{if(typeof p==="number"){hasIndexedPaths=true;if(optimizeIndexedPaths){return[];}}return p;});return{weight:config.weight,path:joinPath(path),mapWith:config.mapWith};})}));return{specs,hasIndexedPaths};}const pathWithMapper=_ref127=>{let{mapWith,path}=_ref127;return mapWith?"".concat(mapWith,"(").concat(path,")"):path;};function createConstraints(terms,specs){const combinedSearchPaths=combinePaths(specs.map(configForType=>(configForType.paths||[]).map(opt=>pathWithMapper(opt))));const constraints=terms.map((_term,i)=>combinedSearchPaths.map(joinedPath=>"".concat(joinedPath," match $t").concat(i))).filter(constraint=>constraint.length>0);return constraints.map(constraint=>"(".concat(constraint.join(" || "),")"));}function extractTermsFromQuery(query){const quotedQueries=[];const unquotedQuery=query.replace(/("[^"]*")/g,match=>{if(words__default.default(match).length>1){quotedQueries.push(match);return"";}return match;});const quotedTerms=quotedQueries.map(str=>trim__default.default(toLower__default.default(str)));const remainingTerms=uniq__default.default(compact__default.default(tokenize(toLower__default.default(unquotedQuery))));return[...quotedTerms,...remainingTerms];}function toOrderClause(orderBy){function wrapFieldWithFn(ordering){return ordering.mapWith?"".concat(ordering.mapWith,"(").concat(ordering.field,")"):ordering.field;}return(orderBy||[]).map(ordering=>[wrapFieldWithFn(ordering),(ordering.direction||"").toLowerCase()].map(str=>str.trim()).filter(Boolean).join(" ")).join(",");}function createSearchQuery(searchTerms){let searchOpts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _a,_b;const{filter,params,tag}=searchOpts;const{specs:exactSearchSpecs,hasIndexedPaths}=createSearchSpecs(searchTerms.types,false);const terms=extractTermsFromQuery(searchTerms.query);const optimizedSpecs=hasIndexedPaths?createSearchSpecs(searchTerms.types,true).specs:exactSearchSpecs;const filters=["_type in $__types",searchOpts.includeDrafts===false&&"!(_id in path('drafts.**'))",...createConstraints(terms,optimizedSpecs),filter?"(".concat(filter,")"):"",searchTerms.filter?"(".concat(searchTerms.filter,")"):""].filter(Boolean);const selections=exactSearchSpecs.map(spec=>{const constraint='_type == "'.concat(spec.typeName,'" => ');const selection2="{ ".concat(spec.paths.map((cfg,i)=>'"w'.concat(i,'": ').concat(pathWithMapper(cfg)))," }");return"".concat(constraint).concat(selection2);});const sortOrder=toOrderClause((searchOpts==null?void 0:searchOpts.sort)||[{field:"_id",direction:"asc"}]);const projectionFields=["_type","_id"];const selection=selections.length>0?"...select(".concat(selections.join(",\n"),")"):"";const finalProjection=projectionFields.join(", ")+(selection?", ".concat(selection):"");let query="*[".concat(filters.join(" && "),"]")+"| order(".concat(sortOrder,")")+"[$__offset...$__limit]"+// the following would improve search quality for paths-with-numbers, but increases the size of the query by up to 50%
// `${hasIndexedPaths ? `[${createConstraints(terms, exactSearchSpec).join(' && ')}]` : ''}` +
"{".concat(finalProjection,"}");if(searchOpts==null?void 0:searchOpts.__unstable_extendedProjection){const extendedProjection=searchOpts==null?void 0:searchOpts.__unstable_extendedProjection;const firstProjection=projectionFields.concat(extendedProjection).join(", ");query=["*[".concat(filters.join(" && "),"]{").concat(firstProjection,"}"),"order(".concat(sortOrder,")[$__offset...$__limit]{").concat(finalProjection,"}")].join("|");}const groqComments=["findability-mvi:".concat(FINDABILITY_MVI)].concat((searchOpts==null?void 0:searchOpts.comments)||[]).map(s=>"// ".concat(s)).join("\n");const updatedQuery=groqComments?"".concat(groqComments,"\n").concat(query):query;const offset=(_a=searchOpts==null?void 0:searchOpts.offset)!=null?_a:0;const limit=((_b=searchOpts==null?void 0:searchOpts.limit)!=null?_b:DEFAULT_LIMIT)+offset;return{query:updatedQuery,params:{...toGroqParams(terms),__types:exactSearchSpecs.map(spec=>spec.typeName),__limit:limit,__offset:offset,...(params||{})},options:{tag},searchSpec:exactSearchSpecs,terms};}const toGroqParams=terms=>{const params={};return terms.reduce((acc,term,i)=>{acc["t".concat(i)]="".concat(term,"*");return acc;},params);};function getSearchTerms(searchParams,types){if(typeof searchParams==="string"){return{query:searchParams,types};}return searchParams.types.length?searchParams:{...searchParams,types};}function createWeightedSearch(types,client){let commonOpts=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return function search(searchParams){let searchOpts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const searchTerms=getSearchTerms(searchParams,types);const{query,params,options,searchSpec,terms}=createSearchQuery(searchTerms,{...commonOpts,...searchOpts});return client.observable.fetch(query,params,options).pipe(commonOpts.unique?operators.map(removeDupes):operators.tap(),// Assign weighting and scores based on current search terms.
// No scores will be assigned when terms are empty.
operators.map(hits=>applyWeights(searchSpec,hits,terms)),// Optionally skip client-side score sorting.
// This can be relevant when ordering results by specific fields, especially dates.
(searchOpts==null?void 0:searchOpts.skipSortByScore)?operators.tap():operators.map(hits=>sortBy__default.default(hits,hit=>-hit.score)));};}function getSearchTypesWithMaxDepth(types,maxFieldDepth){return types.map(type=>({title:type.title,name:type.name,// eslint-disable-next-line camelcase
__experimental_search:_internal.resolveSearchConfig(type,maxFieldDepth)}));}const READABLE={available:true,reason:"READABLE"};const PERMISSION_DENIED={available:false,reason:"PERMISSION_DENIED"};const NOT_FOUND={available:false,reason:"NOT_FOUND"};function getReferenceInfo(documentPreviewStore,id,referenceType){const{publishedId,draftId}=getIdPair(id);const pairAvailability$=documentPreviewStore.unstable_observeDocumentPairAvailability(id);return pairAvailability$.pipe(operators.switchMap(pairAvailability=>{if(!pairAvailability.draft.available&&!pairAvailability.published.available){const availability=pairAvailability.draft.reason==="PERMISSION_DENIED"||pairAvailability.published.reason==="PERMISSION_DENIED"?PERMISSION_DENIED:NOT_FOUND;return rxjs.of({id,type:void 0,availability,preview:{draft:void 0,published:void 0}});}const draftRef={_type:"reference",_ref:draftId};const publishedRef={_type:"reference",_ref:publishedId};const typeName$=rxjs.combineLatest([documentPreviewStore.observeDocumentTypeFromId(draftId),documentPreviewStore.observeDocumentTypeFromId(publishedId)]).pipe(// assume draft + published are always same type
operators.map(_ref128=>{let[draftTypeName,publishedTypeName]=_ref128;return draftTypeName||publishedTypeName;}));return typeName$.pipe(operators.switchMap(typeName=>{if(!typeName){return rxjs.of({id,type:void 0,availability:{available:true,reason:"READABLE"},preview:{draft:void 0,published:void 0}});}const refSchemaType=referenceType.to.find(memberType=>memberType.name===typeName);if(!refSchemaType){return rxjs.of({id,type:typeName,availability:{available:true,reason:"READABLE"},preview:{draft:void 0,published:void 0}});}const previewPaths=getPreviewPaths(refSchemaType==null?void 0:refSchemaType.preview)||[];const draftPreview$=documentPreviewStore.observePaths(draftRef,previewPaths).pipe(operators.map(result=>result?{_id:draftId,...prepareForPreview(result,refSchemaType)}:void 0),operators.startWith(void 0));const publishedPreview$=documentPreviewStore.observePaths(publishedRef,previewPaths).pipe(operators.map(result=>result?{_id:publishedId,...prepareForPreview(result,refSchemaType)}:void 0),operators.startWith(void 0));const value$=rxjs.combineLatest([draftPreview$,publishedPreview$]).pipe(operators.map(_ref129=>{let[draft,published]=_ref129;return{draft,published};}));return value$.pipe(operators.map(value=>{const availability=// eslint-disable-next-line no-nested-ternary
pairAvailability.draft.available||pairAvailability.published.available?READABLE:pairAvailability.draft.reason==="PERMISSION_DENIED"||pairAvailability.published.reason==="PERMISSION_DENIED"?PERMISSION_DENIED:NOT_FOUND;return{type:typeName,id:publishedId,availability,preview:{draft:isRecord$4(value.draft)?value.draft:void 0,published:isRecord$4(value.published)?value.published:void 0}};}));}));}));}function getCounterpartIds(collatedHits){return collatedHits.filter(collatedHit=>// we're interested in hits where either draft or published is missing
!collatedHit.draft||!collatedHit.published).map(collatedHit=>// if we have the draft, return the published id or vice versa
collatedHit.draft?collatedHit.id:getDraftId(collatedHit.id));}function getExistingCounterparts(client,ids){return ids.length===0?rxjs.of([]):client.observable.fetch("*[_id in $ids]._id",{ids},{tag:"get-counterpart-ids"});}function referenceSearch(client,textTerm,type,options){const searchWeighted=createWeightedSearch(getSearchTypesWithMaxDepth(type.to,options.maxFieldDepth),client,options);return searchWeighted(textTerm,{includeDrafts:true}).pipe(operators.map(results=>results.map(result=>result.hit)),operators.map(collate),// pick the 100 best matches
operators.map(collated=>collated.slice(0,100)),operators.mergeMap(collated=>{return getExistingCounterparts(client,getCounterpartIds(collated)).pipe(operators.map(existingCounterpartIds=>{return collated.map(entry=>{const draftId=getDraftId(entry.id);return{id:entry.id,type:entry.type,draft:entry.draft||existingCounterpartIds.includes(draftId)?{_id:draftId,_type:entry.type}:void 0,published:entry.published||existingCounterpartIds.includes(entry.id)?{_id:entry.id,_type:entry.type}:void 0};});}));}));}function useValueRef$2(value){const ref=React.useRef(value);ref.current=value;return ref;}async function resolveUserDefinedFilter$2(options,document,valuePath,getClient){if(!options){return{};}if(typeof options.filter==="function"){const parentPath=valuePath.slice(0,-1);const parent=PathUtils__namespace.get(document,parentPath);return options.filter({document,parentPath,parent,getClient});}return{filter:options.filter,params:"filterParams"in options?options.filterParams:void 0};}function useReferenceInput(options){var _a,_b,_c,_d;const{path,schemaType}=options;const source=useSource();const client=source.getClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const schema=useSchema();const documentPreviewStore=useDocumentPreviewStore();const maxFieldDepth=useSearchMaxFieldDepth();const searchClient=React.useMemo(()=>client.withConfig({apiVersion:"2021-03-25"}),[client]);const{EditReferenceLinkComponent,onEditReference,activePath,initialValueTemplateItems}=useReferenceInputOptions();const documentValue=useFormValue([]);const documentRef=useValueRef$2(documentValue);const documentTypeName=(_a=documentRef.current)==null?void 0:_a._type;const isCurrentDocumentLiveEdit=React.useMemo(()=>{var _a2;return(_a2=schema.get(documentTypeName))==null?void 0:_a2.liveEdit;},[documentTypeName,schema]);const disableNew=((_b=schemaType.options)==null?void 0:_b.disableNew)===true;const getClient=source.getClient;const handleSearch=React.useCallback(searchString=>rxjs.from(resolveUserDefinedFilter$2(schemaType.options,documentRef.current,path,getClient)).pipe(operators.mergeMap(_ref130=>{let{filter,params}=_ref130;return referenceSearch(searchClient,searchString,schemaType,{...schemaType.options,filter,params,tag:"search.reference",maxFieldDepth});}),operators.catchError(err=>{var _a2;const isQueryError=err.details&&err.details.type==="queryParseError";if(((_a2=schemaType.options)==null?void 0:_a2.filter)&&isQueryError){err.message='Invalid reference filter, please check the custom "filter" option';}return rxjs.throwError(err);})),[documentRef,path,searchClient,schemaType,maxFieldDepth,getClient]);const template=(_d=(_c=options.value)==null?void 0:_c._strengthenOnPublish)==null?void 0:_d.template;const EditReferenceLink=React.useMemo(()=>React.forwardRef(function EditReferenceLink_(_props,forwardedRef){return EditReferenceLinkComponent?/* @__PURE__ */jsxRuntime.jsx(EditReferenceLinkComponent,{..._props,ref:forwardedRef,parentRefPath:path,template}):null;}),[EditReferenceLinkComponent,path,template]);const handleEditReference=React.useCallback(event=>{onEditReference==null?void 0:onEditReference({parentRefPath:path,id:event.id,type:event.type,template:event.template});},[onEditReference,path]);const selectedState=PathUtils__namespace.startsWith(path,(activePath==null?void 0:activePath.path)||[])?activePath==null?void 0:activePath.state:"none";const createOptions=React.useMemo(()=>{if(disableNew){return[];}return(initialValueTemplateItems||[]).filter(i=>schemaType.to.some(refType=>{var _a2;return refType.name===((_a2=i.template)==null?void 0:_a2.schemaType);})).map(item=>{var _a2;return((_a2=item.template)==null?void 0:_a2.schemaType)?{id:item.id,title:item.title||"".concat(item.template.schemaType," from template ").concat(item.template.id),type:item.template.schemaType,icon:item.icon,template:{id:item.template.id,params:item.parameters},permission:{granted:item.granted,reason:item.reason}}:void 0;}).filter(isNonNullable$2);},[disableNew,initialValueTemplateItems,schemaType.to]);const getReferenceInfo$1=React.useCallback(id=>getReferenceInfo(documentPreviewStore,id,schemaType),[documentPreviewStore,schemaType]);return{selectedState,handleSearch,isCurrentDocumentLiveEdit,handleEditReference,EditReferenceLink,createOptions,getReferenceInfo:getReferenceInfo$1};}function getTone$3(_ref131){let{readOnly,hasErrors,hasWarnings}=_ref131;if(readOnly){return"transparent";}if(hasErrors){return"critical";}return hasWarnings?"caution":"default";}const MENU_POPOVER_PROPS$a={portal:true,tone:"default"};function ReferenceField(props){var _a,_b,_c,_d,_e,_f;const elementRef=React.useRef(null);const{schemaType,path,open,inputId,children,inputProps}=props;const{readOnly,focused,renderPreview,onChange}=props.inputProps;const[fieldActionsNodes,setFieldActionNodes]=React.useState([]);const documentId=usePublishedId();const handleClear=React.useCallback(()=>inputProps.onChange(unset()),[inputProps]);const value=props.value;const{EditReferenceLink,getReferenceInfo,selectedState,isCurrentDocumentLiveEdit}=useReferenceInput({path,schemaType,value});useScrollIntoViewOnFocusWithin(elementRef,open);useDidUpdate(focused,(hadFocus,hasFocus)=>{if(!hadFocus&&hasFocus&&elementRef.current){elementRef.current.focus();}});const hasErrors=props.validation.some(v=>v.level==="error");const hasWarnings=props.validation.some(v=>v.level==="warning");const loadableReferenceInfo=useReferenceInfo$1(value==null?void 0:value._ref,getReferenceInfo);const refTypeName=((_a=loadableReferenceInfo.result)==null?void 0:_a.type)||((_b=value==null?void 0:value._strengthenOnPublish)==null?void 0:_b.type);const refType=refTypeName?schemaType.to.find(toType=>toType.name===refTypeName):void 0;const pressed=selectedState==="pressed";const selected=selectedState==="selected";const hasRef=value==null?void 0:value._ref;const publishedReferenceExists=hasRef&&((_e=(_d=(_c=loadableReferenceInfo.result)==null?void 0:_c.preview)==null?void 0:_d.published)==null?void 0:_e._id);const handleRemoveStrengthenOnPublish=React.useCallback(()=>{onChange([schemaType.weak===true?set(true,["_weak"]):unset(["_weak"]),unset(["_strengthenOnPublish"])]);},[onChange,schemaType.weak]);const handleFixStrengthMismatch=React.useCallback(()=>{onChange(schemaType.weak===true?set(true,["_weak"]):unset(["_weak"]));},[onChange,schemaType]);const handleReplace=React.useCallback(()=>{inputProps.onPathFocus(["_ref"]);},[inputProps]);const actualStrength=(value==null?void 0:value._weak)?"weak":"strong";const weakShouldBe=schemaType.weak===true?"weak":"strong";const weakWarningOverride=hasRef&&!loadableReferenceInfo.isLoading&&(value==null?void 0:value._strengthenOnPublish);const showWeakRefMismatch=!loadableReferenceInfo.isLoading&&((_f=loadableReferenceInfo.result)==null?void 0:_f.availability.available)&&hasRef&&actualStrength!==weakShouldBe&&!weakWarningOverride;const tone=getTone$3({readOnly,hasErrors,hasWarnings});const isEditing=!(value==null?void 0:value._ref)||inputProps.focusPath[0]==="_ref";const{t}=useTranslation();const footer=/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[isCurrentDocumentLiveEdit&&publishedReferenceExists&&value._strengthenOnPublish&&/* @__PURE__ */jsxRuntime.jsx(ReferenceFinalizeAlertStrip,{schemaType,handleRemoveStrengthenOnPublish}),showWeakRefMismatch&&/* @__PURE__ */jsxRuntime.jsx(ReferenceStrengthMismatchAlertStrip,{actualStrength,handleFixStrengthMismatch}),loadableReferenceInfo.error&&/* @__PURE__ */jsxRuntime.jsx(ReferenceMetadataLoadErrorAlertStrip,{errorMessage:loadableReferenceInfo.error.message,onHandleRetry:loadableReferenceInfo.retry})]});const OpenLink=React.useMemo(()=>// eslint-disable-next-line @typescript-eslint/no-shadow
React.forwardRef(function OpenLink2(restProps,_ref){return/* @__PURE__ */jsxRuntime.jsx(router.IntentLink,{...restProps,intent:"edit",params:{id:value==null?void 0:value._ref,type:refType==null?void 0:refType.name},target:"_blank",rel:"noopener noreferrer",ref:_ref});}),[refType==null?void 0:refType.name,value==null?void 0:value._ref]);const menu=React.useMemo(()=>readOnly?null:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:"none",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{paddingY:3}),id:"".concat(inputId,"-menuButton"),menu:/* @__PURE__ */jsxRuntime.jsxs(ui.Menu,{children:[!readOnly&&/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.reference.action.clear"),tone:"critical",icon:icons.TrashIcon,onClick:handleClear}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.reference.action.replace"),icon:icons.SyncIcon,onClick:handleReplace})]}),!readOnly&&(value==null?void 0:value._ref)&&/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{}),(value==null?void 0:value._ref)&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:OpenLink,"data-as":"a",text:t("inputs.reference.action.open-in-new-tab"),icon:icons.LaunchIcon})]}),popover:MENU_POPOVER_PROPS$a})}),[handleClear,handleReplace,inputId,OpenLink,readOnly,t,value==null?void 0:value._ref]);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[documentId&&props.actions&&props.actions.length>0&&/* @__PURE__ */jsxRuntime.jsx(FieldActionsResolver,{actions:props.actions,documentId,documentType:schemaType.name,onActions:setFieldActionNodes,path,schemaType}),/* @__PURE__ */jsxRuntime.jsx(FieldActionsProvider,{actions:fieldActionsNodes,focused:Boolean(props.inputProps.focused),path,children:/* @__PURE__ */jsxRuntime.jsx(FormField,{__internal_comments:props.__internal_comments,__internal_slot:props.__internal_slot,__unstable_headerActions:fieldActionsNodes,__unstable_presence:props.presence,description:props.description,level:props.level,title:props.title,validation:props.validation,deprecated:props.schemaType.deprecated,children:isEditing?/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children}):/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,radius:2,padding:1,tone,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{gap:1,align:"center",style:{lineHeight:0},children:/* @__PURE__ */jsxRuntime.jsxs(TooltipDelayGroupProvider.TooltipDelayGroupProvider,{children:[/* @__PURE__ */jsxRuntime.jsx(ReferenceLinkCard,{__unstable_focusRing:true,as:EditReferenceLink,"data-pressed":pressed?true:void 0,"data-selected":selected?true:void 0,documentId:value==null?void 0:value._ref,documentType:refType==null?void 0:refType.name,flex:1,pressed,radius:2,ref:elementRef,selected,tone:"inherit",children:/* @__PURE__ */jsxRuntime.jsx(PreviewReferenceValue$1,{value,referenceInfo:loadableReferenceInfo,renderPreview,type:schemaType})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:menu})]})}),footer]})})})})]});}function getOption(type,optionName){return get__default.default(type.options,optionName);}const PSEUDO_OBJECTS=["array","file","image","reference","slug"];const HIDDEN_FIELDS=["asset","crop","hotspot","_ref","_weak"];const NO_LEVEL_LAYOUTS=["tags"];const NO_LEVEL_TYPES=["slug"];function getTypeChain$1(type,visited){if(!type)return[];if(visited.has(type))return[];visited.add(type);const next=type.type?getTypeChain$1(type.type,visited):[];return[type,...next];}function getFieldLevel(schemaType,currentLevel){return types.isArraySchemaType(schemaType)?getArrayFieldLevel(schemaType,currentLevel):getObjectFieldLevel(schemaType,currentLevel);}function getObjectFieldLevel(schemaType,currentLevel){var _a,_b,_c;const{type,options}=schemaType;const typeIfRelevant=asType(type,PSEUDO_OBJECTS);const fields=(schemaType==null?void 0:schemaType.jsonType)==="object"?schemaType.fields:void 0;const typeName=(typeIfRelevant==null?void 0:typeIfRelevant.name)||"";if(NO_LEVEL_TYPES.includes(typeName)){return 0;}const isPseudoObject=PSEUDO_OBJECTS.includes(typeName);const hasVisibleFields=((_a=fields==null?void 0:fields.filter(f=>!HIDDEN_FIELDS.includes(f.name)).length)!=null?_a:0)>0;const hasListOptions=((_c=(_b=options==null?void 0:options.list)==null?void 0:_b.length)!=null?_c:0)>0;if(hasVisibleFields||hasListOptions||!isPseudoObject){return currentLevel;}return 0;}function getArrayFieldLevel(schemaType,currentLevel){var _a;const{options}=schemaType;const hasListOptions=((_a=(options==null?void 0:options.list)||[])==null?void 0:_a.length)>0;const isNoLevelLayout=NO_LEVEL_LAYOUTS.includes((options==null?void 0:options.layout)||"");if(hasListOptions&&!isNoLevelLayout){return currentLevel;}return 0;}function asType(schemaType,asOneOfTypes){if((schemaType==null?void 0:schemaType.name)&&asOneOfTypes.includes(schemaType==null?void 0:schemaType.name)){return schemaType;}if(!schemaType){return void 0;}return asType(schemaType.type,asOneOfTypes);}const EMPTY_ARRAY$3=[];function BooleanField(field){return/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{hasFocus:Boolean(field.inputProps.focused),isChanged:field.inputProps.changed,path:field.path,children:field.children});}function PrimitiveField(field){const[fieldActionsNodes,setFieldActionNodes]=React.useState(EMPTY_ARRAY$3);const documentId=usePublishedId();const focused=Boolean(field.inputProps.focused);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[documentId&&field.actions&&field.actions.length>0&&/* @__PURE__ */jsxRuntime.jsx(FieldActionsResolver,{actions:field.actions,documentId,documentType:field.schemaType.name,onActions:setFieldActionNodes,path:field.path,schemaType:field.schemaType}),/* @__PURE__ */jsxRuntime.jsx(FieldActionsProvider,{actions:fieldActionsNodes,focused,path:field.path,children:/* @__PURE__ */jsxRuntime.jsx(FormField,{__internal_slot:field.__internal_slot,__internal_comments:field.__internal_comments,__unstable_headerActions:fieldActionsNodes,__unstable_presence:field.presence,"data-testid":"field-".concat(field.inputId),description:field.description,inputId:field.inputId,level:field.level,title:field.title,validation:field.validation,deprecated:field.schemaType.deprecated,children:/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{hasFocus:focused,isChanged:field.inputProps.changed,path:field.path,children:field.children})})})]});}function ObjectOrArrayField(field){const[fieldActionsNodes,setFieldActionNodes]=React.useState(EMPTY_ARRAY$3);const documentId=usePublishedId();const focused=Boolean(field.inputProps.focused);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[documentId&&field.actions&&field.actions.length>0&&/* @__PURE__ */jsxRuntime.jsx(FieldActionsResolver,{actions:field.actions,documentId,documentType:field.schemaType.name,onActions:setFieldActionNodes,path:field.path,schemaType:field.schemaType}),/* @__PURE__ */jsxRuntime.jsx(FieldActionsProvider,{actions:fieldActionsNodes,focused,path:field.path,children:/* @__PURE__ */jsxRuntime.jsx(FormFieldSet,{__internal_comments:field.__internal_comments,__internal_slot:field.__internal_slot,__unstable_headerActions:fieldActionsNodes,__unstable_presence:field.presence,collapsed:field.collapsed,collapsible:field.collapsible,"data-testid":"field-".concat(field.inputId),description:field.description,level:field.level,onCollapse:field.onCollapse,onExpand:field.onExpand,title:field.title,validation:field.validation,inputId:field.inputId,deprecated:field.schemaType.deprecated,children:field.children})})]});}function ImageOrFileField(field){const[fieldActionsNodes,setFieldActionNodes]=React.useState(EMPTY_ARRAY$3);const documentId=usePublishedId();const focused=Boolean(field.inputProps.focused);const hotspotField=field.inputProps.members.find(member=>member.kind==="field"&&member.name==="hotspot");const presence=(hotspotField==null?void 0:hotspotField.open)?field.presence:field.presence.concat((hotspotField==null?void 0:hotspotField.field.presence)||EMPTY_ARRAY$3);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[documentId&&field.actions&&field.actions.length>0&&/* @__PURE__ */jsxRuntime.jsx(FieldActionsResolver,{actions:field.actions,documentId,documentType:field.schemaType.name,onActions:setFieldActionNodes,path:field.path,schemaType:field.schemaType}),/* @__PURE__ */jsxRuntime.jsx(FieldActionsProvider,{actions:fieldActionsNodes,focused,path:field.path,children:/* @__PURE__ */jsxRuntime.jsx(FormFieldSet,{__internal_comments:field.__internal_comments,__internal_slot:field.__internal_slot,__unstable_headerActions:fieldActionsNodes,__unstable_presence:presence,collapsed:field.collapsed,collapsible:field.collapsible,description:field.description,level:field.level,onCollapse:field.onCollapse,onExpand:field.onExpand,title:field.title,validation:field.validation,inputId:field.inputId,deprecated:field.schemaType.deprecated,children:field.children})})]});}function defaultResolveFieldComponent(schemaType){var _a;if((_a=schemaType.components)==null?void 0:_a.field)return schemaType.components.field;if(types.isBooleanSchemaType(schemaType)){return BooleanField;}const typeChain=getTypeChain$1(schemaType,/* @__PURE__ */new Set());if(typeChain.some(t=>t.name==="image"||t.name==="file")){return ImageOrFileField;}if(typeChain.some(t=>types.isCrossDatasetReferenceSchemaType(t))){return PrimitiveField;}if(typeChain.some(t=>t.name==="slug")){return PrimitiveField;}if(typeChain.some(t=>types.isReferenceSchemaType(t))){return ReferenceField;}if(schemaType.jsonType!=="object"&&schemaType.jsonType!=="array"){return PrimitiveField;}return ObjectOrArrayField;}function useOnClickOutside(refs,handler){React.useEffect(()=>{const listener=event=>{const target=event.target;if(target instanceof HTMLElement){if(refs.some(ref=>{var _a;return(_a=ref.current)==null?void 0:_a.contains(target);})){return;}handler(event);}};document.addEventListener("mousedown",listener);document.addEventListener("touchstart",listener);return()=>{document.removeEventListener("mousedown",listener);document.removeEventListener("touchstart",listener);};},[refs,handler]);}var __freeze$1N=Object.freeze;var __defProp$1N=Object.defineProperty;var __template$1N=(cooked,raw)=>__freeze$1N(__defProp$1N(cooked,"raw",{value:__freeze$1N(raw||cooked.slice())}));var _a$1O,_b$P;const NARROW_LAYOUT=styled.css(_a$1O||(_a$1O=__template$1N(["\n  grid-template-columns: minmax(0px, 1fr);\n"])));const WIDE_LAYOUT=styled.css(_b$P||(_b$P=__template$1N(["\n  grid-template-columns: 1fr min-content;\n"])));const Root$k=styled__default.default(ui.Grid)(props=>props.$narrow?NARROW_LAYOUT:WIDE_LAYOUT);const AutocompleteContainer=React.forwardRef(function AutocompleteContainer2(props,forwardedRef){const[rootElement,setRootElement]=React.useState(null);const handleNewRef=React.useCallback(element=>{setForwardedRef(forwardedRef,element);setRootElement(element);},[forwardedRef]);const inputWrapperRect=ui.useElementRect(rootElement);return/* @__PURE__ */jsxRuntime.jsx(Root$k,{ref:handleNewRef,gap:1,$narrow:((inputWrapperRect==null?void 0:inputWrapperRect.width)||0)<480,children:props.children});});function setForwardedRef(ref,instance){if(typeof ref==="function"){ref(instance);}else if(ref){ref.current=instance;}}const INLINE_BLOCK_STYLE={display:"inline-flex"};const FULL_WIDTH={width:"100%"};const POPOVER_PROPS$3={portal:true,tone:"default",constrainSize:true,fallbackPlacements:["bottom","left","top"],placement:"right",preventOverflow:true};function CreateButton(props){const{createOptions,onCreate,id,menuRef,...rest}=props;const currentUser=useCurrentUser();const{t}=useTranslation();const getI18nText=useGetI18nText(createOptions);const canCreateAny=createOptions.some(option=>option.permission.granted);if(!canCreateAny){return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:/* @__PURE__ */jsxRuntime.jsx(InsufficientPermissionsMessage,{currentUser,context:"create-new-reference"}),children:/* @__PURE__ */jsxRuntime.jsx("div",{style:INLINE_BLOCK_STYLE,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{text:t("inputs.reference.action.create-new-document"),mode:"ghost",disabled:true,icon:icons.AddIcon,style:FULL_WIDTH})})});}return createOptions.length>1?/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{...rest,disabled:props.readOnly,text:t("inputs.reference.action.create-new-document-select"),mode:"ghost",icon:icons.AddIcon,size:"large"}),id,menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{ref:menuRef,children:createOptions.map(createOption=>/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{disabled:createOption.permission.granted,content:/* @__PURE__ */jsxRuntime.jsx(InsufficientPermissionsMessage,{currentUser,context:"create-document-type"}),portal:true,children:/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{disabled:!createOption.permission.granted,icon:createOption.icon,text:getI18nText(createOption).title,onClick:()=>onCreate(createOption)})})},createOption.id))}),popover:POPOVER_PROPS$3}):/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{...rest,text:t("inputs.reference.action.create-new-document-select"),mode:"ghost",disabled:!createOptions[0].permission.granted||props.readOnly,onClick:()=>onCreate(createOptions[0]),icon:icons.AddIcon,size:"large"});}function OptionPreview$1(props){const{getReferenceInfo,id:documentId,renderPreview}=props;const{isLoading,result:referenceInfo,error}=useReferenceInfo$1(documentId,getReferenceInfo);const{t}=useTranslation();if(isLoading){return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,padding:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.TextSkeleton,{style:{maxWidth:320},radius:1,animated:true}),/* @__PURE__ */jsxRuntime.jsx(ui.TextSkeleton,{style:{maxWidth:200},radius:1,size:1,animated:true})]});}if(error){return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:2,padding:1,children:/* @__PURE__ */jsxRuntime.jsx(Alert,{title:t("inputs.reference.error.failed-to-load-document-title"),children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:error.message})})});}if(!referenceInfo){return null;}if(referenceInfo.availability.reason==="PERMISSION_DENIED"){return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:2,padding:1,children:t("inputs.reference.error.missing-read-permissions-description")});}const refType=props.type.to.find(toType=>toType.name===referenceInfo.type);if(!refType){return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:2,padding:1,children:t("inputs.reference.error.invalid-search-result-type-title",{returnedType:referenceInfo.type})});}return referenceInfo&&refType&&/* @__PURE__ */jsxRuntime.jsx(ReferencePreview,{id:referenceInfo.id,layout:"default",preview:referenceInfo.preview,refType,renderPreview,showTypeLabel:props.type.to.length>1});}var __freeze$1M=Object.freeze;var __defProp$1M=Object.defineProperty;var __template$1M=(cooked,raw)=>__freeze$1M(__defProp$1M(cooked,"raw",{value:__freeze$1M(raw||cooked.slice())}));var _a$1N,_b$O;const StyledPopover$3=styled__default.default(TooltipDelayGroupProvider.Popover)(_a$1N||(_a$1N=__template$1M(["\n  & > div {\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n  }\n"])));const StyledText$4=styled__default.default(ui.Text)(_b$O||(_b$O=__template$1M(["\n  word-break: break-word;\n"])));const FALLBACK_PLACEMENTS$2=["top-start","bottom-start"];const ReferenceAutocomplete$2=React.forwardRef(function ReferenceAutocomplete2(props,ref){const{searchString,loading,portalRef,referenceElement,...restProps}=props;const{t}=useTranslation();const hasResults=props.options&&props.options.length>0;const renderPopover=React.useCallback((_ref132,contentRef)=>{let{content,hidden,inputElement,onMouseEnter,onMouseLeave}=_ref132;return/* @__PURE__ */jsxRuntime.jsx(StyledPopover$3,{placement:"bottom-start",fallbackPlacements:FALLBACK_PLACEMENTS$2,arrow:false,constrainSize:true,onMouseEnter,onMouseLeave,content:/* @__PURE__ */jsxRuntime.jsx("div",{ref:contentRef,children:hasResults?content:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",height:"fill",justify:"center",children:/* @__PURE__ */jsxRuntime.jsx(StyledText$4,{align:"center",muted:true,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.reference.no-results-for-query",values:{searchTerm:searchString||""}})})})})}),open:!loading&&!hidden,ref:portalRef,portal:true,referenceElement:referenceElement||inputElement,matchReferenceWidth:true});},[hasResults,t,searchString,loading,portalRef,referenceElement]);return/* @__PURE__ */jsxRuntime.jsx(ui.Autocomplete,{...restProps,loading,ref,renderPopover});});const ReferenceItemRefContext=React.createContext(null);function useReferenceItemRef(){const ref=React.useContext(ReferenceItemRefContext);if(!ref){return{menuRef:{current:null},containerRef:{current:null}};}return ref;}var __freeze$1L=Object.freeze;var __defProp$1L=Object.defineProperty;var __template$1L=(cooked,raw)=>__freeze$1L(__defProp$1L(cooked,"raw",{value:__freeze$1L(raw||cooked.slice())}));var _a$1M;let StyledPreviewCardImpl;const StyledPreviewCard=React.forwardRef(function StyledPreviewCard2(props,ref){if(!StyledPreviewCardImpl){StyledPreviewCardImpl=styled__default.default(PreviewCard)(_a$1M||(_a$1M=__template$1L(["\n      /* this is a hack to avoid layout jumps while previews are loading\n      there's probably better ways of solving this */\n      min-height: 36px;\n    "])));}return/* @__PURE__ */jsxRuntime.jsx(StyledPreviewCardImpl,{ref,...props});});const INITIAL_SEARCH_STATE$2={hits:[],isLoading:false};const NO_FILTER$2=()=>true;function nonNullable$1(v){return v!==null;}function ReferenceInput(props){var _a2,_b,_c,_d,_e,_f;const{createOptions,onChange,onEditReference,onSearch,schemaType,readOnly,id,onPathFocus,value,renderPreview,path,elementProps,focusPath}=props;const{getReferenceInfo}=useReferenceInput({path,schemaType,value});const[searchState,setSearchState]=React.useState(INITIAL_SEARCH_STATE$2);const handleCreateNew=React.useCallback(option=>{const newDocumentId=uuid.uuid();const patches=[setIfMissing({}),set(schemaType.name,["_type"]),set(newDocumentId,["_ref"]),set(true,["_weak"]),set({type:option.type,weak:schemaType.weak,template:option.template},["_strengthenOnPublish"])].filter(isNonNullable$2);onChange(patches);onEditReference({id:newDocumentId,type:option.type,template:option.template});onPathFocus([]);},[onChange,onEditReference,onPathFocus,schemaType]);const handleChange=React.useCallback(nextId=>{if(!nextId){onChange(unset());onPathFocus([]);return;}const hit=searchState.hits.find(h=>h.id===nextId);if(!hit){throw new Error("Selected an item that wasnt part of the result set");}const patches=[setIfMissing({}),set(schemaType.name,["_type"]),set(getPublishedId(nextId),["_ref"]),hit.published&&!schemaType.weak?unset(["_weak"]):set(true,["_weak"]),hit.published?unset(["_strengthenOnPublish"]):set({type:hit==null?void 0:hit.type,weak:schemaType.weak},["_strengthenOnPublish"])].filter(isNonNullable$2);onChange(patches);onPathFocus([]);},[onChange,onPathFocus,schemaType.name,schemaType.weak,searchState.hits]);const handleClear=React.useCallback(()=>{onChange(unset());},[onChange]);const handleCancelEdit=React.useCallback(()=>{if(!(value==null?void 0:value._ref)){handleClear();}},[handleClear,value==null?void 0:value._ref]);const handleAutocompleteKeyDown=React.useCallback(event=>{if(event.key==="Escape"){onPathFocus([]);}},[onPathFocus]);const loadableReferenceInfo=useReferenceInfo$1(value==null?void 0:value._ref,getReferenceInfo);const autocompletePopoverReferenceElementRef=React.useRef(null);const{push}=ui.useToast();const{t}=useTranslation();const handleQueryChange=reactRx.useObservableCallback(inputValue$=>{return inputValue$.pipe(operators.filter(nonNullable$1),operators.switchMap(searchString=>rxjs.concat(rxjs.of({isLoading:true}),onSearch(searchString).pipe(operators.map(hits2=>({hits:hits2,searchString,isLoading:false})),operators.catchError(error=>{push({title:t("inputs.reference.error.search-failed-title"),description:error.message,status:"error",id:"reference-search-fail-".concat(id)});console.error(error);return rxjs.of({hits:[]});})))),operators.scan((prevState,nextState)=>({...prevState,...nextState}),INITIAL_SEARCH_STATE$2),operators.tap(setSearchState));},[id,onSearch,push,t]);const handleAutocompleteOpenButtonClick=React.useCallback(()=>{handleQueryChange("");},[handleQueryChange]);const handleCreateButtonKeyDown=React.useCallback(e=>{if(e.key==="Escape"){onPathFocus([]);}},[onPathFocus]);const renderOption=React.useCallback(option=>{var _a3,_b2;const documentId=((_a3=option.hit.draft)==null?void 0:_a3._id)||((_b2=option.hit.published)==null?void 0:_b2._id)||option.value;return/* @__PURE__ */jsxRuntime.jsx(StyledPreviewCard,{forwardedAs:"button",type:"button",radius:2,tone:"inherit",children:/* @__PURE__ */jsxRuntime.jsx(OptionPreview$1,{getReferenceInfo,id:documentId,renderPreview,type:schemaType})});},[schemaType,getReferenceInfo,renderPreview]);const renderValue=React.useCallback(()=>{var _a3,_b2,_c2,_d2;return((_b2=(_a3=loadableReferenceInfo.result)==null?void 0:_a3.preview.draft)==null?void 0:_b2.title)||((_d2=(_c2=loadableReferenceInfo.result)==null?void 0:_c2.preview.published)==null?void 0:_d2.title)||"";},[(_b=(_a2=loadableReferenceInfo.result)==null?void 0:_a2.preview.draft)==null?void 0:_b.title,(_d=(_c=loadableReferenceInfo.result)==null?void 0:_c.preview.published)==null?void 0:_d.title]);const handleFocus=React.useCallback(()=>onPathFocus(["_ref"]),[onPathFocus]);const handleBlur=React.useCallback(event=>{var _a3;if(!((_a3=autocompletePopoverReferenceElementRef.current)==null?void 0:_a3.contains(event.relatedTarget))){props.elementProps.onBlur(event);}},[props.elementProps]);const isWeakRefToNonexistent=((_f=(_e=loadableReferenceInfo==null?void 0:loadableReferenceInfo.result)==null?void 0:_e.availability)==null?void 0:_f.reason)==="NOT_FOUND"&&!(value==null?void 0:value._strengthenOnPublish)&&(value==null?void 0:value._weak);useDidUpdate((focusPath==null?void 0:focusPath[0])==="_ref",(hadFocusAtRef,hasFocusAtRef)=>{var _a3;if(!hadFocusAtRef&&hasFocusAtRef){(_a3=elementProps.ref.current)==null?void 0:_a3.focus();}});const hits=React.useMemo(()=>searchState.hits.map(hit=>({value:hit.id,hit})),[searchState.hits]);const isEditing=focusPath.length===1&&focusPath[0]==="_ref";const{menuRef,containerRef}=useReferenceItemRef();const clickOutsideBoundaryRef=React.useRef(null);const autoCompletePortalRef=React.useRef(null);const createButtonMenuPortalRef=React.useRef(null);useOnClickOutside([containerRef,clickOutsideBoundaryRef,autoCompletePortalRef,createButtonMenuPortalRef,menuRef],()=>{if(isEditing){handleCancelEdit();}});return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:1,"data-testid":"reference-input",ref:clickOutsideBoundaryRef,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[isWeakRefToNonexistent?/* @__PURE__ */jsxRuntime.jsx(Alert,{"data-testid":"alert-nonexistent-document",title:t("inputs.reference.error.nonexistent-document-title"),suffix:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{text:t("inputs.reference.error.nonexistent-document.clear-button-label"),onClick:handleClear})}),children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{i18nKey:"inputs.reference.error.nonexistent-document-description",t,values:{documentId:value._ref}})})}):null,/* @__PURE__ */jsxRuntime.jsxs(AutocompleteContainer,{ref:autocompletePopoverReferenceElementRef,children:[/* @__PURE__ */jsxRuntime.jsx(ReferenceAutocomplete$2,{...elementProps,onFocus:handleFocus,onBlur:handleBlur,"data-testid":"autocomplete",loading:searchState.isLoading,referenceElement:autocompletePopoverReferenceElementRef.current,options:hits,radius:2,placeholder:t("inputs.reference.search-placeholder"),onKeyDown:handleAutocompleteKeyDown,readOnly:loadableReferenceInfo.isLoading||readOnly,onQueryChange:handleQueryChange,searchString:searchState.searchString,onChange:handleChange,filterOption:NO_FILTER$2,renderOption,renderValue,openButton:{onClick:handleAutocompleteOpenButtonClick},portalRef:autoCompletePortalRef,value:value==null?void 0:value._ref}),createOptions.length>0&&/* @__PURE__ */jsxRuntime.jsx(CreateButton,{id:"".concat(id,"-selectTypeMenuButton"),readOnly,createOptions,onCreate:handleCreateNew,onKeyDown:handleCreateButtonKeyDown,menuRef:createButtonMenuPortalRef})]})]})});}async function resolveUserDefinedFilter$1(options,document,valuePath,getClient){if(!options){return{};}if(typeof options.filter==="function"){const parentPath=valuePath.slice(0,-1);const parent=PathUtils.get(document,parentPath);const resolvedFilter=await options.filter({document,parentPath,parent,getClient});return resolvedFilter;}return{filter:options.filter,params:"filterParams"in options?options.filterParams:void 0};}function useValueRef$1(value){const ref=React.useRef(value);ref.current=value;return ref;}function StudioReferenceInput(props){var _a,_b,_c,_d;const source=useSource();const searchClient=source.getClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const schema=useSchema();const maxFieldDepth=useSearchMaxFieldDepth();const documentPreviewStore=useDocumentPreviewStore();const{path,schemaType}=props;const{EditReferenceLinkComponent,onEditReference,activePath,initialValueTemplateItems}=useReferenceInputOptions();const documentValue=useFormValue([]);const documentRef=useValueRef$1(documentValue);const documentTypeName=(_a=documentRef.current)==null?void 0:_a._type;const refType=schema.get(documentTypeName);const isDocumentLiveEdit=React.useMemo(()=>refType==null?void 0:refType.liveEdit,[refType]);const disableNew=((_b=schemaType.options)==null?void 0:_b.disableNew)===true;const getClient=source.getClient;const handleSearch=React.useCallback(searchString=>rxjs.from(resolveUserDefinedFilter$1(schemaType.options,documentRef.current,path,getClient)).pipe(operators.mergeMap(_ref133=>{let{filter,params}=_ref133;return referenceSearch(searchClient,searchString,schemaType,{...schemaType.options,filter,params,tag:"search.reference",maxFieldDepth});}),operators.catchError(err=>{var _a2;const isQueryError=err.details&&err.details.type==="queryParseError";if(((_a2=schemaType.options)==null?void 0:_a2.filter)&&isQueryError){err.message='Invalid reference filter, please check the custom "filter" option';}return rxjs.throwError(err);})),[documentRef,path,searchClient,schemaType,maxFieldDepth,getClient]);const template=(_d=(_c=props.value)==null?void 0:_c._strengthenOnPublish)==null?void 0:_d.template;const EditReferenceLink=React.useMemo(()=>React.forwardRef(function EditReferenceLink_(_props,forwardedRef){return EditReferenceLinkComponent?/* @__PURE__ */jsxRuntime.jsx(EditReferenceLinkComponent,{..._props,ref:forwardedRef,parentRefPath:path,template}):null;}),[EditReferenceLinkComponent,path,template]);const handleEditReference=React.useCallback(event=>{onEditReference==null?void 0:onEditReference({parentRefPath:path,id:event.id,type:event.type,template:event.template});},[onEditReference,path]);const selectedState=PathUtils__namespace.startsWith(path,(activePath==null?void 0:activePath.path)||[])?activePath==null?void 0:activePath.state:"none";const createOptions=React.useMemo(()=>{if(disableNew){return[];}return(initialValueTemplateItems||[]).filter(i=>{return schemaType.to.some(_refType=>{var _a2;return _refType.name===((_a2=i.template)==null?void 0:_a2.schemaType);});}).map(item=>{var _a2,_b2,_c2;return((_a2=item.template)==null?void 0:_a2.schemaType)?{id:item.id,title:item.title||"".concat(item.template.schemaType," from template ").concat((_b2=item.template)==null?void 0:_b2.id),i18n:item.i18n,type:item.template.schemaType,icon:item.icon,template:{id:(_c2=item.template)==null?void 0:_c2.id,params:item.parameters},permission:{granted:item.granted,reason:item.reason}}:void 0;}).filter(isNonNullable$2);},[disableNew,initialValueTemplateItems,schemaType.to]);const getReferenceInfo$1=React.useCallback((id,_type)=>getReferenceInfo(documentPreviewStore,id,_type),[documentPreviewStore]);return/* @__PURE__ */jsxRuntime.jsx(ReferenceInput,{...props,onSearch:handleSearch,liveEdit:isDocumentLiveEdit,getReferenceInfo:getReferenceInfo$1,selectedState,editReferenceLinkComponent:EditReferenceLink,createOptions,onEditReference:handleEditReference});}function isObjectItemProps(item){return types.isObjectSchemaType(item.schemaType);}function isObjectInputProps(inputProps){return types.isObjectSchemaType(inputProps.schemaType);}function isStringInputProps(inputProps){return types.isStringSchemaType(inputProps.schemaType);}function isNumberInputProps(inputProps){return types.isNumberSchemaType(inputProps.schemaType);}function isBooleanInputProps(inputProps){return types.isBooleanSchemaType(inputProps.schemaType);}function isArrayOfObjectsInputProps(inputProps){return types.isArrayOfObjectsSchemaType(inputProps.schemaType);}function isArrayOfBlocksInputProps(inputProps){return types.isArrayOfBlocksSchemaType(inputProps.schemaType);}function isArrayOfPrimitivesInputProps(inputProps){return types.isArrayOfPrimitivesSchemaType(inputProps.schemaType);}function restrictToBoundingRect(transform,rect,boundingRect,margins){const value={...transform};const marginY=margins.y||0;const marginX=margins.x||0;if(rect.top+value.y<=boundingRect.top+marginY){value.y=boundingRect.top-rect.top+marginY;}else if(rect.bottom+value.y>=boundingRect.top+boundingRect.height-marginY){value.y=boundingRect.top+boundingRect.height-rect.bottom-marginY;}if(rect.left+value.x<=boundingRect.left-marginX){value.x=boundingRect.left-rect.left+marginX;}else if(rect.right+value.x>=boundingRect.left+boundingRect.width+marginX){value.x=boundingRect.left+boundingRect.width-rect.right+marginX;}return value;}const restrictToParentElementWithMargins=margins=>_ref134=>{let{containerNodeRect,draggingNodeRect,transform}=_ref134;if(!draggingNodeRect||!containerNodeRect){return transform;}return restrictToBoundingRect(transform,draggingNodeRect,containerNodeRect,margins);};var __freeze$1K=Object.freeze;var __defProp$1K=Object.defineProperty;var __template$1K=(cooked,raw)=>__freeze$1K(__defProp$1K(cooked,"raw",{value:__freeze$1K(raw||cooked.slice())}));var _a$1L;const DragHandleButton=styled__default.default(TooltipDelayGroupProvider.Button)(_a$1L||(_a$1L=__template$1K(["\n  cursor: ",";\n"])),props=>props.$grid?"move":"ns-resize");const SortableItemIdContext=React.createContext(null);const DragHandle=function DragHandle2(props){const id=React.useContext(SortableItemIdContext);const{listeners,attributes}=sortable.useSortable({id});const{t}=useTranslation();const{mode="bleed",...rest}=props;return/* @__PURE__ */jsxRuntime.jsx(DragHandleButton,{icon:icons.DragHandleIcon,tooltipProps:{content:t("inputs.array.action.drag.tooltip"),delay:{open:1e3}},mode,"data-ui":"DragHandleButton",...attributes,...rest,...listeners});};var __freeze$1J=Object.freeze;var __defProp$1J=Object.defineProperty;var __template$1J=(cooked,raw)=>__freeze$1J(__defProp$1J(cooked,"raw",{value:__freeze$1J(raw||cooked.slice())}));var _a$1K,_b$N;const MOVING_ITEM_CLASS_NAME="moving";const ListItem$1=styled__default.default(ui.Box)(_b$N||(_b$N=__template$1J(["\n  ","\n"])),props=>props.$moving&&styled.css(_a$1K||(_a$1K=__template$1J(["\n      z-index: 10000;\n      /* prevents hover-effects etc on the dragged element  */\n      pointer-events: none;\n    "]))));const AUTO_SCROLL_OPTIONS={threshold:{x:0,y:0.02}};const SENSOR_OPTIONS={coordinateGetter:sortable.sortableKeyboardCoordinates};const TRANSITION={duration:200,easing:"ease"};function restrictToAxis(axis){return axis==="x"?modifiers.restrictToHorizontalAxis:modifiers.restrictToVerticalAxis;}function sortingStrategy(axis){return axis==="x"?sortable.horizontalListSortingStrategy:sortable.verticalListSortingStrategy;}const SortableList=React.memo(function SortableList2(props){const{items,axis,onItemMove,onItemMoveStart,onItemMoveEnd,children,...rest}=props;const sensors=core.useSensors(core.useSensor(core.PointerSensor),core.useSensor(core.KeyboardSensor,SENSOR_OPTIONS));const handleDragEnd=React.useCallback(event=>{var _a2,_b2,_c,_d;const{active,over}=event;if(active.id!==(over==null?void 0:over.id)){onItemMove==null?void 0:onItemMove({fromIndex:(_b2=(_a2=active.data.current)==null?void 0:_a2.sortable)==null?void 0:_b2.index,toIndex:(_d=(_c=over==null?void 0:over.data.current)==null?void 0:_c.sortable)==null?void 0:_d.index});}onItemMoveEnd==null?void 0:onItemMoveEnd();},[onItemMove,onItemMoveEnd]);const modifiers=React.useMemo(()=>[restrictToParentElementWithMargins({y:4}),...(axis?[restrictToAxis(axis)]:[])],[axis]);return/* @__PURE__ */jsxRuntime.jsx(core.DndContext,{sensors,autoScroll:AUTO_SCROLL_OPTIONS,modifiers,collisionDetection:core.closestCenter,onDragEnd:handleDragEnd,onDragStart:onItemMoveStart,children:/* @__PURE__ */jsxRuntime.jsx(sortable.SortableContext,{items,strategy:axis?sortingStrategy(axis):void 0,children:/* @__PURE__ */jsxRuntime.jsx(ui.Grid,{...rest,children})})});});const SortableListItem=React.forwardRef(function SortableListItem2(props,ref){const{id,children,disableTransition}=props;const{setNodeRef,transform,transition,active}=sortable.useSortable({id,transition:disableTransition?null:TRANSITION});const isActive=id===(active==null?void 0:active.id);const style=React.useMemo(()=>({transform:utilities.CSS.Translate.toString(transform),transition,pointerEvents:active?"none":void 0}),[transform,transition,active]);const setRef=React.useCallback(node=>{setNodeRef(node);if(typeof ref==="function"){ref(node);}else if(ref){ref.current=node;}},[ref,setNodeRef]);return/* @__PURE__ */jsxRuntime.jsx(ListItem$1,{ref:setRef,style,$moving:isActive,className:isActive?MOVING_ITEM_CLASS_NAME:"","data-index":props["data-index"],children});});function List(props){const{onItemMove,onItemMoveEnd,onItemMoveStart,sortable,...rest}=props;const handleSortEnd=React.useCallback(event=>{onItemMove==null?void 0:onItemMove(event);},[onItemMove]);return sortable?/* @__PURE__ */jsxRuntime.jsx(SortableList,{onItemMove:handleSortEnd,onItemMoveStart,onItemMoveEnd,...rest}):/* @__PURE__ */jsxRuntime.jsx(ui.Grid,{...rest});}const Item=React.forwardRef(function Item2(props,ref){const{sortable,...rest}=props;return/* @__PURE__ */jsxRuntime.jsx(SortableItemIdContext.Provider,{value:props.id,children:sortable?/* @__PURE__ */jsxRuntime.jsx(SortableListItem,{ref,...rest}):/* @__PURE__ */jsxRuntime.jsx(ListItem$1,{ref,...rest})});});function focusRingBorderStyle$1(border){return"inset 0 0 0 ".concat(border.width,"px ").concat(border.color);}function focusRingStyle$1(opts){const{base,border,focusRing}=opts;const focusRingOutsetWidth=focusRing.offset+focusRing.width;const focusRingInsetWidth=0-focusRing.offset;const bgColor=base?base.bg:"var(--card-bg-color)";return[focusRingInsetWidth>0&&"inset 0 0 0 ".concat(focusRingInsetWidth,"px var(--card-focus-ring-color)"),border&&focusRingBorderStyle$1(border),focusRingInsetWidth<0&&"0 0 0 ".concat(0-focusRingInsetWidth,"px ").concat(bgColor),focusRingOutsetWidth>0&&"0 0 0 ".concat(focusRingOutsetWidth,"px var(--card-focus-ring-color)")].filter(Boolean).join(",");}var __freeze$1I=Object.freeze;var __defProp$1I=Object.defineProperty;var __template$1I=(cooked,raw)=>__freeze$1I(__defProp$1I(cooked,"raw",{value:__freeze$1I(raw||cooked.slice())}));var _a$1J;function withFocusRing(component){return styled__default.default(component)(props=>{const{$border,$radius}=props;const{card,color,radius}=theme.getTheme_v2(props.theme);const border={width:$border?1:0,color:"var(--card-border-color)"};return styled.css(_a$1J||(_a$1J=__template$1I(["\n        --card-focus-box-shadow: ",";\n\n        border-radius: ",";\n        outline: none;\n        box-shadow: var(--card-focus-box-shadow);\n\n        &:focus {\n          --card-focus-box-shadow: ",";\n        }\n      "])),focusRingBorderStyle$1(border),ui.rem(radius[$radius!=null?$radius:1]),focusRingStyle$1({border,base:color,focusRing:{...card.focusRing,// An offset of 0 is needed to avoid the focus ring overlap the border of the inner items, the theme has an offset of -1
// Detected in empty array items.
offset:0}}));});}function extractPastedFiles(dataTransfer){if(dataTransfer.files&&dataTransfer.files.length>0){return Promise.resolve(Array.from(dataTransfer.files||[]));}return normalizeItems(Array.from(dataTransfer.items||[])).then(flatten__default.default);}function extractDroppedFiles(dataTransfer){const files=Array.from(dataTransfer.files||[]);const items=Array.from(dataTransfer.items||[]);if(files&&files.length>0){return Promise.resolve(files);}return normalizeItems(items).then(flatten__default.default);}function toArray(v){return v===null?[]:[v];}function normalizeItems(items){return Promise.all(items.map(item=>{if(item.kind==="file"&&item.webkitGetAsEntry){let entry;try{entry=item.webkitGetAsEntry();}catch(err){return toArray(item.getAsFile());}if(!entry){return[];}return entry.isDirectory?walk(entry):toArray(item.getAsFile());}if(item.kind==="file"){const file=item.getAsFile();return Promise.resolve(file?[file]:[]);}if(item.kind==="string"){console.warn('DataTransfer with kind="string" is currently not supported');return Promise.resolve([]);}console.warn("Unknown DataTransferItem.kind: %s",item.kind);return Promise.resolve([]);}));}function walk(entry){if(entry.isFile){return new Promise((resolve,reject)=>entry.file(resolve,reject)).then(file=>[file]);}if(entry.isDirectory){const dir=entry.createReader();return new Promise((resolve,reject)=>dir.readEntries(resolve,reject)).then(entries=>entries.filter(entr=>!entr.name.startsWith("."))).then(entries=>Promise.all(entries.map(walk)).then(flatten__default.default));}return Promise.resolve([]);}function imageUrlToBlob(imageUrl){let format=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"image/jpeg";let quality=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;if(imageUrl.match(/^webkit-fake-url:\/\//)){return Promise.reject(new Error("Cannot read image contents from webkit fake url"));}return new Promise((resolve,reject)=>{const loader=new Image();loader.crossOrigin="anonymous";loader.referrerPolicy="strict-origin-when-cross-origin";loader.onload=()=>{const canvas=document.createElement("canvas");canvas.width=loader.width;canvas.height=loader.height;const ctx=canvas.getContext("2d");ctx==null?void 0:ctx.drawImage(loader,0,0,canvas.width,canvas.height);try{canvas.toBlob(resolve,format,quality);}catch(error){reject(error);}};loader.src=imageUrl;});}const PASTE_INPUT_STYLE={opacity:0,position:"absolute"};function fileTarget(Component){return React.forwardRef(function FileTarget(props,ref){const{onFiles,onFilesOver,onFilesOut,disabled,...rest}=props;const[showPasteInput,setShowPasteInput]=React.useState(false);const pasteInput=React.useRef(null);const forwardedRef=ui.useForwardedRef(ref);const enteredElements=React.useRef([]);const emitFiles=React.useCallback(files=>{onFiles==null?void 0:onFiles(files);},[onFiles]);const handleKeyDown=React.useCallback(event=>{if(event.target===forwardedRef.current&&(event.ctrlKey||event.metaKey)&&event.key==="v"){setShowPasteInput(true);}},[forwardedRef]);const handlePaste=React.useCallback(event=>{extractPastedFiles(event.clipboardData).then(files=>{if(!pasteInput.current){return[];}return files.length>0?files:// Invoke Safari hack if we didn't get any files
convertImagesToFilesAndClearContentEditable(pasteInput.current,"image/jpeg");}).then(files=>{var _a;emitFiles(files);setShowPasteInput(false);(_a=forwardedRef.current)==null?void 0:_a.focus();});},[emitFiles,forwardedRef]);const handleDrop=React.useCallback(event=>{enteredElements.current=[];event.preventDefault();event.stopPropagation();const dataTransfer=event.nativeEvent.dataTransfer;if(onFiles&&dataTransfer){extractDroppedFiles(dataTransfer).then(files=>{if(files){emitFiles(files);}});}onFilesOut==null?void 0:onFilesOut();},[emitFiles,onFiles,onFilesOut]);const handleDragOver=React.useCallback(event=>{if(onFiles){event.preventDefault();event.stopPropagation();}},[onFiles]);const handleDragEnter=React.useCallback(event=>{event.stopPropagation();if(onFilesOver&&forwardedRef.current===event.currentTarget){enteredElements.current=[...new Set(enteredElements.current),event.currentTarget];const fileTypes=Array.from(event.dataTransfer.items).map(item=>({type:item.type,kind:item.kind}));onFilesOver(fileTypes);}},[onFilesOver,forwardedRef]);const handleDragLeave=React.useCallback(event=>{event.stopPropagation();const idx=enteredElements.current.indexOf(event.currentTarget);if(idx>-1){enteredElements.current.splice(idx,1);}if(enteredElements.current.length===0){onFilesOut==null?void 0:onFilesOut();}},[onFilesOut]);const prevShowPasteInput=React.useRef(false);React.useEffect(()=>{var _a;if(!prevShowPasteInput.current&&showPasteInput&&pasteInput.current){pasteInput.current.focus();select(pasteInput.current);}else if(prevShowPasteInput.current&&!showPasteInput){(_a=pasteInput.current)==null?void 0:_a.focus();}prevShowPasteInput.current=showPasteInput;},[showPasteInput]);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(Component,{...rest,ref:forwardedRef,onKeyDown:disabled?void 0:handleKeyDown,onDragOver:disabled?void 0:handleDragOver,onDragEnter:disabled?void 0:handleDragEnter,onDragLeave:disabled?void 0:handleDragLeave,onDrop:disabled?void 0:handleDrop}),!disabled&&showPasteInput&&/* @__PURE__ */jsxRuntime.jsx("div",{contentEditable:true,onPaste:handlePaste,ref:pasteInput,style:PASTE_INPUT_STYLE})]});});}function convertImagesToFilesAndClearContentEditable(element){let targetFormat=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"image/jpeg";if(!element.isContentEditable){return Promise.reject(new Error('Expected element to be contentEditable="true". Instead found a non contenteditable '.concat(element.tagName)));}return new Promise(resolve=>setTimeout(resolve,10)).then(()=>Array.from(element.querySelectorAll("img"))).then(imageElements=>{element.innerHTML="";return imageElements;}).then(images=>Promise.all(images.map(img=>imageUrlToBlob(img.src)))).then(imageBlobs=>imageBlobs.map(blob=>new File([blob],"pasted-image.jpg",{type:targetFormat})));}function select(el){const range=document.createRange();range.selectNodeContents(el);const sel=window.getSelection();sel==null?void 0:sel.removeAllRanges();sel==null?void 0:sel.addRange(range);}function DropMessage(props){const{hoveringFiles,types,resolveUploader}=props;const acceptedFiles=hoveringFiles.filter(file=>types.some(type=>resolveUploader(type,file)));const rejectedFilesCount=hoveringFiles.length-acceptedFiles.length;const multiple=types.length>1;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:acceptedFiles.length>0?/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:/* @__PURE__ */jsxRuntime.jsx(icons.UploadIcon,{})}),multiple?t("inputs.files.common.drop-message.drop-to-upload-multi",{count:acceptedFiles.length}):t("inputs.files.common.drop-message.drop-to-upload"),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{})]}),rejectedFilesCount>0&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:4,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.AccessDeniedIcon,{})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:t("inputs.files.common.drop-message.drop-to-upload.rejected-file-message",{count:rejectedFilesCount})})]})})]}):/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:/* @__PURE__ */jsxRuntime.jsx(icons.AccessDeniedIcon,{})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:t("inputs.files.common.drop-message.drop-to-upload.no-accepted-file-message",{count:hoveringFiles.length})})]})});}var __freeze$1H=Object.freeze;var __defProp$1H=Object.defineProperty;var __template$1H=(cooked,raw)=>__freeze$1H(__defProp$1H(cooked,"raw",{value:__freeze$1H(raw||cooked.slice())}));var _a$1I;const Overlay$1=styled__default.default(ui.Layer)(_a$1I||(_a$1I=__template$1H(["\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  top: -2px;\n  left: -2px;\n  right: -2px;\n  bottom: -2px;\n  background-color: var(--card-bg-color);\n  opacity: 0.8;\n"])));var __freeze$1G=Object.freeze;var __defProp$1G=Object.defineProperty;var __template$1G=(cooked,raw)=>__freeze$1G(__defProp$1G(cooked,"raw",{value:__freeze$1G(raw||cooked.slice())}));var _a$1H;const Root$j=styled__default.default.div(_a$1H||(_a$1H=__template$1G(["\n  position: relative;\n"])));function getUploadCandidates(types,resolveUploader,file){return types.map(memberType=>({type:memberType,uploader:resolveUploader(memberType,file)})).filter(member=>member.uploader);}function uploadTarget(Component){const FileTarget=fileTarget(Component);return React.forwardRef(function UploadTarget(props,forwardedRef){const{children,resolveUploader,onUpload,types,...rest}=props;const{push:pushToast}=ui.useToast();const{t}=useTranslation();const uploadFile=React.useCallback((file,resolvedUploader)=>{const{type,uploader}=resolvedUploader;onUpload==null?void 0:onUpload({file,schemaType:type,uploader});},[onUpload]);const handleFiles=React.useCallback(files=>{if(!resolveUploader){return;}const tasks=files.map(file=>({file,uploaderCandidates:getUploadCandidates(types,resolveUploader,file)}));const ready=tasks.filter(task=>task.uploaderCandidates.length>0);const rejected=tasks.filter(task=>task.uploaderCandidates.length===0);if(rejected.length>0){pushToast({closable:true,status:"warning",title:t("inputs.array.error.cannot-upload-unable-to-convert",{count:rejected.length}),description:rejected.map((task,i)=>/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:2,padding:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{weight:"medium",children:task.file.name})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{size:1,children:["(",task.file.type,")"]})})]},i))});}ready.forEach(task=>{uploadFile(task.file,// eslint-disable-next-line max-nested-callbacks
sortBy__default.default(task.uploaderCandidates,candidate=>candidate.uploader.priority)[0]);});},[pushToast,resolveUploader,types,uploadFile,t]);const[hoveringFiles,setHoveringFiles]=React.useState([]);const handleFilesOut=React.useCallback(()=>setHoveringFiles([]),[]);return/* @__PURE__ */jsxRuntime.jsx(Root$j,{children:/* @__PURE__ */jsxRuntime.jsxs(FileTarget,{...rest,ref:forwardedRef,onFiles:handleFiles,onFilesOver:setHoveringFiles,onFilesOut:handleFilesOut,children:[resolveUploader&&hoveringFiles.length>0&&/* @__PURE__ */jsxRuntime.jsx(Overlay$1,{zOffset:10,children:/* @__PURE__ */jsxRuntime.jsx(DropMessage,{hoveringFiles,types,resolveUploader})}),children]})});});}const UploadTargetCard=withFocusRing(uploadTarget(ui.Card));const POPOVER_PROPS$2={constrainSize:true,portal:true,fallbackPlacements:["top","bottom"]};function ArrayOfObjectsFunctions(props){const{schemaType,readOnly,children,onValueCreate,onItemAppend}=props;const menuButtonId=React.useId();const{t}=useTranslation();const insertItem=React.useCallback(itemType=>{const item=onValueCreate(itemType);onItemAppend(item);},[onValueCreate,onItemAppend]);const handleAddBtnClick=React.useCallback(()=>{insertItem(schemaType.of[0]);},[schemaType,insertItem]);const addItemI18nKey=schemaType.of.length>1?"inputs.array.action.add-item-select-type":"inputs.array.action.add-item";if(readOnly){return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{portal:true,content:t("inputs.array.read-only-label"),children:/* @__PURE__ */jsxRuntime.jsx(ui.Grid,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.AddIcon,mode:"ghost",disabled:true,size:"large",text:t(addItemI18nKey)})})});}return/* @__PURE__ */jsxRuntime.jsxs(ui.Grid,{gap:1,style:{gridTemplateColumns:"repeat(auto-fit, minmax(100px, 1fr))"},children:[schemaType.of.length===1?/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.AddIcon,mode:"ghost",onClick:handleAddBtnClick,size:"large",text:t(addItemI18nKey)}):/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.AddIcon,mode:"ghost",size:"large",text:t(addItemI18nKey)}),id:menuButtonId||"",menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:schemaType.of.map((memberDef,i)=>{var _a,_b;const referenceIcon=types.isReferenceSchemaType(memberDef)&&(memberDef.to||[]).length===1&&memberDef.to[0].icon;const icon=memberDef.icon||((_a=memberDef.type)==null?void 0:_a.icon)||referenceIcon;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:memberDef.title||((_b=memberDef.type)==null?void 0:_b.name),onClick:()=>insertItem(memberDef),icon},i);})}),popover:POPOVER_PROPS$2}),children]});}var __freeze$1F=Object.freeze;var __defProp$1F=Object.defineProperty;var __template$1F=(cooked,raw)=>__freeze$1F(__defProp$1F(cooked,"raw",{value:__freeze$1F(raw||cooked.slice())}));var _a$1G,_b$M,_c$r,_d$g;const FooterFlex=styled__default.default(ui.Flex)(_a$1G||(_a$1G=__template$1F(["\n  min-height: 33px;\n"])));const PresenceFlex=styled__default.default(ui.Flex)(_b$M||(_b$M=__template$1F(["\n  position: absolute;\n  top: 0;\n  right: 0;\n  height: 33px;\n"])));const DragHandleCard=styled__default.default(ui.Card)(_c$r||(_c$r=__template$1F(["\n  position: absolute;\n  top: 0;\n  left: 0;\n"])));const Root$i=styled__default.default(ui.Card)(_d$g||(_d$g=__template$1F(["\n  transition: border-color 250ms;\n  box-sizing: border-box;\n  position: relative;\n\n  @media (hover: hover) {\n    "," {\n      opacity: 0;\n    }\n\n    &:hover,\n    &:focus-within {\n      "," {\n        opacity: 1;\n      }\n    }\n  }\n\n  ."," & {\n    box-shadow:\n      0 0 0 0,\n      0 8px 17px 2px var(--card-shadow-umbra-color),\n      0 3px 14px 2px var(--card-shadow-penumbra-color),\n      0 5px 5px -3px var(--card-shadow-ambient-color);\n  }\n\n  &[aria-selected='true'] {\n    box-shadow: 0 0 0 2px var(--card-focus-ring-color);\n  }\n"])),DragHandleCard,DragHandleCard,MOVING_ITEM_CLASS_NAME);function CellLayout(props){const{validation,selected,tone,presence,children,dragHandle,menu,footer,...rest}=props;return/* @__PURE__ */jsxRuntime.jsxs(Root$i,{forwardedAs:ui.Flex,direction:"column",border:true,selected,"aria-selected":selected,radius:1,tone,...rest,children:[children,dragHandle&&/* @__PURE__ */jsxRuntime.jsx(DragHandleCard,{margin:1,radius:2,display:"flex",tone:"inherit","data-ui":"DragHandleCard",children:/* @__PURE__ */jsxRuntime.jsx(DragHandle,{$grid:true,mode:"ghost"})}),presence&&/* @__PURE__ */jsxRuntime.jsx(PresenceFlex,{align:"center",marginX:1,children:presence}),/* @__PURE__ */jsxRuntime.jsxs(FooterFlex,{align:"center",paddingX:1,sizing:"border",justify:"space-between",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{children:validation}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:footer}),menu]})]});}var __freeze$1E=Object.freeze;var __defProp$1E=Object.defineProperty;var __template$1E=(cooked,raw)=>__freeze$1E(__defProp$1E(cooked,"raw",{value:__freeze$1E(raw||cooked.slice())}));var _a$1F;const PopoverCard$1=styled__default.default(ui.Card)(_a$1F||(_a$1F=__template$1E(["\n  max-width: ","px;\n"])),_ref135=>{let{theme}=_ref135;return theme.sanity.container[1];});function IncompatibleItemType$1(props){const{value,onFocus,vertical,...rest}=props;const[showDetails,setShowDetails]=React.useState(false);const[popoverRef,setPopoverRef]=React.useState(null);const{t}=useTranslation();ui.useClickOutside(()=>setShowDetails(false),[popoverRef]);const handleKeyDown=React.useCallback(e=>{if(e.key==="Escape"||e.key==="Tab"){setShowDetails(false);}},[]);const handleShowDetails=React.useCallback(()=>{setShowDetails(v=>!v);},[]);const typeName=content.resolveTypeName(value);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{open:showDetails,ref:setPopoverRef,onKeyDown:handleKeyDown,portal:true,constrainSize:true,tone:"default",content:/* @__PURE__ */jsxRuntime.jsx(PopoverCard$1,{margin:1,padding:3,onKeyDown:handleKeyDown,tabIndex:0,overflow:"auto",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{weight:"medium",children:t("inputs.array.error.type-is-incompatible-title")})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.array.error.current-schema-not-declare-description",values:{typeName}})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{size:1,children:[/* @__PURE__ */jsxRuntime.jsx(icons.BulbOutlineIcon,{})," ",t("inputs.array.error.can-delete-but-no-edit-description")]})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:t("inputs.array.error.json-representation-description")}),/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:2,overflow:"auto",border:true,children:/* @__PURE__ */jsxRuntime.jsx(ui.Code,{size:1,as:"pre",language:"json",children:JSON.stringify(value,null,2)})})]})]})}),children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{as:"button",type:"button",radius:2,tone:"inherit",paddingX:2,paddingY:3,style:{height:"100%"},onFocus,onClick:handleShowDetails,onKeyDown:handleKeyDown,__unstable_focusRing:true,...rest,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,marginTop:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{margin:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",size:4,children:/* @__PURE__ */jsxRuntime.jsx(icons.UnknownIcon,{})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.array.error.type-is-incompatible-prompt",values:{typeName}})})]})})});}const MENU_POPOVER_PROPS$9={portal:true,tone:"default"};function ErrorItem$1(props){const{member,sortable}=props;const id=React.useId();const{onChange}=useFormCallbacks();const{t}=useTranslation();const handleRemove=React.useCallback(()=>{onChange(PatchEvent.from([unset([{_key:member.key}])]));},[onChange,member.key]);return/* @__PURE__ */jsxRuntime.jsx(CellLayout,{dragHandle:sortable,tone:"caution",style:{height:"100%"},menu:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{paddingY:3}),id:"".concat(id,"-menuButton"),menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.array.action.remove-invalid-item"),tone:"critical",icon:icons.TrashIcon,onClick:handleRemove})}),popover:MENU_POPOVER_PROPS$9}),children:member.error.type==="INVALID_ITEM_TYPE"?/* @__PURE__ */jsxRuntime.jsx(IncompatibleItemType$1,{value:member.error.value,vertical:true}):/* @__PURE__ */jsxRuntime.jsx("div",{children:t("inputs.array.error.unexpected-error",{error:member.error.type})})});}function pathToString(){let path=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return path.reduce((target,segment,i)=>{const segmentType=typeof segment;if(segmentType==="number"){return"".concat(target,"[").concat(segment,"]");}if(segmentType==="string"){const separator=i===0?"":".";return"".concat(target).concat(separator).concat(segment);}if(types.isKeyedObject(segment)){return"".concat(target,'[_key=="').concat(segment._key,'"]');}throw new Error('Unsupported path segment "'.concat(segment,'"'));},"");}function isNonNullable$1(t){return t!==null||t!==void 0;}function convertToValidationMarker(validatorResult,level,context){if(!context){throw new Error("missing context");}if(validatorResult===true)return[];if(Array.isArray(validatorResult)){return validatorResult.flatMap(child=>convertToValidationMarker(child,level,context)).filter(isNonNullable$1);}if(typeof validatorResult==="string"){return convertToValidationMarker({message:validatorResult},level,context);}if(typeof validatorResult.message!=="string"){throw new Error("".concat(pathToString(context.path),": Validator must return 'true' if valid or an error message as a string on errors"));}const{message}=validatorResult;const normalizedPaths=[];if(validatorResult.path){normalizedPaths.push(validatorResult.path);}for(const path of validatorResult.paths||[]){normalizedPaths.push(path);}if(!normalizedPaths.length){return[{level:level||"error",item:{message},message,path:context.path||[]}];}return normalizedPaths.map(path=>({path:(context.path||[]).concat(path),level:level||"error",item:{message},message}));}function escapeRegex(string){return string.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&");}function localizeMessage(message,i18n){const{currentLocale}=i18n;const locale=currentLocale.id;if(message[locale]){return message[locale];}if(locale.includes("-")){const language=locale.split("-",1)[0];if(message[language]){return message[language];}}return message["en-US"]||message["en-GB"]||message.en||"Unknown validation error (not localized)";}function isLocalizedMessages(message){return message!==true&&typeof message!=="undefined"&&typeof message!=="string"&&isPlainObject__default.default(message)&&!("message"in message);}function deepEquals(a,b){if(a===b){return true;}if(Array.isArray(a)&&Array.isArray(b)){if(a.length!=b.length)return false;for(let i=0;i<a.length;i++){if(!deepEquals(a[i],b[i])){return false;}}return true;}if(Array.isArray(a)!=Array.isArray(b)){return false;}if(a&&b&&typeof a==="object"&&typeof b==="object"){const keys=Object.keys(a);if(keys.length!==Object.keys(b).length){return false;}if(a instanceof Date&&b instanceof Date){return a.getTime()===b.getTime();}if(a instanceof Date!=b instanceof Date){return false;}if(a instanceof RegExp&&b instanceof RegExp){return a.toString()==b.toString();}if(a instanceof RegExp!=b instanceof RegExp){return false;}for(let i=0;i<keys.length;i++){if(keys[i]==="_key"){continue;}if(!Object.prototype.hasOwnProperty.call(b,keys[i])){return false;}}for(let i=0;i<keys.length;i++){const key=keys[i];if(key==="_key"){continue;}if(!deepEquals(a[key],b[key])){return false;}}return true;}return false;}const _toString={}.toString;const builtIns=[Object,Function,Array,String,Boolean,Number,Date,RegExp,Error];function isBuiltIn(_constructor){for(let i=0;i<builtIns.length;i++){if(builtIns[i]===_constructor)return true;}return false;}function typeString(obj){const stringType=_toString.call(obj).slice(8,-1);if(obj===null||obj===void 0)return stringType.toLowerCase();const constructorType=obj.constructor;if(constructorType&&!isBuiltIn(constructorType))return constructorType.name;return stringType;}const SLOW_VALIDATOR_TIMEOUT=5e3;const formatValidationErrors=options=>{var _a;if(options.message)return options.message;if(options.results.length===1)return(_a=options.results[0])==null?void 0:_a.message;return options.i18n.t("{{messages, list}}",{messages:options.results.map(err=>{var _a2;return err.message||((_a2=err.item)==null?void 0:_a2.message);}),formatParams:{messages:{style:"long",type:options.operation}}});};const genericValidators={type:(expectedType,value,message,_ref136)=>{let{i18n}=_ref136;const actualType=typeString(value);if(actualType!==expectedType&&actualType!=="undefined"){return message||i18n.t("validation:generic.incorrect-type",{actualType,expectedType});}return true;},presence:(expected,value,message,_ref137)=>{let{i18n}=_ref137;if(value===void 0&&expected==="required"){return message||i18n.t("validation:generic.required");}return true;},all:async(children,value,message,context)=>{const resolved=await Promise.all(children.map(child=>child.validate(value,context)));const results=resolved.flat();if(results.length===0){return true;}return formatValidationErrors({message,results,operation:"conjunction",i18n:context.i18n});},either:async(children,value,message,context)=>{const resolved=await Promise.all(children.map(child=>child.validate(value,context)));const results=resolved.flat();if(resolved.find(result=>!result.length)){return true;}return formatValidationErrors({message,results,operation:"disjunction",i18n:context.i18n});},valid:(allowedValues,actual,message,_ref138)=>{let{i18n}=_ref138;const valueType=typeof actual;if(valueType==="undefined"){return true;}const value=(valueType==="number"||valueType==="string")&&"".concat(actual);const strValue=value&&value.length>30?"".concat(value.slice(0,30),"\u2026"):value;return allowedValues.some(expected=>deepEquals(expected,actual))?true:message||i18n.t("validation:generic.not-allowed",value?{context:"hint",replace:{hint:strValue}}:{});},custom:async(fn,value,message,context)=>{const slowTimer=setTimeout(()=>{if(context.environment!=="studio")return;console.warn("Custom validator at ".concat(pathToString(context.path)," has taken more than ").concat(SLOW_VALIDATOR_TIMEOUT,"ms to respond"));},SLOW_VALIDATOR_TIMEOUT);let result;try{result=await fn(value,context);}finally{clearTimeout(slowTimer);}if(isLocalizedMessages(result)){return localizeMessage(result,context.i18n);}if(typeof result==="string"){return message||result;}return result;}};const arrayValidators={...genericValidators,min:(minLength,value,message,_ref139)=>{let{i18n,type}=_ref139;if(!value||value.length>=minLength){return true;}const context=types.isArrayOfBlocksSchemaType(type)?"blocks":void 0;return message||i18n.t("validation:array.minimum-length",{minLength,context});},max:(maxLength,value,message,_ref140)=>{let{i18n,type}=_ref140;if(!value||value.length<=maxLength){return true;}const context=types.isArrayOfBlocksSchemaType(type)?"blocks":void 0;return message||i18n.t("validation:array.maximum-length",{maxLength,context});},length:(wantedLength,value,message,_ref141)=>{let{i18n,type}=_ref141;if(!value||value.length===wantedLength){return true;}const context=types.isArrayOfBlocksSchemaType(type)?"blocks":void 0;return message||i18n.t("validation:array.exact-length",{wantedLength,context});},presence:(flag,value,message,_ref142)=>{let{i18n}=_ref142;if(flag==="required"&&!value){return message||i18n.t("validation:generic.required",{context:"array"});}return true;},valid:(allowedValues,values,message,_ref143)=>{let{i18n}=_ref143;const valueType=typeof values;if(valueType==="undefined"){return true;}const paths=[];for(let i=0;i<values.length;i++){const value=values[i];if(allowedValues.some(expected=>deepEquals(expected,value))){continue;}const pathSegment=value&&value._key?{_key:value._key}:i;paths.push([pathSegment]);}const sharedMessage=message||i18n.t("validation:generic.not-allowed");return paths.map(path=>({message:sharedMessage,path}));},unique:(_unused,value,message,_ref144)=>{let{i18n}=_ref144;const dupeIndices=[];if(!value){return true;}for(let x=0;x<value.length;x++){for(let y=x+1;y<value.length;y++){const itemA=value[x];const itemB=value[y];if(!deepEquals(itemA,itemB)){continue;}if(dupeIndices.indexOf(x)===-1){dupeIndices.push(x);}if(dupeIndices.indexOf(y)===-1){dupeIndices.push(y);}}}const paths=dupeIndices.map(idx=>{const item=value[idx];const pathSegment=item&&item._key?{_key:item._key}:idx;return[pathSegment];});const sharedMessage=message||i18n.t("validation:array.item-duplicate");return paths.map(path=>({message:sharedMessage,path}));}};const booleanValidators={...genericValidators,presence:(flag,value,message,_ref145)=>{let{i18n}=_ref145;if(flag==="required"&&typeof value!=="boolean"){return message||i18n.t("validation:generic.required",{context:"boolean"});}return true;}};function isRecord$3(obj){return typeof obj==="object"&&obj!==null&&!Array.isArray(obj);}const isoDate=/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/;const getFormattedDate=function(){let type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";let value=arguments.length>1?arguments[1]:undefined;let options=arguments.length>2?arguments[2]:undefined;const dateFormat=(options==null?void 0:options.dateFormat)||legacyDateFormat__namespace.DEFAULT_DATE_FORMAT;const timeFormat=(options==null?void 0:options.timeFormat)||legacyDateFormat__namespace.DEFAULT_TIME_FORMAT;return legacyDateFormat__namespace.format(value,type==="date"?dateFormat:"".concat(dateFormat," ").concat(timeFormat),type==="date");};function parseDate(date){let throwOnError=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!date)return null;if(date==="now")return/* @__PURE__ */new Date();const parsed=new Date(date);const isInvalid=isNaN(parsed.getTime());if(isInvalid&&throwOnError){throw new Error('Unable to parse "'.concat(date,'" to a date'));}return isInvalid?null:parsed;}const dateValidators={...genericValidators,type:(_unused,value,message,_ref146)=>{let{i18n}=_ref146;if(typeof value==="undefined"||isoDate.test("".concat(value))){return true;}return message||i18n.t("validation:date.invalid-format");},min:(minDate,value,message,_ref147)=>{let{type,i18n}=_ref147;const dateVal=parseDate(value);const minDateVal=parseDate(minDate,true);if(!dateVal){return true;}if(!value||dateVal>=minDateVal){return true;}if(!type){throw new Error("`type` was not provided in validation context.");}const dateTimeOptions=isRecord$3(type.options)?type.options:{};return message||// Note that the `minDate` passed here is _formatted_, while the raw value provided to the
// validator is available as `providedMinDate`. This because the formatted date is likely
// what the developer wants to present to the user
i18n.t("validation:date.minimum",{minDate:getFormattedDate(type.name,minDateVal,dateTimeOptions),providedMinDate:minDate});},max:(maxDate,value,message,_ref148)=>{let{type,i18n}=_ref148;const dateVal=parseDate(value);const maxDateVal=parseDate(maxDate,true);if(!dateVal){return true;}if(!value||dateVal<=maxDateVal){return true;}if(!type){throw new Error("`type` was not provided in validation context.");}const dateTimeOptions=isRecord$3(type.options)?type.options:{};return message||// Note that the `maxDate` passed here is _formatted_, while the raw value provided to the
// validator is available as `providedMaxDate`. This because the formatted date is likely
// what the developer wants to present to the user
i18n.t("validation:date.maximum",{maxDate:getFormattedDate(type.name,maxDateVal,dateTimeOptions),providedMaxDate:maxDate});}};const precisionRx=/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/;const numberValidators={...genericValidators,integer:(_unused,value,message,_ref149)=>{let{i18n}=_ref149;if(!Number.isInteger(value)){return message||i18n.t("validation:number.non-integer");}return true;},precision:(limit,value,message,_ref150)=>{let{i18n}=_ref150;if(value===void 0)return true;const places=value.toString().match(precisionRx);const decimals=Math.max((places[1]?places[1].length:0)-(places[2]?parseInt(places[2],10):0),0);if(decimals>limit){return message||i18n.t("validation:number.maximum-precision",{limit});}return true;},min:(minNumber,value,message,_ref151)=>{let{i18n}=_ref151;if(value>=minNumber){return true;}return message||i18n.t("validation:number.minimum",{minNumber});},max:(maxNumber,value,message,_ref152)=>{let{i18n}=_ref152;if(value<=maxNumber){return true;}return message||i18n.t("validation:number.maximum",{maxNumber});},greaterThan:(threshold,value,message,_ref153)=>{let{i18n}=_ref153;if(value>threshold){return true;}return message||i18n.t("validation:number.greater-than",{threshold});},lessThan:(threshold,value,message,_ref154)=>{let{i18n}=_ref154;if(value<threshold){return true;}return message||i18n.t("validation:number.less-than",{threshold});}};const metaKeys=["_key","_type","_weak"];const objectValidators={...genericValidators,presence:(expected,value,message,_ref155)=>{let{i18n}=_ref155;if(expected!=="required"){return true;}const keys=value&&Object.keys(value).filter(key=>!metaKeys.includes(key));if(value===void 0||keys&&keys.length===0){return message||i18n.t("validation:generic.required",{context:"object"});}return true;},reference:async(_unused,value,message,context)=>{if(!value){return true;}const{type,getDocumentExists,i18n}=context;if(!types.isReference(value)){return message||i18n.t("validation:object.not-reference");}if(!type){throw new Error("`type` was not provided in validation context");}if("weak"in type&&type.weak){return true;}if(!getDocumentExists){throw new Error("`getDocumentExists` was not provided in validation context");}const exists=await getDocumentExists({id:value._ref});if(!exists){return i18n.t("validation:object.reference-not-published",{documentId:value._ref});}return true;},assetRequired:(flag,value,message,_ref156)=>{let{i18n}=_ref156;if(!value||!value.asset||!value.asset._ref){return message||i18n.t("validation:object.asset-required",{context:flag.assetType||""});}return true;}};const DUMMY_ORIGIN="http://sanity";const isRelativeUrl=url=>/^\.*\//.test(url);const emailRegex=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;const stringValidators={...genericValidators,min:(minLength,value,message,_ref157)=>{let{i18n}=_ref157;if(!value||value.length>=minLength){return true;}return message||i18n.t("validation:string.minimum-length",{minLength});},max:(maxLength,value,message,_ref158)=>{let{i18n}=_ref158;if(!value||value.length<=maxLength){return true;}return message||i18n.t("validation:string.maximum-length",{maxLength});},length:(wantedLength,value,message,_ref159)=>{let{i18n}=_ref159;const strValue=value||"";if(strValue.length===wantedLength){return true;}return message||i18n.t("validation:string.exact-length",{wantedLength});},uri:(constraints,value,message,_ref160)=>{let{i18n}=_ref160;const strValue=value||"";if(!strValue){return true;}const{options}=constraints;const{allowCredentials,relativeOnly}=options;const allowRelative=options.allowRelative||relativeOnly;let url;try{url=allowRelative?new URL(strValue,DUMMY_ORIGIN):new URL(strValue);}catch(err){return message||i18n.t("validation:string.url.invalid");}if(relativeOnly&&url.origin!==DUMMY_ORIGIN){return message||i18n.t("validation:string.url.not-relative");}if(!allowRelative&&url.origin===DUMMY_ORIGIN&&isRelativeUrl(strValue)){return message||i18n.t("validation:string.url.not-absolute");}if(!allowCredentials&&(url.username||url.password)){return message||i18n.t("validation:string.url.includes-credentials");}const urlScheme=url.protocol.replace(/:$/,"");const matchesAllowedScheme=options.scheme.some(scheme=>scheme.test(urlScheme));if(!matchesAllowedScheme){return message||i18n.t("validation:string.url.disallowed-scheme",{scheme:urlScheme});}return true;},stringCasing:(casing,value,message,_ref161)=>{let{i18n}=_ref161;const strValue=value||"";if(casing==="uppercase"&&strValue!==strValue.toLocaleUpperCase()){return message||i18n.t("validation:string.uppercase");}if(casing==="lowercase"&&strValue!==strValue.toLocaleLowerCase()){return message||i18n.t("validation:string.lowercase");}return true;},presence:(flag,value,message,_ref162)=>{let{i18n}=_ref162;if(flag==="required"&&!value){return message||i18n.t("validation:generic.required",{context:"string"});}return true;},regex:(options,value,message,_ref163)=>{let{i18n}=_ref163;const{pattern,name,invert}=options;const regName=name||"".concat(pattern.toString());const strValue=value||"";pattern.lastIndex=0;const matches=pattern.test(strValue);if(!invert&&!matches||invert&&matches){if(message){return message;}return invert?i18n.t("validation:string.regex-match",{name:regName}):i18n.t("validation:string.regex-does-not-match",{name:regName});}return true;},email:(_unused,value,message,_ref164)=>{let{i18n}=_ref164;const strValue="".concat(value||"").trim();if(!strValue||emailRegex.test(strValue)){return true;}return message||i18n.t("validation:string.email");}};var _a$1E;const typeValidators={Boolean:booleanValidators,Number:numberValidators,String:stringValidators,Array:arrayValidators,Object:objectValidators,Date:dateValidators};const getBaseType=type=>{return type&&type.type?getBaseType(type.type):type;};const isFieldRef=constraint=>{if(typeof constraint!=="object"||!constraint)return false;return constraint.type===Rule.FIELD_REF;};const EMPTY_ARRAY$2=[];const FIELD_REF=Symbol("FIELD_REF");const ruleConstraintTypes$1=["Array","Boolean","Date","Number","Object","String"];const Rule=(_a$1E=class{constructor(typeDef){this._type=void 0;this._level=void 0;this._required=void 0;this._typeDef=void 0;this._message=void 0;this._rules=[];this._fieldRules=void 0;// Alias to static method, since we often have access to an _instance_ of a rule but not the actual Rule class
this.valueOfField=_a$1E.valueOfField.bind(_a$1E);this._typeDef=typeDef;this.reset();}_mergeRequired(next){if(this._required==="required"||next._required==="required")return"required";if(this._required==="optional"||next._required==="optional")return"optional";return void 0;}error(message){const rule=this.clone();rule._level="error";rule._message=message||void 0;return rule;}warning(message){const rule=this.clone();rule._level="warning";rule._message=message||void 0;return rule;}info(message){const rule=this.clone();rule._level="info";rule._message=message||void 0;return rule;}reset(){this._type=this._type||void 0;this._rules=(this._rules||[]).filter(rule=>rule.flag==="type");this._message=void 0;this._required=void 0;this._level="error";this._fieldRules=void 0;return this;}isRequired(){return this._required==="required";}clone(){const rule=new _a$1E();rule._type=this._type;rule._message=this._message;rule._required=this._required;rule._rules=cloneDeep__default.default(this._rules);rule._level=this._level;rule._fieldRules=this._fieldRules;rule._typeDef=this._typeDef;return rule;}cloneWithRules(rules){const rule=this.clone();const newRules=/* @__PURE__ */new Set();rules.forEach(curr=>{if(curr.flag==="type"){rule._type=curr.constraint;}newRules.add(curr.flag);});rule._rules=rule._rules.filter(curr=>{const disallowDuplicate=["type","uri","email"].includes(curr.flag);const isDuplicate=newRules.has(curr.flag);return!(disallowDuplicate&&isDuplicate);}).concat(rules);return rule;}merge(rule){if(this._type&&rule._type&&this._type!==rule._type){throw new Error("merge() failed: conflicting types");}const newRule=this.cloneWithRules(rule._rules);newRule._type=this._type||rule._type;newRule._message=this._message||rule._message;newRule._required=this._mergeRequired(rule);newRule._level=this._level==="error"?rule._level:this._level;return newRule;}// Validation flag setters
type(targetType){const type="".concat(targetType.slice(0,1).toUpperCase()).concat(targetType.slice(1));if(!ruleConstraintTypes$1.includes(type)){throw new Error('Unknown type "'.concat(targetType,'"'));}const rule=this.cloneWithRules([{flag:"type",constraint:type}]);rule._type=type;return rule;}all(children){return this.cloneWithRules([{flag:"all",constraint:children}]);}either(children){return this.cloneWithRules([{flag:"either",constraint:children}]);}// Shared rules
optional(){const rule=this.cloneWithRules([{flag:"presence",constraint:"optional"}]);rule._required="optional";return rule;}required(){const rule=this.cloneWithRules([{flag:"presence",constraint:"required"}]);rule._required="required";return rule;}custom(fn){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(options.bypassConcurrencyLimit){Object.assign(fn,{bypassConcurrencyLimit:true});}return this.cloneWithRules([{flag:"custom",constraint:fn}]);}min(len){return this.cloneWithRules([{flag:"min",constraint:len}]);}max(len){return this.cloneWithRules([{flag:"max",constraint:len}]);}length(len){return this.cloneWithRules([{flag:"length",constraint:len}]);}valid(value){const values=Array.isArray(value)?value:[value];return this.cloneWithRules([{flag:"valid",constraint:values}]);}// Numbers only
integer(){return this.cloneWithRules([{flag:"integer"}]);}precision(limit){return this.cloneWithRules([{flag:"precision",constraint:limit}]);}positive(){return this.cloneWithRules([{flag:"min",constraint:0}]);}negative(){return this.cloneWithRules([{flag:"lessThan",constraint:0}]);}greaterThan(num){return this.cloneWithRules([{flag:"greaterThan",constraint:num}]);}lessThan(num){return this.cloneWithRules([{flag:"lessThan",constraint:num}]);}// String only
uppercase(){return this.cloneWithRules([{flag:"stringCasing",constraint:"uppercase"}]);}lowercase(){return this.cloneWithRules([{flag:"stringCasing",constraint:"lowercase"}]);}regex(pattern,a,b){var _a2,_b;const name=typeof a==="string"?a:(_a2=a==null?void 0:a.name)!=null?_a2:b==null?void 0:b.name;const invert=typeof a==="string"?false:(_b=a==null?void 0:a.invert)!=null?_b:b==null?void 0:b.invert;const constraint={pattern,name,invert:invert||false};return this.cloneWithRules([{flag:"regex",constraint}]);}email(){return this.cloneWithRules([{flag:"email"}]);}uri(opts){const optsScheme=(opts==null?void 0:opts.scheme)||["http","https"];const schemes=Array.isArray(optsScheme)?optsScheme:[optsScheme];if(!schemes.length){throw new Error("scheme must have at least 1 scheme specified");}const constraint={options:{scheme:schemes.map(scheme=>{if(!(scheme instanceof RegExp)&&typeof scheme!=="string"){throw new Error("scheme must be a RegExp or a String");}return typeof scheme==="string"?new RegExp("^".concat(escapeRegex(scheme),"$")):scheme;}),allowRelative:(opts==null?void 0:opts.allowRelative)||false,relativeOnly:(opts==null?void 0:opts.relativeOnly)||false,allowCredentials:(opts==null?void 0:opts.allowCredentials)||false}};return this.cloneWithRules([{flag:"uri",constraint}]);}// Array only
unique(){return this.cloneWithRules([{flag:"unique"}]);}// Objects only
reference(){return this.cloneWithRules([{flag:"reference"}]);}fields(rules){if(this._type!=="Object"){throw new Error("fields() can only be called on an object type");}const rule=this.cloneWithRules([]);rule._fieldRules=rules;return rule;}assetRequired(){const base=getBaseType(this._typeDef);let assetType;if(base&&["image","file"].includes(base.name)){assetType=base.name==="image"?"image":"file";}else{assetType="asset";}return this.cloneWithRules([{flag:"assetRequired",constraint:{assetType}}]);}async validate(value,_ref165){let{__internal={},...context}=_ref165;const{customValidationConcurrencyLimiter}=__internal;const valueIsEmpty=value===null||value===void 0;if(valueIsEmpty&&this._required==="optional"){return EMPTY_ARRAY$2;}const rules=// Run only the _custom_ functions if the rule is not set to required or optional
this._required===void 0&&valueIsEmpty?this._rules.filter(curr=>curr.flag==="custom"):this._rules;const validators=this._type&&typeValidators[this._type]||genericValidators;const results=await Promise.all(rules.map(async curr=>{if(curr.flag===void 0){throw new Error('Invalid rule, did not contain "flag"-property');}const validator=validators[curr.flag];if(!validator){const forType=this._type?'type "'.concat(this._type,'"'):"rule without declared type";throw new Error('Validator for flag "'.concat(curr.flag,'" not found for ').concat(forType));}let specConstraint="constraint"in curr?curr.constraint:null;if(isFieldRef(specConstraint)){specConstraint=get__default.default(context.parent,specConstraint.path);}if(curr.flag==="custom"&&customValidationConcurrencyLimiter&&!(specConstraint==null?void 0:specConstraint.bypassConcurrencyLimit)){const customValidator=specConstraint;specConstraint=async function(){await customValidationConcurrencyLimiter.ready();try{return await customValidator(...arguments);}finally{customValidationConcurrencyLimiter.release();}};}const message=isLocalizedMessages(this._message)?localizeMessage(this._message,context.i18n):this._message;try{const result=await validator(specConstraint,value,message,context);return convertToValidationMarker(result,this._level,context);}catch(err){const errorMessage="".concat(pathToString(context.path),": Exception occurred while validating value: ").concat(err.message);return convertToValidationMarker({message:errorMessage},"error",context);}}));return results.flat();}},_a$1E.FIELD_REF=FIELD_REF,_a$1E.array=def=>new _a$1E(def).type("Array"),_a$1E.object=def=>new _a$1E(def).type("Object"),_a$1E.string=def=>new _a$1E(def).type("String"),_a$1E.number=def=>new _a$1E(def).type("Number"),_a$1E.boolean=def=>new _a$1E(def).type("Boolean"),_a$1E.dateTime=def=>new _a$1E(def).type("Date"),_a$1E.valueOfField=path=>({type:FIELD_REF,path}),_a$1E);const memoizedWarnOnArraySlug=memoize__default.default(warnOnArraySlug);function getDocumentIds(id){const isDraft=id.indexOf("drafts.")===0;return{published:isDraft?id.slice("drafts.".length):id,draft:isDraft?id:"drafts.".concat(id)};}function serializePath(path){return path.reduce((target,part,i)=>{const isIndex=typeof part==="number";const isKey=types.isKeyedObject(part);const separator=i===0?"":".";const add=isIndex||isKey?"[]":"".concat(separator).concat(part);return"".concat(target).concat(add);},"");}const defaultIsUnique=(slug,context)=>{const{getClient,document,path,type}=context;const schemaOptions=type==null?void 0:type.options;if(!document){throw new Error("`document` was not provided in validation context.");}if(!path){throw new Error("`path` was not provided in validation context.");}const disableArrayWarning=(schemaOptions==null?void 0:schemaOptions.disableArrayWarning)||false;const{published,draft}=getDocumentIds(document._id);const docType=document._type;const atPath=serializePath(path.concat("current"));if(!disableArrayWarning&&atPath.includes("[]")&&context.environment==="studio"){memoizedWarnOnArraySlug(serializePath(path));}const constraints=["_type == $docType","!(_id in [$draft, $published])","".concat(atPath," == $slug")].join(" && ");return getClient({apiVersion:"2023-11-13"}).fetch("!defined(*[".concat(constraints,"][0]._id)"),{docType,draft,published,slug},{tag:"validation.slug-is-unique"});};function warnOnArraySlug(serializedPath){console.warn(["Slug field at path ".concat(serializedPath," is within an array and cannot be automatically checked for uniqueness"),'If you need to check for uniqueness, provide your own "isUnique" method',"To disable this message, set `disableArrayWarning: true` on the slug `options` field"].join("\n"));}const slugValidator=async(value,context)=>{var _a;if(!value){return true;}const{i18n}=context;if(typeof value!=="object"||Array.isArray(value)){return i18n.t("validation:slug.not-object");}if(!types.isSlug(value)||value.current.trim().length===0){return i18n.t("validation:slug.missing-current");}const options=(_a=context==null?void 0:context.type)==null?void 0:_a.options;const isUnique=(options==null?void 0:options.isUnique)||defaultIsUnique;const slugContext={...context,parent:context.parent,type:context.type,defaultIsUnique};const wasUnique=await isUnique(value.current,slugContext);if(wasUnique){return true;}return i18n.t("validation:slug.not-unique",{slug:value.current});};const ruleConstraintTypes={array:true,boolean:true,date:true,number:true,object:true,string:true};const isRuleConstraint=typeString=>typeString in ruleConstraintTypes;function getTypeChain(type){let visited=arguments.length>1&&arguments[1]!==undefined?arguments[1]:/* @__PURE__ */new Set();if(!type)return[];if(visited.has(type))return[];visited.add(type);const next=type.type?getTypeChain(type.type,visited):[];return[...next,type];}function baseRuleReducer(inputRule,type){let baseRule=inputRule;if(isRuleConstraint(type.jsonType)){baseRule=baseRule.type(type.jsonType);}const typeOptionsList=// if type.options is truthy
(type==null?void 0:type.options)&&// and type.options is an object (non-null from the previous)
typeof type.options==="object"&&// and if `list` is in options
"list"in type.options&&// then finally access the list
type.options.list;if(Array.isArray(typeOptionsList)){baseRule=baseRule.valid(typeOptionsList.map(option=>extractValueFromListOption(option,type)));}if(type.name==="datetime")return baseRule.type("Date");if(type.name==="date")return baseRule.type("Date");if(type.name==="url")return baseRule.uri();if(type.name==="slug")return baseRule.custom(slugValidator,{bypassConcurrencyLimit:true});if(type.name==="reference")return baseRule.reference();if(type.name==="email")return baseRule.email();return baseRule;}function hasValueField(typeDef){if(!typeDef)return false;if(!("fields"in typeDef)&&typeDef.type)return hasValueField(typeDef.type);if(!("fields"in typeDef))return false;if(!Array.isArray(typeDef.fields))return false;return typeDef.fields.some(field=>field.name==="value");}function extractValueFromListOption(option,typeDef){if(typeDef.jsonType==="object"&&hasValueField(typeDef))return option;return option.value===void 0?option:option.value;}function normalizeValidationRules(typeDef){if(!typeDef){return[];}const validation=typeDef.validation;if(Array.isArray(validation)){return validation.flatMap(i=>normalizeValidationRules({...typeDef,validation:i}));}if(validation&&typeof validation==="object"){return[validation];}const baseRule=// using an object + Object.values to de-dupe the type chain by type name
Object.values(getTypeChain(typeDef).reduce((acc,type)=>{acc[type.name]=type;return acc;},{})).reduce(baseRuleReducer,new Rule(typeDef));if(!validation){return[baseRule];}return normalizeValidationRules({...typeDef,validation:validation(baseRule)});}function inferFromSchemaType(typeDef){traverse(typeDef,/* @__PURE__ */new Set());return typeDef;}function traverse(typeDef,visited){if(visited.has(typeDef)){return;}visited.add(typeDef);typeDef.validation=normalizeValidationRules(typeDef);if("fields"in typeDef){for(const field of typeDef.fields){traverse(field.type,visited);}}if("of"in typeDef){for(const candidate of typeDef.of){traverse(candidate,visited);}}if(typeDef.annotations){for(const annotation of typeDef.annotations){traverse(annotation,visited);}}}function inferFromSchema(schema){const typeNames=schema.getTypeNames();typeNames.forEach(typeName=>{const schemaType=schema.get(typeName);if(schemaType){inferFromSchemaType(schemaType);}});return schema;}const shouldEscape=typeof window==="undefined"||typeof document==="undefined";const fallbackLocales=[defaultLocale];const getFallbackLocaleSource=memoize__default.default(function getFallbackLocaleSource2(){const i18n=getFallbackI18nInstance();i18n.init();return{currentLocale:defaultLocale,locales:fallbackLocales,loadNamespaces:i18n.loadNamespaces,t:i18n.t};});function getFallbackI18nInstance(){var _a;const staticResources={[defaultLocale.id]:{}};const staticBundles=((_a=usEnglishLocale.bundles)==null?void 0:_a.filter(isStaticResourceBundle))||[];const namespaces=/* @__PURE__ */new Set();for(const bundle of staticBundles){staticResources[defaultLocale.id][bundle.namespace]=bundle.resources;namespaces.add(bundle.namespace);}return i18next.createInstance({ns:Array.from(namespaces),defaultNS:studioLocaleNamespace,initImmediate:true,partialBundledLanguages:true,fallbackLng:defaultLocale.id,lng:defaultLocale.id,supportedLngs:[defaultLocale.id],debug:false,load:"currentOnly",resources:staticResources,interpolation:{// If we're in a browser, assume this is running inside of the studio, eg a React app,
// and that values returned will be escaped by the framework (eg React) automatically.
escapeValue:shouldEscape}});}const BUFFER_TIME=250;const MAX_BUFFER_SIZE=100;const MAX_REQUEST_CONCURRENCY=1;function createBatchedGetDocumentExists(client){const id$=new rxjs.Subject();const limiter=new concurrencyLimiter.ConcurrencyLimiter(MAX_REQUEST_CONCURRENCY);const existence$=id$.pipe(rxjs.bufferTime(BUFFER_TIME,null,MAX_BUFFER_SIZE),rxjs.map(ids=>Array.from(new Set(ids))),rxjs.mergeMap(ids=>rxjs.from(limiter.ready()).pipe(rxjs.switchMap(()=>client.observable.request({uri:client.getDataUrl("doc",ids.join(",")),json:true,query:{excludeContent:"true"},tag:"documents-availability"}).pipe(rxjs.map(availability=>({availability,ids})))),rxjs.finalize(limiter.release))),rxjs.mergeMap(_ref166=>{let{availability,ids}=_ref166;return ids.map(id=>{const omittedIds=availability.omitted.reduce((acc,next)=>{acc[next.id]=next.reason;return acc;},{});if(!omittedIds[id])return{id,exists:true};if(omittedIds[id]==="existence")return{id,exists:false};return{id,exists:true};});}),rxjs.share());return async function getDocumentExists(options){const result=rxjs.firstValueFrom(existence$.pipe(rxjs.filter(_ref167=>{let{id}=_ref167;return id===options.id;})));id$.next(options.id);const{exists}=await result;return exists;};}const requestIdleCallbackShim=function requestIdleCallbackShim2(callback,options){const start=Date.now();return window.setTimeout(()=>{callback({didTimeout:false,timeRemaining(){return Math.max(0,Date.now()-start);}});},0);};const cancelIdleCallbackShim=function cancelIdleCallbackShim2(handle){return window.clearTimeout(handle);};const win=typeof window==="undefined"?void 0:window;const requestIdleCallback=(win==null?void 0:win.requestIdleCallback)||requestIdleCallbackShim;const cancelIdleCallback=(win==null?void 0:win.cancelIdleCallback)||cancelIdleCallbackShim;const unknownFieldsValidator=type=>value=>{var _a;if(typeof value!=="object")return true;if(!value)return true;const fieldNames=new Set((_a=type.fields)==null?void 0:_a.map(field=>field.name));const unknownFields=Object.keys(value).filter(key=>!key.startsWith("_")).filter(key=>!fieldNames.has(key));return unknownFields.map(unknownField=>({message:"Field '".concat(unknownField,"' does not exist on type '").concat(type.name,"'"),path:[unknownField]}));};const MAX_FETCH_CONCURRENCY=10;const limitConcurrency=client$1.createClientConcurrencyLimiter(MAX_FETCH_CONCURRENCY);const isRecord$2=maybeRecord=>typeof maybeRecord==="object"&&maybeRecord!==null&&!Array.isArray(maybeRecord);const isNonNullable=value=>value!==null&&value!==void 0;function resolveTypeForArrayItem(item,candidates){if(candidates.length===1)return candidates[0];const itemType=types.isTypedObject(item)&&item._type;const primitive=item===void 0||item===null||!itemType&&typeString(item).toLowerCase();if(primitive&&primitive!=="object"){return candidates.find(candidate=>candidate.jsonType===primitive);}return candidates.find(candidate=>{var _a;return((_a=candidate.type)==null?void 0:_a.name)===itemType;})||candidates.find(candidate=>candidate.name===itemType)||candidates.find(candidate=>candidate.name==="object"&&primitive==="object");}function validateDocument(_ref168){let{document,workspace,environment="studio",...options}=_ref168;const getClient=options.getClient||workspace.getClient;const getConcurrencyLimitedClient=clientOptions=>limitConcurrency(getClient(clientOptions));return rxjs.lastValueFrom(validateDocumentObservable({document,getClient:getConcurrencyLimitedClient,i18n:workspace.i18n,schema:workspace.schema,getDocumentExists:options.getDocumentExists||createBatchedGetDocumentExists(getClient({apiVersion:"v2021-03-25"})),environment}));}const customValidationConcurrencyLimiters=/* @__PURE__ */new WeakMap();function validateDocumentObservable(_ref169){let{document,getClient,i18n=getFallbackLocaleSource(),schema,getDocumentExists,environment,maxCustomValidationConcurrency}=_ref169;if(typeof(document==null?void 0:document._type)!=="string"){throw new Error("Tried to validated a value without a '_type'");}const documentType=schema.get(document._type);if(!documentType){if(environment==="studio"){console.warn('Schema type for object type "%s" not found, skipping validation',document._type);return rxjs.of([]);}return rxjs.of([{level:"warning",message:"Could not find schema type for type '".concat(document._type,"', skipping validation"),path:[]}]);}let customValidationConcurrencyLimiter=customValidationConcurrencyLimiters.get(schema);if(!customValidationConcurrencyLimiter&&maxCustomValidationConcurrency){customValidationConcurrencyLimiter=new concurrencyLimiter.ConcurrencyLimiter(maxCustomValidationConcurrency);customValidationConcurrencyLimiters.set(schema,customValidationConcurrencyLimiter);}const validationOptions={getClient,schema,parent:void 0,value:document,path:[],document,type:documentType,i18n,getDocumentExists,environment,customValidationConcurrencyLimiter};return rxjs.from(i18n.loadNamespaces(["validation"])).pipe(operators.switchMap(()=>validateItemObservable(validationOptions)),operators.catchError(err=>{console.error(err);const message=(err==null?void 0:err.message)||"Unknown error";const errorMarker={level:"error",message,item:{message},path:[]};return rxjs.of([errorMarker]);}));}function validateItemObservable(_ref170){let{value,type,path=[],parent,customValidationConcurrencyLimiter,environment,...restOfContext}=_ref170;const addUnknownFieldsValidator=rule=>{if(// if the schema type is an object type
(type==null?void 0:type.jsonType)==="object"&&// and if somewhere in it's type chain, it inherits from object or document
getTypeChain(type).find(t=>["object","document","file","image"].includes(t.name))&&// and the environment is not the studio
environment!=="studio"){return rule.custom(unknownFieldsValidator(type),{bypassConcurrencyLimit:true}).warning();}return rule;};const rules=normalizeValidationRules(type);const selfChecks=rules.map(addUnknownFieldsValidator).map(rule=>rxjs.defer(()=>rule.validate(value,{...restOfContext,environment,parent,path,type,__internal:{customValidationConcurrencyLimiter}})));let nestedChecks=[];const selfIsRequired=rules.some(rule=>rule.isRequired());const shouldRunNestedObjectValidation=// run nested validation for objects
(type==null?void 0:type.jsonType)==="object"&&(// if the value is truthy
!!value||// or
// (the value is null or undefined) and the top-level value is required
(value===null||value===void 0)&&selfIsRequired);if(shouldRunNestedObjectValidation){const fieldTypes=type.fields.reduce((acc,field)=>{acc[field.name]=field.type;return acc;},{});nestedChecks=nestedChecks.concat(rules.map(rule=>rule._fieldRules).filter(isNonNullable).flatMap(fieldResults=>Object.entries(fieldResults)).flatMap(_ref171=>{let[name,validation]=_ref171;const fieldType=fieldTypes[name];return normalizeValidationRules({...fieldType,validation}).map(addUnknownFieldsValidator).map(subRule=>{const nestedValue=isRecord$2(value)?value[name]:void 0;return rxjs.defer(()=>subRule.validate(nestedValue,{...restOfContext,parent:value,path:path.concat(name),type:fieldType,environment,__internal:{customValidationConcurrencyLimiter}}));});}));nestedChecks=nestedChecks.concat(type.fields.map(field=>validateItemObservable({...restOfContext,parent:value,value:isRecord$2(value)?value[field.name]:void 0,path:path.concat(field.name),type:field.type,environment,customValidationConcurrencyLimiter})));}const shouldRunNestedValidationForArrays=(type==null?void 0:type.jsonType)==="array"&&Array.isArray(value);if(shouldRunNestedValidationForArrays){nestedChecks=nestedChecks.concat(value.map((item,index)=>validateItemObservable({...restOfContext,parent:value,value:item,path:path.concat(types.isKeyedObject(item)?{_key:item._key}:index),type:resolveTypeForArrayItem(item,type.of),environment,customValidationConcurrencyLimiter})));}return rxjs.defer(()=>rxjs.merge([...selfChecks,...nestedChecks])).pipe(operators.mergeMap(validateNode=>rxjs.concat(idle(),validateNode),40),operators.mergeAll(),operators.toArray(),operators.map(flatten__default.default),operators.map(results=>{if(rules.some(rule=>rule._fieldRules)){return uniqBy__default.default(results,rule=>JSON.stringify(rule));}return results;}));}function idle(timeout){return new rxjs.Observable(observer=>{const handle=requestIdleCallback(()=>{observer.complete();},timeout?{timeout}:void 0);return()=>cancelIdleCallback(handle);});}var assetSourceData={name:"sanity.assetSourceData",title:"Asset Source Data",type:"object",fields:[{name:"name",title:"Source name",description:"A canonical name for the source this asset is originating from",type:"string"},{name:"id",title:"Asset Source ID",description:"The unique ID for the asset within the originating source so you can programatically find back to it",type:"string"},{name:"url",title:"Asset information URL",description:"A URL to find more information about this asset in the originating source",type:"string"}]};var fileAsset={name:"sanity.fileAsset",title:"File",type:"document",fieldsets:[{name:"system",title:"System fields",description:"These fields are managed by the system and not editable"}],fields:[{name:"originalFilename",type:"string",title:"Original file name",readOnly:true},{name:"label",type:"string",title:"Label"},{name:"title",type:"string",title:"Title"},{name:"description",type:"string",title:"Description"},{name:"altText",type:"string",title:"Alternative text"},{name:"sha1hash",type:"string",title:"SHA1 hash",readOnly:true,fieldset:"system"},{name:"extension",type:"string",title:"File extension",readOnly:true,fieldset:"system"},{name:"mimeType",type:"string",title:"Mime type",readOnly:true,fieldset:"system"},{name:"size",type:"number",title:"File size in bytes",readOnly:true,fieldset:"system"},{name:"assetId",type:"string",title:"Asset ID",readOnly:true,fieldset:"system"},{name:"uploadId",type:"string",readOnly:true,hidden:true,fieldset:"system"},{name:"path",type:"string",title:"Path",readOnly:true,fieldset:"system"},{name:"url",type:"string",title:"Url",readOnly:true,fieldset:"system"},{name:"source",type:"sanity.assetSourceData",title:"Source",readOnly:true,fieldset:"system"}],preview:{select:{title:"originalFilename",path:"path",mimeType:"mimeType",size:"size"},prepare(doc){return{title:doc.title||doc.path.split("/").slice(-1)[0],subtitle:"".concat(doc.mimeType," (").concat((doc.size/1024/1024).toFixed(2)," MB)")};}},orderings:[{title:"File size",name:"fileSizeDesc",by:[{field:"size",direction:"desc"}]}]};var geopoint={title:"Geographical Point",name:"geopoint",type:"object",fields:[{name:"lat",type:"number",title:"Latitude"},{name:"lng",type:"number",title:"Longitude"},{name:"alt",type:"number",title:"Altitude"}]};var imageAsset={name:"sanity.imageAsset",title:"Image",type:"document",fieldsets:[{name:"system",title:"System fields",description:"These fields are managed by the system and not editable"}],fields:[{name:"originalFilename",type:"string",title:"Original file name",readOnly:true},{name:"label",type:"string",title:"Label"},{name:"title",type:"string",title:"Title"},{name:"description",type:"string",title:"Description"},{name:"altText",type:"string",title:"Alternative text"},{name:"sha1hash",type:"string",title:"SHA1 hash",readOnly:true,fieldset:"system"},{name:"extension",type:"string",readOnly:true,title:"File extension",fieldset:"system"},{name:"mimeType",type:"string",readOnly:true,title:"Mime type",fieldset:"system"},{name:"size",type:"number",title:"File size in bytes",readOnly:true,fieldset:"system"},{name:"assetId",type:"string",title:"Asset ID",readOnly:true,fieldset:"system"},{name:"uploadId",type:"string",readOnly:true,hidden:true,fieldset:"system"},{name:"path",type:"string",title:"Path",readOnly:true,fieldset:"system"},{name:"url",type:"string",title:"Url",readOnly:true,fieldset:"system"},{name:"metadata",type:"sanity.imageMetadata",title:"Metadata"},{name:"source",type:"sanity.assetSourceData",title:"Source",readOnly:true,fieldset:"system"}],preview:{select:{id:"_id",title:"originalFilename",mimeType:"mimeType",size:"size"},prepare(doc){return{title:doc.title||typeof doc.path==="string"&&doc.path.split("/").slice(-1)[0],media:{asset:{_ref:doc.id}},subtitle:"".concat(doc.mimeType," (").concat((Number(doc.size)/1024/1024).toFixed(2)," MB)")};}},orderings:[{title:"File size",name:"fileSizeDesc",by:[{field:"size",direction:"desc"}]}]};var imageCrop={name:"sanity.imageCrop",title:"Image crop",type:"object",fields:[{name:"top",type:"number"},{name:"bottom",type:"number"},{name:"left",type:"number"},{name:"right",type:"number"}]};var imageDimensions={name:"sanity.imageDimensions",type:"object",title:"Image dimensions",fields:[{name:"height",type:"number",title:"Height",readOnly:true},{name:"width",type:"number",title:"Width",readOnly:true},{name:"aspectRatio",type:"number",title:"Aspect ratio",readOnly:true}]};var imageHotspot={name:"sanity.imageHotspot",title:"Image hotspot",type:"object",fields:[{name:"x",type:"number"},{name:"y",type:"number"},{name:"height",type:"number"},{name:"width",type:"number"}]};var imageMetadata={name:"sanity.imageMetadata",title:"Image metadata",type:"object",fieldsets:[{name:"extra",title:"Extra metadata\u2026",options:{collapsable:true}}],fields:[{name:"location",type:"geopoint"},{name:"dimensions",title:"Dimensions",type:"sanity.imageDimensions",fieldset:"extra"},{name:"palette",type:"sanity.imagePalette",title:"Palette",fieldset:"extra"},{name:"lqip",title:"LQIP (Low-Quality Image Placeholder)",type:"string",readOnly:true},{name:"blurHash",title:"BlurHash",type:"string",readOnly:true},{name:"hasAlpha",title:"Has alpha channel",type:"boolean",readOnly:true},{name:"isOpaque",title:"Is opaque",type:"boolean",readOnly:true}]};var imagePalette={name:"sanity.imagePalette",title:"Image palette",type:"object",fields:[{name:"darkMuted",type:"sanity.imagePaletteSwatch",title:"Dark Muted"},{name:"lightVibrant",type:"sanity.imagePaletteSwatch",title:"Light Vibrant"},{name:"darkVibrant",type:"sanity.imagePaletteSwatch",title:"Dark Vibrant"},{name:"vibrant",type:"sanity.imagePaletteSwatch",title:"Vibrant"},{name:"dominant",type:"sanity.imagePaletteSwatch",title:"Dominant"},{name:"lightMuted",type:"sanity.imagePaletteSwatch",title:"Light Muted"},{name:"muted",type:"sanity.imagePaletteSwatch",title:"Muted"}]};var imagePaletteSwatch={name:"sanity.imagePaletteSwatch",title:"Image palette swatch",type:"object",fields:[{name:"background",type:"string",title:"Background",readOnly:true},{name:"foreground",type:"string",title:"Foreground",readOnly:true},{name:"population",type:"number",title:"Population",readOnly:true},{name:"title",type:"string",title:"String",readOnly:true}]};var slug={title:"Slug",name:"slug",type:"object",fields:[{name:"current",title:"Current slug",type:"string"},{// The source field is deprecated/unused, but leaving it included and hidden
// to prevent rendering "Unknown field" warnings on legacy data
name:"source",title:"Source field",type:"string",hidden:true}]};const isError$1=problem=>problem.severity==="error";const builtinTypes=[assetSourceData,slug,geopoint,// legacyRichDate,
imageAsset,fileAsset,imageCrop,imageHotspot,imageMetadata,imageDimensions,imagePalette,imagePaletteSwatch];function createSchema(schemaDef){const validated=_internal.validateSchema(schemaDef.types).getTypes();const validation=_internal.groupProblems(validated);const hasErrors=validation.some(group=>group.problems.some(isError$1));const compiled=schema.Schema.compile({name:schemaDef.name,types:hasErrors?[]:[...schemaDef.types,...builtinTypes].filter(Boolean)});compiled._validation=validation;return inferFromSchema(compiled);}function getSchemaTypeTitle(type){if(typeof type.title==="string"){return type.title;}if(type.type){return getSchemaTypeTitle(type.type);}return type.name||type.jsonType;}const PRESENCE_MARGINS=[0,0,1,0];function onDragEnter(event){return event.stopPropagation();}function EditPortal(props){const{children,header,id,legacy_referenceElement:referenceElement,onClose,type,width,autofocus}=props;const[documentScrollElement,setDocumentScrollElement]=React.useState(null);const containerElement=React.useRef(null);const contents=/* @__PURE__ */jsxRuntime.jsx(PresenceOverlay,{margins:PRESENCE_MARGINS,children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{ref:containerElement,children})});if(type==="dialog"){return/* @__PURE__ */jsxRuntime.jsx(VirtualizerScrollInstanceProvider,{scrollElement:documentScrollElement,containerElement,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Dialog,{header,id:id||"",onClickOutside:onClose,onClose,onDragEnter,width,contentRef:setDocumentScrollElement,__unstable_autoFocus:autofocus,children:contents})});}return/* @__PURE__ */jsxRuntime.jsx(PopoverDialog,{header,onClose,referenceElement,width,containerRef:setDocumentScrollElement,children:/* @__PURE__ */jsxRuntime.jsx(VirtualizerScrollInstanceProvider,{scrollElement:documentScrollElement,containerElement,children:contents})});}const MENU_POPOVER_PROPS$8={portal:true,tone:"default",placement:"left",constrainSize:true};const InsertMenu$1=React.memo(function InsertMenu2(props){const{types,onInsert}=props;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(InsertMenuGroup,{pos:"before",types,onInsert,text:t("inputs.array.action.add-before"),icon:icons.InsertAboveIcon}),/* @__PURE__ */jsxRuntime.jsx(InsertMenuGroup,{pos:"after",types,onInsert,text:t("inputs.array.action.add-after"),icon:icons.InsertBelowIcon})]});});function InsertMenuGroup(props){const{types,onInsert,pos,text,icon}=props;if((types==null?void 0:types.length)===1){return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text,icon,onClick:()=>onInsert(pos,types[0])},pos);}return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuGroup,{text,popover:MENU_POPOVER_PROPS$8,children:types==null?void 0:types.map(insertableType=>/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{icon:insertableType.icon,text:insertableType.title,onClick:()=>onInsert(pos,insertableType)},insertableType.name))},pos);}var __freeze$1D=Object.freeze;var __defProp$1D=Object.defineProperty;var __template$1D=(cooked,raw)=>__freeze$1D(__defProp$1D(cooked,"raw",{value:__freeze$1D(raw||cooked.slice())}));var _a$1D;const PreviewCard$1=styled__default.default(ui.Card)(_a$1D||(_a$1D=__template$1D(["\n  border-top-right-radius: inherit;\n  border-top-left-radius: inherit;\n  height: 100%;\n  position: relative;\n\n  @media (hover: hover) {\n    &:hover {\n      filter: brightness(95%);\n    }\n  }\n\n  &:focus:focus-visible {\n    box-shadow: 0 0 0 2px var(--card-focus-ring-color);\n  }\n"])));function getTone$2(_ref172){let{readOnly,hasErrors,hasWarnings}=_ref172;if(readOnly){return"transparent";}if(hasErrors){return"critical";}return hasWarnings?"caution":"default";}const MENU_POPOVER_PROPS$7={portal:true,tone:"default"};function GridItem(props){var _a2,_b,_c,_d,_e,_f;const{schemaType,parentSchemaType,path,readOnly,onRemove,value,open,onInsert,onFocus,onOpen,onClose,changed,focused,children,inputProps:{renderPreview}}=props;const{t}=useTranslation();const sortable=!readOnly&&((_a2=parentSchemaType.options)==null?void 0:_a2.sortable)!==false;const insertableTypes=parentSchemaType.of;const previewCardRef=React.useRef(null);useScrollIntoViewOnFocusWithin(previewCardRef,open);useDidUpdate(focused,(hadFocus,hasFocus)=>{var _a3;if(!hadFocus&&hasFocus&&previewCardRef.current){(_a3=previewCardRef.current)==null?void 0:_a3.focus();}});const resolvingInitialValue=value._resolvingInitialValue;const handleDuplicate=React.useCallback(()=>{onInsert({items:[{...value,_key:randomKey()}],position:"after"});},[onInsert,value]);const handleInsert=React.useCallback((pos,insertType)=>{onInsert({items:[createProtoArrayValue(insertType)],position:pos});},[onInsert]);const childPresence=useChildPresence(path,true);const presence=React.useMemo(()=>{return childPresence.length===0?null:/* @__PURE__ */jsxRuntime.jsx(FieldPresence,{presence:childPresence,maxAvatars:1});},[childPresence]);const childValidation=useChildValidation(path,true);const validation=React.useMemo(()=>{return childValidation.length===0?null:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:1,paddingY:3,children:/* @__PURE__ */jsxRuntime.jsx(FormFieldValidationStatus,{validation:childValidation,__unstable_showSummary:true})});},[childValidation]);const hasErrors=childValidation.some(v=>v.level==="error");const hasWarnings=childValidation.some(v=>v.level==="warning");const menu=React.useMemo(()=>readOnly?null:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{paddingY:3}),id:"".concat(props.inputId,"-menuButton"),menu:/* @__PURE__ */jsxRuntime.jsxs(ui.Menu,{children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.array.action.remove"),tone:"critical",icon:icons.TrashIcon,onClick:onRemove}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.array.action.duplicate"),icon:icons.CopyIcon,onClick:handleDuplicate}),/* @__PURE__ */jsxRuntime.jsx(InsertMenu$1,{types:insertableTypes,onInsert:handleInsert})]}),popover:MENU_POPOVER_PROPS$7}),[handleDuplicate,handleInsert,onRemove,insertableTypes,props.inputId,readOnly,t]);const tone=getTone$2({readOnly,hasErrors,hasWarnings});const item=/* @__PURE__ */jsxRuntime.jsx(CellLayout,{menu,presence,validation,tone,radius:2,border:true,dragHandle:sortable,selected:open,children:/* @__PURE__ */jsxRuntime.jsxs(PreviewCard$1,{tone:"inherit",overflow:"auto",forwardedAs:"button","data-ui":"PreviewCard","data-as":"button",type:"button",flex:1,tabIndex:0,disabled:resolvingInitialValue,onClick:onOpen,ref:previewCardRef,onFocus,__unstable_focusRing:true,children:[renderPreview({schemaType,value,layout:"media",withBorder:false,withShadow:false}),resolvingInitialValue&&/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{fill:true})]})});const itemTypeTitle=getSchemaTypeTitle(schemaType);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path,isChanged:changed,hasFocus:Boolean(focused),children:item}),open&&/* @__PURE__ */jsxRuntime.jsx(EditPortal,{header:readOnly?t("inputs.array.action.view",{itemTypeTitle}):t("inputs.array.action.edit",{itemTypeTitle}),type:((_c=(_b=parentSchemaType==null?void 0:parentSchemaType.options)==null?void 0:_b.modal)==null?void 0:_c.type)||"dialog",width:(_f=(_e=(_d=parentSchemaType==null?void 0:parentSchemaType.options)==null?void 0:_d.modal)==null?void 0:_e.width)!=null?_f:1,id:value._key,onClose,autofocus:focused,legacy_referenceElement:previewCardRef.current,children})]});}const EMPTY$2=[];function GridArrayInput(props){var _a;const{arrayFunctions:ArrayFunctions=ArrayOfObjectsFunctions,elementProps,members,onChange,onInsert,onItemMove,onUpload,readOnly,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderPreview,resolveUploader,schemaType,value=EMPTY$2}=props;const{t}=useTranslation();const handlePrepend=React.useCallback(item=>{onInsert({items:[item],position:"before",referenceItem:0});},[onInsert]);const handleAppend=React.useCallback(item=>{onInsert({items:[item],position:"after",referenceItem:-1});},[onInsert]);const sortable=((_a=schemaType.options)==null?void 0:_a.sortable)!==false;const renderItem=React.useCallback(itemProps=>{return/* @__PURE__ */jsxRuntime.jsx(GridItem,{...itemProps});},[]);const memberKeys=React.useMemo(()=>members.map(member=>member.key),[members]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(UploadTargetCard,{types:schemaType.of,resolveUploader,onUpload,...elementProps,tabIndex:0,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{"data-ui":"ArrayInput__content",space:2,children:[(members==null?void 0:members.length)===0&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:3,border:true,radius:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",muted:true,size:1,children:schemaType.placeholder||/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:t("inputs.array.no-items-label")})})}),(members==null?void 0:members.length)>0&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,radius:1,children:/* @__PURE__ */jsxRuntime.jsx(List,{columns:[2,3,4],gap:3,padding:1,margin:1,items:memberKeys,onItemMove,sortable,children:members.map(member=>/* @__PURE__ */jsxRuntime.jsxs(Item,{sortable,id:member.key,flex:1,children:[member.kind==="item"&&/* @__PURE__ */jsxRuntime.jsx(ArrayOfObjectsItem,{member,renderAnnotation,renderBlock,renderInlineBlock,renderItem,renderField,renderInput,renderPreview}),member.kind==="error"&&/* @__PURE__ */jsxRuntime.jsx(ErrorItem$1,{sortable,member})]},member.key))})})]})}),/* @__PURE__ */jsxRuntime.jsx(ArrayFunctions,{onChange,onItemAppend:handleAppend,onItemPrepend:handlePrepend,onValueCreate:createProtoArrayValue,readOnly,schemaType,value})]});}var __freeze$1C=Object.freeze;var __defProp$1C=Object.defineProperty;var __template$1C=(cooked,raw)=>__freeze$1C(__defProp$1C(cooked,"raw",{value:__freeze$1C(raw||cooked.slice())}));var _a$1C;const Root$h=styled__default.default(ui.Card)(_a$1C||(_a$1C=__template$1C(["\n  position: relative;\n  border: 1px solid transparent;\n  transition: border-color 250ms;\n\n  ."," & {\n    border-color: var(--card-shadow-umbra-color);\n    box-shadow:\n      0 0 0 0,\n      0 8px 17px 2px var(--card-shadow-umbra-color),\n      0 3px 14px 2px var(--card-shadow-penumbra-color),\n      0 5px 5px -3px var(--card-shadow-ambient-color);\n  }\n\n  &:hover {\n    border-color: var(--card-shadow-umbra-color);\n  }\n\n  &[aria-selected='true'] {\n    border-color: var(--card-focus-ring-color);\n  }\n"])),MOVING_ITEM_CLASS_NAME);function RowLayout(props){const{validation,selected,tone,presence,focused,children,dragHandle,menu,footer}=props;const elementRef=React.useRef(null);useDidUpdate(focused,(hadFocus,hasFocus)=>{var _a2;if(!hadFocus&&hasFocus){(_a2=elementRef.current)==null?void 0:_a2.focus();}});return/* @__PURE__ */jsxRuntime.jsx(Root$h,{ref:elementRef,selected,"aria-selected":selected,radius:1,padding:1,tone,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:1,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:1,children:[dragHandle&&/* @__PURE__ */jsxRuntime.jsx(DragHandle,{paddingY:3}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children}),(presence||validation||menu)&&/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",flex:"none",gap:2,style:{lineHeight:0},children:[presence&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:"none",children:presence}),validation&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:"none",children:validation}),menu]})]}),footer]})});}var __freeze$1B=Object.freeze;var __defProp$1B=Object.defineProperty;var __template$1B=(cooked,raw)=>__freeze$1B(__defProp$1B(cooked,"raw",{value:__freeze$1B(raw||cooked.slice())}));var _a$1B;const PopoverCard=styled__default.default(ui.Card)(_a$1B||(_a$1B=__template$1B(["\n  max-width: ","px;\n"])),_ref173=>{let{theme}=_ref173;return theme.sanity.container[1];});function IncompatibleItemType(props){const{value,onFocus,vertical,...rest}=props;const[showDetails,setShowDetails]=React.useState(false);const[popoverRef,setPopoverRef]=React.useState(null);const{t}=useTranslation();ui.useClickOutside(()=>setShowDetails(false),[popoverRef]);const handleKeyDown=React.useCallback(e=>{if(e.key==="Escape"||e.key==="Tab"){setShowDetails(false);}},[]);const handleShowDetails=React.useCallback(()=>{setShowDetails(v=>!v);},[]);const typeName=content.resolveTypeName(value);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{open:showDetails,ref:setPopoverRef,onKeyDown:handleKeyDown,portal:true,constrainSize:true,tone:"default",content:/* @__PURE__ */jsxRuntime.jsx(PopoverCard,{margin:1,padding:3,onKeyDown:handleKeyDown,tabIndex:0,overflow:"auto",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{weight:"medium",children:t("inputs.array.error.type-is-incompatible-title")})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.array.error.current-schema-not-declare-description",values:{typeName}})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{size:1,children:[/* @__PURE__ */jsxRuntime.jsx(icons.BulbOutlineIcon,{})," ",t("inputs.array.error.can-delete-but-no-edit-description")]})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:t("inputs.array.error.json-representation-description")}),/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:2,overflow:"auto",border:true,children:/* @__PURE__ */jsxRuntime.jsx(ui.Code,{size:1,as:"pre",language:"json",children:JSON.stringify(value,null,2)})})]})]})}),children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{as:"button",type:"button",radius:2,tone:"inherit",paddingX:2,paddingY:3,flex:1,onFocus,onClick:handleShowDetails,onKeyDown:handleKeyDown,__unstable_focusRing:true,...rest,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginRight:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:/* @__PURE__ */jsxRuntime.jsx(icons.UnknownIcon,{})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,textOverflow:"ellipsis",children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.array.error.type-is-incompatible-prompt",values:{typeName}})})})]})})});}const MENU_POPOVER_PROPS$6={portal:true,tone:"default"};function ErrorItem(props){const{member,sortable,onRemove}=props;const id=React.useId();const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:1,children:/* @__PURE__ */jsxRuntime.jsx(RowLayout,{dragHandle:sortable,tone:"caution",menu:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{paddingY:3}),id:"".concat(id,"-menuButton"),menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.array.action.remove-invalid-item"),tone:"critical",icon:icons.TrashIcon,onClick:onRemove})}),popover:MENU_POPOVER_PROPS$6}),children:member.error.type==="INVALID_ITEM_TYPE"?/* @__PURE__ */jsxRuntime.jsx(IncompatibleItemType,{value:member.error.value}):/* @__PURE__ */jsxRuntime.jsx("div",{children:t("inputs.array.error.unexpected-error",{error:member.error.type})})})});}function useMemoCompare(next,compare){const previousRef=React.useRef(next);const previous=previousRef.current;const isEqual=compare(previous,next);React.useEffect(()=>{if(!isEqual){previousRef.current=next;}});return isEqual?previous:next;}const EMPTY$1=[];function ListArrayInput(props){var _a;const{arrayFunctions:ArrayFunctions=ArrayOfObjectsFunctions,elementProps,members,onChange,onInsert,onItemMove,onUpload,focusPath,readOnly,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,resolveUploader,schemaType,value=EMPTY$1}=props;const{t}=useTranslation();const[activeDragItemIndex,setActiveDragItemIndex]=React.useState(null);const{space}=ui.useTheme().sanity;const handlePrepend=React.useCallback(item=>{onInsert({items:[item],position:"before",referenceItem:0});},[onInsert]);const handleAppend=React.useCallback(item=>{onInsert({items:[item],position:"after",referenceItem:-1});},[onInsert]);const memberKeys=useMemoCompare(React.useMemo(()=>members.map(member=>member.key),[members]),shallowEquals__default.default);const{scrollElement,containerElement}=useVirtualizerScrollInstance();const parentRef=React.useRef(null);const focusPathKey=React.useMemo(()=>{return types.isKeySegment(focusPath[0])?focusPath[0]._key:focusPath[0];},[focusPath]);const rangeExtractor=React.useCallback(range=>{const newRange={...range};if(activeDragItemIndex!==null){newRange.startIndex=Math.min(range.startIndex,activeDragItemIndex);newRange.endIndex=Math.max(range.endIndex,activeDragItemIndex);}if(focusPathKey){const index=memberKeys.findIndex(key=>key===focusPathKey);if(index!==-1){newRange.startIndex=Math.min(newRange.startIndex,index);newRange.endIndex=Math.max(newRange.endIndex,index);}}return reactVirtual.defaultRangeExtractor(newRange);},[activeDragItemIndex,focusPathKey,memberKeys]);const observeElementOffset=React.useCallback((instance,callback)=>{if(!instance.scrollElement){return void 0;}const scroll=instance.scrollElement;const handleScroll=()=>{var _a2,_b,_c,_d;const containerElementTop=(_b=(_a2=containerElement.current)==null?void 0:_a2.getBoundingClientRect().top)!=null?_b:0;const parentElementTop=(_d=(_c=parentRef.current)==null?void 0:_c.getBoundingClientRect().top)!=null?_d:0;const itemOffset=Math.floor(parentElementTop-containerElementTop);callback(scroll.scrollTop-itemOffset);};handleScroll();instance.scrollElement.addEventListener("scroll",handleScroll,{capture:false,passive:true});return()=>{scroll.removeEventListener("scroll",handleScroll);};},[containerElement]);const estimateSize=React.useCallback(()=>53,[]);const virtualizer=reactVirtual.useVirtualizer({count:members.length,estimateSize,getScrollElement:React.useCallback(()=>scrollElement,[scrollElement]),observeElementOffset,rangeExtractor,getItemKey:React.useCallback(index=>memberKeys[index],[memberKeys]),scrollToFn:(offset,options,instance)=>{if(offset===instance.scrollOffset){return;}reactVirtual.elementScroll(offset,options,instance);}});const items=virtualizer.getVirtualItems();const handleItemMoveStart=React.useCallback(event=>{var _a2,_b;const{active}=event;setActiveDragItemIndex((_b=(_a2=active.data.current)==null?void 0:_a2.sortable)==null?void 0:_b.index);},[]);const handleItemMoveEnd=React.useCallback(()=>{setActiveDragItemIndex(null);},[]);const sortable=((_a=schemaType.options)==null?void 0:_a.sortable)!==false;const listGridGap=1;const paddingY=1;const radius=2;return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,ref:parentRef,children:[/* @__PURE__ */jsxRuntime.jsx(UploadTargetCard,{$radius:radius,types:schemaType.of,resolveUploader,onUpload,...elementProps,tabIndex:0,children:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{"data-ui":"ArrayInput__content",space:2,children:members.length===0?/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:3,border:true,radius:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",muted:true,size:1,children:schemaType.placeholder||/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:t("inputs.array.no-items-label")})})}):/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,radius,style:{// This is not memoized since it changes on scroll so it will change anyways making memo useless
// Account for grid gap
boxSizing:"border-box",height:"".concat(virtualizer.getTotalSize()+items.length*space[listGridGap]+space[paddingY],"px"),width:"100%",position:"relative"},children:/* @__PURE__ */jsxRuntime.jsx(List,{axis:"y",gap:listGridGap,paddingY,items:memberKeys,onItemMove,onItemMoveStart:handleItemMoveStart,onItemMoveEnd:handleItemMoveEnd,sortable,style:{// This is not memoized since it changes on scroll so it will change anyways making memo useless
position:"absolute",top:0,left:0,width:"100%",transform:"translateY(".concat(items[0].start,"px)")},children:items.map(virtualRow=>{const member=members[virtualRow.index];return/* @__PURE__ */jsxRuntime.jsxs(Item,{ref:virtualizer.measureElement,sortable,"data-index":virtualRow.index,id:member.key,children:[member.kind==="item"&&/* @__PURE__ */jsxRuntime.jsx(ArrayOfObjectsItem,{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview}),member.kind==="error"&&/* @__PURE__ */jsxRuntime.jsx(ErrorItem,{sortable,member,onRemove:()=>props.onItemRemove(member.key)})]},virtualRow.key);})})})})}),/* @__PURE__ */jsxRuntime.jsx(ArrayFunctions,{onChange,onItemAppend:handleAppend,onItemPrepend:handlePrepend,onValueCreate:createProtoArrayValue,readOnly,schemaType,value})]});}function ArrayOfObjectsInput(props){var _a;const isGrid=((_a=props.schemaType.options)==null?void 0:_a.layout)==="grid";return isGrid?/* @__PURE__ */jsxRuntime.jsx(GridArrayInput,{...props}):/* @__PURE__ */jsxRuntime.jsx(ListArrayInput,{...props});}function isEqual(item,otherItem){if(item===otherItem){return true;}if(typeof item!==typeof otherItem){return false;}if(typeof item!=="object"&&!Array.isArray(item)){return item===otherItem;}if(item._key&&item._key===otherItem._key){return true;}if(Array.isArray(item)){if(!item.length!==otherItem.length){return false;}return item.every((it,i)=>isEqual(item[i],otherItem[i]));}const keys=Object.keys(item);const otherKeys=Object.keys(item);if(keys.length!==otherKeys.length){return false;}return keys.every(keyName=>isEqual(item[keyName],otherItem[keyName]));}function inArray(array,candidate){return array?array.some(item=>isEqual(item,candidate)):false;}function getMemberTypeOfItem$1(schemaType,item){return schemaType.of.find(memberType=>memberType.name===content.resolveTypeName(item));}const EMPTY_ARRAY$1=[];function ArrayOfObjectOptionsInput(props){var _a,_b;const{renderPreview,schemaType,onChange,onPathFocus,value=[],readOnly,elementProps,path,changed}=props;const options=React.useMemo(()=>{var _a2;return(((_a2=schemaType.options)==null?void 0:_a2.list)||EMPTY_ARRAY$1).map((option,index)=>types.isKeyedObject(option)?option:{...option,_key:"auto-generated-".concat(index)});},[(_a=schemaType.options)==null?void 0:_a.list]);const handleChange=React.useCallback((isChecked,changedOption)=>{if(!isChecked&&types.isKeyedObject(changedOption)){onChange(unset([{_key:changedOption._key}]));return;}const nextValue=options.filter(option=>isEqual(changedOption,option)?isChecked:inArray(value,option));onChange(nextValue.length>0?set(nextValue):unset());},[onChange,options,value]);const handleItemFocus=React.useCallback(index=>{onPathFocus([index]);},[onPathFocus]);const isGrid=((_b=schemaType.options)==null?void 0:_b.layout)==="grid";return/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path,isChanged:changed,hasFocus:false,children:/* @__PURE__ */jsxRuntime.jsx(ui.Grid,{gap:2,columns:isGrid?Math.min(options.length,4):1,tabIndex:0,...elementProps,children:options.map((option,index)=>{const optionType=getMemberTypeOfItem$1(schemaType,option);const checked=inArray(value,option);const disabled=!optionType;return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",as:"label",muted:disabled,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Checkbox,{disabled,checked,onChange:e=>handleChange(e.currentTarget.checked,option),onFocus:()=>handleItemFocus(index),readOnly}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,marginLeft:2,children:optionType?renderPreview({layout:"default",schemaType:optionType,value:option}):/* @__PURE__ */jsxRuntime.jsx(ui.Card,{tone:"caution",radius:2,children:/* @__PURE__ */jsxRuntime.jsx(IncompatibleItemType$2,{value:option,onFocus:()=>handleItemFocus(index)})})})]},index);})})});}function isPrimitiveOption(option){return Boolean(option&&typeof option==="object"&&"title"in option&&"value"in option);}function normalizeOptions(options){return options.map(option=>{if(isPrimitiveOption(option)){return{title:option.title||startCase__default.default(String(option.value)),value:option.value};}return{title:startCase__default.default(String(option)),value:option};});}function getMemberTypeOfItem(schemaType,option){return schemaType.of.find(memberType=>memberType.name===content.resolveTypeName(option.value));}function ArrayOfPrimitiveOptionsInput(props){var _a,_b;const{schemaType,onChange,value=[],readOnly,path,changed,onIndexFocus,elementProps}=props;const options=React.useMemo(()=>{var _a2;return normalizeOptions(((_a2=schemaType.options)==null?void 0:_a2.list)||[]);},[(_a=schemaType.options)==null?void 0:_a.list]);const handleChange=(isChecked,changedValue)=>{const nextValue=options.map(option=>option.value).filter(optionValue=>// note: sparse arrays are not supported here, so multiple options with same value will all be checked
optionValue===changedValue?isChecked:value.includes(optionValue));onChange(nextValue.length>0?set(nextValue):unset());};const isGrid=((_b=schemaType.options)==null?void 0:_b.layout)==="grid";return/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path,isChanged:changed,hasFocus:false,children:/* @__PURE__ */jsxRuntime.jsx(ui.Grid,{gap:2,columns:isGrid?Math.min(options.length,4):1,...elementProps,children:options.map((option,index)=>{const optionType=getMemberTypeOfItem(schemaType,option);const checked=value.includes(option.value);const disabled=!optionType;return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",as:"label",muted:disabled,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Checkbox,{disabled,checked,onChange:e=>handleChange(e.currentTarget.checked,option.value),onFocus:()=>onIndexFocus(index),readOnly}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:option.title})}),!optionType&&/* @__PURE__ */jsxRuntime.jsx(IncompatibleItemType,{value:option,onFocus:()=>onIndexFocus(index)})]},index);})})});}function ArrayOfOptionsInput(props){return isArrayOfObjectsInputProps(props)?/* @__PURE__ */jsxRuntime.jsx(ArrayOfObjectOptionsInput,{...props}):/* @__PURE__ */jsxRuntime.jsx(ArrayOfPrimitiveOptionsInput,{...props});}function ArrayOfPrimitivesFunctions(props){const{schemaType,readOnly,children,onValueCreate,onItemAppend}=props;const menuButtonId=React.useId();const{t}=useTranslation();const insertItem=React.useCallback(itemType=>{onItemAppend(onValueCreate(itemType));},[onValueCreate,onItemAppend]);const handleAddBtnClick=React.useCallback(()=>{insertItem(schemaType.of[0]);},[schemaType,insertItem]);const popoverProps=React.useMemo(()=>({constrainSize:true,portal:true}),[]);const addItemI18nKey=schemaType.of.length>1?"inputs.array.action.add-item-select-type":"inputs.array.action.add-item";if(readOnly){return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{portal:true,content:t("inputs.array.read-only-label"),children:/* @__PURE__ */jsxRuntime.jsx(ui.Grid,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.AddIcon,mode:"ghost",disabled:true,size:"large",text:t(addItemI18nKey)})})});}return/* @__PURE__ */jsxRuntime.jsxs(ui.Grid,{gap:1,style:{gridTemplateColumns:"repeat(auto-fit, minmax(100px, 1fr))"},children:[schemaType.of.length===1?/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.AddIcon,mode:"ghost",onClick:handleAddBtnClick,size:"large",text:t(addItemI18nKey)}):/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.AddIcon,mode:"ghost",size:"large",text:t(addItemI18nKey)}),id:menuButtonId||"",menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:schemaType.of.map((memberDef,i)=>{var _a,_b;const referenceIcon=types.isReferenceSchemaType(memberDef)&&(memberDef.to||[]).length===1&&memberDef.to[0].icon;const icon=memberDef.icon||((_a=memberDef.type)==null?void 0:_a.icon)||referenceIcon;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:memberDef.title||((_b=memberDef.type)==null?void 0:_b.name),onClick:()=>insertItem(memberDef),icon},i);})}),popover:popoverProps}),children]});}const MENU_BUTTON_POPOVER_PROPS$1={portal:true,tone:"default"};const ItemRow=React.forwardRef(function ItemRow2(props,ref){const{sortable,value,insertableTypes,onInsert,onRemove,readOnly,inputId,validation,children,presence,schemaType}=props;const hasError=validation.filter(item=>item.level==="error").length>0;const hasWarning=validation.filter(item=>item.level==="warning").length>0;const handleInsert=React.useCallback((pos,insertType)=>{onInsert({position:pos,items:[getEmptyValue(insertType)]});},[onInsert]);const handleDuplicate=React.useCallback(()=>{if(value)onInsert({position:"after",items:[value]});},[onInsert,value]);const tone=React.useMemo(()=>{if(hasError){return"critical";}if(hasWarning){return"caution";}return void 0;},[hasError,hasWarning]);const{t}=useTranslation();const menu=/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{paddingY:3}),id:"".concat(inputId,"-menuButton"),popover:MENU_BUTTON_POPOVER_PROPS$1,menu:/* @__PURE__ */jsxRuntime.jsxs(ui.Menu,{children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.array.action.remove"),tone:"critical",icon:icons.TrashIcon,onClick:onRemove}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.array.action.duplicate"),icon:icons.CopyIcon,onClick:handleDuplicate}),/* @__PURE__ */jsxRuntime.jsx(InsertMenu$1,{types:insertableTypes,onInsert:handleInsert})]})});return/* @__PURE__ */jsxRuntime.jsx(RowLayout,{tone,menu:!readOnly&&menu,dragHandle:!readOnly&&sortable,presence:presence.length===0?null:/* @__PURE__ */jsxRuntime.jsx(FieldPresence,{presence,maxAvatars:1}),validation:validation.length>0?/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:1,paddingY:3,children:/* @__PURE__ */jsxRuntime.jsx(FormFieldValidationStatus,{validation})}):null,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:schemaType?"flex-end":"center",ref,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"flex-end",flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,marginRight:2,children})})})});});function NoItemsPlaceholder(_ref174){let{schemaType}=_ref174;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:3,border:true,radius:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",muted:true,size:1,children:schemaType.placeholder||t("inputs.array.no-items-label")})});}function nearestIndexOf(array,startIdx,searchElement){return nearestIndex(array,startIdx,element=>element===searchElement);}function nearestIndex(array,startIdx,predicate){let lowerIdx=startIdx-1;let upperIdx=startIdx;const len=array.length;while(lowerIdx>-1||upperIdx<len){const upper=array[upperIdx];if(upperIdx<len&&predicate(upper,upperIdx)){return upperIdx;}const lower=array[lowerIdx];if(lowerIdx>-1&&predicate(lower,lowerIdx)){return lowerIdx;}lowerIdx--;upperIdx++;}return-1;}class ArrayOfPrimitivesInput extends React.PureComponent{constructor(props){super(props);this._element=null;this.handleAppend=itemValue=>{const{value=[],onIndexFocus,onItemAppend}=this.props;onItemAppend(itemValue);onIndexFocus(value.length);};this.handlePrepend=itemValue=>{const{onIndexFocus,value=[],onItemPrepend}=this.props;onItemPrepend(itemValue);onIndexFocus(value.length);};this.handleSortEnd=event=>{const{onIndexFocus,onMoveItem,value}=this.props;if(value)onMoveItem(event);onIndexFocus(event.toIndex);};// Enable transition when the user starts dragging an item
this.handleItemMoveStart=()=>{this.setState({disableTransition:false});};// Disable transition when the user stops dragging an item.
// Note: there's an issue with the transition of items when the sorting is completed, so we disable the
// transition effect when the user stops dragging.
this.handleItemMoveEnd=()=>{this.setState({disableTransition:true});};this.renderArrayItem=props=>{var _a;const{schemaType}=this.props;const sortable=((_a=schemaType.options)==null?void 0:_a.sortable)!==false;return/* @__PURE__ */jsxRuntime.jsx(ItemRow,{...props,sortable,insertableTypes:schemaType.of});};this.state={disableTransition:false};}focus(){if(this._element){this._element.focus();}}getSnapshotBeforeUpdate(prevProps){var _a;const{focusPath:prevFocusPath=[],value:prevValue=[]}=prevProps;const{focusPath=[],value=[]}=this.props;if(prevFocusPath[0]===focusPath[0]&&prevValue.length!==value.length){const focusIndex=focusPath[0];const selection=window.getSelection();if(!((selection==null?void 0:selection.focusNode)instanceof HTMLElement)){return null;}const input=(_a=selection.focusNode)==null?void 0:_a.querySelector("input,textarea");return input instanceof HTMLInputElement?{prevFocusedIndex:focusIndex,restoreSelection:{text:selection.toString(),start:input.selectionStart,end:input.selectionEnd,value:input.value}}:{};}return null;}componentDidUpdate(prevProps,prevState,snapshot){var _a;const{onIndexFocus}=this.props;if((snapshot==null?void 0:snapshot.restoreSelection)&&prevProps.value){const prevFocusedValue=prevProps.value[snapshot.prevFocusedIndex];const nearestIndex=nearestIndexOf(this.props.value||[],snapshot.prevFocusedIndex,prevFocusedValue);if(nearestIndex===-1){return;}const newInput=(_a=this._element)==null?void 0:_a.querySelector("[data-item-index='".concat(nearestIndex,"'] input,textarea"));if(newInput instanceof HTMLInputElement){newInput.focus();try{newInput.setSelectionRange(snapshot.restoreSelection.start,snapshot.restoreSelection.end);}catch{}}onIndexFocus(nearestIndex);}}render(){const{schemaType,members,readOnly,renderInput,onUpload,onItemRemove,resolveUploader,elementProps,arrayFunctions:ArrayFunctions=ArrayOfPrimitivesFunctions,changed}=this.props;const isSortable=!readOnly&&get__default.default(schemaType,"options.sortable")!==false;const membersWithSortIds=members.map(member=>({id:"".concat(member.key,"-").concat(member.kind==="item"?member.item.value:"error"),member}));return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,"data-testid":"array-primitives-input",children:[/* @__PURE__ */jsxRuntime.jsx(UploadTargetCard,{types:schemaType.of,resolveUploader,onUpload,...elementProps,tabIndex:0,children:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:1,children:membersWithSortIds.length===0?/* @__PURE__ */jsxRuntime.jsx(NoItemsPlaceholder,{schemaType}):/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:1,border:true,children:/* @__PURE__ */jsxRuntime.jsx(List,{onItemMove:this.handleSortEnd,onItemMoveStart:this.handleItemMoveStart,onItemMoveEnd:this.handleItemMoveEnd,items:membersWithSortIds.map(m=>m.id),sortable:isSortable,gap:1,children:membersWithSortIds.map((_ref175,index)=>{let{member,id}=_ref175;return/* @__PURE__ */jsxRuntime.jsxs(Item,{id,sortable:isSortable,disableTransition:this.state.disableTransition,children:[member.kind==="item"&&/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path:member.item.path,isChanged:changed,hasFocus:false,children:/* @__PURE__ */jsxRuntime.jsx(ArrayOfPrimitivesItem,{member,renderItem:this.renderArrayItem,renderInput})}),member.kind==="error"&&/* @__PURE__ */jsxRuntime.jsx(ErrorItem,{sortable:isSortable,member,onRemove:()=>onItemRemove(index)})]},member.key);})})})})}),/* @__PURE__ */jsxRuntime.jsx(ArrayFunctions,{onChange:this.props.onChange,onItemAppend:this.handleAppend,onItemPrepend:this.handlePrepend,onValueCreate:getEmptyValue,readOnly:this.props.readOnly,schemaType:this.props.schemaType,value:this.props.value})]});}}function UniversalArrayInput(props){const isArrayOfOptionsInput=React.useMemo(()=>{var _a;return Array.isArray((_a=props.schemaType.options)==null?void 0:_a.list);},[props.schemaType]);if(isArrayOfOptionsInput){return/* @__PURE__ */jsxRuntime.jsx(ArrayOfOptionsInput,{...props});}return isArrayOfPrimitivesInputProps(props)?/* @__PURE__ */jsxRuntime.jsx(ArrayOfPrimitivesInput,{...props}):/* @__PURE__ */jsxRuntime.jsx(ArrayOfObjectsInput,{...props});}var __freeze$1A=Object.freeze;var __defProp$1A=Object.defineProperty;var __template$1A=(cooked,raw)=>__freeze$1A(__defProp$1A(cooked,"raw",{value:__freeze$1A(raw||cooked.slice())}));var _a$1A,_b$L,_c$q;const Root$g=styled__default.default(ui.Card)(_a$1A||(_a$1A=__template$1A(["\n  line-height: 1;\n"])));const CenterAlignedBox=styled__default.default(ui.Box)(_b$L||(_b$L=__template$1A(["\n  align-self: center;\n"])));const ZeroLineHeightBox=styled__default.default(ui.Box)(_c$q||(_c$q=__template$1A(["\n  line-height: 0;\n"])));function BooleanInput(props){var _a2;const{id,value,schemaType,readOnly,elementProps,validation}=props;const layout=((_a2=schemaType.options)==null?void 0:_a2.layout)||"switch";const indeterminate=typeof value!=="boolean";const checked=value||false;const LayoutSpecificInput=layout==="checkbox"?ui.Checkbox:ui.Switch;const tone=readOnly?"transparent":void 0;return/* @__PURE__ */jsxRuntime.jsx(Root$g,{border:true,"data-testid":"boolean-input",radius:2,tone,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[/* @__PURE__ */jsxRuntime.jsx(ZeroLineHeightBox,{padding:3,children:/* @__PURE__ */jsxRuntime.jsx(LayoutSpecificInput,{label:schemaType.title,...elementProps,checked,disabled:readOnly,indeterminate,style:{margin:-4}})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,paddingY:2,children:/* @__PURE__ */jsxRuntime.jsx(FormFieldHeaderText,{deprecated:schemaType.deprecated,description:schemaType.description,inputId:id,validation,title:schemaType.title})}),/* @__PURE__ */jsxRuntime.jsx(CenterAlignedBox,{paddingX:3,paddingY:1,children:/* @__PURE__ */jsxRuntime.jsx(FormFieldStatus,{maxAvatars:1,position:"top"})})]})});}function CalendarDay$1(props){const{date,focused,isCurrentMonth,isToday,onSelect,selected}=props;const handleClick=React.useCallback(()=>{onSelect(date);},[date,onSelect]);return/* @__PURE__ */jsxRuntime.jsx("div",{"aria-selected":selected,"data-ui":"CalendarDay",children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{"aria-label":date.toDateString(),"aria-pressed":selected,as:"button",__unstable_focusRing:true,"data-weekday":true,"data-focused":focused?"true":"",role:"button",tabIndex:-1,onClick:handleClick,padding:2,radius:2,selected,tone:isToday||selected?"primary":"default",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:!selected&&!isCurrentMonth,size:1,style:{textAlign:"center"},weight:isCurrentMonth?"medium":"regular",children:date.getDate()})})});}const HOURS_24=range__default.default(0,24);const ARROW_KEYS$1=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];const TAIL_WEEKDAYS$1=[1,2,3,4,5,6];const getWeekStartsOfMonth$1=(date,weekStartsOn)=>{const firstDay=dateFns.startOfMonth(date);return dateFns.eachWeekOfInterval({start:firstDay,end:dateFns.lastDayOfMonth(firstDay)},{weekStartsOn:weekStartsOn===7?0:weekStartsOn});};const getWeekDaysFromWeekStarts$1=weekStarts=>{return weekStarts.map(weekStart=>[weekStart,...TAIL_WEEKDAYS$1.map(d=>dateFns.addDays(weekStart,d))]);};const useWeeksOfMonth$1=date=>{const{weekInfo}=useCurrentLocale();return getWeekDaysFromWeekStarts$1(getWeekStartsOfMonth$1(date,weekInfo.firstDay)).map(days=>({number:dateFns.getWeek(days[0]),days}));};function CalendarMonth$1(props){const{weekInfo:{firstDay:weekStartDay}}=useCurrentLocale();const weekDayNames=weekStartDay===1?props.weekDayNames:[props.weekDayNames[6],...props.weekDayNames.slice(0,6)];return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{"aria-hidden":props.hidden||false,"data-ui":"CalendarMonth",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Grid,{gap:1,style:{gridTemplateColumns:"repeat(7, minmax(44px, 46px))"},children:[weekDayNames.map(weekday=>/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingY:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",style:{textAlign:"center"},children:weekday})},weekday)),useWeeksOfMonth$1(props.date).map((week,weekIdx)=>week.days.map((date,dayIdx)=>{const focused=props.focused&&dateFns.isSameDay(date,props.focused);const selected=props.selected&&dateFns.isSameDay(date,props.selected);const isToday=dateFns.isSameDay(date,/* @__PURE__ */new Date());const isCurrentMonth=props.focused&&dateFns.isSameMonth(date,props.focused);return/* @__PURE__ */jsxRuntime.jsx(CalendarDay$1,{date,focused,isCurrentMonth,isToday,onSelect:props.onSelect,selected},"".concat(weekIdx,"-").concat(dayIdx));}))]})});}const features={dayPresets:false,timePresets:false};const LazyTextInput=React.forwardRef(function LazyTextInput2(_ref176,forwardedRef){let{onChange,onBlur,onKeyPress,value,...rest}=_ref176;const[inputValue,setInputValue]=React.useState();const handleChange=React.useCallback(event=>{setInputValue(event.currentTarget.value);},[]);const checkEvent=React.useCallback(event=>{const currentValue=event.currentTarget.value;if(currentValue!=="".concat(value)){if(onChange){onChange(event);}}setInputValue(void 0);},[onChange,value]);const handleBlur=React.useCallback(e=>{checkEvent(e);if(onBlur){onBlur(e);}},[checkEvent,onBlur]);const handleKeyPress=React.useCallback(e=>{if(e.key==="Enter"){checkEvent(e);}if(onKeyPress){onKeyPress(e);}},[checkEvent,onKeyPress]);return/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{...rest,"data-testid":"date-input",ref:forwardedRef,value:inputValue===void 0?value:inputValue,onChange:handleChange,onBlur:handleBlur,onKeyPress:handleKeyPress});});const YearInput=props=>{const{onChange,...restProps}=props;const handleChange=React.useCallback(event=>{const numericValue=parseInt(event.currentTarget.value,10);if(!isNaN(numericValue)){onChange(numericValue);}},[onChange]);return/* @__PURE__ */jsxRuntime.jsx(LazyTextInput,{...restProps,fontSize:1,onChange:handleChange,inputMode:"numeric",padding:2,radius:2});};const PRESERVE_FOCUS_ELEMENT$1=/* @__PURE__ */jsxRuntime.jsx("span",{"data-preserve-focus":true,style:{overflow:"hidden",position:"absolute",outline:"none"},tabIndex:-1});const CALENDAR_ICON_BUTTON_PROPS={padding:2};const Calendar$1=React.forwardRef(function Calendar2(props,forwardedRef){const{selectTime,onFocusedDateChange,selectedDate=/* @__PURE__ */new Date(),focusedDate=selectedDate,timeStep=1,onSelect,labels,...restProps}=props;const setFocusedDate=React.useCallback(date=>onFocusedDateChange(date),[onFocusedDateChange]);const setFocusedDateMonth=React.useCallback(month=>setFocusedDate(dateFns.setDate(dateFns.setMonth(focusedDate,month),1)),[focusedDate,setFocusedDate]);const handleFocusedMonthChange=React.useCallback(e=>setFocusedDateMonth(Number(e.currentTarget.value)),[setFocusedDateMonth]);const moveFocusedDate=React.useCallback(by=>setFocusedDate(dateFns.addMonths(focusedDate,by)),[focusedDate,setFocusedDate]);const setFocusedDateYear=React.useCallback(year=>setFocusedDate(dateFns.setYear(focusedDate,year)),[focusedDate,setFocusedDate]);const handleDateChange=React.useCallback(date=>{onSelect(dateFns.setMinutes(dateFns.setHours(date,selectedDate.getHours()),selectedDate.getMinutes()));},[onSelect,selectedDate]);const handleMinutesChange=React.useCallback(event=>{const m=Number(event.currentTarget.value);onSelect(dateFns.setMinutes(selectedDate,m));},[onSelect,selectedDate]);const handleHoursChange=React.useCallback(event=>{const m=Number(event.currentTarget.value);onSelect(dateFns.setHours(selectedDate,m));},[onSelect,selectedDate]);React.useCallback((hours,mins)=>{onSelect(dateFns.setHours(dateFns.setMinutes(selectedDate,mins),hours));},[onSelect,selectedDate]);const ref=ui.useForwardedRef(forwardedRef);const focusCurrentWeekDay=React.useCallback(()=>{var _a,_b;(_b=(_a=ref.current)==null?void 0:_a.querySelector('[data-focused="true"]'))==null?void 0:_b.focus();},[ref]);const handleKeyDown=React.useCallback(event=>{var _a,_b;if(!ARROW_KEYS$1.includes(event.key)){return;}const target=event.currentTarget;event.preventDefault();if(target.hasAttribute("data-calendar-grid")){focusCurrentWeekDay();return;}if(event.key==="ArrowUp"){onFocusedDateChange(dateFns.addDays(focusedDate,-7));}if(event.key==="ArrowDown"){onFocusedDateChange(dateFns.addDays(focusedDate,7));}if(event.key==="ArrowLeft"){onFocusedDateChange(dateFns.addDays(focusedDate,-1));}if(event.key==="ArrowRight"){onFocusedDateChange(dateFns.addDays(focusedDate,1));}(_b=(_a=ref.current)==null?void 0:_a.querySelector("[data-preserve-focus]"))==null?void 0:_b.focus();},[ref,focusCurrentWeekDay,onFocusedDateChange,focusedDate]);React.useEffect(()=>{focusCurrentWeekDay();},[focusCurrentWeekDay]);React.useEffect(()=>{var _a;const currentFocusInCalendarGrid=(_a=document.activeElement)==null?void 0:_a.matches("[data-calendar-grid], [data-calendar-grid] [data-preserve-focus]");if(// Only move focus if it's currently in the calendar grid
currentFocusInCalendarGrid){focusCurrentWeekDay();}},[ref,focusCurrentWeekDay,focusedDate]);React.useCallback(()=>handleDateChange(dateFns.addDays(/* @__PURE__ */new Date(),-1)),[handleDateChange]);React.useCallback(()=>handleDateChange(/* @__PURE__ */new Date()),[handleDateChange]);React.useCallback(()=>handleDateChange(dateFns.addDays(/* @__PURE__ */new Date(),1)),[handleDateChange]);const handleNowClick=React.useCallback(()=>onSelect(/* @__PURE__ */new Date()),[onSelect]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{"data-ui":"Calendar",...restProps,ref,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{padding:2,children:[features.dayPresets,/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(CalendarMonthSelect,{moveFocusedDate,onChange:handleFocusedMonthChange,labels:{goToPreviousMonth:labels.goToPreviousMonth,goToNextMonth:labels.goToNextMonth},monthNames:labels.monthNames,value:focusedDate==null?void 0:focusedDate.getMonth()})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:2,children:/* @__PURE__ */jsxRuntime.jsx(CalendarYearSelect,{moveFocusedDate,labels:{goToNextYear:labels.goToNextYear,goToPreviousYear:labels.goToPreviousYear},onChange:setFocusedDateYear,value:focusedDate.getFullYear()})})]}),/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{"data-calendar-grid":true,onKeyDown:handleKeyDown,marginTop:2,overflow:"hidden",tabIndex:0,children:[/* @__PURE__ */jsxRuntime.jsx(CalendarMonth$1,{weekDayNames:labels.weekDayNamesShort,date:focusedDate,focused:focusedDate,onSelect:handleDateChange,selected:selectedDate}),PRESERVE_FOCUS_ELEMENT$1]})]}),selectTime&&/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{padding:2,style:{borderTop:"1px solid var(--card-border-color)"},children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",flex:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Select,{"aria-label":labels.selectHour,fontSize:1,padding:2,radius:2,value:selectedDate==null?void 0:selectedDate.getHours(),onChange:handleHoursChange,children:HOURS_24.map(h=>/* @__PURE__ */jsxRuntime.jsx("option",{value:h,children:"".concat(h).padStart(2,"0")},h))})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:":"})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Select,{"aria-label":labels.selectMinute,fontSize:1,padding:2,radius:2,value:selectedDate==null?void 0:selectedDate.getMinutes(),onChange:handleMinutesChange,children:range__default.default(0,60,timeStep).map(m=>/* @__PURE__ */jsxRuntime.jsx("option",{value:m,children:"".concat(m).padStart(2,"0")},m))})})]}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:2,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{text:labels.setToCurrentTime,mode:"bleed",onClick:handleNowClick})})]}),features.timePresets]})]});});function CalendarMonthSelect(props){const{moveFocusedDate,onChange,value,labels,monthNames}=props;const handlePrevMonthClick=React.useCallback(()=>moveFocusedDate(-1),[moveFocusedDate]);const handleNextMonthClick=React.useCallback(()=>moveFocusedDate(1),[moveFocusedDate]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{flex:1,gap:1,children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":labels.goToPreviousMonth,onClick:handlePrevMonthClick,mode:"bleed",icon:icons.ChevronLeftIcon,tooltipProps:{content:"Previous month"},...CALENDAR_ICON_BUTTON_PROPS}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Select,{fontSize:1,radius:2,value,onChange,padding:2,children:monthNames.map((monthName,i)=>// eslint-disable-next-line react/no-array-index-key
/* @__PURE__ */jsxRuntime.jsx("option",{value:i,children:monthName},i))})}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":labels.goToNextMonth,mode:"bleed",icon:icons.ChevronRightIcon,onClick:handleNextMonthClick,tooltipProps:{content:"Next month"},...CALENDAR_ICON_BUTTON_PROPS})]});}function CalendarYearSelect(props){const{moveFocusedDate,onChange,value,labels}=props;const handlePrevYearClick=React.useCallback(()=>moveFocusedDate(-12),[moveFocusedDate]);const handleNextYearClick=React.useCallback(()=>moveFocusedDate(12),[moveFocusedDate]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:1,children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":labels.goToPreviousYear,onClick:handlePrevYearClick,mode:"bleed",icon:icons.ChevronLeftIcon,tooltipProps:{content:"Previous year"},...CALENDAR_ICON_BUTTON_PROPS}),/* @__PURE__ */jsxRuntime.jsx(YearInput,{value,onChange,radius:0,style:{width:48}}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":labels.goToNextYear,onClick:handleNextYearClick,mode:"bleed",icon:icons.ChevronRightIcon,tooltipProps:{content:"Next year"},...CALENDAR_ICON_BUTTON_PROPS})]});}const DatePicker$1=React.forwardRef(function DatePicker2(props,ref){const{value=/* @__PURE__ */new Date(),onChange,calendarLabels,...rest}=props;const[focusedDate,setFocusedDay]=React.useState();const handleSelect=React.useCallback(nextDate=>{onChange(nextDate);setFocusedDay(void 0);},[onChange]);return/* @__PURE__ */jsxRuntime.jsx(Calendar$1,{...rest,labels:calendarLabels,ref,selectedDate:value,onSelect:handleSelect,focusedDate:focusedDate||value,onFocusedDateChange:setFocusedDay});});const DateTimeInput$1=React.forwardRef(function DateTimeInput2(props,ref){const{value,inputValue,onInputChange,onChange,selectTime,timeStep,calendarLabels,...rest}=props;const[popoverRef,setPopoverRef]=React.useState(null);const forwardedRef=ui.useForwardedRef(ref);const buttonRef=React.useRef(null);const[isPickerOpen,setPickerOpen]=React.useState(false);ui.useClickOutside(()=>setPickerOpen(false),[popoverRef]);const handleDeactivation=React.useCallback(()=>{var _a,_b;(_a=forwardedRef.current)==null?void 0:_a.focus();(_b=forwardedRef.current)==null?void 0:_b.select();},[forwardedRef]);const handleKeyUp=React.useCallback(e=>{if(e.key==="Escape"){setPickerOpen(false);}},[]);const handleClick=React.useCallback(()=>setPickerOpen(true),[]);const suffix=/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{style:{padding:"5px"},children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{ref:buttonRef,icon:icons.CalendarIcon,mode:"bleed",onClick:handleClick,style:{display:"block"},"data-testid":"select-date-button",tooltipProps:{content:"Select date"}})});return/* @__PURE__ */jsxRuntime.jsx(LazyTextInput,{ref:forwardedRef,...rest,value:inputValue,onChange:onInputChange,suffix:isPickerOpen?// Note: we're conditionally inserting the popover here due to an
// issue with popovers rendering incorrectly on subsequent renders
// see https://github.com/sanity-io/design/issues/519
/* @__PURE__ */jsxRuntime.jsx(ui.LayerProvider,{zOffset:1e3,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{constrainSize:true,"data-testid":"date-input-dialog",portal:true,content:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{overflow:"auto",children:/* @__PURE__ */jsxRuntime.jsx(FocusLock__default.default,{onDeactivation:handleDeactivation,children:/* @__PURE__ */jsxRuntime.jsx(DatePicker$1,{calendarLabels,selectTime,timeStep,onKeyUp:handleKeyUp,value,onChange})})}),open:true,placement:"bottom",ref:setPopoverRef,children:suffix})}):suffix});});const DEFAULT_PLACEHOLDER_TIME=/* @__PURE__ */new Date();const CommonDateTimeInput=React.forwardRef(function CommonDateTimeInput2(props,ref){const{id,deserialize,formatInputValue,onChange,parseInputValue,placeholder,readOnly,selectTime,serialize,timeStep,value,...restProps}=props;const[localValue,setLocalValue]=React.useState(null);const{t}=useTranslation();React.useEffect(()=>{setLocalValue(null);},[value]);const handleDatePickerInputChange=React.useCallback(event=>{const nextInputValue=event.currentTarget.value;const result=nextInputValue===""?null:parseInputValue(nextInputValue);if(result===null){onChange(null);if(typeof value==="undefined"&&localValue){setLocalValue(null);}}else if(result.isValid){onChange(serialize(result.date));}else{setLocalValue(nextInputValue);}},[parseInputValue,onChange,value,localValue,serialize]);const handleDatePickerChange=React.useCallback(nextDate=>{onChange(nextDate?serialize(nextDate):null);},[serialize,onChange]);const forwardedRef=ui.useForwardedRef(ref);const parseResult=localValue?parseInputValue(localValue):value?deserialize(value):null;const inputValue=localValue?localValue:(parseResult==null?void 0:parseResult.isValid)?formatInputValue(parseResult.date):value;return readOnly?/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{value:inputValue,readOnly:true}):/* @__PURE__ */jsxRuntime.jsx(DateTimeInput$1,{...restProps,calendarLabels:props.calendarLabels,id,selectTime,timeStep,placeholder:placeholder||t("inputs.datetime.placeholder",{example:formatInputValue(DEFAULT_PLACEHOLDER_TIME)}),ref:forwardedRef,value:parseResult==null?void 0:parseResult.date,inputValue:inputValue||"",readOnly:Boolean(readOnly),onInputChange:handleDatePickerInputChange,onChange:handleDatePickerChange,customValidity:parseResult==null?void 0:parseResult.error});});function isValidDate(date){return date instanceof Date&&!isNaN(date.valueOf());}function getCalendarLabels(t){return{goToTomorrow:t("calendar.action.go-to-tomorrow"),goToToday:t("calendar.action.go-to-today"),goToYesterday:t("calendar.action.go-to-yesterday"),goToNextMonth:t("calendar.action.go-to-next-month"),goToPreviousMonth:t("calendar.action.go-to-previous-month"),goToNextYear:t("calendar.action.go-to-next-year"),goToPreviousYear:t("calendar.action.go-to-previous-year"),setToCurrentTime:t("calendar.action.set-to-current-time"),selectHour:t("calendar.action.select-hour"),selectMinute:t("calendar.action.select-minute"),monthNames:[t("calendar.month-names.january"),t("calendar.month-names.february"),t("calendar.month-names.march"),t("calendar.month-names.april"),t("calendar.month-names.may"),t("calendar.month-names.june"),t("calendar.month-names.july"),t("calendar.month-names.august"),t("calendar.month-names.september"),t("calendar.month-names.october"),t("calendar.month-names.november"),t("calendar.month-names.december")],weekDayNamesShort:[t("calendar.weekday-names.short.monday"),t("calendar.weekday-names.short.tuesday"),t("calendar.weekday-names.short.wednesday"),t("calendar.weekday-names.short.thursday"),t("calendar.weekday-names.short.friday"),t("calendar.weekday-names.short.saturday"),t("calendar.weekday-names.short.sunday")],setToTimePreset:(time,date)=>t("calendar.action.set-to-time-preset",{time,date})};}const deserialize$1=value=>legacyDateFormat.parse(value,legacyDateFormat.DEFAULT_DATE_FORMAT);const serialize$2=date=>legacyDateFormat.format(date,legacyDateFormat.DEFAULT_DATE_FORMAT);function DateInput(props){var _a;const{readOnly,onChange,schemaType,elementProps,value}=props;const dateFormat=((_a=schemaType.options)==null?void 0:_a.dateFormat)||legacyDateFormat.DEFAULT_DATE_FORMAT;const{t}=useTranslation();const handleChange=React.useCallback(nextDate=>{onChange(nextDate===null?unset():set(nextDate));},[onChange]);const formatInputValue=React.useCallback(date=>legacyDateFormat.format(date,dateFormat),[dateFormat]);const parseInputValue=React.useCallback(inputValue=>legacyDateFormat.parse(inputValue,dateFormat),[dateFormat]);const calendarLabels=React.useMemo(()=>getCalendarLabels(t),[t]);return/* @__PURE__ */jsxRuntime.jsx(CommonDateTimeInput,{...elementProps,deserialize:deserialize$1,formatInputValue,onChange:handleChange,parseInputValue,placeholder:schemaType.placeholder,calendarLabels,readOnly,selectTime:false,serialize:serialize$2,value});}function parseOptions(){let options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{dateFormat:options.dateFormat||legacyDateFormat.DEFAULT_DATE_FORMAT,timeFormat:options.timeFormat||legacyDateFormat.DEFAULT_TIME_FORMAT,timeStep:"timeStep"in options&&Number(options.timeStep)||1};}function serialize$1(date){return date.toISOString();}function deserialize(isoString){const deserialized=new Date(isoString);if(isValidDate(deserialized)){return{isValid:true,date:deserialized};}return{isValid:false,error:'Invalid date value: "'.concat(isoString,'"')};}function enforceTimeStep(dateString,timeStep){if(!timeStep||timeStep===1){return dateString;}const date=dateFns.parseISO(dateString);const minutes=dateFns.getMinutes(date);const leftOver=minutes%timeStep;if(leftOver!==0){return serialize$1(dateFns.setMinutes(date,minutes-leftOver));}return serialize$1(date);}function DateTimeInput(props){const{onChange,schemaType,value,elementProps}=props;const{dateFormat,timeFormat,timeStep}=parseOptions(schemaType.options);const{t}=useTranslation();const handleChange=React.useCallback(nextDate=>{let date=nextDate;if(date!==null&&timeStep>1){date=enforceTimeStep(date,timeStep);}onChange(date===null?unset():set(date));},[onChange,timeStep]);const formatInputValue=React.useCallback(date=>legacyDateFormat.format(date,"".concat(dateFormat," ").concat(timeFormat)),[dateFormat,timeFormat]);const parseInputValue=React.useCallback(inputValue=>legacyDateFormat.parse(inputValue,"".concat(dateFormat," ").concat(timeFormat)),[dateFormat,timeFormat]);const calendarLabels=React.useMemo(()=>getCalendarLabels(t),[t]);return/* @__PURE__ */jsxRuntime.jsx(CommonDateTimeInput,{...elementProps,calendarLabels,onChange:handleChange,deserialize,formatInputValue,parseInputValue,placeholder:schemaType.placeholder,selectTime:true,serialize:serialize$1,timeStep,value});}function EmailInput(props){const{validationError,elementProps}=props;return/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{...elementProps,type:"email",inputMode:"email",customValidity:validationError});}const normalizeRules=(validation,type)=>{if(typeof validation==="function"){throw new Error('Schema type "'.concat((type==null?void 0:type.name)||"<not-found>","\"'s `validation` was not run though `inferFromSchema`"));}if(!validation)return[];if(Array.isArray(validation))return validation;return[validation];};function getValidationRule(type,ruleName){for(const rule of normalizeRules(type==null?void 0:type.validation,type)){for(const ruleSpec of rule._rules){if(ruleSpec.flag===ruleName){return ruleSpec;}}}return null;}function NumberInput(props){const{schemaType,validationError,elementProps}=props;const minRule=getValidationRule(schemaType,"min");const integerRule=getValidationRule(schemaType,"integer");const precisionRule=getValidationRule(schemaType,"precision");const onlyPositiveNumber=typeof(minRule==null?void 0:minRule.constraint)==="number"&&(minRule==null?void 0:minRule.constraint)>=0;const onlyIntegers=integerRule||(precisionRule==null?void 0:precisionRule.constraint)===0;const inputMode=onlyPositiveNumber?onlyIntegers?"numeric":"decimal":"text";return/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{...elementProps,type:"number",step:"any",inputMode,customValidity:validationError,placeholder:schemaType.placeholder,pattern:onlyPositiveNumber?"[d]*":void 0,max:Number.MAX_SAFE_INTEGER,min:Number.MIN_SAFE_INTEGER,"data-testid":"number-input"});}const GroupTab=React.forwardRef(function GroupTab2(props,ref){const{onClick}=props;const handleClick=React.useCallback(()=>{onClick==null?void 0:onClick(props.name);},[props.name,onClick]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tab,{"data-testid":"group-tab-".concat(props.name),id:"".concat(props.name,"-tab"),label:props.title,ref,...props,onClick:handleClick});});const GroupOption=props=>{const{name,title,...rest}=props;const{selected}=props;return/* @__PURE__ */jsxRuntime.jsx("option",{title,value:name,id:"".concat(name,"-tab"),"aria-controls":rest["aria-controls"],"data-testid":"group-select-".concat(name),"aria-selected":selected?"true":"false",children:title||name});};var __freeze$1z=Object.freeze;var __defProp$1z=Object.defineProperty;var __template$1z=(cooked,raw)=>__freeze$1z(__defProp$1z(cooked,"raw",{value:__freeze$1z(raw||cooked.slice())}));var _a$1z;const Root$f=styled__default.default(ui.ElementQuery)(_a$1z||(_a$1z=__template$1z(["\n  /* Hide on small screens */\n  &[data-eq-max~='0'] [data-ui='TabList'] {\n    display: none;\n  }\n\n  /* Hide on medium to large screens */\n  [data-ui='Select'] {\n    display: none;\n  }\n\n  /* Show on small screens */\n  &[data-eq-max~='0'] [data-ui='Select'] {\n    display: block;\n  }\n"])));const GroupTabs=_ref177=>{let{inputId,groups,onClick,shouldAutoFocus=true,disabled}=_ref177;return/* @__PURE__ */jsxRuntime.jsx(ui.TabList,{space:2,"data-testid":"field-group-tabs",children:groups.map(group=>{return/* @__PURE__ */jsxRuntime.jsx(GroupTab,{"aria-controls":"".concat(inputId,"-field-group-fields"),autoFocus:shouldAutoFocus&&group.selected,disabled:disabled||group.disabled,icon:group==null?void 0:group.icon,name:group.name,onClick,selected:Boolean(group.selected),title:group.title||group.name},"".concat(inputId,"-").concat(group.name,"-tab"));})});};const GroupSelect=_ref178=>{let{disabled,groups,inputId,onSelect,shouldAutoFocus=true}=_ref178;var _a2;const handleSelect=React.useCallback(event=>{onSelect(event.currentTarget.value);},[onSelect]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ui.Select,{"aria-label":t("inputs.object.field-group-tabs.aria-label"),autoFocus:shouldAutoFocus,"data-testid":"field-group-select",disabled,fontSize:2,muted:true,onChange:handleSelect,value:(_a2=groups.find(g=>g.selected))==null?void 0:_a2.name,children:groups.map(group=>{return/* @__PURE__ */jsxRuntime.jsx(GroupOption,{"aria-controls":"".concat(inputId,"-field-group-fields"),disabled:group.disabled,name:group.name,selected:Boolean(group.selected),title:group.title||group.name},"".concat(inputId,"-").concat(group.name,"-tab"));})});};const FieldGroupTabs=React.memo(function FieldGroupTabs2(_ref179){let{disabled=false,onClick,...props}=_ref179;const handleClick=React.useCallback(groupName=>{onClick==null?void 0:onClick(groupName);},[onClick]);return/* @__PURE__ */jsxRuntime.jsxs(Root$f,{"data-testid":"field-group-root",children:[/* @__PURE__ */jsxRuntime.jsx(GroupTabs,{...props,disabled,onClick:handleClick}),/* @__PURE__ */jsxRuntime.jsx(GroupSelect,{...props,disabled,onSelect:handleClick})]});});var __freeze$1y=Object.freeze;var __defProp$1y=Object.defineProperty;var __template$1y=(cooked,raw)=>__freeze$1y(__defProp$1y(cooked,"raw",{value:__freeze$1y(raw||cooked.slice())}));var _a$1y,_b$K;const FieldGroupTabsWrapper=styled__default.default(ui.Card)(_a$1y||(_a$1y=__template$1y(["\n  margin-bottom: ","px;\n  padding-bottom: ","px;\n"])),_ref180=>{let{$level,theme}=_ref180;return $level===0?0:theme.sanity.space[5]*-1;},_ref181=>{let{$level,theme}=_ref181;return $level===0?theme.sanity.space[4]:theme.sanity.space[4];});const AlignedBottomGrid=styled__default.default(ui.Grid)(_b$K||(_b$K=__template$1y(["\n  align-items: flex-end;\n"])));function UnknownFields(props){const{fieldNames,onChange,readOnly,value}=props;const fieldsLen=fieldNames.length;const handleUnsetClick=React.useCallback(fieldName=>{onChange(unset([fieldName]));},[onChange]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(Alert,{status:"warning",title:/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:t("inputs.object.unknown-fields.warning.title",{count:fieldsLen})}),children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:t("inputs.object.unknown-fields.warning.description",{count:fieldsLen})})}),/* @__PURE__ */jsxRuntime.jsxs(Details,{marginTop:4,open:isDev,title:t("inputs.object.unknown-fields.warning.details.title"),children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginBottom:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:t("inputs.object.unknown-fields.warning.details.description",{count:fieldsLen})})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"ul",space:3,children:fieldNames.map(fieldName=>{return/* @__PURE__ */jsxRuntime.jsx(UnknownField,{fieldName,onUnsetClick:handleUnsetClick,readOnly,value:value==null?void 0:value[fieldName]},fieldName);})})]})]});}function UnknownField(_ref182){let{fieldName,onUnsetClick,readOnly,value}=_ref182;const handleUnsetClick=React.useCallback(()=>{onUnsetClick(fieldName);},[fieldName,onUnsetClick]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{as:"li",overflow:"hidden",radius:2,shadow:1,tone:"caution",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:3,shadow:1,tone:"inherit",children:/* @__PURE__ */jsxRuntime.jsx(ui.Code,{size:1,children:fieldName})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{overflow:"auto",padding:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Code,{language:"json",size:1,children:JSON.stringify(value,null,2)})}),readOnly&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.object.unknown-fields.read-only.description"})})}),!readOnly&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:3,shadow:1,tone:"inherit",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.TrashIcon,mode:"ghost",onClick:handleUnsetClick,size:"large",tone:"critical",text:t("inputs.object.unknown-fields.remove-field-button.text")})})]});}const ObjectInput=React.memo(function ObjectInput2(props){const{schemaType,groups,members,onChange,renderAnnotation,renderBlock,renderInlineBlock,renderInput,renderField,renderItem,renderPreview,level,value,id,onFieldGroupSelect}=props;const{columns}=schemaType.options||{};const renderedUnknownFields=React.useMemo(()=>{if(!schemaType.fields){return null;}const knownFieldNames=schemaType.fields.map(field=>field.name);const unknownFields=Object.keys(value||{}).filter(key=>!key.startsWith("_")&&!knownFieldNames.includes(key));if(unknownFields.length===0){return null;}return/* @__PURE__ */jsxRuntime.jsx(UnknownFields,{fieldNames:unknownFields,value,onChange});},[onChange,schemaType.fields,value]);const selectedGroup=React.useMemo(()=>groups.find(_ref183=>{let{selected}=_ref183;return selected;}),[groups]);const renderObjectMembers=React.useCallback(()=>/* @__PURE__ */jsxRuntime.jsx(ObjectInputMembers,{members,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview}),[members,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview]);if(members.length===0){return null;}return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:6,children:[groups.length>0?/* @__PURE__ */jsxRuntime.jsx(FieldGroupTabsWrapper,{$level:level,"data-testid":"field-groups",children:/* @__PURE__ */jsxRuntime.jsx(FieldGroupTabs,{groups,inputId:id,onClick:onFieldGroupSelect,shouldAutoFocus:false})}):null,/* @__PURE__ */jsxRuntime.jsx(React.Fragment,{children:columns?/* @__PURE__ */jsxRuntime.jsx(AlignedBottomGrid,{columns,gap:4,marginTop:1,children:renderObjectMembers()}):renderObjectMembers()},selectedGroup==null?void 0:selectedGroup.name),renderedUnknownFields]});});const GetFormValueContext=React.createContext(null);function GetFormValueProvider(props){const valueRef=React.useRef(props.value);valueRef.current=props.value;const getValue=React.useCallback(path=>getValueAtPath(valueRef.current,path),[valueRef]);return/* @__PURE__ */jsxRuntime.jsx(GetFormValueContext.Provider,{value:getValue,children:props.children});}function useGetFormValue(){const ctx=React.useContext(GetFormValueContext);if(!ctx){throw new Error("useFormValue must be used within a FormValueProvider");}return ctx;}const defaultSlugify=(value,type)=>{var _a;const maxLength=(_a=type.options)==null?void 0:_a.maxLength;const slugifyOpts={truncate:typeof maxLength==="number"?maxLength:200,symbols:true};return value?speakingurl__default.default(value,slugifyOpts):"";};async function slugify(sourceValue,type,context){var _a;if(!sourceValue){return sourceValue;}const slugifier=((_a=type.options)==null?void 0:_a.slugify)||defaultSlugify;return slugifier(sourceValue,type,context);}function useAsync(fn,dependencies){const[state,setState]=React.useState(null);const lastId=React.useRef(0);const wrappedCallback=React.useCallback(arg=>{const asyncId=++lastId.current;setState({status:"pending"});Promise.resolve().then(()=>fn(arg)).then(res=>{if(asyncId===lastId.current){setState({status:"complete",result:res});}},err=>{if(asyncId===lastId.current){setState({status:"error",error:err});}});},// eslint-disable-next-line react-hooks/exhaustive-deps -- this is under control, and enforced by our linter setup
[fn,...dependencies]);return[state,wrappedCallback];}function useSlugContext(){const{getClient}=useSource();const schema=useSchema();const currentUser=useCurrentUser();const projectId=useProjectId();const dataset=useDataset();return React.useMemo(()=>{return{projectId,dataset,getClient,schema,currentUser};},[getClient,schema,currentUser,projectId,dataset]);}function getSlugSourceContext(valuePath,document,context){const parentPath=valuePath.slice(0,-1);const parent=PathUtils__namespace.get(document,parentPath);return{parentPath,parent,...context};}async function getNewFromSource(source,document,context){return typeof source==="function"?source(document,context):PathUtils__namespace.get(document,source);}function SlugInput(props){var _a;const getFormValue=useGetFormValue();const{path,value,schemaType,validation,onChange,readOnly,elementProps}=props;const sourceField=(_a=schemaType.options)==null?void 0:_a.source;const errors=React.useMemo(()=>validation.filter(item=>item.level==="error"),[validation]);const slugContext=useSlugContext();const{t}=useTranslation();const updateSlug=React.useCallback(nextSlug=>{if(!nextSlug){onChange(PatchEvent.from(unset([])));return;}onChange(PatchEvent.from([setIfMissing({_type:schemaType.name}),set(nextSlug,["current"])]));},[onChange,schemaType.name]);const[generateState,handleGenerateSlug]=useAsync(()=>{if(!sourceField){return Promise.reject(new Error(t("inputs.slug.error.missing-source",{schemaType:schemaType.name})));}const doc=getFormValue([])||{_type:schemaType.name};const sourceContext=getSlugSourceContext(path,doc,slugContext);return getNewFromSource(sourceField,doc,sourceContext).then(newFromSource=>slugify(newFromSource||"",schemaType,sourceContext)).then(newSlug=>updateSlug(newSlug));},[sourceField,getFormValue,schemaType,path,slugContext,updateSlug,t]);const isUpdating=(generateState==null?void 0:generateState.status)==="pending";const handleChange=React.useCallback(event=>updateSlug(event.currentTarget.value),[updateSlug]);return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:1,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{flex:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{customValidity:errors.length>0?errors[0].message:"",disabled:isUpdating,onChange:handleChange,value:(value==null?void 0:value.current)||"",readOnly,...elementProps}),(generateState==null?void 0:generateState.status)==="error"&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:2,tone:"critical",children:generateState.error.message})]}),sourceField&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",type:"button",disabled:readOnly||isUpdating,onClick:handleGenerateSlug,size:"large",text:(generateState==null?void 0:generateState.status)==="pending"?t("inputs.slug.action.generating"):t("inputs.slug.action.generate")})]})});}function StringInput(props){const{validationError,elementProps}=props;return/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{...elementProps,customValidity:validationError,"data-testid":"string-input"});}var __freeze$1x=Object.freeze;var __defProp$1x=Object.defineProperty;var __template$1x=(cooked,raw)=>__freeze$1x(__defProp$1x(cooked,"raw",{value:__freeze$1x(raw||cooked.slice())}));var _a$1x;const StyledTextArea=styled__default.default(ui.TextArea)(_a$1x||(_a$1x=__template$1x(["\n  &[data-as='textarea'] {\n    resize: vertical;\n  }\n"])));function TextInput(props){const{schemaType,validationError,value,elementProps}=props;return/* @__PURE__ */jsxRuntime.jsx(StyledTextArea,{customValidity:validationError,value:value||"",placeholder:schemaType.placeholder,rows:typeof schemaType.rows==="number"?schemaType.rows:10,...elementProps});}function UrlInput(props){var _a,_b;const{schemaType,validationError,elementProps}=props;const uriRule=getValidationRule(schemaType,"uri");const inputType=((_b=(_a=uriRule==null?void 0:uriRule.constraint)==null?void 0:_a.options)==null?void 0:_b.allowRelative)?"text":"url";return/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{type:inputType,inputMode:"url",customValidity:validationError,...elementProps});}function DisabledFeatureWarning(_ref184){let{value,onClearValue}=_ref184;const hasRef=React.useMemo(()=>Boolean(value==null?void 0:value._ref),[value==null?void 0:value._ref]);const{t}=useTranslation();const description=/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.reference.cross-dataset.feature-disabled-description",components:{DocumentationLink:_ref185=>{let{children}=_ref185;return/* @__PURE__ */jsxRuntime.jsx("a",{href:"https://www.sanity.io/docs/cross-dataset-references",target:"_blank",rel:"noreferrer",children});}}});return/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{tone:"caution",padding:4,border:true,radius:2,"data-testid":"alert-cross-dataset-reference-feature-disabled",children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:4,marginBottom:hasRef?4:void 0,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"h2",size:1,weight:"medium",children:t("inputs.reference.cross-dataset.feature-unavailable-title")}),hasRef&&/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",size:1,children:description}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",size:1,children:t("inputs.reference.cross-dataset.feature-disabled-actions")})]}),!hasRef&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",size:1,children:description})]})]}),onClearValue&&hasRef&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.ResetIcon,mode:"ghost",onClick:onClearValue,text:t("inputs.reference.action.clear"),width:"fill"})]});}var __freeze$1w=Object.freeze;var __defProp$1w=Object.defineProperty;var __template$1w=(cooked,raw)=>__freeze$1w(__defProp$1w(cooked,"raw",{value:__freeze$1w(raw||cooked.slice())}));var _a$1w;const StyledPreviewFlex=styled__default.default(ui.Flex)(_a$1w||(_a$1w=__template$1w(["\n  /* this is a hack to avoid layout jumps while previews are loading\n  or the message is not tall enough to fill the card\n  there's probably better ways of solving this */\n  min-height: 36px;\n"])));function CrossDatasetReferencePreview(props){var _a,_b,_c;const{refType,showStudioUrlIcon,hasStudioUrl,showTypeLabel,availability,preview,id,dataset,projectId}=props;const notFound=(availability==null?void 0:availability.reason)==="NOT_FOUND";const insufficientPermissions=(availability==null?void 0:availability.reason)==="PERMISSION_DENIED";const previewMedia=(_a=preview.published)==null?void 0:_a.media;const{t}=useTranslation();const media=React.useMemo(()=>{if(previewMedia){const isValidImageAsset=typeof(previewMedia==null?void 0:previewMedia.asset)!=="undefined"&&assetUtils.isImageSource(previewMedia);const isValidElement=React.isValidElement(previewMedia);if(!isValidImageAsset&&!isValidElement){return null;}return function MediaPreview(_ref186){let{dimensions}=_ref186;return isValidElement?previewMedia:/* @__PURE__ */jsxRuntime.jsx("img",{src:imageUrlBuilder__default.default({dataset,projectId}).image(previewMedia).withOptions(dimensions).url(),alt:t("inputs.reference.image-preview-alt-text"),referrerPolicy:"strict-origin-when-cross-origin"});};}return(refType==null?void 0:refType.icon)?React.createElement(refType.icon):null;},[previewMedia,dataset,projectId,refType==null?void 0:refType.icon,t]);return/* @__PURE__ */jsxRuntime.jsxs(StyledPreviewFlex,{align:"center",justify:"center",flex:1,"data-testid":"preview",children:[(availability==null?void 0:availability.available)?/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(DefaultPreview,{title:(_b=preview.published)==null?void 0:_b.title,subtitle:(_c=preview.published)==null?void 0:_c.subtitle,media:media||false})}):/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,paddingY:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,children:t("inputs.reference.error.document-unavailable-title")})})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingLeft:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{space:4,children:[refType&&showTypeLabel&&/* @__PURE__ */jsxRuntime.jsx(ui.Badge,{mode:"outline",children:refType.title||refType.type}),(insufficientPermissions||notFound)&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{portal:true,content:t(notFound?"inputs.reference.referenced-document-does-not-exist":"inputs.reference.referenced-document-insufficient-permissions",{documentId:id}),children:/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{tone:"default",children:insufficientPermissions?/* @__PURE__ */jsxRuntime.jsx(icons.AccessDeniedIcon,{}):/* @__PURE__ */jsxRuntime.jsx(icons.HelpCircleIcon,{})})})}),!(notFound||insufficientPermissions)&&showStudioUrlIcon&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{portal:true,content:t(hasStudioUrl?"inputs.reference.document-opens-in-new-tab":"input.reference.document-cannot-be-opened.failed-to-resolve-url"),children:/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{size:1,tone:"default",muted:!hasStudioUrl,children:/* @__PURE__ */jsxRuntime.jsx(icons.LaunchIcon,{})})})})]})})]});}const noop=()=>{};const INITIAL_LOADING_STATE$1={isLoading:true,result:void 0,error:void 0,retry:noop};const EMPTY_STATE={isLoading:false,result:void 0,error:void 0,retry:noop};function useReferenceInfo(doc,getReferenceInfo){const[retryAttempt,setRetryAttempt]=React.useState(0);const retry=React.useCallback(()=>{setRetryAttempt(current=>current+1);},[]);const docInfo=React.useMemo(()=>({_id:doc._id,_type:doc._type}),[doc._id,doc._type]);const referenceInfo=reactRx.useMemoObservable(()=>docInfo._id?getReferenceInfo(docInfo).pipe(operators.map(result=>({isLoading:false,result,error:void 0,retry,retryAttempt})),operators.startWith(INITIAL_LOADING_STATE$1),operators.catchError(err=>{console.error(err);return rxjs.of({isLoading:false,result:void 0,error:err,retry,retryAttempt});})):rxjs.of(EMPTY_STATE),[docInfo,getReferenceInfo,retry,retryAttempt],INITIAL_LOADING_STATE$1);const previousId=usePrevious(doc._id,doc._id);if(previousId!==doc._id){return INITIAL_LOADING_STATE$1;}return referenceInfo;}function useProjectId$1(){const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);return client.config().projectId;}function OptionPreview(props){var _a;const{isLoading,result:referenceInfo,error}=useReferenceInfo(props.document,props.getReferenceInfo);const{t}=useTranslation();const projectId=useProjectId$1();if(isLoading){return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,padding:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.TextSkeleton,{style:{maxWidth:320},radius:1,animated:true}),/* @__PURE__ */jsxRuntime.jsx(ui.TextSkeleton,{style:{maxWidth:200},radius:1,size:1,animated:true})]});}if(error){return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:2,padding:1,children:/* @__PURE__ */jsxRuntime.jsx(Alert,{title:t("inputs.reference.error.failed-to-load-document-title"),children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:error.message})})});}if(!referenceInfo){return null;}if(((_a=referenceInfo.availability)==null?void 0:_a.reason)==="PERMISSION_DENIED"){return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:2,padding:1,children:t("inputs.reference.error.missing-read-permissions-description")});}const refType=props.referenceType.to.find(toEntry=>toEntry.type===referenceInfo.type);if(!refType){return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:2,padding:1,children:t("inputs.reference.error.invalid-search-result-type-title",{returnedType:referenceInfo.type})});}return referenceInfo&&refType&&/* @__PURE__ */jsxRuntime.jsx(CrossDatasetReferencePreview,{id:referenceInfo.id,availability:referenceInfo.availability,preview:referenceInfo.preview,refType,dataset:props.referenceType.dataset,projectId,showTypeLabel:props.referenceType.to.length>1});}function PreviewReferenceValue(props){var _a,_b;const{value,type,showStudioUrlIcon,hasStudioUrl,referenceInfo}=props;const{t}=useTranslation();const projectId=useProjectId$1();if(referenceInfo.isLoading||referenceInfo.error){return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,padding:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.TextSkeleton,{style:{maxWidth:320},radius:1,animated:!referenceInfo.error}),/* @__PURE__ */jsxRuntime.jsx(ui.TextSkeleton,{style:{maxWidth:200},radius:1,size:1,animated:!referenceInfo.error})]});}const showTypeLabel=type.to.length>1;const refTypeName=(_a=referenceInfo.result)==null?void 0:_a.type;const refType=type.to.find(toType=>toType.type===refTypeName);if(((_b=referenceInfo.result.availability)==null?void 0:_b.available)&&!refType){return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:2,padding:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.reference.cross-dataset.invalid-type",values:{typeName:refTypeName||"unknown"},components:{JsonValue:()=>/* @__PURE__ */jsxRuntime.jsx("pre",{children:JSON.stringify(value,null,2)})}})})});}return/* @__PURE__ */jsxRuntime.jsx(CrossDatasetReferencePreview,{availability:referenceInfo.result.availability,hasStudioUrl,showStudioUrlIcon,preview:referenceInfo.result.preview,refType,projectId,dataset:type.dataset,id:value._ref,showTypeLabel});}var __freeze$1v=Object.freeze;var __defProp$1v=Object.defineProperty;var __template$1v=(cooked,raw)=>__freeze$1v(__defProp$1v(cooked,"raw",{value:__freeze$1v(raw||cooked.slice())}));var _a$1v,_b$J;const StyledPopover$2=styled__default.default(TooltipDelayGroupProvider.Popover)(_a$1v||(_a$1v=__template$1v(["\n  & > div {\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n  }\n"])));const StyledText$3=styled__default.default(ui.Text)(_b$J||(_b$J=__template$1v(["\n  word-break: break-word;\n"])));const FALLBACK_PLACEMENTS$1=["top-start","bottom-start"];const ReferenceAutocomplete$1=React.forwardRef(function ReferenceAutocomplete2(props,ref){const{searchString,loading,portalRef,referenceElement,...restProps}=props;const{t}=useTranslation();const hasResults=props.options&&props.options.length>0;const renderPopover=React.useCallback((_ref187,contentRef)=>{let{content,hidden,inputElement,onMouseEnter,onMouseLeave}=_ref187;return/* @__PURE__ */jsxRuntime.jsx(StyledPopover$2,{"data-testid":"autocomplete-popover",placement:"bottom-start",fallbackPlacements:FALLBACK_PLACEMENTS$1,arrow:false,constrainSize:true,onMouseEnter,onMouseLeave,content:/* @__PURE__ */jsxRuntime.jsx("div",{ref:contentRef,children:hasResults?content:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",height:"fill",justify:"center",children:/* @__PURE__ */jsxRuntime.jsx(StyledText$3,{align:"center",muted:true,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"inputs.reference.no-results-for-query",values:{searchTerm:searchString||""}})})})})}),open:!loading&&!hidden,ref:portalRef,portal:true,referenceElement:referenceElement||inputElement,matchReferenceWidth:true});},[hasResults,t,searchString,loading,portalRef,referenceElement]);return/* @__PURE__ */jsxRuntime.jsx(ui.Autocomplete,{...restProps,ref,renderPopover});});const INITIAL_SEARCH_STATE$1={hits:[],isLoading:false};const NO_FILTER$1=()=>true;const REF_PATH=["_ref"];const CROSS_DATASET_FEATUREKEY="crossDatasetReferences";function CrossDatasetReferenceInput(props){var _a,_b;const{changed,focused,focusPath,getReferenceInfo,onChange,onPathFocus,onSearch,path,readOnly,schemaType,validation,value,elementProps}=props;const{t}=useTranslation();const projectId=useProjectId$1();const[searchState,setSearchState]=React.useState(INITIAL_SEARCH_STATE$1);const handleChange=React.useCallback(id=>{if(!id){onChange(unset());onPathFocus([]);return;}const hit=searchState.hits.find(h=>h.id===id);if(!hit){throw new Error("Selected an item that wasnt part of the result set");}onChange(set({_type:schemaType.name,_ref:getPublishedId(id),_projectId:projectId,_dataset:schemaType.dataset,_weak:schemaType.weak,// persist _key between mutations if the value is in an array
_key:value==null?void 0:value._key}));onPathFocus([]);},[value==null?void 0:value._key,searchState.hits,schemaType.name,schemaType.dataset,schemaType.weak,projectId,onChange,onPathFocus]);const handleClear=React.useCallback(()=>{onChange(unset());},[onChange]);const handleAutocompleteKeyDown=React.useCallback(event=>{if(event.key==="Escape"){onPathFocus==null?void 0:onPathFocus([]);}},[onPathFocus]);const getReferenceInfoMemo=React.useCallback(doc=>getReferenceInfo(doc,schemaType),[getReferenceInfo,schemaType]);const refDoc=React.useMemo(()=>({_id:value==null?void 0:value._ref}),[value==null?void 0:value._ref]);const loadableReferenceInfo=useReferenceInfo(refDoc,getReferenceInfoMemo);const featureInfo=useFeatureEnabled(CROSS_DATASET_FEATUREKEY);const autocompletePopoverReferenceElementRef=React.useRef(null);const hasFocusAtRef=focusPath.length===1&&focusPath[0]==="_ref";const focusElementRef=elementProps.ref;useDidUpdate({hasFocusAt:hasFocusAtRef,ref:value==null?void 0:value._ref},(prev,current)=>{var _a2;const refUpdated=(prev==null?void 0:prev.ref)!==current.ref;const focusAtUpdated=(prev==null?void 0:prev.hasFocusAt)!==current.hasFocusAt;if((focusAtUpdated||refUpdated)&&current.hasFocusAt){(_a2=focusElementRef.current)==null?void 0:_a2.focus();}});const actualStrength=(value==null?void 0:value._weak)?"weak":"strong";const weakShouldBe=schemaType.weak===true?"weak":"strong";const hasRef=Boolean(value==null?void 0:value._ref);const handleFixStrengthMismatch=React.useCallback(()=>{onChange(schemaType.weak===true?set(true,["_weak"]):unset(["_weak"]));},[onChange,schemaType]);const{push}=ui.useToast();const errors=React.useMemo(()=>validation.filter(item=>item.level==="error"),[validation]);const handleFocus=React.useCallback(event=>{if(event.currentTarget===elementProps.ref.current){onPathFocus==null?void 0:onPathFocus([PathUtils.FOCUS_TERMINATOR]);}},[elementProps.ref,onPathFocus]);const handleAutocompleteFocus=React.useCallback(event=>{if(event.currentTarget===elementProps.ref.current){onPathFocus==null?void 0:onPathFocus(REF_PATH);}},[elementProps.ref,onPathFocus]);const handleReplace=React.useCallback(()=>{onPathFocus==null?void 0:onPathFocus(REF_PATH);},[onPathFocus]);const inputId=React.useId();const handleQueryChange=reactRx.useObservableCallback(inputValue$=>{return inputValue$.pipe(operators.filter(isNonNullable$2),operators.distinctUntilChanged(),operators.switchMap(searchString=>rxjs.concat(rxjs.of({isLoading:true}),onSearch(searchString).pipe(operators.map(hits=>({hits,searchString,isLoading:false})),operators.catchError(error=>{push({title:"Reference search failed",description:error.message,status:"error",id:"reference-search-fail-".concat(inputId)});console.error(error);return rxjs.of({hits:[]});})))),operators.scan((prevState,nextState)=>({...prevState,...nextState}),INITIAL_SEARCH_STATE$1),operators.tap(setSearchState));},[inputId,onSearch,push]);const handleAutocompleteOpenButtonClick=React.useCallback(()=>{handleQueryChange("");},[handleQueryChange]);const showWeakRefMismatch=!loadableReferenceInfo.isLoading&&hasRef&&actualStrength!==weakShouldBe;const studioUrl=(value==null?void 0:value._ref)&&((_b=schemaType.studioUrl)==null?void 0:_b.call(schemaType,{id:value==null?void 0:value._ref,type:(_a=loadableReferenceInfo==null?void 0:loadableReferenceInfo.result)==null?void 0:_a.type}))||null;const renderOption=React.useCallback(option=>{return/* @__PURE__ */jsxRuntime.jsx(PreviewCard,{as:"button",type:"button",radius:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:3,paddingY:1,children:/* @__PURE__ */jsxRuntime.jsx(OptionPreview,{referenceType:schemaType,document:option.hit.published,getReferenceInfo:getReferenceInfoMemo})})});},[schemaType,getReferenceInfoMemo]);const isEditing=hasFocusAtRef||!(value==null?void 0:value._ref);const clickOutsideBoundaryRef=React.useRef(null);const autocompletePortalRef=React.useRef(null);const createButtonMenuPortalRef=React.useRef(null);useOnClickOutside([clickOutsideBoundaryRef,autocompletePortalRef,createButtonMenuPortalRef],()=>{if(hasFocusAtRef){onPathFocus([]);}});return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[!featureInfo.isLoading&&!featureInfo.enabled&&/* @__PURE__ */jsxRuntime.jsx(DisabledFeatureWarning,{value,onClearValue:handleClear}),(featureInfo.isLoading||featureInfo.enabled)&&/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:1,children:isEditing?/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:2,ref:clickOutsideBoundaryRef,children:/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path,isChanged:changed,hasFocus:!!focused,children:/* @__PURE__ */jsxRuntime.jsx("div",{ref:autocompletePopoverReferenceElementRef,children:/* @__PURE__ */jsxRuntime.jsx(ReferenceAutocomplete$1,{...elementProps,"data-testid":"autocomplete",loading:searchState.isLoading,referenceElement:autocompletePopoverReferenceElementRef.current,portalRef:autocompletePortalRef,id:inputId||"",options:searchState.hits.map(hit=>({value:hit.id,hit})),onFocus:handleAutocompleteFocus,radius:2,placeholder:t("inputs.reference.search-placeholder"),onKeyDown:handleAutocompleteKeyDown,readOnly,disabled:loadableReferenceInfo.isLoading,onQueryChange:handleQueryChange,searchString:searchState.searchString,onChange:handleChange,filterOption:NO_FILTER$1,renderOption,openButton:{onClick:handleAutocompleteOpenButtonClick}})})})}):/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path,isChanged:changed,hasFocus:!!focused,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{padding:0,border:true,flex:1,radius:1,tone:readOnly?"transparent":loadableReferenceInfo.error||errors.length>0?"critical":"default",children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",padding:1,children:[studioUrl?/* @__PURE__ */jsxRuntime.jsx(PreviewCard,{as:"a",target:"_blank",rel:"noopener noreferrer",href:studioUrl,"data-as":"a",flex:1,padding:1,paddingRight:3,radius:2,tone:"inherit",__unstable_focusRing:true,tabIndex:0,onFocus:handleFocus,ref:elementProps.ref,children:/* @__PURE__ */jsxRuntime.jsx(PreviewReferenceValue,{value,referenceInfo:loadableReferenceInfo,showStudioUrlIcon:true,hasStudioUrl:!!studioUrl,type:schemaType})}):/* @__PURE__ */jsxRuntime.jsx(PreviewCard,{flex:1,padding:1,paddingRight:3,radius:2,tone:"inherit",__unstable_focusRing:true,tabIndex:0,onFocus:handleFocus,ref:elementProps.ref,children:/* @__PURE__ */jsxRuntime.jsx(PreviewReferenceValue,{value,referenceInfo:loadableReferenceInfo,showStudioUrlIcon:true,type:schemaType})}),/* @__PURE__ */jsxRuntime.jsx(ui.Inline,{paddingX:1,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{"data-testid":"menu-button"}),id:"".concat(inputId,"-menuButton"),menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:!readOnly&&/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.reference.action.clear"),tone:"critical",icon:icons.ResetIcon,"data-testid":"menu-item-clear",onClick:handleClear}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.reference.action.replace"),icon:icons.SyncIcon,"data-testid":"menu-item-replace",onClick:handleReplace})]})}),placement:"right",popover:{portal:true,tone:"default"}})})]}),showWeakRefMismatch&&/* @__PURE__ */jsxRuntime.jsx(ReferenceStrengthMismatchAlertStrip,{actualStrength,handleFixStrengthMismatch}),loadableReferenceInfo.error&&/* @__PURE__ */jsxRuntime.jsx(ReferenceMetadataLoadErrorAlertStrip,{errorMessage:loadableReferenceInfo.error.message,onHandleRetry:loadableReferenceInfo.retry})]})})})]});}const REQUEST_TAG_BASE="cross-dataset-refs";const AVAILABILITY_READABLE$1={available:true,reason:"READABLE"};const AVAILABILITY_PERMISSION_DENIED$1={available:false,reason:"PERMISSION_DENIED"};const AVAILABILITY_NOT_FOUND$1={available:false,reason:"NOT_FOUND"};function createGetReferenceInfo(context){const{client,documentPreviewStore}=context;const{dataset,projectId}=client.config();const apiConfig=dataset&&projectId?{dataset,projectId}:void 0;return function getReferenceInfo(doc,referenceType){return(doc._type?rxjs.of(doc):documentPreviewStore.observeDocumentTypeFromId(doc._id,apiConfig).pipe(operators.map(docType=>({_id:doc._id,_type:docType})))).pipe(operators.switchMap(resolvedDoc=>{if(!resolvedDoc._type){return fetchDocumentAvailability(client,doc._id).pipe(operators.map(availability=>({id:doc._id,type:void 0,availability,preview:{published:void 0}})));}const refSchemaType=referenceType.to.find(candidate=>candidate.type===resolvedDoc._type);const previewPaths=getPreviewPaths(refSchemaType==null?void 0:refSchemaType.preview)||[];const publishedPreview$=documentPreviewStore.observePaths(doc,previewPaths,apiConfig).pipe(operators.map(result=>result?prepareForPreview(result,refSchemaType):result));return rxjs.combineLatest([publishedPreview$]).pipe(operators.map(_ref188=>{let[publishedPreview]=_ref188;return{type:resolvedDoc._type,id:doc._id,availability:AVAILABILITY_READABLE$1,preview:{published:isRecord$4(publishedPreview)?publishedPreview:void 0}};}));}));};}function fetchDocumentAvailability(client,id){const requestOptions={uri:client.getDataUrl("doc",id),json:true,query:{excludeContent:"true"},tag:"".concat(REQUEST_TAG_BASE,".availability")};return client.observable.request(requestOptions).pipe(operators.map(response=>{const omitted=keyBy__default.default(response.omitted||[],entry=>entry.id);const omittedEntry=omitted[id];if(!omittedEntry){return AVAILABILITY_READABLE$1;}if(omittedEntry.reason==="existence"){return AVAILABILITY_NOT_FOUND$1;}if(omittedEntry.reason==="permission"){return AVAILABILITY_PERMISSION_DENIED$1;}return null;}));}function search(client,textTerm,type,options){const searchWeighted=createWeightedSearch(type.to.map(crossDatasetType=>({name:crossDatasetType.type,// eslint-disable-next-line camelcase
__experimental_search:_internal.resolveSearchConfigForBaseFieldPaths(crossDatasetType,options.maxFieldDepth)})),client,options);return searchWeighted(textTerm,{includeDrafts:false}).pipe(// pick the 100 best matches
operators.map(results=>results.map(result=>result.hit)),operators.map(collate),operators.map(collated=>collated.map(entry=>({id:entry.id,type:entry.type,published:entry.published}))));}async function resolveUserDefinedFilter(options,document,valuePath,getClient){if(!options){return{};}if(typeof options.filter==="function"){const parentPath=valuePath.slice(0,-1);const parent=PathUtils.get(document,parentPath);const resolvedFilter=await options.filter({document,parentPath,parent,getClient});return resolvedFilter;}return{filter:options.filter,params:"filterParams"in options?options.filterParams:void 0};}function useValueRef(value){const ref=React.useRef(value);ref.current=value;return ref;}function StudioCrossDatasetReferenceInput(props){const{path,schemaType}=props;const source=useSource();const client=source.getClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const documentPreviewStore=useDocumentPreviewStore();const getClient=source.getClient;const crossDatasetClient=React.useMemo(()=>{return client.withConfig({dataset:schemaType.dataset,apiVersion:"2023-11-13",ignoreBrowserTokenWarning:true}).clone();},[client,schemaType.dataset]);const maxFieldDepth=useSearchMaxFieldDepth(crossDatasetClient);const documentValue=useFormValue([]);const documentRef=useValueRef(documentValue);const handleSearch=React.useCallback(searchString=>rxjs.from(resolveUserDefinedFilter(schemaType.options,documentRef.current,path,getClient)).pipe(operators.mergeMap(_ref189=>{let{filter,params}=_ref189;return search(crossDatasetClient,searchString,schemaType,{...schemaType.options,filter,params,tag:"search.cross-dataset-reference",maxFieldDepth});}),operators.catchError(err=>{var _a;const isQueryError=err.details&&err.details.type==="queryParseError";if(((_a=schemaType.options)==null?void 0:_a.filter)&&isQueryError){err.message='Invalid reference filter, please check the custom "filter" option';}return rxjs.throwError(err);})),[crossDatasetClient,documentRef,path,schemaType,maxFieldDepth,getClient]);const getReferenceInfo=React.useMemo(()=>createGetReferenceInfo({client:crossDatasetClient,documentPreviewStore}),[crossDatasetClient,documentPreviewStore]);return/* @__PURE__ */jsxRuntime.jsx(CrossDatasetReferenceInput,{...props,getReferenceInfo,onSearch:handleSearch});}function WithReferencedAsset(props){const{reference,children,observeAsset,waitPlaceholder}=props;const documentId=reference==null?void 0:reference._ref;const asset=reactRx.useMemoObservable(()=>observeAsset(documentId),[documentId,observeAsset]);return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:documentId&&asset?children(asset):waitPlaceholder});}var __freeze$1u=Object.freeze;var __defProp$1u=Object.defineProperty;var __template$1u=(cooked,raw)=>__freeze$1u(__defProp$1u(cooked,"raw",{value:__freeze$1u(raw||cooked.slice())}));var _a$1u;const FileMenuItem=styled__default.default(TooltipDelayGroupProvider.MenuItem)(_a$1u||(_a$1u=__template$1u(["\n  position: relative;\n\n  & input {\n    overflow: hidden;\n    overflow: clip;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    min-width: 0;\n    display: block;\n    appearance: none;\n    padding: 0;\n    margin: 0;\n    border: 0;\n    opacity: 0;\n  }\n"])));const FileInputMenuItem=React.forwardRef(function FileInputMenuItem2(props,forwardedRef){const{icon,id:idProp,accept,capture,multiple,onSelect,text,disabled,...rest}=props;const id="".concat(idProp||"","-").concat(React.useId());const handleChange=React.useCallback(event=>{if(onSelect&&event.target.files){onSelect(Array.from(event.target.files));}},[onSelect]);const renderMenuItem=React.useCallback(item=>/* @__PURE__ */jsxRuntime.jsxs("div",{children:[item,/* @__PURE__ */jsxRuntime.jsx("input",{"data-testid":"file-menuitem-input",accept,capture,id,multiple,onChange:handleChange,type:"file",value:"",disabled})]}),[accept,capture,disabled,handleChange,id,multiple]);return/* @__PURE__ */jsxRuntime.jsx(FileMenuItem,{...rest,htmlFor:id,disabled,ref:forwardedRef,icon,text,renderMenuItem});});function ActionsMenu(props){const{onUpload,onReset,readOnly,accept,directUploads,browse,downloadUrl,copyUrl}=props;const{push:pushToast}=ui.useToast();const{t}=useTranslation();const handleCopyURL=React.useCallback(()=>{navigator.clipboard.writeText(copyUrl||"");pushToast({closable:true,status:"success",title:t("inputs.files.common.actions-menu.notification.url-copied")});},[copyUrl,pushToast,t]);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(FileInputMenuItem,{icon:icons.UploadIcon,onSelect:onUpload,accept,text:t("inputs.files.common.actions-menu.upload.label"),"data-testid":"file-input-upload-button",disabled:readOnly||!directUploads}),browse,(downloadUrl||copyUrl)&&/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{}),downloadUrl&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:"a",icon:icons.DownloadIcon,text:t("inputs.files.common.actions-menu.download.label"),href:downloadUrl}),copyUrl&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{icon:icons.CopyIcon,text:t("inputs.files.common.actions-menu.copy-url.label"),onClick:handleCopyURL}),/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{tone:"critical",icon:icons.ResetIcon,text:t("inputs.files.common.actions-menu.clear-field.label"),onClick:onReset,disabled:readOnly,"data-testid":"file-input-clear"})]});}function urlToFile(url,filename){return new Promise((resolve,reject)=>{const xhr=new XMLHttpRequest();xhr.onload=()=>{const reader=new FileReader();reader.onloadend=()=>{var _a;const string=(_a=reader.result)==null?void 0:_a.toString();const ext=string==null?void 0:string.substring("data:image/".length,string.indexOf(";base64"));if(!ext&&!filename){reject(new Error("Could not find mime type for image"));return;}resolve(dataURLtoFile(reader.result,filename||"".concat(uuid.uuid(),".").concat(ext)));};reader.readAsDataURL(xhr.response);};xhr.onerror=error=>{reject(error);};xhr.open("GET",url);xhr.responseType="blob";xhr.send();});}function base64ToFile(base64Data,filename){return new Promise((resolve,reject)=>{const string=base64Data.toString();const ext=string.substring("data:image/".length,string.indexOf(";base64"));if(!ext&&!filename){reject(new Error("Could not find mime type for image"));return;}resolve(dataURLtoFile(base64Data,filename||"".concat(uuid.uuid(),".").concat(ext)));});}function dataURLtoFile(dataurl,filename){var _a;const arr=dataurl.split(",");const mime=(_a=arr[0].match(/:(.*?);/))==null?void 0:_a[1];const bstr=atob(arr[1]);let n=bstr.length;const u8arr=new Uint8Array(n);while(n--){u8arr[n]=bstr.charCodeAt(n);}return new File([u8arr],filename,{type:mime});}function handleSelectAssetFromSource(_ref190){let{assetFromSource,onChange,type,resolveUploader,uploadWith,isImage}=_ref190;if(!assetFromSource){throw new Error("No asset given");}if(!Array.isArray(assetFromSource)||assetFromSource.length===0){throw new Error("Returned value must be an array with at least one item (asset)");}const firstAsset=assetFromSource[0];const assetProps=firstAsset.assetDocumentProps;const originalFilename=assetProps==null?void 0:assetProps.originalFilename;const label=assetProps==null?void 0:assetProps.label;const title=assetProps==null?void 0:assetProps.title;const description=assetProps==null?void 0:assetProps.description;const creditLine=assetProps==null?void 0:assetProps.creditLine;const source=assetProps==null?void 0:assetProps.source;const imagePatches=isImage?[unset(["hotspot"]),unset(["crop"])]:[];switch(firstAsset.kind){case"assetDocumentId":onChange([setIfMissing({_type:type.name}),...imagePatches,set({_type:"reference",_ref:firstAsset.value},["asset"])]);break;case"file":{const uploader=resolveUploader(type,firstAsset.value);if(uploader){uploadWith(uploader,firstAsset.value,{label,title,description,creditLine,source});}break;}case"base64":base64ToFile(firstAsset.value,originalFilename).then(file=>{const uploader=resolveUploader(type,file);if(uploader){uploadWith(uploader,file,{label,title,description,creditLine,source});}});break;case"url":urlToFile(firstAsset.value,originalFilename).then(file=>{const uploader=resolveUploader(type,file);if(uploader){uploadWith(uploader,file,{label,title,description,creditLine,source});}});break;default:{throw new Error("Invalid value returned from asset source plugin");}}}var __freeze$1t=Object.freeze;var __defProp$1t=Object.defineProperty;var __template$1t=(cooked,raw)=>__freeze$1t(__defProp$1t(cooked,"raw",{value:__freeze$1t(raw||cooked.slice())}));var _a$1t;const RootFlex$4=styled__default.default(ui.Flex)(_a$1t||(_a$1t=__template$1t(["\n  pointer-events: none;\n"])));function PlaceholderText(props){const{hoveringFiles,type,readOnly,acceptedFiles,rejectedFilesCount,directUploads}=props;const isFileType=type==="file";const{t}=useTranslation();const messageIcon=React.useMemo(()=>{if(readOnly){return/* @__PURE__ */jsxRuntime.jsx(icons.ReadOnlyIcon,{});}if(hoveringFiles&&rejectedFilesCount>0||!directUploads){return/* @__PURE__ */jsxRuntime.jsx(icons.AccessDeniedIcon,{});}return isFileType?/* @__PURE__ */jsxRuntime.jsx(icons.BinaryDocumentIcon,{}):/* @__PURE__ */jsxRuntime.jsx(icons.ImageIcon,{});},[directUploads,hoveringFiles,isFileType,readOnly,rejectedFilesCount]);const messageText=React.useMemo(()=>{if(!directUploads){return t("inputs.files.common.placeholder.upload-not-supported");}if(readOnly){return t("inputs.files.common.placeholder.read-only");}if(hoveringFiles&&directUploads&&!readOnly){if(acceptedFiles.length>0){return t("inputs.files.common.placeholder.drop-to-upload",{context:type});}if(rejectedFilesCount>0){return t("inputs.files.common.placeholder.cannot-upload-some-files",{count:rejectedFilesCount});}}return t("inputs.files.common.placeholder.drag-or-paste-to-upload",{context:type});},[acceptedFiles.length,directUploads,hoveringFiles,readOnly,rejectedFilesCount,t,type]);return/* @__PURE__ */jsxRuntime.jsxs(RootFlex$4,{align:"center",gap:3,justify:"center",paddingLeft:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:messageIcon}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,children:messageText})]});}const FileTarget=withFocusRing(fileTarget(ui.Card));var __freeze$1s=Object.freeze;var __defProp$1s=Object.defineProperty;var __template$1s=(cooked,raw)=>__freeze$1s(__defProp$1s(cooked,"raw",{value:__freeze$1s(raw||cooked.slice())}));var _a$1s;const FileButton=styled__default.default(TooltipDelayGroupProvider.Button).attrs({forwardedAs:"label"})(_ref191=>{let{theme}=_ref191;const{focusRing}=theme.sanity;const base=theme.sanity.color.base;const border={width:1,color:"var(--card-border-color)"};return styled.css(_a$1s||(_a$1s=__template$1s(["\n      &:not([data-disabled='true']) {\n        &:focus-within {\n          box-shadow: ",";\n        }\n      }\n\n      // The underlying file input is rendered as children within a Sanity UI <Button> component.\n      // The below visibly hides it by targeting the input's parent <span> element, which is\n      // added by the <Button> component.\n      // TODO: refactor, avoid nth-child selector usage\n      & > span:nth-child(2) {\n        overflow: hidden;\n        overflow: clip;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        position: absolute;\n        min-width: 0;\n        display: block;\n        appearance: none;\n        padding: 0;\n        margin: 0;\n        border: 0;\n        opacity: 0;\n      }\n    "])),focusRingStyle$1({base,border,focusRing}));});const FileInputButton=React.forwardRef(function FileInputButton2(props,forwardedRef){const{icon,id:idProp,accept,capture,multiple,onSelect,text,disabled,...rest}=props;const id="".concat(idProp||"","-").concat(React.useId());const handleChange=React.useCallback(event=>{if(onSelect&&event.target.files){onSelect(Array.from(event.target.files));}},[onSelect]);return/* @__PURE__ */jsxRuntime.jsx(FileButton,{...rest,icon,text,htmlFor:id,disabled,children:/* @__PURE__ */jsxRuntime.jsx("input",{"data-testid":"file-button-input",accept,capture,id,multiple,onChange:handleChange,ref:forwardedRef,type:"file",value:"",disabled})});});function UploadPlaceholderComponent(props){const{accept,acceptedFiles,browse,directUploads,hoveringFiles,onUpload,readOnly,rejectedFilesCount,type}=props;const[rootElement,setRootElement]=React.useState(null);const rect=ui.useElementSize(rootElement);const collapsed=(rect==null?void 0:rect.border)&&rect.border.width<440;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:collapsed?void 0:"center",direction:collapsed?"column":"row",gap:4,justify:"space-between",paddingY:collapsed?1:void 0,ref:setRootElement,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(PlaceholderText,{acceptedFiles,directUploads,hoveringFiles,readOnly,rejectedFilesCount,type})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:1,justify:"center",wrap:"wrap",children:[/* @__PURE__ */jsxRuntime.jsx(FileInputButton,{accept,"data-testid":"file-input-upload-button",disabled:readOnly||!directUploads,icon:icons.UploadIcon,mode:"bleed",onSelect:onUpload,text:t("input.files.common.upload-placeholder.file-input-button.text")}),browse]})]});}const UploadPlaceholder=React.memo(UploadPlaceholderComponent);const STALE_UPLOAD_MS=1e3*60*2;var __freeze$1r=Object.freeze;var __defProp$1r=Object.defineProperty;var __template$1r=(cooked,raw)=>__freeze$1r(__defProp$1r(cooked,"raw",{value:__freeze$1r(raw||cooked.slice())}));var _a$1r,_b$I,_c$p,_d$f;const CardWrapper=styled__default.default(ui.Card)(_a$1r||(_a$1r=__template$1r(["\n  min-height: 82px;\n  box-sizing: border-box;\n"])));const FlexWrapper=styled__default.default(ui.Flex)(_b$I||(_b$I=__template$1r(["\n  text-overflow: ellipsis;\n  overflow: hidden;\n  overflow: clip;\n"])));const LeftSection=styled__default.default(ui.Stack)(_c$p||(_c$p=__template$1r(["\n  position: relative;\n  width: 60%;\n"])));const CodeWrapper=styled__default.default(ui.Code)(_d$f||(_d$f=__template$1r(["\n  position: relative;\n  width: 100%;\n\n  code {\n    overflow: hidden;\n    overflow: clip;\n    text-overflow: ellipsis;\n    position: relative;\n    max-width: 200px;\n  }\n"])));const elapsedMs=date=>(/* @__PURE__ */new Date()).getTime()-new Date(date).getTime();function UploadProgress(_ref192){let{uploadState,onCancel,onStale,height}=_ref192;const filename=uploadState.file.name;React.useEffect(()=>{if(elapsedMs(uploadState.updatedAt)>STALE_UPLOAD_MS){onStale==null?void 0:onStale();}},[uploadState.updatedAt,onStale]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(CardWrapper,{tone:"primary",padding:4,border:true,style:{height:"".concat(height,"px")},children:/* @__PURE__ */jsxRuntime.jsxs(FlexWrapper,{align:"center",justify:"space-between",height:"fill",direction:"row",gap:2,children:[/* @__PURE__ */jsxRuntime.jsxs(LeftSection,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{justify:"center",gap:[3,3,2,2],direction:["column","column","row"],children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Inline,{space:2,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"input.files.common.upload-progress",components:{FileName:()=>/* @__PURE__ */jsxRuntime.jsx(CodeWrapper,{size:1,children:filename?filename:"\u2026"})}})})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,marginTop:3,radius:5,children:/* @__PURE__ */jsxRuntime.jsx(LinearProgress,{value:uploadState.progress})})]}),onCancel?/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",onClick:onCancel,text:t("input.files.common.cancel-upload"),tone:"critical"}):null]})});}function UploadWarning(_ref193){let{onClearStale}=_ref193;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{tone:"caution",padding:4,border:true,radius:2,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:4,marginBottom:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:t("inputs.files.common.stale-upload-warning.title")}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:t("inputs.files.common.stale-upload-warning.description",{staleThresholdMinutes:Math.ceil(STALE_UPLOAD_MS/1e3/60)})})]})]}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.ResetIcon,mode:"ghost",onClick:onClearStale,text:t("inputs.files.common.stale-upload-warning.clear"),width:"fill"})]});}function formatBytes(bytes){let decimals=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;if(bytes===0)return"0 Bytes";const k=1024;const dm=decimals<0?0:decimals;const sizes=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"];const i=Math.floor(Math.log(bytes)/Math.log(k));return"".concat(parseFloat((bytes/Math.pow(k,i)).toFixed(dm))," ").concat(sizes[i]);}function FileActionsMenu(props){const{originalFilename,size,children,muted,disabled,onClick,isMenuOpen,onMenuOpen,setMenuButtonElement}=props;const[menuElement,setMenuElement]=React.useState(null);const[buttonElement,setButtonElement]=React.useState(null);const handleClick=React.useCallback(()=>onMenuOpen(true),[onMenuOpen]);ui.useGlobalKeyDown(React.useCallback(event=>{if(isMenuOpen&&(event.key==="Escape"||event.key==="Tab")){onMenuOpen(false);buttonElement==null?void 0:buttonElement.focus();}},[isMenuOpen,onMenuOpen,buttonElement]));ui.useClickOutside(React.useCallback(event=>{if(!(buttonElement==null?void 0:buttonElement.contains(event.target))){onMenuOpen(false);}},[buttonElement,onMenuOpen]),[menuElement]);const setOptionsButtonRef=React.useCallback(el=>{setMenuButtonElement(el);setButtonElement(el);},[setMenuButtonElement]);React.useEffect(()=>{if(isMenuOpen){menuElement==null?void 0:menuElement.focus();}},[isMenuOpen,menuElement]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{wrap:"nowrap",justify:"space-between",align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{as:muted||disabled?void 0:"button",radius:2,padding:2,tone:"inherit",onClick,flex:1,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{wrap:"nowrap",align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:3,tone:"transparent",shadow:1,radius:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted,children:/* @__PURE__ */jsxRuntime.jsx(icons.BinaryDocumentIcon,{})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{flex:1,space:2,marginLeft:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,textOverflow:"ellipsis",muted,"data-testid":"file-name",weight:"medium",children:originalFilename}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,"data-testid":"file-size",children:formatBytes(size)})]})]})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{justify:"center",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{content:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{ref:setMenuElement,children}),id:"file-actions-menu",portal:true,open:isMenuOpen,constrainSize:true,children:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{"aria-label":t("inputs.file.actions-menu.file-options.aria-label"),"data-testid":"options-menu-button",onClick:handleClick,paddingY:3,ref:setOptionsButtonRef})})})})]});}function FileSkeleton$1(){return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",justify:"flex-start",padding:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Skeleton,{padding:3,radius:1,animated:true}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{flex:1,space:2,marginLeft:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.TextSkeleton,{style:{width:"100%"},radius:1,animated:true}),/* @__PURE__ */jsxRuntime.jsx(ui.TextSkeleton,{style:{width:"100%"},radius:1,animated:true})]})]});}function InvalidFileWarning(_ref194){let{onClearValue}=_ref194;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{tone:"caution",padding:4,border:true,radius:2,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:4,marginBottom:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:t("inputs.file.invalid-file-warning.title")}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:t("inputs.file.invalid-file-warning.description")})]})]}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.ResetIcon,mode:"ghost",onClick:onClearValue,text:t("inputs.file.invalid-file-warning.reset-button.text"),width:"fill"})]});}var __freeze$1q=Object.freeze;var __defProp$1q=Object.defineProperty;var __template$1q=(cooked,raw)=>__freeze$1q(__defProp$1q(cooked,"raw",{value:__freeze$1q(raw||cooked.slice())}));var _a$1q,_b$H;const CardOverlay=styled__default.default(ui.Card)(_a$1q||(_a$1q=__template$1q(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n"])));const FlexContainer$1=styled__default.default(ui.Flex)(_b$H||(_b$H=__template$1q(["\n  height: 100%;\n"])));function passThrough$1(_ref195){let{children}=_ref195;return children;}const ASSET_FIELD_PATH$1=["asset"];class BaseFileInput extends React.PureComponent{constructor(props){var _this;super(props);_this=this;this.uploadSubscription=null;this.browseButtonElement=null;this.state={isUploading:false,selectedAssetSource:null,hoveringFiles:[],isStale:false,isMenuOpen:false};this.toast=null;this.handleRemoveButtonClick=()=>{const{path,value}=this.props;const parentPathSegment=path.slice(-1)[0];const isArrayElement=typeof parentPathSegment!=="string";const allKeys=Object.keys(value||{});const remainingKeys=allKeys.filter(key=>!["_type","_key","_upload","asset"].includes(key));const isEmpty=remainingKeys.length===0;const removeKeys=["asset"].concat(allKeys.filter(key=>["_upload"].includes(key))).map(key=>unset([key]));this.props.onChange(PatchEvent.from(isEmpty&&!isArrayElement?unset():removeKeys));};this.handleCancelUpload=()=>{this.cancelUpload();};this.handleClearUploadState=()=>{this.setState({isStale:false});this.clearUploadStatus();};this.handleStaleUpload=()=>{this.setState({isStale:true});};this.handleClearField=()=>{this.props.onChange(unset(["asset"]));};this.handleSelectFiles=files=>{const{directUploads,readOnly}=this.props;const{hoveringFiles}=this.state;if(directUploads&&!readOnly){this.uploadFirstAccepted(files);}else if(hoveringFiles.length>0){this.handleFilesOut();}};this.handleSelectFileFromAssetSource=source=>{this.setState({selectedAssetSource:source});};this.handleAssetSourceClosed=()=>{var _a;this.setState({selectedAssetSource:null});(_a=this.browseButtonElement)==null?void 0:_a.focus();};this.setBrowseButtonElement=el=>{this.browseButtonElement=el;};this.uploadWith=function(uploader,file){let assetDocumentProps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};const{schemaType,onChange,client,t}=_this.props;const{source}=assetDocumentProps;const options={metadata:get__default.default(schemaType,"options.metadata"),storeOriginalFilename:get__default.default(schemaType,"options.storeOriginalFilename"),source};_this.cancelUpload();_this.setState({isUploading:true});onChange(PatchEvent.from([setIfMissing({_type:schemaType.name})]));_this.uploadSubscription=uploader.upload(client,file,schemaType,options).subscribe({next:uploadEvent=>{if(uploadEvent.patches){onChange(PatchEvent.from(uploadEvent.patches));}},error:err=>{var _a;console.error(err);(_a=_this.toast)==null?void 0:_a.push({status:"error",description:t("inputs.file.upload-failed.description"),title:t("inputs.file.upload-failed.title")});_this.clearUploadStatus();},complete:()=>{_this.setState({isUploading:false});}});};this.handleSelectAssetFromSource=assetFromSource=>{const{onChange,schemaType,resolveUploader}=this.props;handleSelectAssetFromSource({assetFromSource,onChange,type:schemaType,resolveUploader,uploadWith:this.uploadWith});this.setState({selectedAssetSource:null});};this.handleFileTargetFocus=event=>{var _a;if(event.currentTarget===event.target&&event.currentTarget===((_a=this.props.elementProps.ref)==null?void 0:_a.current)){this.props.elementProps.onFocus(event);}};this.handleFilesOver=fileInfo=>{this.setState({hoveringFiles:fileInfo});};this.handleFilesOut=()=>{this.setState({hoveringFiles:[]});};this.handleUpload=_ref196=>{let{file,uploader}=_ref196;this.uploadWith(uploader,file);};this.setToast=toast=>{this.toast=toast;};this._assetFieldPath=props.path.concat(ASSET_FIELD_PATH$1);}clearUploadStatus(){var _a;if((_a=this.props.value)==null?void 0:_a._upload){this.props.onChange(PatchEvent.from([unset(["_upload"])]));}}cancelUpload(){if(this.uploadSubscription){this.uploadSubscription.unsubscribe();this.clearUploadStatus();}}uploadFirstAccepted(files){const{schemaType}=this.props;const match=files.map(file=>{var _a,_b;return{file,uploader:(_b=(_a=this.props).resolveUploader)==null?void 0:_b.call(_a,schemaType,file)};}).find(result=>result.uploader);if(match){this.uploadWith(match.uploader,match.file);}this.setState({isMenuOpen:false});}renderUploadState(uploadState){const{isUploading}=this.state;return/* @__PURE__ */jsxRuntime.jsx(UploadProgress,{uploadState,onCancel:isUploading?this.handleCancelUpload:void 0,onStale:this.handleStaleUpload});}renderAssetSource(){const{selectedAssetSource}=this.state;const{value,schemaType,observeAsset,t}=this.props;if(!selectedAssetSource){return null;}const accept=get__default.default(schemaType,"options.accept","");const Component=selectedAssetSource.component;if(value&&value.asset){return/* @__PURE__ */jsxRuntime.jsx(WithReferencedAsset,{observeAsset,reference:value.asset,waitPlaceholder:/* @__PURE__ */jsxRuntime.jsx(FileSkeleton$1,{}),children:fileAsset=>/* @__PURE__ */jsxRuntime.jsx(Component,{selectedAssets:[fileAsset],selectionType:"single",assetType:"file",accept,dialogHeaderTitle:t("inputs.file.dialog.title"),onClose:this.handleAssetSourceClosed,onSelect:this.handleSelectAssetFromSource})});}return/* @__PURE__ */jsxRuntime.jsx(Component,{selectedAssets:[],selectionType:"single",assetType:"file",accept,dialogHeaderTitle:t("inputs.file.dialog.title"),onClose:this.handleAssetSourceClosed,onSelect:this.handleSelectAssetFromSource});}renderAsset(){const{value,changed,readOnly,elementProps}=this.props;const{hoveringFiles,isStale}=this.state;const hasValueOrUpload=Boolean((value==null?void 0:value._upload)||(value==null?void 0:value.asset));if(value&&typeof value.asset!=="undefined"&&!(value==null?void 0:value._upload)&&!assetUtils.isFileSource(value)){return()=>/* @__PURE__ */jsxRuntime.jsx(InvalidFileWarning,{onClearValue:this.handleClearField});}return inputProps=>/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[isStale&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginBottom:2,children:/* @__PURE__ */jsxRuntime.jsx(UploadWarning,{onClearStale:this.handleClearUploadState})}),/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path:this._assetFieldPath,hasFocus:!!inputProps.focused,isChanged:changed,children:(value==null?void 0:value._upload)?this.renderUploadState(value._upload):/* @__PURE__ */jsxRuntime.jsx(FileTarget,{...elementProps,onFocus:this.handleFileTargetFocus,tabIndex:0,disabled:Boolean(readOnly),onFiles:this.handleSelectFiles,onFilesOver:this.handleFilesOver,onFilesOut:this.handleFilesOut,tone:this.getFileTone(),$border:hasValueOrUpload||hoveringFiles.length>0,style:{padding:1},sizing:"border",radius:2,children:/* @__PURE__ */jsxRuntime.jsxs("div",{style:{position:"relative"},children:[!(value==null?void 0:value.asset)&&this.renderUploadPlaceholder(),(value==null?void 0:value.asset)&&hoveringFiles.length>0?this.renderAssetMenu(this.getFileTone()):null,!(value==null?void 0:value._upload)&&(value==null?void 0:value.asset)&&this.renderPreview()]})})})]});}renderPreview(){const{value,readOnly,assetSources,schemaType,directUploads,observeAsset,t}=this.props;const{isMenuOpen}=this.state;const asset=value==null?void 0:value.asset;if(!asset){return null;}const accept=get__default.default(schemaType,"options.accept","");let browseMenuItem=assetSources&&(assetSources==null?void 0:assetSources.length)===0?null:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{icon:icons.SearchIcon,text:t("inputs.file.browse-button.text"),onClick:()=>{this.setState({isMenuOpen:false});this.handleSelectFileFromAssetSource(assetSources[0]);},disabled:readOnly,"data-testid":"file-input-browse-button"});if(assetSources.length>1){browseMenuItem=assetSources.map(assetSource=>{return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:(assetSource.i18nKey?t(assetSource.i18nKey):assetSource.title)||startCase__default.default(assetSource.name),onClick:()=>{this.setState({isMenuOpen:false});this.handleSelectFileFromAssetSource(assetSource);},icon:assetSource.icon||icons.ImageIcon,disabled:readOnly,"data-testid":"file-input-browse-button-".concat(assetSource.name)},assetSource.name);});}return/* @__PURE__ */jsxRuntime.jsx(WithReferencedAsset,{reference:asset,observeAsset,waitPlaceholder:/* @__PURE__ */jsxRuntime.jsx(FileSkeleton$1,{}),children:_ref197=>{let{originalFilename,extension,url,size}=_ref197;const filename=originalFilename||"download.".concat(extension);let copyUrl;let downloadUrl;if(assetUtils.isFileSource(value)){downloadUrl="".concat(url,"?dl");copyUrl=url;}return/* @__PURE__ */jsxRuntime.jsx(FileActionsMenu,{size,originalFilename:filename,muted:!readOnly,onMenuOpen:isOpen=>this.setState({isMenuOpen:isOpen}),isMenuOpen,setMenuButtonElement:this.setBrowseButtonElement,children:/* @__PURE__ */jsxRuntime.jsx(ActionsMenu,{onUpload:this.handleSelectFiles,browse:browseMenuItem,onReset:this.handleRemoveButtonClick,downloadUrl,copyUrl,readOnly,accept,directUploads})});}});}renderAssetMenu(tone){const{schemaType,readOnly,directUploads,resolveUploader}=this.props;const{hoveringFiles}=this.state;const acceptedFiles=hoveringFiles.filter(file=>resolveUploader==null?void 0:resolveUploader(schemaType,file));const rejectedFilesCount=hoveringFiles.length-acceptedFiles.length;return/* @__PURE__ */jsxRuntime.jsx(CardOverlay,{radius:2,tone,children:/* @__PURE__ */jsxRuntime.jsx(FlexContainer$1,{align:"center",justify:"center",gap:2,flex:1,children:/* @__PURE__ */jsxRuntime.jsx(PlaceholderText,{readOnly,hoveringFiles,acceptedFiles,rejectedFilesCount,directUploads,type:"file"})})});}renderBrowser(){const{assetSources,readOnly,directUploads,id,t}=this.props;if(assetSources.length===0)return null;if(assetSources.length>1&&!readOnly&&directUploads){return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{id:"".concat(id,"_assetFileButton"),ref:this.setBrowseButtonElement,button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"bleed",text:t("inputs.file.multi-browse-button.text"),"data-testid":"file-input-multi-browse-button",icon:icons.SearchIcon}),"data-testid":"input-select-button",menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:assetSources.map(assetSource=>{return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:assetSource.title,onClick:()=>{this.setState({isMenuOpen:false});this.handleSelectFileFromAssetSource(assetSource);},icon:assetSource.icon||icons.ImageIcon,disabled:readOnly,"data-testid":"file-input-browse-button-".concat(assetSource.name)},assetSource.name);})})});}return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{text:t("inputs.file.browse-button.text"),icon:icons.SearchIcon,mode:"bleed",onClick:()=>{this.setState({isMenuOpen:false});this.handleSelectFileFromAssetSource(assetSources[0]);},"data-testid":"file-input-browse-button",disabled:readOnly,ref:this.setBrowseButtonElement});}renderUploadPlaceholder(){const{readOnly,schemaType,directUploads,resolveUploader}=this.props;const{hoveringFiles}=this.state;const acceptedFiles=hoveringFiles.filter(file=>resolveUploader==null?void 0:resolveUploader(schemaType,file));const rejectedFilesCount=hoveringFiles.length-acceptedFiles.length;const accept=get__default.default(schemaType,"options.accept","");return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{tone:readOnly?"transparent":"inherit",border:true,paddingX:3,paddingY:2,radius:2,style:hoveringFiles.length===0?{borderStyle:"dashed"}:{borderStyle:"dashed",borderColor:"transparent"},children:/* @__PURE__ */jsxRuntime.jsx(UploadPlaceholder,{browse:this.renderBrowser(),onUpload:this.handleSelectFiles,readOnly,hoveringFiles,acceptedFiles,rejectedFilesCount,type:"file",accept,directUploads})})});}getFileTone(){const{directUploads,schemaType,value,readOnly,resolveUploader}=this.props;const{hoveringFiles}=this.state;const acceptedFiles=hoveringFiles.filter(file=>resolveUploader==null?void 0:resolveUploader(schemaType,file));const rejectedFilesCount=hoveringFiles.length-acceptedFiles.length;if(hoveringFiles.length>0){if(rejectedFilesCount>0||!directUploads){return"critical";}}if(!(value==null?void 0:value._upload)&&!readOnly&&hoveringFiles.length>0){return"primary";}return(value==null?void 0:value._upload)&&(value==null?void 0:value.asset)&&readOnly?"transparent":"default";}render(){const{members,renderAnnotation,renderBlock,renderInlineBlock,renderItem,renderInput,renderField,renderPreview,t}=this.props;const{selectedAssetSource}=this.state;return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ImperativeToast,{ref:this.setToast}),members.map(member=>{if(member.kind==="field"&&(member.name==="crop"||member.name==="hotspot")){return null;}if(member.kind==="field"){return/* @__PURE__ */jsxRuntime.jsx(MemberField,{member,renderAnnotation,renderInlineBlock,renderBlock,renderInput:member.name==="asset"?this.renderAsset():renderInput,renderField:member.name==="asset"?passThrough$1:renderField,renderItem,renderPreview},member.key);}if(member.kind==="fieldSet"){return/* @__PURE__ */jsxRuntime.jsx(MemberFieldSet,{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview},member.key);}if(member.kind==="error"){return/* @__PURE__ */jsxRuntime.jsx(MemberFieldError,{member},member.key);}return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:t("inputs.file.error.unknown-member-kind",{kind:member.kind})});}),selectedAssetSource&&this.renderAssetSource()]});}}function StudioFileInput(props){var _a;const sourcesFromSchema=(_a=props.schemaType.options)==null?void 0:_a.sources;const documentPreviewStore=useDocumentPreviewStore();const{file:fileConfig}=useFormBuilder().__internal;const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const{t}=useTranslation();const resolveUploader$1=React.useCallback((type,file)=>{if(!fileConfig.directUploads){return null;}return resolveUploader(type,file);},[fileConfig.directUploads]);const assetSources=React.useMemo(()=>sourcesFromSchema||fileConfig.assetSources,[fileConfig,sourcesFromSchema]);const observeAsset=React.useCallback(id=>observeFileAsset(documentPreviewStore,id),[documentPreviewStore]);return/* @__PURE__ */jsxRuntime.jsx(BaseFileInput,{...props,t,client,assetSources,directUploads:fileConfig.directUploads,observeAsset,resolveUploader:resolveUploader$1});}var __freeze$1p=Object.freeze;var __defProp$1p=Object.defineProperty;var __template$1p=(cooked,raw)=>__freeze$1p(__defProp$1p(cooked,"raw",{value:__freeze$1p(raw||cooked.slice())}));var _a$1p;const RatioBox$1=styled__default.default(ui.Box)(_a$1p||(_a$1p=__template$1p(["\n  position: relative;\n  padding-bottom: calc("," * 100%);\n\n  & > div {\n    position: absolute;\n    top: ","px;\n    left: ","px;\n    right: ","px;\n    bottom: ","px;\n  }\n"])),_ref198=>{let{ratio=3/2}=_ref198;return 1/ratio;},_ref199=>{let{padding=0}=_ref199;return padding;},_ref200=>{let{padding=0}=_ref200;return padding;},_ref201=>{let{padding=0}=_ref201;return padding;},_ref202=>{let{padding=0}=_ref202;return padding;});const DEFAULT_HOTSPOT={x:0.5,y:0.5,height:1,width:1};const DEFAULT_CROP={top:0,left:0,right:0,bottom:0};function calculateStyles(){let options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const imageAspect=readAspectRatio(options.image)||1;const hotspot=options.hotspot||DEFAULT_HOTSPOT;const crop=options.crop||DEFAULT_CROP;const containerAspect=readAspectRatio(options.container)||imageAspect*readCropAspect(crop);const align=options.align||{x:"center",y:"center"};const result=calculateHotSpotCrop(imageAspect,{hotspot,crop},{aspect:containerAspect,align});const containerHeight=styleFormat(round(100/containerAspect));return{debug:{result},container:{//outline: '1px solid cyan',
overflow:"hidden",position:"relative",width:"100%",height:containerHeight},padding:{marginTop:containerHeight},crop:{position:"absolute",overflow:"hidden",height:toStylePercentage(result.crop.height),width:toStylePercentage(result.crop.width),top:toStylePercentage(result.crop.top),left:toStylePercentage(result.crop.left)},image:{position:"absolute",height:toStylePercentage(result.image.height),width:toStylePercentage(result.image.width),top:toStylePercentage(result.image.top),left:toStylePercentage(result.image.left)}};}function readAspectRatio(opts){if(!opts){return null;}if("aspectRatio"in opts){return opts.aspectRatio;}if("height"in opts||"width"in opts){if(typeof opts.height!=="number"&&typeof opts.width!=="number"){throw new Error("Height and width must be numbers, got ".concat(JSON.stringify(opts)));}return opts.width/opts.height;}return null;}function round(num){let decimals=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;const multiplier=Math.pow(10,decimals);return Math.round(num*multiplier)/multiplier;}function calculateHotSpotCrop(sourceAspect,descriptor,spec){const crop=descriptor.crop;const viewportAspect=spec.aspect;const alignment=spec.align;const netWidth=1-crop.left-crop.right;const netHeight=1-crop.top-crop.bottom;const outImg={top:-crop.top/netHeight,left:-crop.left/netWidth,width:1/netWidth,height:1/netHeight};const cropRationalAspect=netWidth/netHeight;const cropAspect=cropRationalAspect*sourceAspect;const hotspot={x:(descriptor.hotspot.x-crop.left)/netWidth,y:(descriptor.hotspot.y-crop.top)/netHeight,height:descriptor.hotspot.height/netHeight,width:descriptor.hotspot.width/netWidth};const maxHotspotXScale=1/hotspot.width;const maxHotspotYScale=1/hotspot.height*cropAspect/viewportAspect;const maxScale=Math.min(maxHotspotXScale,maxHotspotYScale);let minFullBleedScale;const cropIsTaller=cropAspect<=viewportAspect;if(cropIsTaller){minFullBleedScale=1;}else{minFullBleedScale=cropAspect/viewportAspect;}let method;let outCrop;if(minFullBleedScale>maxScale){method="letterbox";let letterboxScale;const diff=minFullBleedScale-maxScale;if(cropIsTaller){letterboxScale=1-diff;}else{letterboxScale=maxScale;}outCrop={width:letterboxScale,height:letterboxScale/cropAspect*viewportAspect,// Gets overwritten further down
left:0,top:0};const hotspotLeft=hotspot.x*outCrop.width-hotspot.width*outCrop.width/2;switch(alignment.x){case"left":outCrop.left=cropIsTaller?0:-hotspotLeft;break;case"right":outCrop.left=cropIsTaller?1-outCrop.width:hotspotLeft;break;case"center":outCrop.left=cropIsTaller?(1-outCrop.width)/2:-hotspotLeft;break;default:throw new Error("Invalid x alignment: '".concat(alignment.x,"'. Must be either 'left', 'right' or 'center'"));}const hotspotTop=hotspot.y*outCrop.height-hotspot.height*outCrop.height/2;switch(alignment.y){case"top":outCrop.top=cropIsTaller?-hotspotTop:0;break;case"bottom":outCrop.top=hotspotTop;break;case"center":outCrop.top=cropIsTaller?-hotspotTop:(1-outCrop.height)/2;break;default:throw new Error("Invalid y alignment: '".concat(alignment.y,"'. Must be either 'top', 'bottom' or 'center'"));}}else if(cropIsTaller){method="full_width";let top=-hotspot.y/cropAspect*viewportAspect+0.5;const height=minFullBleedScale/cropAspect*viewportAspect;if(top>0){top=0;}else if(-top>height-1){top=-(height-1);}outCrop={width:minFullBleedScale,height,left:0,// Place the Y center of the hotspot near the center of the viewport
top};}else{method="full_height";const width=minFullBleedScale;let left=0.5-hotspot.x*minFullBleedScale;if(left>0){left=0;}else if(-left>width-1){left=-(width-1);}outCrop={width,height:minFullBleedScale/cropAspect*viewportAspect,top:0,// Place the X center of the hotspot at the center of the viewport
left};}return{method,crop:outCrop,image:outImg};}function readCropAspect(crop){const height=1-crop.top-crop.bottom;const width=1-crop.left-crop.right;return width/height;}function styleFormat(num){return num===0?0:"".concat(num,"%");}function toStylePercentage(num){return styleFormat(round(num*100));}var __freeze$1o=Object.freeze;var __defProp$1o=Object.defineProperty;var __template$1o=(cooked,raw)=>__freeze$1o(__defProp$1o(cooked,"raw",{value:__freeze$1o(raw||cooked.slice())}));var _a$1o;const HotspotImageContainer=styled__default.default.div(_a$1o||(_a$1o=__template$1o(["\n  position: relative;\n  width: 100%;\n"])));const debug$2=debug__default.default("sanity-imagetool");function getCropAspect(crop,srcAspect){const origHeight=1/srcAspect;const origWidth=srcAspect*origHeight;const cropWidth=origWidth-(crop.left+crop.right)*origWidth;const cropHeight=origHeight-(crop.top+crop.bottom)*origHeight;return cropWidth/cropHeight;}const HotspotImage=React.memo(function HotspotImage2(props){const{alignX="center",alignY="center",alt,aspectRatio="none",className="",crop=DEFAULT_CROP,hotspot=DEFAULT_HOTSPOT,onError,onLoad,src,srcAspectRatio,srcSet,style}=props;const[containerAspect,setContainerAspect]=React.useState(null);const containerElementRef=React.useRef(null);const imageElementRef=React.useRef(null);const updateContainerAspect=React.useCallback(()=>{if(!containerElementRef.current)return;if(aspectRatio==="auto"){const parentNode=containerElementRef.current.parentNode;React.startTransition(()=>setContainerAspect(parentNode.offsetWidth/parentNode.offsetHeight));}else{setContainerAspect(null);}},[aspectRatio]);React.useEffect(()=>{const imageElement=imageElementRef.current;const alreadyLoaded=imageElement&&imageElement.src&&imageElement.complete&&imageElement.naturalWidth!==void 0;if(alreadyLoaded){debug$2("Image '%s' already loaded, refreshing (from cache) to trigger onLoad / onError",src);imageElement.src=imageElement.src;}updateContainerAspect();window.addEventListener("resize",updateContainerAspect);return()=>{window.removeEventListener("resize",updateContainerAspect);};},[src,updateContainerAspect]);const targetAspect=React.useMemo(()=>{if(aspectRatio==="none"){return crop?getCropAspect(crop,srcAspectRatio):srcAspectRatio;}if(aspectRatio==="auto"){return containerAspect;}return aspectRatio||null;},[aspectRatio,containerAspect,crop,srcAspectRatio]);const targetStyles=React.useMemo(()=>calculateStyles({container:{aspectRatio:targetAspect||srcAspectRatio},image:{aspectRatio:srcAspectRatio},hotspot,crop,align:{x:alignX,y:alignY}}),[alignX,alignY,crop,hotspot,srcAspectRatio,targetAspect]);return/* @__PURE__ */jsxRuntime.jsx(HotspotImageContainer,{className:"".concat(className),style,ref:containerElementRef,children:/* @__PURE__ */jsxRuntime.jsxs("div",{style:targetStyles.container,children:[/* @__PURE__ */jsxRuntime.jsx("div",{style:targetStyles.padding}),/* @__PURE__ */jsxRuntime.jsx("div",{style:targetStyles.crop,children:/* @__PURE__ */jsxRuntime.jsx("img",{ref:imageElementRef,src,alt,srcSet,onLoad,onError,style:targetStyles.image})})]})});});function ImageLoader(props){const{src,children}=props;const[isLoading,setIsLoading]=React.useState(true);const[image,setImage]=React.useState(null);const[error,setError]=React.useState(null);React.useEffect(()=>{setImage(null);setError(null);setIsLoading(true);const image2=new Image();image2.onload=()=>{setImage(image2);setError(null);setIsLoading(false);};image2.onerror=()=>{setError(new Error("Could not load image from ".concat(JSON.stringify(src))));setIsLoading(false);};image2.referrerPolicy="strict-origin-when-cross-origin";image2.src=src;},[src]);return children({image,error,isLoading});}function Resize(props){const{image,maxHeight,maxWidth,children}=props;const[canvas]=React.useState(()=>{const canvasElement=document.createElement("canvas");canvasElement.style.display="none";return canvasElement;});React.useEffect(()=>{document.body.appendChild(canvas);return()=>{document.body.removeChild(canvas);};},[canvas]);const resize=React.useCallback((image2,maxHeight2,maxWidth2)=>{const ratio=image2.width/image2.height;const width=Math.min(image2.width,maxWidth2);const height=Math.min(image2.height,maxHeight2);const landscape=image2.width>image2.height;const targetWidth=landscape?width:height*ratio;const targetHeight=landscape?width/ratio:height;canvas.width=targetWidth;canvas.height=targetHeight;const ctx=canvas.getContext("2d");if(ctx){ctx.drawImage(image2,0,0,image2.width,image2.height,0,0,targetWidth,targetHeight);}return canvas;},[canvas]);return children(resize(image,maxHeight,maxWidth));}class Point{constructor(x,y){this.x=x;this.y=y;}}class HLine{constructor(y,left,right){this.y=y;this._left=left;this._right=right;}get right(){return new Point(this._right,this.y);}get left(){return new Point(this._left,this.y);}get length(){return this._right-this._left;}}class Corners{constructor(rect){this.rect=rect;}get top(){return new HLine(this.rect.top,this.rect.left,this.rect.right);}get bottom(){return new HLine(this.rect.bottom,this.rect.left,this.rect.right);}}class Rect{// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
static fromEdges(_ref203){let{left,right,top,bottom}=_ref203;return new Rect(left,top,1-left-right,1-top-bottom);}constructor(){let left=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;let top=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;let width=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;let height=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;this.left=left;this.top=top;this.width=width;this.height=height;}setTopLeft(left,top){return new Rect(left,top,this.width||0,this.height||0);}setSize(width,height){return new Rect(this.left||0,this.top||0,width,height);}setCenter(x,y){const width=this.width||0;const height=this.height||0;return new Rect(x-width/2,y-height/2,width||0,height||0);}get center(){return new Point(this.left+this.width/2,this.top+this.height/2);}get corners(){return new Corners(this);}get right(){return this.left+this.width;}get bottom(){return this.top+this.height;}multiply(rect){return new Rect((this.left||0)+this.width*rect.left,(this.top||0)+this.height*rect.top,this.width*rect.width,this.height*rect.height);}grow(delta){return new Rect(this.left-delta,this.top-delta,this.width+delta*2,this.height+delta*2);}shrink(delta){return this.grow(-delta);}cropRelative(crop){const top=this.top+crop.top*this.height;const left=this.left+crop.left*this.width;const height=this.height*crop.height;const width=this.width*crop.width;return new Rect(left,top,width,height);}clamp(bounds){let{left,top,width,height}=this;if(bounds.width<width){width=bounds.width;left=bounds.left;}if(bounds.height<height){height=bounds.height;top=bounds.top;}if(left+width>bounds.left+bounds.width){left=bounds.right-width;}if(top+height>bounds.top+bounds.height){top=bounds.bottom-height;}return new Rect(Math.max(left,bounds.left),Math.max(top,bounds.top),width,height);}}function isPointInEllipse(point,ellipse){const center={x:ellipse.center.x,y:ellipse.center.y};const xradius=ellipse.width/2;const yradius=ellipse.height/2;if(xradius<=0||yradius<=0){return false;}const normalized={x:point.x-center.x,y:point.y-center.y};return Math.pow(normalized.x,2)/Math.pow(xradius,2)+Math.pow(normalized.y,2)/Math.pow(yradius,2)<=1;}function isPointInCircle(_ref204,circle){let{x,y}=_ref204;return Math.pow(x-circle.x,2)+Math.pow(y-circle.y,2)<Math.pow(circle.radius,2);}function isPointInRect(point,rect){return point.x>=rect.left&&point.x<=rect.left+rect.width&&point.y>=rect.top&&point.y<=rect.top+rect.height;}function getPointAtCircumference(radians,ellipse){return{x:ellipse.center.x-ellipse.width/2*Math.cos(radians),y:ellipse.center.y-ellipse.height/2*Math.sin(radians)};}const OPEN_HAND="data:image/png;base64,AAACAAEAICACAAcABQAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAA//AAAd/wAAGf+AAAH9gAADbYAAA2yAAAZsAAAGbAAAAGAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//4AB//8AAf//AAD//5AA///gAP//4AD//8AF///AB///5A////5///8=";const CLOSE_HAND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAABdSURBVEjH7ZA7DsAwCEMN6v2vTCdESpLKQRl5gxfzMQDNRQyWlEK83QAIRh3cH/QbIhQwMDl8gORl7A16WD/xxAdq6N6SgycKUblf41+wbFBT44RiCi11NU3TLHgBxRUUD4ITqnIAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMDEtMjFUMDA6MTM6NDMrMDE6MDC74T7AAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDEyLTA0LTAyVDA0OjEzOjM3KzAyOjAwQJ35wQAAAABJRU5ErkJggg==";const testProperties=["","webkit","moz","ms","o"].map(prefix=>"".concat(prefix,"backingStoreRatio"));let foundProperty=-1;function getBackingStoreRatio(context){if(foundProperty===-1){foundProperty=testProperties.find(testProperty=>testProperty in context);}return foundProperty&&context[foundProperty];}const debug$1=debug__default.default("sanity-imagetool");function makeDragAware(Component){return class DragAware extends React.PureComponent{constructor(){super(...arguments);this.domNode=null;this.currentPos=null;this.isDragging=false;this.handleDragStart=event=>{const{onDragStart,readOnly}=this.props;if(readOnly||!this.domNode){return;}if(this.isDragging){debug$1("Start cancelled, already a drag in progress");return;}this.isDragging=true;const nextPos=getPos(event);debug$1("Drag started %o",nextPos);onDragStart(getPositionRelativeToRect(nextPos.x,nextPos.y,this.domNode.getBoundingClientRect()));this.currentPos=nextPos;};this.handleDrag=event=>{if(!this.isDragging||this.props.readOnly||!this.currentPos){return;}const{onDrag}=this.props;const nextPos=getPos(event);const diff=diffPos(nextPos,this.currentPos);onDrag(diff);debug$1("moving by %o",diff);this.currentPos=nextPos;};this.handleDragEnd=event=>{const{onDragEnd,readOnly}=this.props;if(!this.isDragging||readOnly||!this.domNode){return;}const nextPos=getPos(event);onDragEnd(getPositionRelativeToRect(nextPos.x,nextPos.y,this.domNode.getBoundingClientRect()));this.isDragging=false;this.currentPos=null;debug$1("Done moving %o",nextPos);};this.handleDragCancel=()=>{if(!this.isDragging||this.props.readOnly||!this.currentPos||!this.domNode){return;}const{onDragEnd}=this.props;this.isDragging=false;onDragEnd(getPositionRelativeToRect(this.currentPos.x,this.currentPos.y,this.domNode.getBoundingClientRect()));this.currentPos=null;};this.setDomNode=node=>{this.domNode=node;};}componentDidMount(){document.body.addEventListener("pointermove",this.handleDrag);document.body.addEventListener("pointerup",this.handleDragEnd);document.body.addEventListener("pointerleave",this.handleDragCancel);document.body.addEventListener("pointercancel",this.handleDragCancel);}componentWillUnmount(){document.body.removeEventListener("pointermove",this.handleDrag);document.body.removeEventListener("pointerup",this.handleDragEnd);document.body.removeEventListener("pointerleave",this.handleDragCancel);document.body.removeEventListener("pointercancel",this.handleDragCancel);}render(){const{readOnly,onDragStart,onDragEnd,onDrag,...rest}=this.props;return/* @__PURE__ */jsxRuntime.jsx(Component,{ref:this.setDomNode,onPointerDown:readOnly?void 0:this.handleDragStart,onPointerMove:readOnly?void 0:this.handleDrag,...rest});}};}function getPositionRelativeToRect(x,y,rect){return{x:x-rect.left,y:y-rect.top};}function getPos(event){return{x:event.clientX,y:event.clientY};}function diffPos(pos,otherPos){return{x:pos.x-otherPos.x,y:pos.y-otherPos.y};}var __freeze$1n=Object.freeze;var __defProp$1n=Object.defineProperty;var __template$1n=(cooked,raw)=>__freeze$1n(__defProp$1n(cooked,"raw",{value:__freeze$1n(raw||cooked.slice())}));var _a$1n,_b$G;const DragAwareCanvas=makeDragAware("canvas");const RootContainer=styled__default.default.div(_a$1n||(_a$1n=__template$1n(["\n  width: 100%;\n  height: 100%;\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"])));const CanvasContainer=styled__default.default(DragAwareCanvas)(_b$G||(_b$G=__template$1n(["\n  display: block;\n  position: relative;\n  max-width: calc(100% - 0.5em); /* to prevent overlap with change bar */\n  max-height: calc(100% + 1em);\n  user-select: none;\n  // Enable only multi-finger panning and zooming within this element.\n  // This prevents single finger panning when manipulating drag handles,\n  // which can cause unwanted scrolling in the underlying document body.\n  touch-action: pinch-zoom;\n"])));const MARGIN_PX=8;const CROP_HANDLE_SIZE=12;const HOTSPOT_HANDLE_SIZE=10;function normalizeRect(rect){const flippedY=rect.top>rect.bottom;const flippedX=rect.left>rect.right;return{top:flippedY?rect.bottom:rect.top,bottom:flippedY?rect.top:rect.bottom,left:flippedX?rect.right:rect.left,right:flippedX?rect.left:rect.right};}function checkCropBoundaries(value,delta){if(!value||!value.crop||value.crop.top+delta.top<0||value.crop.left+delta.left<0||value.crop.right+delta.right<0||value.crop.bottom+delta.bottom<0){return false;}return true;}function limitToBoundaries(value,delta){const{top,right,bottom,left}=value.crop||DEFAULT_CROP;const newValue={hotspot:value.hotspot,crop:{top:top+(delta.top||0)>0?top:0,right:right+(delta.right||0)>0?right:0,bottom:bottom+(delta.bottom||0)>0?bottom:0,left:left+(delta.left||0)>0?left:0}};const newDelta={top:top+(delta.top||0)>0?delta.top||0:0,right:right+(delta.right||0)>0?delta.right||0:0,bottom:bottom+(delta.bottom||0)>0?delta.bottom||0:0,left:left+(delta.left||0)>0?delta.left||0:0};return{value:newValue,delta:newDelta};}function getCropCursorForHandle(handle){switch(handle){case"left":case"right":return"col-resize";case"top":case"bottom":return"row-resize";case"topRight":case"bottomLeft":return"nesw-resize";case"topLeft":case"bottomRight":return"nwse-resize";default:return null;}}const getDevicePixelRatio$1=memoize__default.default(()=>{const devicePixelRatio=window.devicePixelRatio||1;const ctx=document.createElement("canvas").getContext("2d");const backingStoreRatio=ctx&&getBackingStoreRatio(ctx)||1;return devicePixelRatio/backingStoreRatio;});const cropHandleKeys=["left","right","top","topLeft","topRight","bottom","bottomLeft","bottomRight"];class ToolCanvas extends React.PureComponent{constructor(){super(...arguments);this.state={cropping:false,cropMoving:false,moving:false,resizing:false,pointerPosition:null};this.handleDragStart=_ref205=>{let{x,y}=_ref205;const pointerPosition={x:x*this.getScale(),y:y*this.getScale()};const inHotspot=isPointInEllipse(pointerPosition,this.getHotspotRect());const inDragHandle=isPointInCircle(pointerPosition,this.getDragHandleCoords());const activeCropHandle=this.getActiveCropHandleFor(pointerPosition);const inCropRect=isPointInRect(pointerPosition,this.getCropRect());if(activeCropHandle){this.setState({cropping:activeCropHandle});}else if(inDragHandle){this.setState({resizing:true});}else if(inHotspot){this.setState({moving:true});}else if(inCropRect){this.setState({cropMoving:true});}};this.handleDrag=pos=>{if(this.state.cropping){this.emitCrop(this.state.cropping,pos);}else if(this.state.cropMoving){this.emitCropMove(pos);}else if(this.state.moving){this.emitMove(pos);}else if(this.state.resizing){this.emitResize(pos);}};this.handleDragEnd=()=>{const{onChange,onChangeEnd}=this.props;this.setState({moving:false,resizing:false,cropping:false,cropMoving:false});const{hotspot,crop:rawCrop}=this.getClampedValue();const crop=normalizeRect(rawCrop);const finalValue={crop:{top:crop.top,bottom:1-crop.bottom,left:crop.left,right:1-crop.right},hotspot:{x:hotspot.center.x,y:hotspot.center.y,height:Math.abs(hotspot.height),width:Math.abs(hotspot.width)}};onChange(finalValue);if(onChangeEnd){onChangeEnd(finalValue);}};this.handlePointerOut=()=>{this.setState({pointerPosition:null});};this.handlePointerMove=event=>{const clientRect=event.currentTarget.getBoundingClientRect();this.setState({pointerPosition:{x:(event.clientX-clientRect.left)*this.getScale(),y:(event.clientY-clientRect.top)*this.getScale()}});};this.setCanvas=node=>{this.canvas=node;};}getHotspotRect(){const{value,image}=this.props;const hotspot=value.hotspot||DEFAULT_HOTSPOT;const hotspotRect=new Rect().setSize(hotspot.width,hotspot.height).setCenter(hotspot.x,hotspot.y);return new Rect().setSize(image.width,image.height).shrink(MARGIN_PX*this.getScale()).multiply(hotspotRect);}getCropRect(){const{value,image}=this.props;return new Rect().setSize(image.width,image.height).shrink(MARGIN_PX*this.getScale()).cropRelative(Rect.fromEdges(value.crop||DEFAULT_CROP).clamp(new Rect(0,0,1,1)));}getCropHandles(){const inner=this.getCropRect();const handleSize=CROP_HANDLE_SIZE*this.getScale();const halfCropHandleSize=handleSize/2;const cropHandle=new Rect(0,0,handleSize,handleSize);return{left:cropHandle.setTopLeft(inner.left-halfCropHandleSize,inner.center.y-halfCropHandleSize),right:cropHandle.setTopLeft(inner.right-halfCropHandleSize,inner.center.y-halfCropHandleSize),top:cropHandle.setTopLeft(inner.center.x-halfCropHandleSize,inner.top-halfCropHandleSize),topLeft:cropHandle.setTopLeft(inner.left-halfCropHandleSize,inner.top-halfCropHandleSize),topRight:cropHandle.setTopLeft(inner.right-halfCropHandleSize,inner.top-halfCropHandleSize),bottom:cropHandle.setTopLeft(inner.center.x-halfCropHandleSize,inner.bottom-halfCropHandleSize),bottomLeft:cropHandle.setTopLeft(inner.left-halfCropHandleSize,inner.bottom-halfCropHandleSize),bottomRight:cropHandle.setTopLeft(inner.right-halfCropHandleSize,inner.bottom-halfCropHandleSize)};}getActiveCropHandleFor(_ref206){let{x,y}=_ref206;const cropHandles=this.getCropHandles();for(const position of cropHandleKeys){if(isPointInRect({x,y},cropHandles[position])){return position;}}return false;}emitMove(pos){const{image,value,onChange}=this.props;const scale=this.getScale();const delta={x:pos.x*scale/image.width,y:pos.y*scale/image.height};onChange(applyHotspotMoveBy(value,delta));}emitCropMove(pos){const{image,onChange,value}=this.props;const scale=this.getScale();const left=pos.x*scale/image.width;const right=-pos.x*scale/image.width;const top=pos.y*scale/image.height;const bottom=-pos.y*scale/image.height;const delta={left,right,top,bottom};if(checkCropBoundaries(value,delta)){onChange(applyCropMoveBy(value,delta));}}emitCrop(side,pos){const{image,onChange,value}=this.props;const scale=this.getScale();let left=0;let right=0;let top=0;let bottom=0;if(side=="left"||side==="topLeft"||side==="bottomLeft"){left=pos.x*scale/image.width;}else if(side=="right"||side==="topRight"||side==="bottomRight"){right=-pos.x*scale/image.width;}if(side=="top"||side==="topLeft"||side==="topRight"){top=pos.y*scale/image.height;}else if(side=="bottom"||side==="bottomLeft"||side==="bottomRight"){bottom=-pos.y*scale/image.height;}const delta={left,right,top,bottom};const newValue=limitToBoundaries(value,delta).value;const newDelta=limitToBoundaries(value,delta).delta;onChange(applyCropMoveBy(newValue,newDelta));}emitResize(pos){const{image,onChange,value}=this.props;const scale=this.getScale();const delta={x:pos.x*scale*2/image.width,y:pos.y*scale*2/image.height};onChange(applyHotspotResizeBy(value,{height:delta.y,width:delta.x}));}getClampedValue(){const value=this.props.value;const crop=Rect.fromEdges(value.crop||DEFAULT_CROP).clamp(new Rect(0,0,1,1));const hotspot=value.hotspot||DEFAULT_HOTSPOT;const hotspotRect=new Rect(0,0,1,1).setSize(hotspot.width,hotspot.height).setCenter(hotspot.x,hotspot.y).clamp(crop);return{crop,hotspot:hotspotRect};}paintHotspot(context,opacity){const{image,readOnly}=this.props;const imageRect=new Rect().setSize(image.width,image.height);const{hotspot,crop}=this.getClampedValue();const scale=this.getScale();const margin=MARGIN_PX*scale;context.save();drawBackdrop();drawEllipse();context.clip();drawHole();context.restore();if(!readOnly){drawDragHandle(Math.PI*1.25);}function drawEllipse(){context.save();const dest=imageRect.shrink(margin).multiply(hotspot);const scaleY=dest.height/dest.width;context.scale(1,scaleY);context.beginPath();context.globalAlpha=opacity;context.arc(dest.center.x,dest.center.y/scaleY,Math.abs(dest.width/2),0,2*Math.PI,false);context.strokeStyle="white";context.lineWidth=1.5*scale;context.stroke();context.closePath();context.restore();}function drawImage(srcLeft,srcTop,srcWidth,srcHeight,destLeft,destTop,destWidth,destHeight){context.save();context.drawImage(image,srcLeft,srcTop,srcWidth,srcHeight,destLeft,destTop,destWidth,destHeight);context.restore();}function drawHole(){const src=imageRect.multiply(hotspot);const dest=imageRect.shrink(margin).multiply(hotspot);drawImage(src.left,src.top,src.width,src.height,dest.left,dest.top,dest.width,dest.height);}function drawBackdrop(){const src=imageRect.cropRelative(crop);const dest=imageRect.shrink(margin).cropRelative(crop);context.save();drawImage(src.left,src.top,src.width,src.height,dest.left,dest.top,dest.width,dest.height);context.globalAlpha=0.5;context.fillStyle="black";context.fillRect(dest.left,dest.top,dest.width,dest.height);context.restore();}function drawDragHandle(radians){context.save();const radius=HOTSPOT_HANDLE_SIZE*scale;const dest=imageRect.shrink(margin).multiply(hotspot);const point=getPointAtCircumference(radians,dest);context.beginPath();context.arc(point.x,point.y,radius,0,2*Math.PI,false);context.fillStyle="rgb(255,255,255)";context.fill();context.closePath();context.restore();context.beginPath();context.arc(point.x,point.y,radius,0,2*Math.PI,false);context.strokeStyle="rgb(0, 0, 0)";context.lineWidth=0.5*scale;context.stroke();context.closePath();}}getActualSize(){var _a;const node=(_a=this.canvas)==null?void 0:_a.domNode;return node?{height:node.clientHeight,width:node.clientWidth}:{height:0,width:0};}getDragHandleCoords(){const bbox=this.getHotspotRect();const point=getPointAtCircumference(Math.PI*1.25,bbox);return{x:point.x,y:point.y,radius:8*this.getScale()};}debug(context){context.save();const{image}=this.props;const bbox=this.getHotspotRect();const scale=this.getScale();const margin=MARGIN_PX*scale;if(context.setLineDash){context.setLineDash([2*scale,2*scale]);}context.lineWidth=0.5*scale;context.strokeStyle="rgba(200, 200, 200, 0.5)";vline(bbox.center.x);hline(bbox.center.y);context.strokeStyle="rgba(150, 150, 150, 0.5)";hline(bbox.top);hline(bbox.bottom);vline(bbox.left);vline(bbox.right);context.restore();function vline(x){line(x,margin,x,image.height-margin);}function hline(y){line(margin,y,image.width-margin,y);}function line(x1,y1,x2,y2){context.beginPath();context.moveTo(x1,y1);context.lineTo(x2,y2);context.stroke();context.closePath();}}paintBackground(context){const{image}=this.props;const inner=new Rect().setSize(image.width,image.height).shrink(MARGIN_PX*this.getScale());context.save();context.fillStyle="white";context.clearRect(0,0,image.width,image.height);context.globalAlpha=0.3;context.drawImage(image,inner.left,inner.top,inner.width,inner.height);context.restore();}paint(context){const{readOnly}=this.props;context.save();const pxratio=getDevicePixelRatio$1();context.scale(pxratio,pxratio);const opacity=!readOnly&&this.state.pointerPosition?0.8:0.2;this.paintBackground(context);this.paintHotspot(context,opacity);this.debug(context);this.paintCropBorder(context);if(!readOnly){this.highlightCropHandles(context,opacity);}context.restore();}paintPointerPosition(context){if(!this.state.pointerPosition){return;}const{x,y}=this.state.pointerPosition;context.beginPath();context.arc(x,y,14*this.getScale(),0,2*Math.PI,false);context.fillStyle="lightblue";context.fill();context.restore();}paintCropBorder(context){const cropRect=this.getCropRect();context.save();context.beginPath();context.fillStyle="rgba(66, 66, 66, 0.9)";context.lineWidth=1;context.rect(cropRect.left,cropRect.top,cropRect.width,cropRect.height);context.stroke();context.closePath();context.restore();}highlightCropHandles(context,opacity){context.save();const cropHandles=this.getCropHandles();cropHandleKeys.forEach(handle=>{context.fillStyle=this.state.cropping===handle?"rgba(202, 54, 53, ".concat(opacity,")"):"rgba(230, 230, 230, ".concat(opacity+0.4,")");const{left,top,height,width}=cropHandles[handle];context.fillRect(left,top,width,height);context.beginPath();context.fillStyle="rgba(66, 66, 66, ".concat(opacity,")");context.rect(left,top,width,height);context.closePath();context.stroke();});context.restore();}getScale(){const actualSize=this.getActualSize();return this.props.image.width/actualSize.width;}getCursor(){const{pointerPosition}=this.state;const{readOnly}=this.props;if(!pointerPosition||readOnly){return"auto";}const activeCropArea=this.state.cropping||this.getActiveCropHandleFor(pointerPosition);if(activeCropArea){return getCropCursorForHandle(activeCropArea)||"auto";}const pointerOverDragHandle=isPointInCircle(pointerPosition,this.getDragHandleCoords());if(this.state.resizing||pointerOverDragHandle){return"move";}if(this.state.moving||this.state.cropMoving){return"url(".concat(CLOSE_HAND,"), move");}const pointerOverHotspot=isPointInEllipse(pointerPosition,this.getHotspotRect());const pointerOverCropRect=isPointInRect(pointerPosition,this.getCropRect());if(pointerOverHotspot||pointerOverCropRect){return"url(".concat(OPEN_HAND,"), move");}return"auto";}componentDidMount(){this.draw();}componentDidUpdate(){this.draw();}draw(){if(!this.canvas){return;}const domNode=this.canvas.domNode;const context=domNode.getContext("2d");if(!context){return;}this.paint(context);const currentCursor=domNode.style.cursor;const newCursor=this.getCursor();if(currentCursor!==newCursor){domNode.style.cursor=newCursor;}}render(){const{image,readOnly}=this.props;const ratio=getDevicePixelRatio$1();return/* @__PURE__ */jsxRuntime.jsx(RootContainer,{children:/* @__PURE__ */jsxRuntime.jsx(CanvasContainer,{readOnly,ref:this.setCanvas,onDrag:this.handleDrag,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,onPointerMove:this.handlePointerMove,onPointerOut:this.handlePointerOut,height:image.height*ratio,width:image.width*ratio})});}}function applyHotspotMoveBy(value,delta){const currentHotspot=value&&value.hotspot||DEFAULT_HOTSPOT;return{...value,hotspot:{...currentHotspot,x:currentHotspot.x+delta.x,y:currentHotspot.y+delta.y}};}function applyHotspotResizeBy(value,delta){const currentHotspot=value&&value.hotspot||DEFAULT_HOTSPOT;return{...value,hotspot:{...currentHotspot,height:currentHotspot.height+delta.height,width:currentHotspot.width+delta.width}};}function applyCropMoveBy(value,delta){const currentCrop=value&&value.crop||DEFAULT_CROP;return{...value,crop:{left:currentCrop.left+(delta.left||0),right:currentCrop.right+(delta.right||0),top:currentCrop.top+(delta.top||0),bottom:currentCrop.bottom+(delta.bottom||0)}};}function ImageTool(props){return/* @__PURE__ */jsxRuntime.jsx(ImageLoader,{src:props.src,children:_ref207=>{let{isLoading,image,error}=_ref207;if(isLoading){return/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{showText:true});}if(error){return/* @__PURE__ */jsxRuntime.jsx("div",{children:error.message});}if(image){return/* @__PURE__ */jsxRuntime.jsx(Resize,{image,maxHeight:ImageTool.maxHeight,maxWidth:ImageTool.maxWidth,children:canvas=>/* @__PURE__ */jsxRuntime.jsx(ToolCanvas,{image:canvas,...props})});}return null;}});}ImageTool.maxHeight=500;ImageTool.maxWidth=1e3;const PROBABLY_THE_TINIEST_GIF_EVER="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function isBlob(src){return src.startsWith("blob:");}function loadImage(src){return new rxjs.Observable(subscriber=>{const image=document.createElement("img");let completed=false;const onload=()=>{completed=true;subscriber.next(image);subscriber.complete();};const onerror=()=>{completed=true;subscriber.error(new Error("Could not load image from ".concat(isBlob(src)?"blob":src)));};image.onload=onload;image.onerror=onerror;image.src=src;return()=>{image.onload=null;image.onerror=null;if(!completed){image.src=PROBABLY_THE_TINIEST_GIF_EVER;}};});}const INITIAL_STATE$2={isLoading:true};function useLoadImage(url){const[state,setState]=React.useState(INITIAL_STATE$2);React.useEffect(()=>{setState(INITIAL_STATE$2);const subscription=loadImage(url).subscribe({error:err=>{setState({isLoading:false,error:err});},next:image=>{setState({image,isLoading:false});}});return()=>{subscription.unsubscribe();};},[url]);return state;}var __freeze$1m=Object.freeze;var __defProp$1m=Object.defineProperty;var __template$1m=(cooked,raw)=>__freeze$1m(__defProp$1m(cooked,"raw",{value:__freeze$1m(raw||cooked.slice())}));var _a$1m;const HOTSPOT_PATH=["hotspot"];const PREVIEW_ASPECT_RATIOS=[["3:4",3/4],["Square",1/1],["16:9",16/9],["Panorama",4/1]];const DEFAULT_VALUE={crop:DEFAULT_CROP,hotspot:DEFAULT_HOTSPOT};const Placeholder$1=styled__default.default.div(_a$1m||(_a$1m=__template$1m(["\n  min-height: 6em;\n"])));function LoadStatus(props){return/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",justify:"center",padding:4,style:{overflowWrap:"break-word"},children:props.children});}function ImageToolInput(props){const{imageUrl,value,changed,level,path,focusPath=EMPTY_ARRAY$9,presence,onChange,schemaType,onPathFocus,readOnly,elementProps}=props;const[localValue,setLocalValue]=React.useState(value||DEFAULT_VALUE);const{image,isLoading:isImageLoading,error:imageLoadError}=useLoadImage(imageUrl);const handleFocus=React.useCallback(()=>{onPathFocus(HOTSPOT_PATH);},[onPathFocus]);React.useEffect(()=>{setLocalValue(value||DEFAULT_VALUE);},[value]);const hasFocus=focusPath[0]==="hotspot";useDidUpdate(hasFocus,hadFocus=>{var _a2;if(!hadFocus&&hasFocus){(_a2=elementProps.ref.current)==null?void 0:_a2.focus();}});const handleChangeEnd=React.useCallback(finalValue=>{if(readOnly){return;}const cropField=schemaType.fields.find(field=>field.name==="crop"&&field.type.name!=="object");const hotspotField=schemaType.fields.find(field=>field.type.name!=="object"&&field.name==="hotspot");const crop=cropField?{_type:cropField.type.name,...(finalValue.crop||DEFAULT_CROP)}:finalValue.crop;const hotspot=hotspotField?{_type:hotspotField.type.name,...(finalValue.hotspot||DEFAULT_HOTSPOT)}:finalValue.hotspot;onChange([set(crop,["crop"]),set(hotspot,["hotspot"])]);},[onChange,readOnly,schemaType.fields]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(FormField,{title:t("inputs.imagetool.title"),level,description:t("inputs.imagetool.description"),deprecated:schemaType.deprecated,__unstable_presence:presence,children:/* @__PURE__ */jsxRuntime.jsxs("div",{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{__unstable_checkered:true,__unstable_focusRing:true,tabIndex:0,ref:elementProps.ref,onFocus:handleFocus,children:/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path:path.concat(HOTSPOT_PATH),hasFocus:focusPath[0]==="hotspot",isChanged:changed,children:/* @__PURE__ */jsxRuntime.jsxs(RatioBox$1,{ratio:3/2,children:[(isImageLoading||imageLoadError)&&/* @__PURE__ */jsxRuntime.jsx(LoadStatus,{children:imageLoadError?/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:4,radius:2,tone:"critical",border:true,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:t("inputs.imagetool.load-error",{errorMessage:imageLoadError.message})})}):/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{showText:true})}),!isImageLoading&&image&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{margin:1,children:/* @__PURE__ */jsxRuntime.jsx(ImageTool,{value:localValue,src:image.src,readOnly:Boolean(readOnly),onChangeEnd:handleChangeEnd,onChange:setLocalValue})})]})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Grid,{columns:PREVIEW_ASPECT_RATIOS.length,gap:1,children:PREVIEW_ASPECT_RATIOS.map(_ref208=>{let[title,ratio]=_ref208;return/* @__PURE__ */jsxRuntime.jsxs("div",{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{as:"h4",size:0,children:title}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:2,children:/* @__PURE__ */jsxRuntime.jsx(RatioBox$1,{ratio,children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{__unstable_checkered:true,children:!isImageLoading&&image?/* @__PURE__ */jsxRuntime.jsx(HotspotImage,{aspectRatio:ratio,src:image.src,srcAspectRatio:image.width/image.height,hotspot:localValue.hotspot||DEFAULT_HOTSPOT,crop:localValue.crop||DEFAULT_CROP}):/* @__PURE__ */jsxRuntime.jsx(Placeholder$1,{})})})})]},ratio);})})})]})});}var __freeze$1l=Object.freeze;var __defProp$1l=Object.defineProperty;var __template$1l=(cooked,raw)=>__freeze$1l(__defProp$1l(cooked,"raw",{value:__freeze$1l(raw||cooked.slice())}));var _a$1l;const MenuActionsWrapper=styled__default.default(ui.Inline)(_a$1l||(_a$1l=__template$1l(["\n  position: absolute;\n  top: 0;\n  right: 0;\n"])));function ImageActionsMenu(props){const{onEdit,children,showEdit,setHotspotButtonElement,setMenuButtonElement,onMenuOpen,isMenuOpen}=props;const[menuElement,setMenuElement]=React.useState(null);const[buttonElement,setButtonElement]=React.useState(null);const handleClick=React.useCallback(()=>onMenuOpen(!isMenuOpen),[onMenuOpen,isMenuOpen]);ui.useGlobalKeyDown(React.useCallback(event=>{if(isMenuOpen&&(event.key==="Escape"||event.key==="Tab")){onMenuOpen(false);buttonElement==null?void 0:buttonElement.focus();}},[isMenuOpen,onMenuOpen,buttonElement]));ui.useClickOutside(React.useCallback(event=>{if(!(buttonElement==null?void 0:buttonElement.contains(event.target))){onMenuOpen(false);}},[buttonElement,onMenuOpen]),[menuElement]);const setOptionsButtonRef=React.useCallback(el=>{setMenuButtonElement(el);setButtonElement(el);},[setMenuButtonElement]);React.useEffect(()=>{if(isMenuOpen){menuElement==null?void 0:menuElement.focus();}},[isMenuOpen,menuElement]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.TooltipDelayGroupProvider,{children:/* @__PURE__ */jsxRuntime.jsxs(MenuActionsWrapper,{"data-buttons":true,space:1,padding:2,children:[showEdit&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("inputs.image.actions-menu.edit-details.aria-label"),"data-testid":"options-menu-edit-details",icon:icons.CropIcon,mode:"ghost",onClick:onEdit,ref:setHotspotButtonElement,tooltipProps:{content:t("inputs.image.actions-menu.crop-image-tooltip")}}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{id:"image-actions-menu",content:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{ref:setMenuElement,children}),portal:true,open:isMenuOpen,constrainSize:true,children:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{"aria-label":t("inputs.image.actions-menu.options.aria-label"),"data-testid":"options-menu-button",mode:"ghost",onClick:handleClick,ref:setOptionsButtonRef})})]})});}var __freeze$1k=Object.freeze;var __defProp$1k=Object.defineProperty;var __template$1k=(cooked,raw)=>__freeze$1k(__defProp$1k(cooked,"raw",{value:__freeze$1k(raw||cooked.slice())}));var _a$1k,_b$F,_c$o;const MAX_DEFAULT_HEIGHT=30;const RatioBox=styled__default.default(ui.Card)(_a$1k||(_a$1k=__template$1k(["\n  position: relative;\n  width: 100%;\n  overflow: hidden;\n  overflow: clip;\n  min-height: 3.75rem;\n  max-height: 20rem;\n\n  & > div[data-container] {\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    display: flex !important;\n    align-items: center;\n    justify-content: center;\n  }\n\n  & img {\n    max-width: 100%;\n    max-height: 100%;\n  }\n"])));const Overlay=styled__default.default(ui.Flex)(_ref209=>{let{$drag,$tone}=_ref209;const textColor=ui.studioTheme.color.light[$tone].card.enabled.fg;const backgroundColor=ui.rgba(ui.studioTheme.color.light[$tone].card.enabled.bg,0.8);return styled.css(_b$F||(_b$F=__template$1k(["\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    backdrop-filter: ",";\n    color: ",";\n    background-color: ",";\n  "])),$drag?"blur(10px)":"",$tone?textColor:"",$drag?backgroundColor:"transparent");});const FlexOverlay=styled__default.default(ui.Flex)(_c$o||(_c$o=__template$1k(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n"])));const getImageSize=src=>{const imageUrlParams=new URLSearchParams(src.split("?")[1]);const rect=imageUrlParams.get("rect");if(rect){return[rect.split(",")[2],rect.split(",")[3]].map(Number);}return src.split("-")[1].split(".")[0].split("x").map(Number);};function ImagePreview$1(props){const{drag,readOnly,isRejected,src,...rest}=props;const[isLoaded,setLoaded]=React.useState(false);const[rootElement,setRootElement]=React.useState(null);const rootRect=ui.useElementRect(rootElement);const rootWidth=(rootRect==null?void 0:rootRect.width)||0;const acceptTone=isRejected||readOnly?"critical":"primary";const tone=drag?acceptTone:"default";const maxHeightToPx=MAX_DEFAULT_HEIGHT*document.documentElement.clientHeight/100;const[imageWidth,imageHeight]=getImageSize(src);const imageRatio=imageWidth/imageHeight;const renderedImageHeight=imageWidth>rootWidth?rootWidth/imageRatio:imageHeight;const rootHeight=renderedImageHeight<maxHeightToPx?null:"".concat(MAX_DEFAULT_HEIGHT,"vh");React.useEffect(()=>{setLoaded(false);},[src]);const onLoadChange=React.useCallback(()=>{setLoaded(true);},[]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(RatioBox,{...rest,ref:setRootElement,style:{height:rootHeight},tone:"transparent",children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{"data-container":true,tone:"inherit",children:[!isLoaded&&/* @__PURE__ */jsxRuntime.jsx(OverlayComponent,{cardTone:"transparent",drag:true,content:/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{showText:true})}),/* @__PURE__ */jsxRuntime.jsx("img",{src,"data-testid":"hotspot-image-input",alt:props.alt,onLoad:onLoadChange,referrerPolicy:"strict-origin-when-cross-origin"})]}),drag&&/* @__PURE__ */jsxRuntime.jsx(OverlayComponent,{cardTone:tone,drag,content:/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginBottom:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{children:/* @__PURE__ */jsxRuntime.jsx(HoverIcon,{isRejected,readOnly})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:t(getHoverTextTranslationKey({isRejected,readOnly}))})]})})]});}function HoverIcon(_ref210){let{isRejected,readOnly}=_ref210;if(isRejected){return/* @__PURE__ */jsxRuntime.jsx(icons.AccessDeniedIcon,{});}if(readOnly){return/* @__PURE__ */jsxRuntime.jsx(icons.ReadOnlyIcon,{});}return/* @__PURE__ */jsxRuntime.jsx(icons.ImageIcon,{});}function getHoverTextTranslationKey(_ref211){let{isRejected,readOnly}=_ref211;if(isRejected){return"inputs.image.drag-overlay.this-field-is-read-only";}return readOnly?"inputs.image.drag-overlay.cannot-upload-here":"inputs.image.drag-overlay.drop-to-upload-image";}function OverlayComponent(_ref212){let{cardTone,drag,content}=_ref212;return/* @__PURE__ */jsxRuntime.jsx(Overlay,{justify:"flex-end",padding:3,$drag:drag,$tone:cardTone,children:/* @__PURE__ */jsxRuntime.jsx(FlexOverlay,{direction:"column",align:"center",justify:"center",children:content})});}function InvalidImageWarning(_ref213){let{onClearValue}=_ref213;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{tone:"caution",padding:4,border:true,radius:2,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:4,marginBottom:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:t("inputs.image.invalid-image-warning.title")}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:t("inputs.image.invalid-image-warning.description")})]})]}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.ResetIcon,mode:"ghost",onClick:onClearValue,text:t("inputs.image.invalid-image-warning.reset-button.text"),width:"fill"})]});}const getDevicePixelRatio=()=>{if(typeof window==="undefined"||!window.devicePixelRatio){return 1;}return Math.round(Math.max(1,window.devicePixelRatio));};function passThrough(_ref214){let{children}=_ref214;return children;}const ASSET_FIELD_PATH=["asset"];const ASSET_IMAGE_MENU_POPOVER={portal:true};class BaseImageInput extends React.PureComponent{constructor(props){var _this2;super(props);_this2=this;this._previewElement=null;this.uploadSubscription=null;this.state={isUploading:false,selectedAssetSource:null,hoveringFiles:[],isStale:false,hotspotButtonElement:null,menuButtonElement:null,isMenuOpen:false};this.toast=null;this.setPreviewElement=el=>{this._previewElement=el;};this.setHotspotButtonElement=el=>{this.setState({hotspotButtonElement:el});};// Get the menu button element in `ImageActionsMenu` so that focus can be restored to
// it when closing the dialog (see `handleAssetSourceClosed`)
this.setMenuButtonElement=el=>{this.setState({menuButtonElement:el});};this.getUploadOptions=file=>{const{schemaType,resolveUploader}=this.props;const uploader=resolveUploader&&resolveUploader(schemaType,file);return uploader?[{type:schemaType,uploader}]:[];};this.uploadWith=function(uploader,file){let assetDocumentProps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};const{schemaType,onChange,client,t:t2}=_this2.props;const{label,title,description,creditLine,source}=assetDocumentProps;const options={metadata:get__default.default(schemaType,"options.metadata"),storeOriginalFilename:get__default.default(schemaType,"options.storeOriginalFilename"),label,title,description,creditLine,source};_this2.cancelUpload();_this2.setState({isUploading:true});onChange(setIfMissing({_type:schemaType.name}));_this2.uploadSubscription=uploader.upload(client,file,schemaType,options).subscribe({next:uploadEvent=>{if(uploadEvent.patches){onChange(uploadEvent.patches);}},error:err=>{var _a;console.error(err);(_a=_this2.toast)==null?void 0:_a.push({status:"error",description:t2("inputs.image.upload-error.description"),title:t2("inputs.image.upload-error.title")});_this2.clearUploadStatus();},complete:()=>{onChange([unset(["hotspot"]),unset(["crop"])]);_this2.setState({isUploading:false});}});};this.handleRemoveButtonClick=()=>{const{value}=this.props;const allKeys=Object.keys(value||{});const remainingKeys=allKeys.filter(key=>!["_type","_key","_upload","asset","crop","hotspot"].includes(key));const isEmpty=remainingKeys.length===0;const removeKeys=["asset"].concat(allKeys.filter(key=>["crop","hotspot","_upload"].includes(key))).map(key=>unset([key]));this.props.onChange(isEmpty&&!this.valueIsArrayElement()?unset():removeKeys);};this.handleFieldChange=event=>{const{onChange,schemaType}=this.props;if(!this.valueIsArrayElement()&&this.eventIsUnsettingLastFilledField(event)){onChange(unset());return;}onChange(event.prepend(setIfMissing({_type:schemaType.name})).patches);};this.eventIsUnsettingLastFilledField=event=>{const patch=event.patches[0];if(event.patches.length!==1||patch.type!=="unset"){return false;}const allKeys=Object.keys(this.props.value||{});const remainingKeys=allKeys.filter(key=>!["_type","_key","crop","hotspot"].includes(key));const isEmpty=event.patches[0].path.length===1&&remainingKeys.length===1&&remainingKeys[0]===event.patches[0].path[0];return isEmpty;};this.valueIsArrayElement=()=>{const{path}=this.props;const parentPathSegment=path.slice(-1)[0];return typeof parentPathSegment!=="string";};this.handleOpenDialog=()=>{this.props.onPathFocus(["hotspot"]);};this.handleCloseDialog=()=>{var _a;this.props.onPathFocus([]);(_a=this.state.hotspotButtonElement)==null?void 0:_a.focus();};this.handleSelectAssetFromSource=assetFromSource=>{const{onChange,schemaType,resolveUploader}=this.props;handleSelectAssetFromSource({assetFromSource,onChange,type:schemaType,resolveUploader,uploadWith:this.uploadWith,isImage:true});this.setState({selectedAssetSource:null});};this.handleFileTargetFocus=event=>{var _a;if(event.currentTarget===event.target&&event.currentTarget===((_a=this.props.elementProps.ref)==null?void 0:_a.current)){this.props.elementProps.onFocus(event);}};this.handleFilesOver=hoveringFiles=>{this.setState({hoveringFiles:hoveringFiles.filter(file=>file.kind!=="string")});};this.handleFilesOut=()=>{this.setState({hoveringFiles:[]});};this.handleCancelUpload=()=>{this.cancelUpload();};this.handleClearUploadState=()=>{this.setState({isStale:false});this.clearUploadStatus();};this.handleStaleUpload=()=>{this.setState({isStale:true});};this.handleClearField=()=>{this.props.onChange([unset(["asset"]),unset(["crop"]),unset(["hotspot"])]);};this.handleSelectFiles=files=>{const{directUploads,readOnly}=this.props;const{hoveringFiles}=this.state;if(directUploads&&!readOnly){this.uploadFirstAccepted(files);}else if(hoveringFiles.length>0){this.handleFilesOut();}};this.handleSelectImageFromAssetSource=source=>{this.setState({selectedAssetSource:source});};this.handleAssetSourceClosed=()=>{var _a;this.setState({selectedAssetSource:null});(_a=this.state.menuButtonElement)==null?void 0:_a.focus();};this.renderHotspotInput=hotspotInputProps=>{const{value,changed,id,imageUrlBuilder,t:t2}=this.props;const withImageTool=this.isImageToolEnabled()&&value&&value.asset;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Dialog,{__unstable_autoFocus:false,header:t2("inputs.image.hotspot-dialog.title"),id:"".concat(id,"_dialog"),onClickOutside:this.handleCloseDialog,onClose:this.handleCloseDialog,width:1,children:/* @__PURE__ */jsxRuntime.jsx(PresenceOverlay,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:5,children:withImageTool&&(value==null?void 0:value.asset)&&/* @__PURE__ */jsxRuntime.jsx(ImageToolInput,{...this.props,imageUrl:imageUrlBuilder.image(value.asset).url(),value,presence:hotspotInputProps.presence,changed})})})});};this.renderPreview=()=>{const{value,schemaType,readOnly,directUploads,imageUrlBuilder,t:t2,resolveUploader}=this.props;if(!value||!assetUtils.isImageSource(value)){return null;}const{hoveringFiles}=this.state;const acceptedFiles=hoveringFiles.filter(file=>resolveUploader(schemaType,file));const rejectedFilesCount=hoveringFiles.length-acceptedFiles.length;const imageUrl=imageUrlBuilder.width(2e3).fit("max").image(value).dpr(getDevicePixelRatio()).auto("format").url();return/* @__PURE__ */jsxRuntime.jsx(ImagePreview$1,{drag:!(value==null?void 0:value._upload)&&hoveringFiles.length>0,isRejected:rejectedFilesCount>0||!directUploads,readOnly,src:imageUrl,alt:t2("inputs.image.preview-uploaded-image")});};this.setToast=toast=>{this.toast=toast;};this._assetPath=props.path.concat(ASSET_FIELD_PATH);}isImageToolEnabled(){return get__default.default(this.props.schemaType,"options.hotspot")===true;}clearUploadStatus(){var _a;if((_a=this.props.value)==null?void 0:_a._upload){this.props.onChange(unset(["_upload"]));}}cancelUpload(){if(this.uploadSubscription){this.uploadSubscription.unsubscribe();this.clearUploadStatus();}}uploadFirstAccepted(files){const{schemaType,resolveUploader}=this.props;const match=files.map(file=>({file,uploader:resolveUploader(schemaType,file)})).find(result=>result.uploader);if(match){this.uploadWith(match.uploader,match.file);}this.setState({isMenuOpen:false});}renderAssetMenu(){const{value,assetSources,schemaType,readOnly,directUploads,imageUrlBuilder,observeAsset,t:t2}=this.props;const asset=value==null?void 0:value.asset;if(!asset){return null;}const accept=get__default.default(schemaType,"options.accept","image/*");const showAdvancedEditButton=value&&asset&&this.isImageToolEnabled();let browseMenuItem=assetSources&&assetSources.length===0?null:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{icon:icons.SearchIcon,text:t2("inputs.image.browse-menu.text"),onClick:()=>{this.setState({isMenuOpen:false});this.handleSelectImageFromAssetSource(assetSources[0]);},disabled:readOnly,"data-testid":"file-input-browse-button"});if(assetSources&&assetSources.length>1){browseMenuItem=assetSources.map(assetSource=>{return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:(assetSource.i18nKey?t2(assetSource.i18nKey):assetSource.title)||startCase__default.default(assetSource.name),onClick:()=>{this.setState({isMenuOpen:false});this.handleSelectImageFromAssetSource(assetSource);},icon:assetSource.icon||icons.ImageIcon,"data-testid":"file-input-browse-button-".concat(assetSource.name),disabled:readOnly},assetSource.name);});}return/* @__PURE__ */jsxRuntime.jsx(WithReferencedAsset,{observeAsset,reference:asset,children:_ref215=>{let{_id,originalFilename,extension}=_ref215;let copyUrl;let downloadUrl;if(assetUtils.isImageSource(value)){const filename=originalFilename||"download.".concat(extension);downloadUrl=imageUrlBuilder.image(_id).forceDownload(filename).url();copyUrl=imageUrlBuilder.image(_id).url();}return/* @__PURE__ */jsxRuntime.jsx(ImageActionsMenu,{isMenuOpen:this.state.isMenuOpen,onEdit:this.handleOpenDialog,onMenuOpen:isOpen=>this.setState({isMenuOpen:isOpen}),setHotspotButtonElement:this.setHotspotButtonElement,setMenuButtonElement:this.setMenuButtonElement,showEdit:showAdvancedEditButton,children:/* @__PURE__ */jsxRuntime.jsx(ActionsMenu,{onUpload:this.handleSelectFiles,browse:browseMenuItem,onReset:this.handleRemoveButtonClick,downloadUrl,copyUrl,readOnly,directUploads,accept})});}});}renderBrowser(){const{assetSources,readOnly,directUploads,id,t:t2}=this.props;if(assetSources&&assetSources.length===0)return null;if(assetSources&&assetSources.length>1&&!readOnly&&directUploads){return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{id:"".concat(id,"_assetImageButton"),ref:this.setMenuButtonElement,button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"data-testid":"file-input-multi-browse-button",icon:icons.SearchIcon,iconRight:icons.ChevronDownIcon,mode:"bleed",text:t2("inputs.image.browse-menu.text")}),menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:assetSources.map(assetSource=>{return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:(assetSource.i18nKey?t2(assetSource.i18nKey):assetSource.title)||startCase__default.default(assetSource.name),onClick:()=>{this.setState({isMenuOpen:false});this.handleSelectImageFromAssetSource(assetSource);},icon:assetSource.icon||icons.ImageIcon,disabled:readOnly,"data-testid":"file-input-browse-button-".concat(assetSource.name)},assetSource.name);})}),popover:ASSET_IMAGE_MENU_POPOVER});}return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{text:t2("inputs.image.browse-menu.text"),icon:icons.SearchIcon,mode:"bleed",onClick:()=>{this.setState({isMenuOpen:false});this.handleSelectImageFromAssetSource(assetSources[0]);},"data-testid":"file-input-browse-button",disabled:readOnly});}renderUploadPlaceholder(){const{schemaType,readOnly,directUploads,resolveUploader}=this.props;const{hoveringFiles}=this.state;const acceptedFiles=hoveringFiles.filter(file=>resolveUploader(schemaType,file));const rejectedFilesCount=hoveringFiles.length-acceptedFiles.length;const accept=get__default.default(schemaType,"options.accept","image/*");return/* @__PURE__ */jsxRuntime.jsx("div",{style:{padding:1},children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{tone:readOnly?"transparent":"inherit",border:true,paddingX:3,paddingY:2,radius:2,style:hoveringFiles.length===0?{}:{borderColor:"transparent"},children:/* @__PURE__ */jsxRuntime.jsx(UploadPlaceholder,{browse:this.renderBrowser(),onUpload:this.handleSelectFiles,readOnly,hoveringFiles,acceptedFiles,rejectedFilesCount,type:"image",accept,directUploads})})});}renderUploadState(uploadState){var _a;const{isUploading}=this.state;const height=(_a=this._previewElement)==null?void 0:_a.offsetHeight;return/* @__PURE__ */jsxRuntime.jsx(UploadProgress,{uploadState,onCancel:isUploading?this.handleCancelUpload:void 0,onStale:this.handleStaleUpload,height});}renderAssetSource(){const{selectedAssetSource}=this.state;const{value,schemaType,observeAsset}=this.props;const accept=get__default.default(schemaType,"options.accept","image/*");if(!selectedAssetSource){return null;}const Component=selectedAssetSource.component;if(value&&value.asset){return/* @__PURE__ */jsxRuntime.jsx(WithReferencedAsset,{observeAsset,reference:value.asset,children:imageAsset=>/* @__PURE__ */jsxRuntime.jsx(Component,{selectedAssets:[imageAsset],assetType:"image",accept,selectionType:"single",onClose:this.handleAssetSourceClosed,onSelect:this.handleSelectAssetFromSource})});}return/* @__PURE__ */jsxRuntime.jsx(Component,{selectedAssets:[],selectionType:"single",assetType:"image",accept,onClose:this.handleAssetSourceClosed,onSelect:this.handleSelectAssetFromSource});}getFileTone(){const{schemaType,value,readOnly,directUploads,resolveUploader}=this.props;const{hoveringFiles}=this.state;const acceptedFiles=hoveringFiles.filter(file=>resolveUploader(schemaType,file));const rejectedFilesCount=hoveringFiles.length-acceptedFiles.length;if(hoveringFiles.length>0){if(rejectedFilesCount>0||!directUploads){return"critical";}}if(!(value==null?void 0:value._upload)&&!readOnly&&hoveringFiles.length>0){return"primary";}if(readOnly){return"transparent";}return(value==null?void 0:value._upload)&&(value==null?void 0:value.asset)?"transparent":"default";}renderAsset(){const{value,readOnly,elementProps}=this.props;const{hoveringFiles,isStale}=this.state;const hasValueOrUpload=Boolean((value==null?void 0:value._upload)||(value==null?void 0:value.asset));if(value&&typeof value.asset!=="undefined"&&!(value==null?void 0:value._upload)&&!assetUtils.isImageSource(value)){return()=>/* @__PURE__ */jsxRuntime.jsx(InvalidImageWarning,{onClearValue:this.handleClearField});}return inputProps=>/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[isStale&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginBottom:2,children:/* @__PURE__ */jsxRuntime.jsx(UploadWarning,{onClearStale:this.handleClearUploadState})}),/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path:inputProps.path.concat(ASSET_FIELD_PATH),hasFocus:!!inputProps.focused,isChanged:inputProps.changed,children:(value==null?void 0:value._upload)?this.renderUploadState(value._upload):/* @__PURE__ */jsxRuntime.jsxs(FileTarget,{...elementProps,onFocus:this.handleFileTargetFocus,tabIndex:0,disabled:Boolean(readOnly),onFiles:this.handleSelectFiles,onFilesOver:this.handleFilesOver,onFilesOut:this.handleFilesOut,tone:this.getFileTone(),$border:hasValueOrUpload||hoveringFiles.length>0,sizing:"border",radius:2,children:[!(value==null?void 0:value.asset)&&this.renderUploadPlaceholder(),!(value==null?void 0:value._upload)&&(value==null?void 0:value.asset)&&/* @__PURE__ */jsxRuntime.jsxs("div",{style:{position:"relative"},ref:this.setPreviewElement,children:[this.renderPreview(),this.renderAssetMenu()]})]})})]});}render(){const{focusPath,members,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview}=this.props;const{selectedAssetSource}=this.state;const hotspotField=members.find(member=>member.kind==="field"&&member.name==="hotspot");return(// The Stack space should match the space in ObjectInput
/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:5,"data-testid":"image-input",children:[/* @__PURE__ */jsxRuntime.jsx(ImperativeToast,{ref:this.setToast}),members.map(member=>{if(member.kind==="field"&&(member.name==="crop"||member.name==="hotspot")){return null;}if(member.kind==="field"){return/* @__PURE__ */jsxRuntime.jsx(MemberField,{member,renderAnnotation,renderBlock,renderInlineBlock,renderInput:member.name==="asset"?this.renderAsset():renderInput,renderField:member.name==="asset"?passThrough:renderField,renderItem,renderPreview},member.key);}if(member.kind==="fieldSet"){return/* @__PURE__ */jsxRuntime.jsx(MemberFieldSet,{member,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview},member.key);}if(member.kind==="error"){return/* @__PURE__ */jsxRuntime.jsx(MemberFieldError,{member},member.key);}return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:t("inputs.image.error.unknown-member-kind",{kind:member.kind})});}),hotspotField&&focusPath[0]==="hotspot"&&/* @__PURE__ */jsxRuntime.jsx(FormInput,{...this.props,absolutePath:hotspotField.field.path,renderInput:this.renderHotspotInput}),selectedAssetSource&&this.renderAssetSource()]}));}}function StudioImageInput(props){var _a;const sourcesFromSchema=(_a=props.schemaType.options)==null?void 0:_a.sources;const{image}=useFormBuilder().__internal;const documentPreviewStore=useDocumentPreviewStore();const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const supportsImageUploads=image.directUploads;const resolveUploader$1=React.useCallback((type,file)=>{if(!supportsImageUploads){return null;}return resolveUploader(type,file);},[supportsImageUploads]);const assetSources=React.useMemo(()=>sourcesFromSchema||image.assetSources,[image,sourcesFromSchema]);const builder=React.useMemo(()=>imageUrlBuilder__default.default(client),[client]);const observeAsset=React.useCallback(id=>observeImageAsset(documentPreviewStore,id),[documentPreviewStore]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(BaseImageInput,{...props,t,client,assetSources,directUploads:supportsImageUploads,imageUrlBuilder:builder,observeAsset,resolveUploader:resolveUploader$1});}const defaultInputs={document:ObjectInput,object:ObjectInput,array:UniversalArrayInput,boolean:BooleanInput,number:NumberInput,text:TextInput,email:EmailInput,datetime:DateTimeInput,date:DateInput,url:UrlInput,image:StudioImageInput,file:StudioFileInput,string:StringInput,slug:SlugInput,crossDatasetReference:StudioCrossDatasetReferenceInput};const PortableTextInputExpanded=telemetry.defineEvent({version:1,name:"Portable Text Editor Expanded",description:"The portable text editor was expanded"});const PortableTextInputCollapsed=telemetry.defineEvent({version:1,name:"Portable Text Editor Collapsed",description:"The portable text editor was collapsed"});const PortableTextInvalidValueIgnore=telemetry.defineEvent({version:1,name:"Portable Text Editor Invalid Value Ignored",description:"The portable text got an invalid value from the form and pressed button to ignore it"});const PortableTextInvalidValueResolve=telemetry.defineEvent({version:1,name:"Portable Text Editor Invalid Value Resolved",description:"The portable text got an invalid value from the form and pressed button to resolve it."});var __freeze$1j=Object.freeze;var __defProp$1j=Object.defineProperty;var __template$1j=(cooked,raw)=>__freeze$1j(__defProp$1j(cooked,"raw",{value:__freeze$1j(raw||cooked.slice())}));var _a$1j,_b$E,_c$n,_d$e;const OverlayContainer=styled__default.default.div(_a$1j||(_a$1j=__template$1j(["\n  position: relative;\n"])));const ContentContainer=styled__default.default.div(_b$E||(_b$E=__template$1j(["\n  z-index: 13;\n  opacity: 0;\n  transition: opacity 300ms linear;\n"])));const CardContainer=styled__default.default(ui.Card)(_c$n||(_c$n=__template$1j(["\n  border: 1px solid var(--card-border-color);\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 12;\n  transition: opacity 150ms ease-in-out;\n  opacity: 0;\n  box-sizing: border-box;\n"])));const FlexContainer=styled__default.default(ui.Flex)(_d$e||(_d$e=__template$1j(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n\n  &:hover,\n  &:focus {\n    & "," {\n      opacity: 0.9;\n    }\n\n    & "," {\n      opacity: 1;\n    }\n  }\n"])),CardContainer,ContentContainer);const isTouchDevice=()=>typeof window!=="undefined"&&"ontouchstart"in window||typeof navigator!=="undefined"&&navigator.maxTouchPoints>0;function ActivateOnFocus(props){const{children,message,onActivate,isOverlayActive}=props;const[focused,setFocused]=React.useState(false);const{t}=useTranslation();const handleClick=React.useCallback(()=>{if(onActivate){onActivate();}},[onActivate]);const handleKeyDown=React.useCallback(event=>{if(!isOverlayActive){return;}if(event.code==="Space"&&onActivate){event.preventDefault();onActivate();}},[isOverlayActive,onActivate]);const handleOnFocus=React.useCallback(()=>{setFocused(true);},[]);const handleBlur=React.useCallback(()=>{setFocused(false);},[]);const msg=React.useMemo(()=>{const isTouch=isTouchDevice();let messageContext;if(isTouch){messageContext="tap";}else if(focused){messageContext="click-focused";}else{messageContext="click";}const text=message||t("inputs.portable-text.activate-on-focus-message",{context:messageContext});return/* @__PURE__ */jsxRuntime.jsx(ui.Text,{weight:"medium",children:text});},[focused,message,t]);return/* @__PURE__ */jsxRuntime.jsxs(OverlayContainer,{onBlur:handleBlur,onClick:handleClick,onFocus:handleOnFocus,onKeyDown:handleKeyDown,children:[isOverlayActive&&/* @__PURE__ */jsxRuntime.jsxs(FlexContainer,{"data-testid":"activate-overlay",tabIndex:0,align:"center",justify:"center",children:[/* @__PURE__ */jsxRuntime.jsx(CardContainer,{radius:2}),/* @__PURE__ */jsxRuntime.jsx(ContentContainer,{children:msg})]}),children]});}var __freeze$1i=Object.freeze;var __defProp$1i=Object.defineProperty;var __template$1i=(cooked,raw)=>__freeze$1i(__defProp$1i(cooked,"raw",{value:__freeze$1i(raw||cooked.slice())}));var _a$1i,_b$D;const Root$e=styled__default.default.div(props=>{const{color,input,radius}=theme.getTheme_v2(props.theme);const border={color:color.input.default.enabled.border,width:input.border.width};return styled.css(_a$1i||(_a$1i=__template$1i(["\n    --input-box-shadow: ",";\n\n    position: relative;\n\n    & [data-wrapper] {\n      overflow: hidden;\n      overflow: clip;\n      position: relative;\n      z-index: 1;\n      padding: ","px;\n    }\n\n    & [data-border] {\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      box-shadow: var(--input-box-shadow);\n      z-index: 2;\n      border-radius: ","px;\n      pointer-events: none;\n    }\n\n    &:not([data-read-only])[data-focused] [data-border] {\n      --input-box-shadow: ",";\n    }\n  "])),focusRingBorderStyle$1(border),input.border.width,radius[2],focusRingStyle$1({base:color,border,focusRing:input.text.focusRing}));});const ExpandedLayer=styled__default.default(ui.Layer)(_b$D||(_b$D=__template$1i(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n"])));const TEXT_LEVELS=[1,2,3,4,5,6,7,8,9];const TEXT_BULLET_MARKERS=["\u25CF","\u25CB","\u25A0"];const TEXT_NUMBER_FORMATS=["number","lower-alpha","lower-roman"];const TEXT_DECORATOR_TAGS={em:"em","strike-through":"s",underline:"u",strong:"strong",code:"code"};const TEXT_STYLE_PADDING={h1:{paddingTop:5,paddingBottom:4},h2:{paddingTop:4,paddingBottom:4},h3:{paddingTop:4,paddingBottom:3},h4:{paddingTop:4,paddingBottom:3},h5:{paddingTop:4,paddingBottom:3},h6:{paddingTop:4,paddingBottom:2},normal:{paddingTop:2,paddingBottom:3},blockquote:{paddingTop:2,paddingBottom:3}};var __freeze$1h=Object.freeze;var __defProp$1h=Object.defineProperty;var __template$1h=(cooked,raw)=>__freeze$1h(__defProp$1h(cooked,"raw",{value:__freeze$1h(raw||cooked.slice())}));var _a$1h;const Root$d=styled__default.default.span(_a$1h||(_a$1h=__template$1h(["\n  /* Make sure the annotation styling is visible */\n  &[data-mark='code'] {\n    mix-blend-mode: multiply;\n    color: inherit;\n  }\n"])));function Decorator(props){const{value,focused,selected,children,schemaType}=props;const tag=TEXT_DECORATOR_TAGS[value];const CustomComponent=schemaType.component;const DefaultComponent=React.useCallback(defaultComponentProps=>{return/* @__PURE__ */jsxRuntime.jsx(Root$d,{as:tag,"data-mark":value,children:defaultComponentProps.children});},[tag,value]);return React.useMemo(()=>{const componentProps={focused,renderDefault:DefaultComponent,schemaType,selected,title:schemaType.title,value};return CustomComponent?/* @__PURE__ */jsxRuntime.jsx(CustomComponent,{...componentProps,children}):/* @__PURE__ */jsxRuntime.jsx(DefaultComponent,{...componentProps,children});},[CustomComponent,DefaultComponent,children,focused,schemaType,selected,value]);}function createListName(level){return"list-level-".concat(level);}var __freeze$1g=Object.freeze;var __defProp$1g=Object.defineProperty;var __template$1g=(cooked,raw)=>__freeze$1g(__defProp$1g(cooked,"raw",{value:__freeze$1g(raw||cooked.slice())}));var _a$1g;const ReviewChangesHighlightBlock=styled__default.default.div(_ref216=>{let{theme}=_ref216;const{radius,space,color}=theme.sanity;const bg=ui.rgba(color.spot.yellow,0.2);return styled.css(_a$1g||(_a$1g=__template$1g(["\n    position: absolute;\n    border-radius: ","px;\n    top: -","px;\n    bottom: -","px;\n    left: ","px;\n    right: 0;\n    background-color: ",";\n  "])),radius[3],space[2],space[1]+space[1],space[4]+space[1],bg);});var __freeze$1f=Object.freeze;var __defProp$1f=Object.defineProperty;var __template$1f=(cooked,raw)=>__freeze$1f(__defProp$1f(cooked,"raw",{value:__freeze$1f(raw||cooked.slice())}));var _a$1f;const StyledChangeIndicatorWithProvidedFullPath=styled__default.default(ChangeIndicator)(()=>{return styled.css(_a$1f||(_a$1f=__template$1f(["\n    width: 1px;\n    height: 100%;\n\n    & > div {\n      height: 100%;\n    }\n  "])));});function createInsertCallback(options){const{allowedDecorators,block,onChange}=options;let toInsert;return givenBlock=>{toInsert=Array.isArray(givenBlock)?givenBlock:[givenBlock];toInsert=toInsert.map(blk=>blockTools.normalizeBlock(blk,{allowedDecorators}));const patches=[insert(toInsert,"after",[{_key:block._key}])];return onChange(PatchEvent.from(patches));};}function createSetCallback(options){const{allowedDecorators,block,onChange}=options;return givenBlock=>{const patches=[set(blockTools.normalizeBlock(givenBlock,{allowedDecorators}),[{_key:block._key}])];return onChange(PatchEvent.from(patches));};}function createUnsetCallback(options){const{block,onChange}=options;return()=>{const patches=[unset([{_key:block._key}])];return onChange(PatchEvent.from(patches));};}var __freeze$1e=Object.freeze;var __defProp$1e=Object.defineProperty;var __template$1e=(cooked,raw)=>__freeze$1e(__defProp$1e(cooked,"raw",{value:__freeze$1e(raw||cooked.slice())}));var _a$1e;const Root$c=styled__default.default.div(_a$1e||(_a$1e=__template$1e(["\n  display: flex;\n  pointer-events: all;\n"])));function BlockActions(props){const editor=portableTextEditor.usePortableTextEditor();const{block,onChange,renderBlockActions}=props;const decoratorValues=React.useMemo(()=>editor.schemaTypes.decorators.map(d=>d.value),[editor]);const blockActions=React.useMemo(()=>{if(renderBlockActions){const blockActionProps={block,value:portableTextEditor.PortableTextEditor.getValue(editor),set:createSetCallback({allowedDecorators:decoratorValues,block,onChange}),unset:createUnsetCallback({block,onChange}),insert:createInsertCallback({allowedDecorators:decoratorValues,block,onChange})};return renderBlockActions(blockActionProps);}return void 0;},[renderBlockActions,block,editor,onChange,decoratorValues]);if(!blockActions)return null;return/* @__PURE__ */jsxRuntime.jsx(Root$c,{contentEditable:false,children:blockActions});}var __freeze$1d=Object.freeze;var __defProp$1d=Object.defineProperty;var __template$1d=(cooked,raw)=>__freeze$1d(__defProp$1d(cooked,"raw",{value:__freeze$1d(raw||cooked.slice())}));var _a$1d,_b$C,_c$m,_d$d,_e$9,_f$7,_g$5,_h$3,_i$1,_j;function textBlockStyle(props){const{$level}=props;const{color:color$1,font,radius,space}=theme.getTheme_v2(props.theme);const numberMarker=TEXT_NUMBER_FORMATS[($level-1)%TEXT_NUMBER_FORMATS.length];const bulletMarker=TEXT_BULLET_MARKERS[($level-1)%TEXT_BULLET_MARKERS.length];return styled.css(_a$1d||(_a$1d=__template$1d(["\n    --marker-bg-color: transparent;\n\n    mix-blend-mode: ",";\n    position: relative;\n\n    & > [data-ui='TextBlock_inner'] {\n      position: relative;\n      flex: 1;\n    }\n\n    & > div:before {\n      content: '';\n      position: absolute;\n      top: -","px;\n      bottom: -","px;\n      left: -","px;\n      right: -","px;\n      border-radius: ","px;\n      background-color: var(--marker-bg-color);\n      // This is to make sure the marker is always behind the text\n      z-index: -1;\n    }\n\n    &[data-markers] {\n      --marker-bg-color: ",";\n    }\n\n    &[data-warning] {\n      --card-border-color: ",";\n      --marker-bg-color: ",";\n    }\n\n    &[data-error] {\n      --card-border-color: ",";\n      --marker-bg-color: ",";\n    }\n\n    & [data-list-prefix] {\n      position: absolute;\n      margin-left: -4.5rem;\n      width: 3.75rem;\n      text-align: right;\n      box-sizing: border-box;\n    }\n\n    &[data-list-item='number'] [data-list-prefix] {\n      font-variant-numeric: tabular-nums;\n\n      & > span:before {\n        content: counter(",") '.';\n        content: counter(",", ",") '.';\n      }\n    }\n\n    &[data-list-item='bullet'] [data-list-prefix] {\n      & > span {\n        position: relative;\n        top: -0.1875em;\n\n        &:before {\n          content: '","';\n          font-size: 0.46666em;\n        }\n      }\n    }\n\n    & [data-text] {\n      overflow-wrap: anywhere;\n      text-transform: none;\n      white-space: pre-wrap;\n      font-family: ",";\n      flex: 1;\n\n      *::selection {\n        background-color: ",";\n      }\n    }\n  "])),color$1._dark?"screen":"multiply",space[1],space[1],space[1],space[1],radius[2],color$1._dark?color.hues.purple[950].hex:color.hues.purple[50].hex,color$1.button.ghost.caution.enabled.border,color$1.button.ghost.caution.hovered.bg,color$1.button.ghost.critical.enabled.border,color$1.button.ghost.critical.hovered.bg,createListName($level),createListName($level),numberMarker,bulletMarker,font.text.family,theme.rgba(color$1.focusRing,0.3));}const TextRoot=styled__default.default.div(textBlockStyle);const TextBlockFlexWrapper=styled__default.default(ui.Box)(_b$C||(_b$C=__template$1d(["\n  position: relative;\n  display: flex;\n"])));const ListPrefixWrapper=styled__default.default.div(_c$m||(_c$m=__template$1d(["\n  user-select: none;\n  white-space: nowrap;\n"])));const BlockExtrasContainer=styled__default.default(ui.Box)(_d$d||(_d$d=__template$1d(["\n  user-select: none;\n"])));const BlockActionsOuter$1=styled__default.default(ui.Box)(_e$9||(_e$9=__template$1d(["\n  line-height: 0;\n  width: 25px;\n  position: relative;\n"])));const BlockActionsInner$1=styled__default.default(ui.Flex)(_ref217=>{let{theme}=_ref217;const{fonts,space}=theme.sanity;const textSize1=fonts.text.sizes[1];const textSize2=fonts.text.sizes[2];const capHeight1=textSize1.lineHeight-textSize1.ascenderHeight-textSize1.descenderHeight;const capHeight2=textSize2.lineHeight-textSize2.ascenderHeight-textSize2.descenderHeight;const buttonHeight=capHeight1+space[2]+space[2];const negativeTop=0-(buttonHeight-capHeight2)/2;return styled.css(_f$7||(_f$7=__template$1d(["\n    user-select: none;\n    position: absolute;\n    right: 0;\n    top: ","px;\n  "])),negativeTop);});const TooltipBox$2=styled__default.default(ui.Box)(_g$5||(_g$5=__template$1d(["\n  max-width: 250px;\n"])));const TextFlex=styled__default.default(ui.Flex)(_h$3||(_h$3=__template$1d(["\n  position: relative;\n  padding-left: ","px;\n"])),_ref218=>{let{$level}=_ref218;return $level?$level*32:0;});const ChangeIndicatorWrapper$1=styled__default.default.div(_ref219=>{let{theme,$hasChanges}=_ref219;const{space}=theme.sanity;return styled.css(_j||(_j=__template$1d(["\n      position: absolute;\n      width: ","px;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      padding-left: ","px;\n      user-select: none;\n\n      ","\n    "])),space[2],space[1],!$hasChanges&&styled.css(_i$1||(_i$1=__template$1d(["\n        display: none;\n      "]))));});var __freeze$1c=Object.freeze;var __defProp$1c=Object.defineProperty;var __template$1c=(cooked,raw)=>__freeze$1c(__defProp$1c(cooked,"raw",{value:__freeze$1c(raw||cooked.slice())}));var _a$1c,_b$B;const TextContainer=styled__default.default.div(_a$1c||(_a$1c=__template$1c(["\n  display: block;\n"])));const Normal=_ref220=>{let{children,...rest}=_ref220;return/* @__PURE__ */jsxRuntime.jsx(ui.Text,{"data-testid":"text-style--normal",...rest,children:/* @__PURE__ */jsxRuntime.jsx(TextContainer,{children})});};const Heading1=_ref221=>{let{children,...rest}=_ref221;return/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{as:"h1","data-testid":"text-style--h1",size:5,...rest,children:/* @__PURE__ */jsxRuntime.jsx(TextContainer,{children})});};const Heading2=_ref222=>{let{children,...rest}=_ref222;return/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{as:"h2","data-testid":"text-style--h2",size:4,...rest,children:/* @__PURE__ */jsxRuntime.jsx(TextContainer,{children})});};const Heading3=_ref223=>{let{children,...rest}=_ref223;return/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{as:"h3","data-testid":"text-style--h3",size:3,...rest,children:/* @__PURE__ */jsxRuntime.jsx(TextContainer,{children})});};const Heading4=_ref224=>{let{children,...rest}=_ref224;return/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{as:"h4","data-testid":"text-style--h4",size:2,...rest,children:/* @__PURE__ */jsxRuntime.jsx(TextContainer,{children})});};const Heading5=_ref225=>{let{children,...rest}=_ref225;return/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{as:"h5","data-testid":"text-style--h5",size:1,...rest,children:/* @__PURE__ */jsxRuntime.jsx(TextContainer,{children})});};const Heading6=_ref226=>{let{children,...rest}=_ref226;return/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{as:"h6","data-testid":"text-style--h6",size:0,...rest,children:/* @__PURE__ */jsxRuntime.jsx(TextContainer,{children})});};const BlockQuoteRoot=styled__default.default.blockquote(_b$B||(_b$B=__template$1c(["\n  position: relative;\n  display: block;\n  margin: 0;\n  padding-left: ","px;\n\n  &::before {\n    content: '';\n    position: absolute;\n    left: 0;\n    top: -4px;\n    bottom: -4px;\n    width: 3px;\n    background: var(--card-border-color);\n  }\n"])),_ref227=>{let{theme}=_ref227;return theme.sanity.space[3];});const BlockQuote=_ref228=>{let{children,...rest}=_ref228;return/* @__PURE__ */jsxRuntime.jsx(BlockQuoteRoot,{"data-testid":"text-style--blockquote",...rest,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",children})});};const TEXT_STYLES={normal:Normal,h1:Heading1,h2:Heading2,h3:Heading3,h4:Heading4,h5:Heading5,h6:Heading6,blockquote:BlockQuote};function TextBlock(props){const{children,floatingBoundary,focused,isFullscreen,onItemClose,onItemOpen,onPathFocus,path,readOnly,referenceBoundary,renderBlock,renderAnnotation,renderBlockActions,renderCustomMarkers,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType,selected,spellCheck,value}=props;const{Markers}=useFormBuilder().__internal.components;const[reviewChangesHovered,setReviewChangesHovered]=React.useState(false);const markers=usePortableTextMarkers(path);const memberItem=usePortableTextMemberItem(pathToString$1(path));const editor=portableTextEditor.usePortableTextEditor();const{onChange}=useFormCallbacks();const presence=useChildPresence(path,true);const textPresence=React.useMemo(()=>{return presence.filter(p=>PathUtils.isEqual(p.path,path)||p.path.slice(-3)[1]==="children"&&p.path.length-path.length===2);},[path,presence]);const handleChangeIndicatorMouseEnter=React.useCallback(()=>setReviewChangesHovered(true),[]);const handleChangeIndicatorMouseLeave=React.useCallback(()=>setReviewChangesHovered(false),[]);const{validation,hasError,hasWarning,hasInfo}=useMemberValidation(memberItem==null?void 0:memberItem.node);const hasMarkers=Boolean(renderCustomMarkers)&&markers.length>0;const tooltipEnabled=hasError||hasWarning||hasMarkers||hasInfo;const onOpen=React.useCallback(()=>{if(memberItem){onItemOpen(memberItem.node.path);}},[onItemOpen,memberItem]);const onRemove=React.useCallback(()=>{const point={path:path.slice(-1),offset:0};const sel={focus:point,anchor:point};portableTextEditor.PortableTextEditor.delete(editor,sel,{mode:"blocks"});portableTextEditor.PortableTextEditor.focus(editor);},[path,editor]);const text=React.useMemo(()=>{return/* @__PURE__ */jsxRuntime.jsxs(TextFlex,{align:"flex-start",$level:value==null?void 0:value.level,children:[value.listItem&&/* @__PURE__ */jsxRuntime.jsx(ListPrefixWrapper,{contentEditable:false,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{"data-list-prefix":"",children:/* @__PURE__ */jsxRuntime.jsx(TextContainer,{})})}),/* @__PURE__ */jsxRuntime.jsx("div",{"data-text":"",style:debugRender(),children})]});},[value.listItem,value.level,children]);const innerPaddingProps=React.useMemo(()=>{if(isFullscreen&&!renderBlockActions){return{paddingX:5};}if(isFullscreen&&renderBlockActions){return{paddingLeft:5,paddingRight:2};}if(renderBlockActions){return{paddingLeft:3,paddingRight:2};}return{paddingX:3};},[isFullscreen,renderBlockActions]);const outerPaddingProps=React.useMemo(()=>{if(value.listItem){return{paddingY:2};}return TEXT_STYLE_PADDING[value.style||"normal"]||{paddingY:2};},[value]);const isOpen=Boolean(memberItem==null?void 0:memberItem.member.open);const parentSchemaType=editor.schemaTypes.portableText;const componentProps=React.useMemo(()=>{var _a;return{__unstable_floatingBoundary:floatingBoundary,__unstable_referenceBoundary:referenceBoundary,__unstable_referenceElement:((_a=memberItem==null?void 0:memberItem.elementRef)==null?void 0:_a.current)||null,children:text,focused,markers,onClose:onItemClose,onOpen,onPathFocus,onRemove,open:isOpen,parentSchemaType,path:(memberItem==null?void 0:memberItem.node.path)||EMPTY_ARRAY$9,presence:textPresence,readOnly:Boolean(readOnly),renderAnnotation,renderBlock,renderDefault:DefaultComponent$1,renderField,renderInput,renderInlineBlock,renderItem,renderPreview,schemaType,selected,validation,value};},[floatingBoundary,focused,isOpen,markers,memberItem==null?void 0:memberItem.elementRef,memberItem==null?void 0:memberItem.node.path,onItemClose,onOpen,onPathFocus,onRemove,parentSchemaType,readOnly,referenceBoundary,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType,selected,text,textPresence,validation,value]);const toolTipContent=React.useMemo(()=>tooltipEnabled&&/* @__PURE__ */jsxRuntime.jsx(TooltipBox$2,{children:/* @__PURE__ */jsxRuntime.jsx(Markers,{markers,renderCustomMarkers,validation})})||null,[Markers,markers,renderCustomMarkers,tooltipEnabled,validation]);return React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx(ui.Box,{"data-testid":"text-block",...outerPaddingProps,style:debugRender(),ref:memberItem==null?void 0:memberItem.elementRef,children:/* @__PURE__ */jsxRuntime.jsx(TextBlockFlexWrapper,{"data-testid":"text-block__wrapper",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{flex:1,...innerPaddingProps,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:toolTipContent,disabled:!tooltipEnabled,placement:"top",portal:"editor",children:/* @__PURE__ */jsxRuntime.jsx(TextRoot,{$level:value.level||1,"data-error":hasError?"":void 0,"data-list-item":value.listItem,"data-markers":hasMarkers?"":void 0,"data-read-only":readOnly,"data-testid":"text-block__text","data-warning":hasWarning?"":void 0,spellCheck,children:renderBlock&&renderBlock(componentProps)})})}),/* @__PURE__ */jsxRuntime.jsxs(BlockExtrasContainer,{contentEditable:false,children:[/* @__PURE__ */jsxRuntime.jsx(BlockActionsOuter$1,{marginRight:1,children:/* @__PURE__ */jsxRuntime.jsx(BlockActionsInner$1,{children:renderBlockActions&&focused&&!readOnly&&/* @__PURE__ */jsxRuntime.jsx(BlockActions,{onChange,block:value,renderBlockActions})})}),isFullscreen&&memberItem&&/* @__PURE__ */jsxRuntime.jsx(ChangeIndicatorWrapper$1,{$hasChanges:memberItem.member.item.changed,onMouseEnter:handleChangeIndicatorMouseEnter,onMouseLeave:handleChangeIndicatorMouseLeave,children:/* @__PURE__ */jsxRuntime.jsx(StyledChangeIndicatorWithProvidedFullPath,{hasFocus:focused,isChanged:memberItem.member.item.changed,path:memberItem.member.item.path,withHoverEffect:false})})]}),reviewChangesHovered&&/* @__PURE__ */jsxRuntime.jsx(ReviewChangesHighlightBlock,{})]})})}),[componentProps,focused,handleChangeIndicatorMouseEnter,handleChangeIndicatorMouseLeave,hasError,hasMarkers,hasWarning,innerPaddingProps,isFullscreen,memberItem,onChange,outerPaddingProps,readOnly,renderBlock,renderBlockActions,reviewChangesHovered,spellCheck,toolTipContent,tooltipEnabled,value]);}const DefaultComponent$1=props=>{return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:props.children});};var __freeze$1b=Object.freeze;var __defProp$1b=Object.defineProperty;var __template$1b=(cooked,raw)=>__freeze$1b(__defProp$1b(cooked,"raw",{value:__freeze$1b(raw||cooked.slice())}));var _a$1b,_b$A,_c$l,_d$c,_e$8,_f$6,_g$4,_h$2;const Root$b=styled__default.default(ui.Card)(_a$1b||(_a$1b=__template$1b(["\n  height: ",";\n\n  &:not([hidden]) {\n    display: flex;\n  }\n\n  flex-direction: column;\n"])),_ref229=>{let{$fullscreen}=_ref229;return $fullscreen?"100%":"15em";});const ToolbarCard=styled__default.default(ui.Card)(_b$A||(_b$A=__template$1b(["\n  z-index: 10;\n  line-height: 0;\n"])));const EditableCard=styled__default.default(ui.Card)(_c$l||(_c$l=__template$1b(["\n  position: relative;\n  overflow: hidden;\n  overflow: clip;\n\n  & > [data-portal] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    pointer-events: none;\n\n    & > * {\n      pointer-events: initial;\n    }\n  }\n\n  &::selection,\n  *::selection {\n    background-color: transparent;\n  }\n"])));const Scroller=styled__default.default(ScrollContainer)(_d$c||(_d$c=__template$1b(["\n  position: relative;\n  overflow: auto;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n\n  & > * {\n    flex: 1;\n    min-height: auto;\n  }\n"])));const EditableContainer=styled__default.default(ui.Container)(_e$8||(_e$8=__template$1b(["\n  /* @todo: calculate from theme */\n  /* max-width: 728px; */\n"])));const EditableWrapper=styled__default.default(ui.Card)(_h$2||(_h$2=__template$1b(["\n  height: 100%;\n  width: 100%;\n  counter-reset: ",";\n  overflow: hidden;\n  overflow: clip;\n\n  & > div {\n    height: 100%;\n  }\n\n  & .pt-editable {\n    display: block;\n    width: 100%;\n    height: 100%;\n\n    ","\n\n    & > .pt-list-item-bullet + .pt-list-item-number,\n    & > .pt-list-item-number + .pt-list-item-bullet {\n      margin-top: ","px;\n      counter-reset: ",";\n    }\n\n    & > :not(.pt-list-item) + .pt-list-item {\n      margin-top: ","px;\n    }\n\n    /* Reset the list count if the element is not a numbered list item */\n    & > :not(.pt-list-item-number) {\n      counter-reset: ",";\n    }\n\n    ","\n\n    & > .pt-list-item + :not(.pt-list-item) {\n      margin-top: ","px;\n    }\n\n    & > :first-child {\n      padding-top: ","px;\n    }\n\n    & > :last-child {\n      padding-bottom: ","px;\n    }\n\n    /* & > .pt-block {\n      & .pt-inline-object {\n      }\n    } */\n\n    & .pt-drop-indicator {\n      pointer-events: none;\n      border: 1px solid var(--card-focus-ring-color) !important;\n      height: 0px !important;\n      border-radius: ","px;\n      margin-top: -3px;\n      left: calc(\n        "," - 1px\n      );\n      right: calc(\n        "," - 1px\n      );\n      width: calc(\n        100% -\n          "," + 2px\n      ) !important;\n    }\n  }\n"])),TEXT_LEVELS.map(l=>createListName(l)).join(" "),TEXT_LEVELS.map(l=>{return styled.css(_f$6||(_f$6=__template$1b(["\n        & > .pt-list-item-number[class~='pt-list-item-level-","'] {\n          counter-increment: ",";\n        }\n      "])),l,createListName(l));}),_ref230=>{let{theme}=_ref230;return theme.sanity.space[3];},TEXT_LEVELS.map(l=>createListName(l)).join(" "),_ref231=>{let{theme}=_ref231;return theme.sanity.space[2];},TEXT_LEVELS.map(l=>createListName(l)).join(" "),TEXT_LEVELS.slice(1).map(l=>{return styled.css(_g$4||(_g$4=__template$1b(["\n        & > .pt-list-item-level-"," + .pt-list-item-level-"," {\n          counter-reset: ",";\n        }\n      "])),l,l-1,createListName(l));}),_ref232=>{let{theme}=_ref232;return theme.sanity.space[3];},_ref233=>{let{$isFullscreen,theme}=_ref233;return theme.sanity.space[$isFullscreen?5:3];},_ref234=>{let{$isFullscreen,theme}=_ref234;return theme.sanity.space[$isFullscreen?9:5];},props=>theme.getTheme_v2(props.theme).radius[2],_ref235=>{let{$isFullscreen,theme}=_ref235;return $isFullscreen?ui.rem(theme.sanity.space[5]):ui.rem(theme.sanity.space[3]);},_ref236=>{let{$isFullscreen,theme}=_ref236;return $isFullscreen?ui.rem(theme.sanity.space[5]):ui.rem(theme.sanity.space[3]);},_ref237=>{let{$isFullscreen,theme}=_ref237;return $isFullscreen?ui.rem(theme.sanity.space[5]*2):ui.rem(theme.sanity.space[3]*2);});function useScrollSelectionIntoView(scrollElement){return React.useMemo(()=>(editor,domRange)=>{const selection=portableTextEditor.PortableTextEditor.getSelection(editor);if(selection){const leafEl=domRange.startContainer.parentElement;if(!leafEl){return;}scrollIntoView__default.default(leafEl,{scrollMode:"if-needed",boundary:scrollElement,block:"start",inline:"nearest"});}},[scrollElement]);}function useSpellcheck(){const editor=portableTextEditor.usePortableTextEditor();return React.useMemo(()=>{var _a;const spellCheckOption=(_a=editor.schemaTypes.block.options)==null?void 0:_a.spellCheck;const isChrome96=typeof navigator==="undefined"?false:/Chrome\/96/.test(navigator.userAgent);return spellCheckOption===void 0&&isChrome96===true?false:spellCheckOption;},[editor]);}const DefaultComponent=dProps=>{return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:dProps.children});};const ListItem=props=>{const{block,children,schemaType,selected,focused,level,value}=props;const{title,component:CustomComponent}=schemaType;return React.useMemo(()=>{const componentProps={block,focused,level,renderDefault:DefaultComponent,schemaType,selected,title,value};return CustomComponent?/* @__PURE__ */jsxRuntime.jsx(CustomComponent,{...componentProps,children}):/* @__PURE__ */jsxRuntime.jsx(DefaultComponent,{...componentProps,children});},[CustomComponent,block,children,focused,level,schemaType,selected,title,value]);};const Style=props=>{const{block,focused,children,selected,schemaType}=props;const DefaultComponentWithFallback=React.useMemo(()=>(block.style&&TEXT_STYLES[block.style]?TEXT_STYLES[block.style]:TEXT_STYLES[0])||Normal,[block.style]);const DefaultComponent=React.useCallback(defaultComponentProps=>{return/* @__PURE__ */jsxRuntime.jsx(DefaultComponentWithFallback,{children:/* @__PURE__ */jsxRuntime.jsx(TextContainer,{"data-testid":"text-style--".concat(block.style),children:defaultComponentProps.children})});},[DefaultComponentWithFallback,block.style]);return React.useMemo(()=>{const CustomComponent=schemaType.component;const{title,value}=schemaType;const componentProps={block,focused,renderDefault:DefaultComponent,schemaType,selected,title,value};return CustomComponent?/* @__PURE__ */jsxRuntime.jsx(CustomComponent,{...componentProps,children}):/* @__PURE__ */jsxRuntime.jsx(DefaultComponent,{...componentProps,children});},[DefaultComponent,block,children,focused,schemaType,selected]);};var __freeze$1a=Object.freeze;var __defProp$1a=Object.defineProperty;var __template$1a=(cooked,raw)=>__freeze$1a(__defProp$1a(cooked,"raw",{value:__freeze$1a(raw||cooked.slice())}));var _a$1a;const DividerDiv=styled__default.default.div(_a$1a||(_a$1a=__template$1a(["\n  border-right: 1px solid var(--card-border-color);\n  height: auto;\n\n  &[data-hidden] {\n    opacity: 0;\n  }\n"])));function CollapseMenuDivider(props){const{hidden,...rest}=props;return/* @__PURE__ */jsxRuntime.jsx(DividerDiv,{"data-ui":"CollapseMenuDivider","data-hidden":hidden?"":void 0,...rest});}const MENU_BUTTON_POPOVER_PROPS={portal:true,constrainSize:true};const CollapseOverflowMenu=React.forwardRef(function CollapseOverflowMenu2(props,forwardedRef){const{disableRestoreFocusOnClose,menuButton,menuButtonProps,menuOptions,onMenuClose}=props;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{__unstable_disableRestoreFocusOnClose:disableRestoreFocusOnClose,id:"menu-button",ref:forwardedRef,onClose:onMenuClose,popover:MENU_BUTTON_POPOVER_PROPS,...menuButtonProps,button:menuButton,menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:menuOptions.map((c,index)=>{const{// eslint-disable-next-line @typescript-eslint/no-unused-vars
collapsedProps={},// eslint-disable-next-line @typescript-eslint/no-unused-vars
expandedProps={},// eslint-disable-next-line @typescript-eslint/no-unused-vars
tooltipProps={},// eslint-disable-next-line @typescript-eslint/no-unused-vars
tooltipText,// eslint-disable-next-line @typescript-eslint/no-unused-vars
dividerBefore,// eslint-disable-next-line @typescript-eslint/no-unused-vars
fontSize,// eslint-disable-next-line @typescript-eslint/no-unused-vars
padding,text,icon,selected,...rest}=c.props;return/* @__PURE__ */jsxRuntime.jsxs(React.Fragment,{children:[dividerBefore&&index!==0&&/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text,icon,pressed:selected,...rest})]},c.key);})})});});function ObserveElement(props){const{onIntersectionChange,children,options,...rest}=props;const[el,setEl]=React.useState(null);React.useEffect(()=>{if(!el)return void 0;const io=new IntersectionObserver(onIntersectionChange,options);io.observe(el);return()=>{io.unobserve(el);io.disconnect();};},[el,onIntersectionChange,options]);return/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{ref:setEl,...rest,children});}var __freeze$19=Object.freeze;var __defProp$19=Object.defineProperty;var __template$19=(cooked,raw)=>__freeze$19(__defProp$19(cooked,"raw",{value:__freeze$19(raw||cooked.slice())}));var _a$19,_b$z,_c$k,_d$b,_e$7;const FOCUS_RING_PADDING=3;const OPTION_STYLE=styled.css(_a$19||(_a$19=__template$19(["\n  list-style: none;\n  display: flex;\n  white-space: nowrap;\n\n  &[data-hidden='true'] {\n    opacity: 0;\n    visibility: hidden;\n  }\n"])));const OuterFlex=styled__default.default(ui.Flex)(_b$z||(_b$z=__template$19(["\n  padding: ","px;\n  margin: -","px;\n  box-sizing: border-box;\n"])),FOCUS_RING_PADDING,FOCUS_RING_PADDING);const RootFlex$3=styled__default.default(ui.Flex)(_c$k||(_c$k=__template$19(["\n  border-radius: inherit;\n  position: relative;\n"])));const RowFlex=styled__default.default(ui.Flex)(_d$b||(_d$b=__template$19(["\n  width: max-content;\n  &[data-hidden='true'] {\n    visibility: hidden;\n    position: relative;\n    margin-top: -1px;\n    height: 1px;\n  }\n"])));const OptionObserveElement$1=styled__default.default(ObserveElement)(_e$7||(_e$7=__template$19(["\n  ","\n"])),OPTION_STYLE);function _isReactElement$1(node){return Boolean(node);}const CollapseMenu=React.forwardRef(function CollapseMenu2(props,ref){const{children,collapsed,disableRestoreFocusOnClose,onMenuClose,menuButtonProps,...rest}=props;const menuOptions=React.useMemo(()=>React.Children.toArray(children).filter(_isReactElement$1),[children]);const menuButton=React.useMemo(()=>(menuButtonProps==null?void 0:menuButtonProps.button)||/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{}),[menuButtonProps]);if(collapsed){return/* @__PURE__ */jsxRuntime.jsx(CollapseOverflowMenu,{ref,disableRestoreFocusOnClose,menuButton,menuButtonProps,menuOptions,onMenuClose});}return/* @__PURE__ */jsxRuntime.jsx(AutoCollapseMenu,{...rest,ref,disableRestoreFocusOnClose,menuButtonProps,menuOptions,onMenuClose});});const AutoCollapseMenu=React.forwardRef(function AutoCollapseMenu2(props,ref){const{collapseText=true,disableRestoreFocusOnClose,gap,menuOptions,menuButtonProps,onMenuClose,...rest}=props;const[rootEl,setRootEl]=React.useState(null);const[expandedIntersections,setExpandedIntersections]=React.useState({});const[collapsedIntersections,setCollapsedIntersections]=React.useState({});const intersectionOptions=React.useMemo(()=>({root:rootEl,// safari needs threshold to be < 1
threshold:0.99,rootMargin:"2px"}),[rootEl]);const menuOptionKeys=React.useMemo(()=>menuOptions.map(child=>child.key),[menuOptions]);const pendingIntersections=React.useMemo(()=>[...difference__default.default(menuOptionKeys,Object.keys(expandedIntersections)),...difference__default.default(menuOptionKeys,Object.keys(collapsedIntersections))],[menuOptionKeys,expandedIntersections,collapsedIntersections]);const overflowingExpandedElements=React.useMemo(()=>menuOptions.filter(optionElement=>{const entry=expandedIntersections[optionElement.key];return entry&&!entry.intersects;}),[expandedIntersections,menuOptions]);const handleExpandedIntersection=React.useCallback((e,element)=>{setExpandedIntersections(current=>{const key=element.key;if(key===null){throw new Error("Expected element to have a non-null key");}const nextState={intersects:e.isIntersecting,element};const currentState=current[key];if(!currentState||currentState.intersects!==nextState.intersects){return{...current,[key]:nextState};}return current;});},[]);const handleCollapsedIntersection=React.useCallback((e,element)=>{setCollapsedIntersections(current=>{const key=element.key;if(key===null){throw new Error("Expected child element to have a non-null key");}const currentElementIntersection=current[key];const nextElementIntersection={intersects:e.isIntersecting,element};return(currentElementIntersection==null?void 0:currentElementIntersection.intersects)===nextElementIntersection.intersects?current:{...current,[key]:nextElementIntersection};});},[]);const collapsedElements=React.useMemo(()=>menuOptions.map(optionElement=>{const{collapsedProps}=optionElement.props;const modeProps=collapsedProps;const text=collapseText?void 0:optionElement.props.text;return React.cloneElement(optionElement,{...modeProps,text});}),[menuOptions,collapseText]);const overflowingCollapsedOptionElements=React.useMemo(()=>menuOptions.filter(optionElement=>{const intersection=collapsedIntersections[optionElement.key];return(intersection==null?void 0:intersection.intersects)===false;}),[menuOptions,collapsedIntersections]);const shouldCollapse=overflowingExpandedElements.length>0;const visibleMenuOptions=shouldCollapse?collapsedElements.filter(optionElement=>{const intersection=collapsedIntersections[optionElement.key];return(intersection==null?void 0:intersection.intersects)===true;}):menuOptions;const menuButton=React.useMemo(()=>(menuButtonProps==null?void 0:menuButtonProps.button)||/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{}),[menuButtonProps]);return/* @__PURE__ */jsxRuntime.jsxs(OuterFlex,{align:"center","data-ui":"CollapseMenu",overflow:"hidden",sizing:"border",ref,...rest,children:[/* @__PURE__ */jsxRuntime.jsxs(RootFlex$3,{direction:"column",flex:1,justify:"center",ref:setRootEl,children:[/* @__PURE__ */jsxRuntime.jsx(RowFlex,{gap,children:pendingIntersections.length===0&&visibleMenuOptions.map((optionElement,index)=>{const{dividerBefore,tooltipText="",tooltipProps={}}=optionElement.props;const hidden=!optionElement.key||!(optionElement.key in expandedIntersections)||overflowingCollapsedOptionElements.includes(optionElement);return/* @__PURE__ */jsxRuntime.jsxs(React.Fragment,{children:[dividerBefore&&index!==0&&/* @__PURE__ */jsxRuntime.jsx(CollapseMenuDivider,{hidden}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{portal:true,disabled:!tooltipText,content:tooltipText,...tooltipProps,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{children:React.cloneElement(optionElement,{disabled:optionElement.props.disabled||hidden,"aria-hidden":hidden})})})]},optionElement.key);})}),/* @__PURE__ */jsxRuntime.jsx(RenderHidden,{gap,elements:menuOptions,intersectionOptions,onIntersectionChange:handleExpandedIntersection}),/* @__PURE__ */jsxRuntime.jsx(RenderHidden,{gap,elements:collapsedElements,intersectionOptions,onIntersectionChange:handleCollapsedIntersection})]}),overflowingCollapsedOptionElements.length>0&&/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{marginLeft:gap,children:/* @__PURE__ */jsxRuntime.jsx(CollapseOverflowMenu,{disableRestoreFocusOnClose,menuButton,menuButtonProps,menuOptions:overflowingCollapsedOptionElements,onMenuClose})})]});});const RenderHidden=React.memo(function RenderHidden2(props){const{elements,gap,intersectionOptions,onIntersectionChange}=props;return/* @__PURE__ */jsxRuntime.jsx(RowFlex,{"data-hidden":true,"aria-hidden":"true",gap,overflow:"hidden",children:elements.map((element,index)=>{const{dividerBefore}=element.props;return/* @__PURE__ */jsxRuntime.jsxs(React.Fragment,{children:[dividerBefore&&index!==0&&/* @__PURE__ */jsxRuntime.jsx(CollapseMenuDivider,{hidden:true}),/* @__PURE__ */jsxRuntime.jsx(OptionObserveElement$1,{options:intersectionOptions,onIntersectionChange:e=>onIntersectionChange(e[0],element),children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{children:React.cloneElement(element,{disabled:true,"aria-hidden":true})})})]},element.key);})});});const CollapseMenuButton=React.forwardRef(function CollapseMenuButton2(props,ref){const{// eslint-disable-next-line @typescript-eslint/no-unused-vars
collapsedProps={},// eslint-disable-next-line @typescript-eslint/no-unused-vars
expandedProps={},// eslint-disable-next-line @typescript-eslint/no-unused-vars
tooltipProps={},// eslint-disable-next-line @typescript-eslint/no-unused-vars
tooltipText,// eslint-disable-next-line @typescript-eslint/no-unused-vars
dividerBefore,// eslint-disable-next-line @typescript-eslint/no-unused-vars
...rest}=props;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"data-ui":"CollapseMenuButton",...rest,ref});});var __freeze$18=Object.freeze;var __defProp$18=Object.defineProperty;var __template$18=(cooked,raw)=>__freeze$18(__defProp$18(cooked,"raw",{value:__freeze$18(raw||cooked.slice())}));var _a$18;const CustomIconDiv=styled__default.default.div(_a$18||(_a$18=__template$18(["\n  width: 1em;\n  height: 1em;\n  border-radius: inherit;\n  background-origin: content-box;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: cover;\n  transform: scale(0.7);\n"])));function CustomIcon(props){const{icon,active}=props;const inlineStyle=React.useMemo(()=>({backgroundImage:"url(".concat(icon,")"),filter:active?"invert(100%)":"invert(0%)"}),[active,icon]);return/* @__PURE__ */jsxRuntime.jsx(CustomIconDiv,{style:inlineStyle});}function getPTEFormatActions(editor,disabled,hotkeyOpts,t){const types=editor.schemaTypes;return types.decorators.map(decorator=>{const shortCutKey=Object.keys(hotkeyOpts.marks||{}).find(key=>{var _a;return((_a=hotkeyOpts.marks)==null?void 0:_a[key])===decorator.value;});let hotkeys=[];if(shortCutKey){hotkeys=[shortCutKey];}return{type:"format",disabled,icon:decorator==null?void 0:decorator.icon,key:decorator.value,handle:()=>{portableTextEditor.PortableTextEditor.toggleMark(editor,decorator.value);portableTextEditor.PortableTextEditor.focus(editor);},hotkeys,title:decorator.i18nTitleKey&&t?t(decorator.i18nTitleKey):decorator.title};});}function getPTEListActions(editor,disabled,t){const types=editor.schemaTypes;return types.lists.map(listItem=>{return{type:"listStyle",key:listItem.value,disabled,icon:listItem==null?void 0:listItem.icon,handle:()=>{portableTextEditor.PortableTextEditor.toggleList(editor,listItem.value);},title:listItem.i18nTitleKey&&t?t(listItem.i18nTitleKey):listItem.title};});}function getAnnotationIcon(type){return get__default.default(type,"icon")||get__default.default(type,"type.icon")||get__default.default(type,"type.to.icon")||get__default.default(type,"type.to[0].icon");}function getPTEAnnotationActions(editor,disabled,onInsert,t){const types=editor.schemaTypes;const focusChild=portableTextEditor.PortableTextEditor.focusChild(editor);const hasText=focusChild&&focusChild.text;return types.annotations.map(aType=>{return{type:"annotation",disabled:!hasText||disabled,icon:getAnnotationIcon(aType),key:aType.name,handle:active=>{if(active){portableTextEditor.PortableTextEditor.removeAnnotation(editor,aType);portableTextEditor.PortableTextEditor.focus(editor);}else{onInsert(aType);}},title:aType.i18nTitleKey&&t?t(aType.i18nTitleKey):aType.title||capitalize__default.default(aType.name)};});}function getPTEToolbarActionGroups(editor,disabled,onInsertAnnotation,hotkeyOpts,t){return[{name:"format",actions:getPTEFormatActions(editor,disabled,hotkeyOpts,t)},{name:"list",actions:getPTEListActions(editor,disabled,t)},{name:"annotation",actions:getPTEAnnotationActions(editor,disabled,onInsertAnnotation,t)}];}function getBlockStyles(types){return types.styles.map(style=>{return{key:"style-".concat(style.value),style:style.value,styleComponent:style&&style.component,title:style.title,i18nTitleKey:style.i18nTitleKey};});}function getInsertMenuIcon(type,fallbackIcon){const referenceIcon=get__default.default(type,"to[0].icon");return type.icon||type.type&&type.type.icon||referenceIcon||fallbackIcon;}function getInsertMenuItems(types,disabled,onInsertBlock,onInsertInline){const blockItems=types.blockObjects.map((type,index)=>({handle:()=>onInsertBlock(type),icon:getInsertMenuIcon(type,icons.BlockElementIcon),inline:false,key:"block-".concat(index),type}));const inlineItems=types.inlineObjects.map((type,index)=>({handle:()=>onInsertInline(type),icon:getInsertMenuIcon(type,icons.InlineElementIcon),inline:true,key:"inline-".concat(index),type}));const filteredBlockItems=blockItems.concat(inlineItems).filter(item=>{var _a;return!((_a=item.type)==null?void 0:_a.hidden);});return filteredBlockItems;}const annotationIcons={link:icons.LinkIcon};const formatIcons={strong:icons.BoldIcon,em:icons.ItalicIcon,"strike-through":icons.StrikethroughIcon,underline:icons.UnderlineIcon,code:icons.CodeIcon};const listStyleIcons={number:icons.OlistIcon,bullet:icons.UlistIcon};function getActionIcon(action,active){if(action.icon){if(typeof action.icon==="string"){return/* @__PURE__ */jsxRuntime.jsx(CustomIcon,{active,icon:action.icon});}return action.icon;}if(action.type==="annotation"){return annotationIcons[action.key]||icons.UnknownIcon;}if(action.type==="listStyle"){return listStyleIcons[action.key]||icons.UnknownIcon;}return formatIcons[action.key]||icons.UnknownIcon;}function useFocusBlock(){const editor=portableTextEditor.usePortableTextEditor();const selection=portableTextEditor.usePortableTextEditorSelection();return React.useMemo(()=>portableTextEditor.PortableTextEditor.focusBlock(editor),[editor,selection]);}function useActionGroups(_ref238){let{hotkeys,onMemberOpen,resolveInitialValue,disabled}=_ref238;const editor=portableTextEditor.usePortableTextEditor();const{t}=useTranslation();const handleInsertAnnotation=React.useCallback(async schemaType=>{const initialValue=await resolveInitialValue(schemaType);const paths=portableTextEditor.PortableTextEditor.addAnnotation(editor,schemaType,initialValue);if(paths&&paths.markDefPath){onMemberOpen(paths.markDefPath);}},[editor,onMemberOpen,resolveInitialValue]);return React.useMemo(()=>editor?getPTEToolbarActionGroups(editor,disabled,handleInsertAnnotation,hotkeys,t):[],[disabled,editor,handleInsertAnnotation,hotkeys,t]);}function useActiveActionKeys(_ref239){let{actions}=_ref239;const editor=portableTextEditor.usePortableTextEditor();const selection=portableTextEditor.usePortableTextEditorSelection();return useUnique(React.useMemo(()=>{const activeAnnotationKeys=portableTextEditor.PortableTextEditor.activeAnnotations(editor).map(a=>a._type);return actions.filter(a=>{if(a.type==="annotation"){return activeAnnotationKeys.includes(a.key);}if(a.type==="listStyle"){return portableTextEditor.PortableTextEditor.hasListStyle(editor,a.key);}return portableTextEditor.PortableTextEditor.isMarkActive(editor,a.key);}).map(a=>a.key);},// eslint-disable-next-line react-hooks/exhaustive-deps
[editor,// This is needed so that active actions update as `selection` changes
selection]));}function useActiveStyleKeys(_ref240){let{items}=_ref240;const editor=portableTextEditor.usePortableTextEditor();const focusBlock=useFocusBlock();const selection=portableTextEditor.usePortableTextEditorSelection();return useUnique(React.useMemo(()=>items.filter(i=>portableTextEditor.PortableTextEditor.hasBlockStyle(editor,i.style)).map(i=>i.style),//  eslint-disable-next-line react-hooks/exhaustive-deps
[focusBlock,// This is needed so that active styles update as `selection` changes
selection]));}const CollapseMenuMemo$1=React.memo(CollapseMenu);const MENU_POPOVER_PROPS$5={constrainSize:true,portal:true};const ActionMenu=React.memo(function ActionMenu2(props){const{disabled:disabledProp,groups,isFullscreen,collapsed}=props;const focusBlock=useFocusBlock();const editor=portableTextEditor.usePortableTextEditor();const selection=portableTextEditor.usePortableTextEditorSelection();const{t}=reactI18next.useTranslation();const isSelectingMultipleBlocks=// Path at 0 is the block level, by comparing those we can detect if the user is selecting multiple blocks
selection&&types.isKeySegment(selection.anchor.path[0])&&types.isKeySegment(selection.focus.path[0])?// In case of keyed segments
selection.anchor.path[0]._key!==(selection==null?void 0:selection.focus.path[0]._key):// In case of non-keyed segments
(selection==null?void 0:selection.anchor.path[0])!==(selection==null?void 0:selection.focus.path[0]);const isVoidBlock=(focusBlock==null?void 0:focusBlock._type)!==editor.schemaTypes.block.name;const isEmptyTextBlock=!isVoidBlock&&Array.isArray(focusBlock.children)&&focusBlock.children.length===1&&(focusBlock==null?void 0:focusBlock.children[0].text)==="";const disabled=disabledProp||isVoidBlock;const actions=React.useMemo(()=>groups.reduce((acc,group)=>{return acc.concat(group.actions.map(// eslint-disable-next-line max-nested-callbacks
(action,actionIndex)=>{if(actionIndex===0)return{...action,firstInGroup:true};return action;}));},[]),[groups]);const activeKeys=useActiveActionKeys({actions});const handleMenuClose=React.useCallback(()=>{portableTextEditor.PortableTextEditor.focus(editor);},[editor]);const tooltipPlacement=isFullscreen?"bottom":"top";const children=React.useMemo(()=>actions.map(action=>{const annotationDisabled=action.type==="annotation"&&(isEmptyTextBlock||isSelectingMultipleBlocks);const annotationDisabledText=isEmptyTextBlock?t("user-menu.action.portable-text.annotation-disabled_empty-block",{name:action.title||action.key}):t("user-menu.action.portable-text.annotation-disabled_multiple-blocks",{name:action.title||action.key});const active=activeKeys.includes(action.key);return/* @__PURE__ */jsxRuntime.jsx(CollapseMenuButton,{"aria-label":t("toolbar.portable-text.action-button-aria-label",{action:action.title||action.key}),"data-testid":"action-button-".concat(action.key),disabled:disabled||annotationDisabled,mode:"bleed",dividerBefore:action.firstInGroup,icon:getActionIcon(action,active),onClick:()=>action.handle(active),selected:active,text:action.title||action.key,tooltipText:annotationDisabled?annotationDisabledText:action.title||action.key,tooltipProps:{disabled,placement:tooltipPlacement,portal:"default"}},action.key);}),[actions,activeKeys,disabled,isEmptyTextBlock,isSelectingMultipleBlocks,t,tooltipPlacement]);const menuButtonProps=React.useMemo(()=>({button:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{"data-testid":"action-menu-button",disabled,tooltipProps:{placement:tooltipPlacement}}),popover:MENU_POPOVER_PROPS$5}),[disabled,tooltipPlacement]);return/* @__PURE__ */jsxRuntime.jsx(CollapseMenuMemo$1,{"data-testid":"action-menu-auto-collapse-menu",collapsed,disableRestoreFocusOnClose:true,gap:1,menuButtonProps,onMenuClose:handleMenuClose,children});});var __freeze$17=Object.freeze;var __defProp$17=Object.defineProperty;var __template$17=(cooked,raw)=>__freeze$17(__defProp$17(cooked,"raw",{value:__freeze$17(raw||cooked.slice())}));var _a$17;const MenuButtonMemo=React.memo(TooltipDelayGroupProvider.MenuButton);const StyledMenuItem=styled__default.default(ui.MenuItem)(_a$17||(_a$17=__template$17(["\n  // Change the border color variable used by BlockQuote\n  // to make the border visible when the MenuItem is selected\n  &[data-selected] {\n    [data-option='blockquote'] {\n      --card-border-color: var(--card-muted-fg-color);\n    }\n  }\n"])));const MENU_POPOVER_PROPS$4={constrainSize:true,placement:"bottom-start",portal:"default"};const TEXT_STYLE_OPTIONS={h1:title=>/* @__PURE__ */jsxRuntime.jsx(Heading1,{children:title}),h2:title=>/* @__PURE__ */jsxRuntime.jsx(Heading2,{children:title}),h3:title=>/* @__PURE__ */jsxRuntime.jsx(Heading3,{children:title}),h4:title=>/* @__PURE__ */jsxRuntime.jsx(Heading4,{children:title}),h5:title=>/* @__PURE__ */jsxRuntime.jsx(Heading5,{children:title}),h6:title=>/* @__PURE__ */jsxRuntime.jsx(Heading6,{children:title}),normal:title=>/* @__PURE__ */jsxRuntime.jsx(Normal,{children:title}),blockquote:title=>/* @__PURE__ */jsxRuntime.jsx(BlockQuote,{"data-option":"blockquote",children:title})};const TEXT_STYLE_KEYS=Object.keys(TEXT_STYLE_OPTIONS);const preventDefault=event=>event.preventDefault();const emptyStyle={key:"style-none",style:"",title:"No style",i18nTitleKey:"inputs.portable-text.style.none"};const BlockStyleSelect=React.memo(function BlockStyleSelect2(props){const{disabled,items:itemsProp}=props;const editor=portableTextEditor.usePortableTextEditor();const focusBlock=useFocusBlock();const{t}=useTranslation();const _disabled=disabled||(focusBlock?editor.schemaTypes.block.name!==focusBlock._type:false);const activeKeys=useActiveStyleKeys({items:itemsProp});const{activeItems,items}=React.useMemo(()=>{const _activeItems=itemsProp.filter(item=>activeKeys.includes(item.style));let _items=itemsProp;if(_activeItems.length===0&&_items.length>1){_items=_items.concat([emptyStyle]);_activeItems.push(emptyStyle);}return{activeItems:_activeItems,items:_items};},[activeKeys,itemsProp]);const menuButtonText=React.useMemo(()=>{if(activeItems.length>1){return t("inputs.portable-text.style.multiple");}if(activeItems.length!==1){return emptyStyle.i18nTitleKey?t(emptyStyle.i18nTitleKey):emptyStyle.title;}return activeItems[0].i18nTitleKey?t(activeItems[0].i18nTitleKey):activeItems[0].title;},[activeItems,t]);const handleChange=React.useCallback(item=>{if(focusBlock&&item.style!==focusBlock.style){portableTextEditor.PortableTextEditor.toggleBlockStyle(editor,item.style);portableTextEditor.PortableTextEditor.focus(editor);}},[editor,focusBlock]);const renderOption=React.useCallback((style,title)=>{const hasTextStyle=TEXT_STYLE_KEYS.includes(style);const renderStyle=TEXT_STYLE_OPTIONS[style];if(hasTextStyle){return renderStyle(title);}return/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:title});},[]);const button=React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{disabled:_disabled,iconRight:icons.ChevronDownIcon,justify:"space-between",mode:"bleed",onClick:preventDefault,text:menuButtonText,width:"fill"}),[_disabled,menuButtonText]);const menu=React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{disabled:_disabled,children:items.map(item=>{return/* @__PURE__ */jsxRuntime.jsx(StyledMenuItem,{pressed:activeItems.includes(item),onClick:_disabled?void 0:()=>handleChange(item),children:renderOption(item.style,item.i18nTitleKey?t(item.i18nTitleKey):(item==null?void 0:item.title)||item.style)},item.key);})}),[_disabled,activeItems,handleChange,items,renderOption,t]);return/* @__PURE__ */jsxRuntime.jsx(MenuButtonMemo,{popover:MENU_POPOVER_PROPS$4,id:"block-style-select",button,menu});});const CollapseMenuMemo=React.memo(CollapseMenu);const MENU_POPOVER_PROPS$3={constrainSize:true,portal:true};const InsertMenu=React.memo(function InsertMenu2(props){const{disabled,items,isFullscreen,collapsed}=props;const{t}=useTranslation();const focusBlock=useFocusBlock();const editor=portableTextEditor.usePortableTextEditor();const isVoidFocus=focusBlock&&focusBlock._type!==editor.schemaTypes.block.name;const handleMenuClose=React.useCallback(()=>{portableTextEditor.PortableTextEditor.focus(editor);},[editor]);const tooltipPlacement=isFullscreen?"bottom":"top";const children=React.useMemo(()=>{return items.map(item=>{const title=item.type.title||upperFirst__default.default(item.type.name);return/* @__PURE__ */jsxRuntime.jsx(CollapseMenuButton,{"aria-label":t(item.inline?"inputs.portable-text.action.insert-inline-object-aria-label":"inputs.portable-text.action.insert-block-aria-label",{typeName:title}),mode:"bleed",disabled:disabled||isVoidFocus&&item.inline===true,icon:item.icon,onClick:item.handle,text:title,tooltipText:t(item.inline?"inputs.portable-text.action.insert-inline-object":"inputs.portable-text.action.insert-block",{typeName:title}),tooltipProps:{disabled,placement:tooltipPlacement,portal:"default"}},item.key);});},[disabled,isVoidFocus,items,t,tooltipPlacement]);const menuButtonProps=React.useMemo(()=>({button:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{"data-testid":"insert-menu-button",disabled,tooltipProps:{placement:tooltipPlacement}}),popover:MENU_POPOVER_PROPS$3}),[disabled,tooltipPlacement]);return/* @__PURE__ */jsxRuntime.jsx(CollapseMenuMemo,{"data-testid":"insert-menu-auto-collapse-menu",collapsed,collapseText:false,disableRestoreFocusOnClose:true,gap:1,menuButtonProps,onMenuClose:handleMenuClose,children});});var __freeze$16=Object.freeze;var __defProp$16=Object.defineProperty;var __template$16=(cooked,raw)=>__freeze$16(__defProp$16(cooked,"raw",{value:__freeze$16(raw||cooked.slice())}));var _a$16,_b$y,_c$j,_d$a,_e$6,_f$5;const RootFlex$2=styled__default.default(ui.Flex)(_a$16||(_a$16=__template$16(["\n  width: 100%;\n"])));const StyleSelectBox=styled__default.default(ui.Box)(_b$y||(_b$y=__template$16(["\n  width: 8em;\n"])));const StyleSelectFlex=styled__default.default(ui.Flex)(_c$j||(_c$j=__template$16(["\n  border-right: 1px solid var(--card-border-color);\n"])));const ActionMenuBox=styled__default.default(ui.Box)(_e$6||(_e$6=__template$16(["\n  ","\n"])),_ref241=>{let{$withInsertMenu}=_ref241;return $withInsertMenu&&styled.css(_d$a||(_d$a=__template$16(["\n      max-width: max-content;\n      border-right: 1px solid var(--card-border-color);\n    "])));});const FullscreenButtonBox=styled__default.default(ui.Box)(_f$5||(_f$5=__template$16(["\n  border-left: 1px solid var(--card-border-color);\n"])));const SLOW_INITIAL_VALUE_LIMIT=300;const IS_MAC$1=typeof window!="undefined"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform);const InnerToolbar=React.memo(function InnerToolbar2(_ref242){let{actionGroups,blockStyles,collapsible,disabled,insertMenuItems,isFullscreen,onToggleFullscreen}=_ref242;const{t}=useTranslation();const actionsLen=actionGroups.reduce((acc,x)=>acc+x.actions.length,0);const showActionMenu=actionsLen>0;const showInsertMenu=insertMenuItems.length>0;const[rootElement,setRootElement]=React.useState(null);const rootElementRect=ui.useElementRect(rootElement);const collapsed=collapsible&&rootElementRect?(rootElementRect==null?void 0:rootElementRect.width)<400:false;const showBlockStyleSelect=blockStyles.length>1;useRovingFocus({rootElement});const preventEditorBlurOnToolbarMouseDown=React.useCallback(e=>{e.preventDefault();},[]);return/* @__PURE__ */jsxRuntime.jsxs(RootFlex$2,{align:"center",ref:setRootElement,onMouseDown:preventEditorBlurOnToolbarMouseDown,children:[showBlockStyleSelect&&/* @__PURE__ */jsxRuntime.jsx(StyleSelectFlex,{flex:collapsed?1:void 0,children:/* @__PURE__ */jsxRuntime.jsx(StyleSelectBox,{padding:isFullscreen?2:1,children:/* @__PURE__ */jsxRuntime.jsx(BlockStyleSelect,{disabled,items:blockStyles})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{flex:1,children:[showActionMenu&&/* @__PURE__ */jsxRuntime.jsx(ActionMenuBox,{flex:collapsed?void 0:1,padding:isFullscreen?2:1,$withInsertMenu:showInsertMenu,children:/* @__PURE__ */jsxRuntime.jsx(ActionMenu,{disabled,collapsed,groups:actionGroups,isFullscreen})}),showInsertMenu&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:collapsed?void 0:1,padding:isFullscreen?2:1,children:/* @__PURE__ */jsxRuntime.jsx(InsertMenu,{disabled,collapsed,items:insertMenuItems,isFullscreen})})]}),/* @__PURE__ */jsxRuntime.jsx(FullscreenButtonBox,{padding:isFullscreen?2:1,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("inputs.portable-text.action.expand-editor"),icon:isFullscreen?icons.CollapseIcon:icons.ExpandIcon,mode:"bleed",onClick:onToggleFullscreen,tooltipProps:{content:t(isFullscreen?"inputs.portable-text.action.collapse-editor":"inputs.portable-text.action.expand-editor"),hotkeys:["".concat(IS_MAC$1?"Cmd":"Ctrl"),"Enter"],placement:isFullscreen?"bottom":"top",portal:"default"}})})]});});function Toolbar(props){const{collapsible,hotkeys,isFullscreen,readOnly,onMemberOpen,onToggleFullscreen}=props;const editor=portableTextEditor.usePortableTextEditor();const selection=portableTextEditor.usePortableTextEditorSelection();const resolveInitialValueForType=useResolveInitialValueForType();const disabled=readOnly||!selection;const{push}=ui.useToast();const resolveInitialValue=React.useCallback(type=>{let isSlow=false;const slowTimer=setTimeout(()=>{isSlow=true;push({id:"resolving-initial-value",status:"info",title:"Resolving initial value\u2026"});},SLOW_INITIAL_VALUE_LIMIT);return resolveInitialValueForType(type,{}).then(value=>{if(isSlow){push({id:"resolving-initial-value",status:"info",duration:500,title:"Initial value resolved"});}return value;}).catch(error=>{push({title:"Could not resolve initial value",id:"resolving-initial-value",description:"Unable to resolve initial value for type: ".concat(type.name,": ").concat(error.message,"."),status:"error"});return void 0;}).finally(()=>clearTimeout(slowTimer));},[push,resolveInitialValueForType]);const handleInsertBlock=React.useCallback(async type=>{const initialValue=await resolveInitialValue(type);const path=portableTextEditor.PortableTextEditor.insertBlock(editor,type,initialValue);if(path){onMemberOpen(path);}},[editor,onMemberOpen,resolveInitialValue]);const handleInsertInline=React.useCallback(async type=>{const initialValue=await resolveInitialValue(type);const path=portableTextEditor.PortableTextEditor.insertChild(editor,type,initialValue);if(path){onMemberOpen(path);}},[editor,onMemberOpen,resolveInitialValue]);const actionGroups=useActionGroups({hotkeys,onMemberOpen,resolveInitialValue,disabled:true});const blockStyles=React.useMemo(()=>getBlockStyles(editor.schemaTypes),[editor]);const insertMenuItems=React.useMemo(()=>getInsertMenuItems(editor.schemaTypes,disabled,handleInsertBlock,handleInsertInline),[disabled,editor,handleInsertBlock,handleInsertInline]);return/* @__PURE__ */jsxRuntime.jsx(InnerToolbar,{actionGroups,blockStyles,collapsible,disabled,insertMenuItems,isFullscreen,onToggleFullscreen});}var __freeze$15=Object.freeze;var __defProp$15=Object.defineProperty;var __template$15=(cooked,raw)=>__freeze$15(__defProp$15(cooked,"raw",{value:__freeze$15(raw||cooked.slice())}));var _a$15;const noOutlineStyle={outline:"none"};const FORM_BUILDER_DEFAULT_ID="root";const PlaceholderWrapper=styled__default.default.span(props=>{const{color}=theme.getTheme_v2(props.theme);return styled.css(_a$15||(_a$15=__template$15(["\n    color: ",";\n  "])),color.input.default.enabled.placeholder);});const renderDecorator=props=>{return/* @__PURE__ */jsxRuntime.jsx(Decorator,{...props});};const renderStyle=props=>{return/* @__PURE__ */jsxRuntime.jsx(Style,{...props});};const renderListItem=props=>{return/* @__PURE__ */jsxRuntime.jsx(ListItem,{...props});};function Editor(props){const{hotkeys,initialSelection,isActive,isFullscreen,onCopy,onItemOpen,onPaste,onToggleFullscreen,path,readOnly,renderAnnotation,renderBlock,renderChild,scrollElement,setPortalElement,setScrollElement,ariaDescribedBy}=props;const{id}=useFormBuilder();const{t}=useTranslation();const{isTopLayer}=ui.useLayer();const editableRef=React.useRef(null);const{element:boundaryElement}=ui.useBoundaryElement();ui.useGlobalKeyDown(React.useCallback(event=>{if(!isTopLayer||!isFullscreen){return;}if(event.key==="Escape"){onToggleFullscreen();}},[onToggleFullscreen,isFullscreen,isTopLayer]));const renderPlaceholder=React.useCallback(()=>/* @__PURE__ */jsxRuntime.jsx(PlaceholderWrapper,{"data-testid":"pt-input-placeholder",children:t("inputs.portable-text.empty-placeholder")}),[t]);const spellcheck=useSpellcheck();const scrollSelectionIntoView=useScrollSelectionIntoView(scrollElement);const editable=React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx(portableTextEditor.PortableTextEditable,{"aria-describedby":ariaDescribedBy,hotkeys,onCopy,onPaste,ref:editableRef,renderAnnotation,renderBlock,renderChild,renderDecorator,renderListItem,renderPlaceholder,renderStyle,scrollSelectionIntoView,selection:initialSelection,spellCheck:spellcheck,style:noOutlineStyle}),[ariaDescribedBy,hotkeys,initialSelection,onCopy,onPaste,renderAnnotation,renderBlock,renderChild,renderPlaceholder,scrollSelectionIntoView,spellcheck]);const handleToolBarOnMemberOpen=React.useCallback(relativePath=>{onItemOpen(path.concat(relativePath));},[onItemOpen,path]);const collapsibleToolbar=id===FORM_BUILDER_DEFAULT_ID;return/* @__PURE__ */jsxRuntime.jsxs(Root$b,{$fullscreen:isFullscreen,"data-testid":"pt-editor",children:[isActive&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.TooltipDelayGroupProvider,{children:/* @__PURE__ */jsxRuntime.jsx(ToolbarCard,{"data-testid":"pt-editor__toolbar-card",shadow:1,children:/* @__PURE__ */jsxRuntime.jsx(Toolbar,{collapsible:collapsibleToolbar,hotkeys,isFullscreen,onMemberOpen:handleToolBarOnMemberOpen,onToggleFullscreen,readOnly})})}),/* @__PURE__ */jsxRuntime.jsxs(EditableCard,{flex:1,tone:readOnly?"transparent":"default",children:[/* @__PURE__ */jsxRuntime.jsx(Scroller,{ref:setScrollElement,children:/* @__PURE__ */jsxRuntime.jsx(EditableContainer,{padding:isFullscreen?2:0,sizing:"border",width:1,children:/* @__PURE__ */jsxRuntime.jsx(EditableWrapper,{$isFullscreen:isFullscreen,tone:readOnly?"transparent":"default",children:/* @__PURE__ */jsxRuntime.jsx(ui.BoundaryElementProvider,{element:isFullscreen?scrollElement:boundaryElement,children:editable})})})}),/* @__PURE__ */jsxRuntime.jsx("div",{"data-portal":"",ref:setPortalElement})]})]});}function useHotkeys(hotkeys){const editor=portableTextEditor.usePortableTextEditor();const[initialHotkeys]=React.useState(()=>hotkeys);if(initialHotkeys!==hotkeys){console.warn("Make sure that hotkeys are a stable object across renders, or there will be issues with key handling in the Portable Text Editor.");}return React.useMemo(()=>{const defaultHotkeys={marks:{}};editor.schemaTypes.decorators.forEach(dec=>{switch(dec.value){case"strong":defaultHotkeys.marks["mod+b"]=dec.value;break;case"em":defaultHotkeys.marks["mod+i"]=dec.value;break;case"underline":defaultHotkeys.marks["mod+u"]=dec.value;break;case"code":defaultHotkeys.marks["mod+'"]=dec.value;break;}});return{marks:{...defaultHotkeys.marks,...(initialHotkeys||{}).marks},custom:initialHotkeys.custom};},[editor,initialHotkeys]);}function useTrackFocusPath(props){const{focusPath,boundaryElement,onItemClose}=props;const portableTextMemberItems=usePortableTextMemberItems();const editor=portableTextEditor.usePortableTextEditor();const selection=portableTextEditor.usePortableTextEditorSelection();React.useLayoutEffect(()=>{var _a,_b,_c,_d,_e;if(focusPath.length===0){return;}const openItem=portableTextMemberItems.find(m=>m.member.open);if(openItem&&((_a=openItem.elementRef)==null?void 0:_a.current)){if(boundaryElement){scrollIntoView__default.default(boundaryElement,{scrollMode:"if-needed",block:"start",inline:"start"});scrollIntoView__default.default(openItem.elementRef.current,{scrollMode:"if-needed",boundary:boundaryElement,block:"start",inline:"start"});}if((selection==null?void 0:selection.focus.path)&&PathUtils.isEqual(selection.focus.path,focusPath.slice(0,selection.focus.path.length))){return;}const isTextBlock=openItem.kind==="textBlock";const isBlockFocusPath=focusPath.length===1;if(isTextBlock||isBlockFocusPath){const textBlockChildKey=isTextBlock&&types.isKeyedObject(focusPath[2])?focusPath[2]._key:void 0;const child=textBlockChildKey&&Array.isArray((_b=openItem.node.value)==null?void 0:_b.children)?(_c=openItem.node.value)==null?void 0:_c.children.find(c=>c._key===textBlockChildKey):void 0;const isSpanTextFocusPath=child&&child._type==="span"&&focusPath.length===4&&focusPath[1]==="children"&&focusPath[3]==="text"||false;const isTextChildFocusPath=isTextBlock&&(focusPath.length===3&&focusPath[1]==="children"||isSpanTextFocusPath);let path=[];if(isTextChildFocusPath){path=focusPath.slice(0,3);}else if(// Known text block, but unknown child. Select first child in that block.
isTextBlock&&isBlockFocusPath&&Array.isArray((_d=openItem.node.value)==null?void 0:_d.children)){path=[focusPath[0],"children",{_key:(_e=openItem.node.value)==null?void 0:_e.children[0]._key}];}else if(isBlockFocusPath){path=[{_key:openItem.key}];}if(path.length){portableTextEditor.PortableTextEditor.select(editor,{anchor:{path,offset:0},focus:{path,offset:0}});if(isTextBlock){portableTextEditor.PortableTextEditor.focus(editor);}}}}},[boundaryElement,editor,focusPath,onItemClose,portableTextMemberItems,selection==null?void 0:selection.focus.path]);}var __freeze$14=Object.freeze;var __defProp$14=Object.defineProperty;var __template$14=(cooked,raw)=>__freeze$14(__defProp$14(cooked,"raw",{value:__freeze$14(raw||cooked.slice())}));var _a$14,_b$x,_c$i;const Root$a=styled__default.default(ui.Card)(rootStyle);const PreviewSpan=styled__default.default.span(_a$14||(_a$14=__template$14(["\n  display: block;\n  max-width: calc(5em + 80px);\n  position: relative;\n"])));const TooltipBox$1=styled__default.default(ui.Box)(_b$x||(_b$x=__template$14(["\n  max-width: 250px;\n"])));function rootStyle(_ref243){let{theme}=_ref243;var _a2,_b2,_c2;const{color:color$1,radius}=theme.sanity;return styled.css(_c$i||(_c$i=__template$14(["\n    line-height: 0;\n    border-radius: ","px;\n    padding: 2px;\n    box-shadow: inset 0 0 0 1px var(--card-border-color);\n    height: calc(1em - 1px);\n    margin-top: 0.0625em;\n    cursor: default;\n\n    &:not([hidden]) {\n      display: inline-flex;\n      align-items: center;\n      vertical-align: top;\n    }\n\n    &[data-ready-only] {\n      cursor: default;\n    }\n\n    &[data-focused] {\n      box-shadow: inset 0 0 0 1px ",";\n      color: ",";\n    }\n\n    &[data-selected] {\n      background-color: ",";\n    }\n\n    &:not([data-focused]):not([data-selected]) {\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ",";\n        }\n      }\n    }\n\n    &[data-markers] {\n      --card-bg-color: ",";\n    }\n\n    &[data-warning] {\n      --card-bg-color: ",";\n\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ",";\n        }\n      }\n    }\n\n    &[data-invalid] {\n      --card-bg-color: ",";\n      --card-border-color: ",";\n\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ",";\n        }\n      }\n    }\n  "])),radius[2],(_a2=color$1.selectable)==null?void 0:_a2.primary.selected.border,(_b2=color$1.selectable)==null?void 0:_b2.primary.pressed.fg,(_c2=color$1.selectable)==null?void 0:_c2.primary.pressed.bg,color$1.input.default.hovered.border,color$1.dark?color.hues.purple[950].hex:color.hues.purple[50].hex,color$1.muted.caution.hovered.bg,color$1.muted.caution.hovered.border,color$1.input.invalid.enabled.bg,color$1.input.invalid.enabled.border,color$1.input.invalid.hovered.border);}const POPOVER_FALLBACK_PLACEMENTS=["top","bottom"];function InlineObjectToolbarPopover(props){const{floatingBoundary,onClosePopover,onEdit,onDelete,referenceBoundary,referenceElement,title,open}=props;const{sanity}=ui.useTheme();const{t}=useTranslation();const editButtonRef=React.useRef(null);const deleteButtonRef=React.useRef(null);const popoverScheme=sanity.color.dark?"light":"dark";ui.useGlobalKeyDown(React.useCallback(event=>{if(event.key==="Escape"){event.preventDefault();event.stopPropagation();onClosePopover();}},[onClosePopover]));const handleDelete=React.useCallback(event=>{var _a;if((_a=deleteButtonRef.current)==null?void 0:_a.disabled){return;}event.preventDefault();event.stopPropagation();try{onDelete(event);}catch(err){console.error(err);}finally{if(deleteButtonRef.current){deleteButtonRef.current.disabled=true;}}},[onDelete]);const popoverContent=React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:1,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{space:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{weight:"medium",size:1,children:title})}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("inputs.portable-text.inline-object.edit-aria-label"),icon:icons.EditIcon,mode:"bleed",onClick:onEdit,ref:editButtonRef,tooltipProps:{content:t("inputs.portable-text.inline-object.edit")}}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("inputs.portable-text.inline-object.remove-aria-label"),ref:deleteButtonRef,icon:icons.TrashIcon,mode:"bleed",onClick:handleDelete,tone:"critical",tooltipProps:{content:t("inputs.portable-text.inline-object.remove")}})]})}),[handleDelete,onEdit,title,t]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{constrainSize:true,content:popoverContent,fallbackPlacements:POPOVER_FALLBACK_PLACEMENTS,floatingBoundary,open,placement:"top",portal:true,referenceBoundary,referenceElement,scheme:popoverScheme});}const InlineObject=props=>{var _a;const{floatingBoundary,focused,onItemClose,onItemOpen,onPathFocus,path,readOnly,referenceBoundary,relativePath,renderAnnotation,renderBlock,renderCustomMarkers,renderField,renderItem,renderInlineBlock,renderInput,renderPreview,schemaType,selected,value}=props;const{Markers}=useFormBuilder().__internal.components;const editor=portableTextEditor.usePortableTextEditor();const markers=usePortableTextMarkers(path);const memberItem=usePortableTextMemberItem(pathToString$1(path));const{validation,hasError,hasInfo,hasWarning}=useMemberValidation(memberItem==null?void 0:memberItem.node);const parentSchemaType=editor.schemaTypes.block;const hasMarkers=markers.length>0;const selfSelection=React.useMemo(()=>({anchor:{path:relativePath,offset:0},focus:{path:relativePath,offset:0}}),[relativePath]);const onRemove=React.useCallback(()=>{portableTextEditor.PortableTextEditor.delete(editor,selfSelection,{mode:"children"});portableTextEditor.PortableTextEditor.focus(editor);},[selfSelection,editor]);const onOpen=React.useCallback(()=>{if(memberItem){portableTextEditor.PortableTextEditor.blur(editor);onItemOpen(memberItem.node.path);}},[editor,onItemOpen,memberItem]);const onClose=React.useCallback(()=>{onItemClose();portableTextEditor.PortableTextEditor.select(editor,selfSelection);portableTextEditor.PortableTextEditor.focus(editor);},[onItemClose,editor,selfSelection]);const isOpen=Boolean(memberItem==null?void 0:memberItem.member.open);const input=memberItem==null?void 0:memberItem.input;const nodePath=(memberItem==null?void 0:memberItem.node.path)||EMPTY_ARRAY$9;const referenceElement=(_a=memberItem==null?void 0:memberItem.elementRef)==null?void 0:_a.current;const presence=useChildPresence(path,true);const rootPresence=React.useMemo(()=>presence.filter(p=>PathUtils.isEqual(p.path,path)),[path,presence]);const componentProps=React.useMemo(()=>({__unstable_floatingBoundary:floatingBoundary,__unstable_referenceBoundary:referenceBoundary,__unstable_referenceElement:referenceElement,children:input,focused,onClose,onOpen,onPathFocus,onRemove,open:isOpen,markers,member:memberItem==null?void 0:memberItem.member,parentSchemaType,path:nodePath,presence:rootPresence,readOnly:Boolean(readOnly),renderAnnotation,renderBlock,renderDefault:DefaultInlineObjectComponent,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType,selected,value,validation}),[floatingBoundary,focused,input,isOpen,markers,memberItem==null?void 0:memberItem.member,nodePath,onClose,onOpen,onPathFocus,onRemove,parentSchemaType,readOnly,referenceBoundary,referenceElement,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,rootPresence,schemaType,selected,validation,value]);const tooltipEnabled=hasError||hasWarning||hasInfo||hasMarkers;const toolTipContent=React.useMemo(()=>tooltipEnabled&&/* @__PURE__ */jsxRuntime.jsx(TooltipBox$1,{children:/* @__PURE__ */jsxRuntime.jsx(Markers,{markers,validation,renderCustomMarkers})})||null,[Markers,markers,renderCustomMarkers,tooltipEnabled,validation]);return React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx("span",{ref:memberItem==null?void 0:memberItem.elementRef,contentEditable:false,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{placement:"bottom",portal:"editor",disabled:!tooltipEnabled,content:toolTipContent,children:renderInlineBlock&&/* @__PURE__ */jsxRuntime.jsx("span",{style:{position:"relative"},children:renderInlineBlock(componentProps)})})}),[componentProps,memberItem==null?void 0:memberItem.elementRef,renderInlineBlock,toolTipContent,tooltipEnabled]);};const DefaultInlineObjectComponent=props=>{const{__unstable_floatingBoundary:floatingBoundary,__unstable_referenceBoundary:referenceBoundary,__unstable_referenceElement:referenceElement,children,focused,markers,onClose,onOpen,onRemove,open,readOnly,renderPreview,schemaType,selected,validation,value}=props;const{t}=useTranslation();const hasMarkers=markers.length>0;const[popoverOpen,setPopoverOpen]=React.useState(false);const popoverTitle=(schemaType==null?void 0:schemaType.title)||schemaType.name;const hasError=validation.filter(v=>v.level==="error").length>0;const hasWarning=validation.filter(v=>v.level==="warning").length>0;const openItem=React.useCallback(()=>{setPopoverOpen(false);onOpen();},[onOpen]);React.useEffect(()=>{if(open){setPopoverOpen(false);}else if(focused){setPopoverOpen(true);}else{setPopoverOpen(false);}},[focused,open]);const tone=React.useMemo(()=>{if(hasError){return"critical";}if(hasWarning){return"caution";}if(selected||focused){return"primary";}return void 0;},[focused,hasError,hasWarning,selected]);const onClosePopover=React.useCallback(()=>{setPopoverOpen(false);},[]);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(Root$a,{"aria-label":t("inputs.portable-text.inline-block.aria-label"),"data-focused":focused||void 0,"data-invalid":hasError||void 0,"data-markers":hasMarkers||void 0,"data-read-only":readOnly||void 0,"data-selected":selected||void 0,"data-warning":hasWarning||void 0,forwardedAs:"span",onClick:readOnly?openItem:void 0,onDoubleClick:openItem,tone,children:/* @__PURE__ */jsxRuntime.jsx(PreviewSpan,{children:renderPreview({layout:"inline",schemaType,skipVisibilityCheck:true,value,fallbackTitle:"Click to edit"})})}),referenceElement&&/* @__PURE__ */jsxRuntime.jsx(InlineObjectToolbarPopover,{floatingBoundary,onClosePopover,onDelete:onRemove,onEdit:openItem,open:popoverOpen,referenceBoundary,referenceElement,title:popoverTitle}),open&&/* @__PURE__ */jsxRuntime.jsx(ObjectEditModal,{defaultType:"popover",onClose,autoFocus:focused,floatingBoundary,referenceBoundary,referenceElement,schemaType,children})]});};function Compositor(props){const{changed,focused,focusPath=EMPTY_ARRAY$9,hasFocusWithin,hotkeys,isActive,isFullscreen,onActivate,onCopy,onItemClose,onItemOpen,onItemRemove,onPaste,onPathFocus,onToggleFullscreen,path,readOnly,renderAnnotation,renderBlock,renderBlockActions,renderCustomMarkers,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,value}=props;const editor=portableTextEditor.usePortableTextEditor();const boundaryElement=ui.useBoundaryElement().element;const[wrapperElement,setWrapperElement]=React.useState(null);const[scrollElement,setScrollElement]=React.useState(null);const handleToggleFullscreen=React.useCallback(()=>{onToggleFullscreen();},[onToggleFullscreen]);const hotkeysWithFullscreenToggle=React.useMemo(()=>({...hotkeys,custom:{"mod+enter":onToggleFullscreen,...((hotkeys==null?void 0:hotkeys.custom)||{})}}),[hotkeys,onToggleFullscreen]);const editorHotkeys=useHotkeys(hotkeysWithFullscreenToggle);const _renderBlockActions=!!value&&renderBlockActions?renderBlockActions:void 0;const _renderCustomMarkers=!!value&&renderCustomMarkers?renderCustomMarkers:void 0;const[portalElement,setPortalElement]=React.useState(null);const renderTextBlock=React.useCallback(blockProps=>{const{children,focused:blockFocused,path:blockPath,selected,schemaType:blockSchemaType,value:block}=blockProps;return/* @__PURE__ */jsxRuntime.jsx(TextBlock,{floatingBoundary:boundaryElement,focused:blockFocused,isFullscreen,onItemClose,onItemOpen,onItemRemove,onPathFocus,path:path.concat(blockPath),readOnly,referenceBoundary:scrollElement,renderAnnotation,renderField,renderInlineBlock,renderInput,renderItem,renderBlockActions:_renderBlockActions,renderCustomMarkers:_renderCustomMarkers,renderPreview,renderBlock,schemaType:blockSchemaType,selected,value:block,children});},[_renderBlockActions,_renderCustomMarkers,scrollElement,isFullscreen,onItemClose,onItemOpen,onItemRemove,onPathFocus,boundaryElement,path,readOnly,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview]);const renderObjectBlock=React.useCallback(blockProps=>{const{focused:blockFocused,path:blockPath,selected:blockSelected,schemaType:blockSchemaType,value:blockValue}=blockProps;return/* @__PURE__ */jsxRuntime.jsx(BlockObject,{floatingBoundary:boundaryElement,focused:blockFocused,isFullscreen,onItemClose,onItemOpen,onItemRemove,onPathFocus,path:path.concat(blockPath),readOnly,referenceBoundary:scrollElement,relativePath:blockPath,renderAnnotation,renderBlock,renderBlockActions:_renderBlockActions,renderCustomMarkers:_renderCustomMarkers,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType:blockSchemaType,selected:blockSelected,value:blockValue});},[boundaryElement,scrollElement,isFullscreen,onItemClose,onItemOpen,onItemRemove,onPathFocus,path,readOnly,renderAnnotation,renderBlock,_renderBlockActions,_renderCustomMarkers,renderField,renderInlineBlock,renderInput,renderItem,renderPreview]);const editorRenderBlock=React.useCallback(blockProps=>{const{value:block}=blockProps;const isTextBlock=block._type===editor.schemaTypes.block.name;if(isTextBlock){return renderTextBlock(blockProps);}return renderObjectBlock(blockProps);},[editor.schemaTypes.block.name,renderObjectBlock,renderTextBlock]);const editorRenderChild=React.useCallback(childProps=>{const{children,focused:childFocused,path:childPath,selected,schemaType:childSchemaType,value:child}=childProps;const isSpan=child._type===editor.schemaTypes.span.name;if(isSpan){return children;}return/* @__PURE__ */jsxRuntime.jsx(InlineObject,{floatingBoundary:boundaryElement,focused:childFocused,onItemClose,onItemOpen,onPathFocus,path:path.concat(childPath),readOnly,referenceBoundary:scrollElement,relativePath:childPath,renderAnnotation,renderBlock,renderCustomMarkers,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType:childSchemaType,selected,value:child});},[boundaryElement,scrollElement,editor.schemaTypes.span.name,onItemClose,onItemOpen,onPathFocus,path,readOnly,renderAnnotation,renderBlock,renderCustomMarkers,renderField,renderInlineBlock,renderInput,renderItem,renderPreview]);const editorRenderAnnotation=React.useCallback(annotationProps=>{const{children,focused:editorNodeFocused,path:aPath,selected,schemaType:aSchemaType,value:aValue}=annotationProps;return/* @__PURE__ */jsxRuntime.jsx(Annotation,{editorNodeFocused,floatingBoundary:boundaryElement,focused:Boolean(focused),onItemClose,onItemOpen,onPathFocus,path:path.concat(aPath),readOnly,referenceBoundary:scrollElement,renderAnnotation,renderBlock,renderCustomMarkers,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType:aSchemaType,selected,value:aValue,children});},[boundaryElement,scrollElement,focused,onItemClose,onItemOpen,onPathFocus,path,readOnly,renderAnnotation,renderBlock,renderCustomMarkers,renderField,renderInlineBlock,renderInput,renderItem,renderPreview]);const ariaDescribedBy=props.elementProps["aria-describedby"];const initialSelection=React.useMemo(()=>{if(hasFocusWithin){return{anchor:{path:focusPath,offset:0},focus:{path:focusPath,offset:0}};}return void 0;},[]);const editorNode=React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx(Editor,{ariaDescribedBy,initialSelection,hotkeys:editorHotkeys,isActive,isFullscreen,onItemOpen,onCopy,onPaste,onToggleFullscreen:handleToggleFullscreen,path,readOnly,renderAnnotation:editorRenderAnnotation,renderBlock:editorRenderBlock,renderChild:editorRenderChild,setPortalElement,scrollElement,setScrollElement}),// Keep only stable ones here!
[ariaDescribedBy,editorHotkeys,editorRenderAnnotation,editorRenderBlock,editorRenderChild,handleToggleFullscreen,initialSelection,isActive,isFullscreen,onCopy,onItemOpen,onPaste,path,readOnly,scrollElement]);const portal=ui.usePortal();const portalElements=React.useMemo(()=>({collapsed:wrapperElement,default:portal.element,editor:portalElement,expanded:portal.element}),[portal.element,portalElement,wrapperElement]);useTrackFocusPath({focusPath,boundaryElement:scrollElement,onItemClose});const editorFocused=focused||hasFocusWithin;return/* @__PURE__ */jsxRuntime.jsx(ui.PortalProvider,{__unstable_elements:portalElements,element:portal.element,children:/* @__PURE__ */jsxRuntime.jsx(ActivateOnFocus,{onActivate,isOverlayActive:!isActive,children:/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{disabled:isFullscreen,hasFocus:Boolean(focused),isChanged:changed,path,children:/* @__PURE__ */jsxRuntime.jsxs(Root$e,{"data-focused":editorFocused?"":void 0,"data-read-only":readOnly?"":void 0,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{"data-wrapper":"",ref:setWrapperElement,children:/* @__PURE__ */jsxRuntime.jsx(ui.Portal,{__unstable_name:isFullscreen?"expanded":"collapsed",children:isFullscreen?/* @__PURE__ */jsxRuntime.jsx(ExpandedLayer,{children:editorNode}):editorNode})}),/* @__PURE__ */jsxRuntime.jsx("div",{"data-border":""})]})})})});}function InvalidValue(props){const{onChange,onIgnore,resolution,readOnly}=props;const telemetry=react.useTelemetry();const{t}=useTranslation();const handleAction=React.useCallback(()=>{if(resolution){onChange({type:"mutation",patches:resolution.patches});telemetry.log(PortableTextInvalidValueResolve,{PTEInvalidValueId:resolution.i18n.description,PTEInvalidValueDescription:resolution.description});}},[onChange,resolution,telemetry]);const handleOnIgnore=React.useCallback(()=>{telemetry.log(PortableTextInvalidValueIgnore);onIgnore();},[onIgnore,telemetry]);if(!resolution)return null;return/* @__PURE__ */jsxRuntime.jsx(Alert,{title:/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:t("inputs.portable-text.invalid-value.title")}),suffix:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{padding:2,children:[resolution.action&&/* @__PURE__ */jsxRuntime.jsxs(ui.Grid,{columns:[1,2],gap:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Button,{mode:"ghost",onClick:handleOnIgnore,text:t("inputs.portable-text.invalid-value.ignore-button.text")}),!readOnly&&/* @__PURE__ */jsxRuntime.jsx(ui.Button,{onClick:handleAction,text:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:resolution.i18n.action,values:resolution.i18n.values}),tone:"caution"})]}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:3,children:resolution.action&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:t("inputs.portable-text.invalid-value.action-disclaimer")})})]}),children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:resolution.i18n.description,values:resolution.i18n.values})}),/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,overflow:"auto",padding:2,tone:"inherit",children:/* @__PURE__ */jsxRuntime.jsx(ui.Code,{language:"json",children:JSON.stringify(resolution.item,null,2)})})]})});}function usePatches(props){const{path}=props;const{patchChannel}=useFormBuilder().__internal;const subscribe=React.useCallback(subscriber=>{return patchChannel.subscribe(_ref244=>{let{snapshot,patches}=_ref244;const filteredPatches=patches.filter(patch=>_startsWith(patch.path,path)).map(patch=>({...patch,path:patch.path.slice(path.length)}));if(filteredPatches.length){subscriber({shouldReset:_shouldReset(path,patches),snapshot:isRecord$4(snapshot)?_getValueAtPath(snapshot,path):{},patches:filteredPatches});}});},[path,patchChannel]);return{subscribe};}function _isSegmentEqual(segment1,segment2){const segment1Type=typeof segment1;if(segment1Type!==typeof segment2){return false;}if(segment1Type==="object"){return shallowEquals__default.default(segment1,segment2);}return segment1===segment2;}function _startsWith(subjectPath,checkPath){if(subjectPath===checkPath){return true;}if(!Array.isArray(subjectPath)||!Array.isArray(checkPath)){return false;}if(subjectPath.length<checkPath.length){return false;}for(let i=0,len=checkPath.length;i<len;i++){if(!_isSegmentEqual(checkPath[i],subjectPath[i])){return false;}}return true;}function _isAncestor(path1,path2){return path1.length===0||_startsWith(path2,path1)&&!_startsWith(path1,path2);}function _shouldReset(path,patches){return patches.some(patch=>_isAncestor(patch.path,path)&&(patch.type==="set"||patch.type==="unset"));}function _getValueAtPath(value,path){return path.reduce((result,segment)=>{if(typeof segment==="object"){return find__default.default(result,segment);}return get__default.default(result,segment);},value);}function PortableTextInput(props){const{editorRef:editorRefProp,elementProps,hotkeys,markers=EMPTY_ARRAY$9,onChange,onEditorChange,onCopy,onInsert,onItemRemove,onPaste,onPathFocus,path,readOnly,renderBlockActions,renderCustomMarkers,schemaType,value}=props;const{onBlur}=elementProps;const defaultEditorRef=React.useRef(null);const editorRef=editorRefProp||defaultEditorRef;React.useImperativeHandle(elementProps.ref,()=>({focus(){if(editorRef.current){portableTextEditor.PortableTextEditor.focus(editorRef.current);}}}));const{subscribe}=usePatches({path});const[ignoreValidationError,setIgnoreValidationError]=React.useState(false);const[invalidValue,setInvalidValue]=React.useState(null);const[isFullscreen,setIsFullscreen]=React.useState(false);const[isActive,setIsActive]=React.useState(false);const[isOffline,setIsOffline]=React.useState(false);const[hasFocusWithin,setHasFocusWithin]=React.useState(false);const telemetry=react.useTelemetry();const toast=ui.useToast();const patchSubject=React.useMemo(()=>new rxjs.Subject(),[]);const patches$=React.useMemo(()=>patchSubject.asObservable(),[patchSubject]);const innerElementRef=React.useRef(null);const handleToggleFullscreen=React.useCallback(()=>{setIsFullscreen(v=>{const next=!v;if(next){telemetry.log(PortableTextInputExpanded);}else{telemetry.log(PortableTextInputCollapsed);}return next;});},[telemetry]);React.useEffect(()=>{if(invalidValue&&value!==invalidValue.value){setInvalidValue(null);}},[invalidValue,value]);React.useEffect(()=>{return subscribe(_ref245=>{let{patches,snapshot}=_ref245;patchSubject.next({patches,snapshot});});},[patchSubject,subscribe]);const portableTextMemberItems=usePortableTextMemberItemsFromProps(props);React.useEffect(()=>{if(hasFocusWithin){setIsActive(true);}},[hasFocusWithin]);const setFocusPathFromEditorSelection=React.useCallback(focusPath=>{const isSpanPath=focusPath.length===3&&// A span path is always 3 segments long
focusPath[1]==="children"&&// Is a child of a block
types.isKeySegment(focusPath[2])&&// Contains the key of the child
!portableTextMemberItems.some(item=>types.isKeySegment(focusPath[2])&&item.member.key===focusPath[2]._key);if(isSpanPath){onPathFocus(focusPath.concat("text"));}else{onPathFocus(focusPath);}},[onPathFocus,portableTextMemberItems]);const handleEditorChange=React.useCallback(change=>{switch(change.type){case"mutation":onChange(toFormPatches(change.patches));break;case"connection":if(change.value==="offline"){setIsOffline(true);}else if(change.value==="online"){setIsOffline(false);}break;case"selection":React.startTransition(()=>{if(change.selection){setFocusPathFromEditorSelection(change.selection.focus.path);}});break;case"focus":setIsActive(true);setHasFocusWithin(true);break;case"blur":onBlur(change.event);setHasFocusWithin(false);break;case"undo":case"redo":onChange(toFormPatches(change.patches));break;case"invalidValue":setInvalidValue(change);break;case"error":toast.push({status:change.level,description:change.description});break;}if(editorRef.current&&onEditorChange){onEditorChange(change,editorRef.current);}},[editorRef,onBlur,onChange,onEditorChange,setFocusPathFromEditorSelection,toast]);React.useEffect(()=>{setIgnoreValidationError(false);},[value]);const handleIgnoreInvalidValue=React.useCallback(()=>{setIgnoreValidationError(true);},[]);const respondToInvalidContent=React.useMemo(()=>{if(invalidValue&&invalidValue.resolution){return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginBottom:2,children:/* @__PURE__ */jsxRuntime.jsx(InvalidValue,{onChange:handleEditorChange,onIgnore:handleIgnoreInvalidValue,resolution:invalidValue.resolution,readOnly:isOffline||readOnly})});}return null;},[handleEditorChange,handleIgnoreInvalidValue,invalidValue,isOffline,readOnly]);const handleActivate=React.useCallback(()=>{if(!isActive){setIsActive(true);if(editorRef.current){portableTextEditor.PortableTextEditor.focus(editorRef.current);}}},[editorRef,isActive]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{ref:innerElementRef,children:[!ignoreValidationError&&respondToInvalidContent,(!invalidValue||ignoreValidationError)&&/* @__PURE__ */jsxRuntime.jsx(PortableTextMarkersProvider,{markers,children:/* @__PURE__ */jsxRuntime.jsx(PortableTextMemberItemsProvider,{memberItems:portableTextMemberItems,children:/* @__PURE__ */jsxRuntime.jsx(portableTextEditor.PortableTextEditor,{patches$,onChange:handleEditorChange,maxBlocks:void 0,ref:editorRef,readOnly:isOffline||readOnly,schemaType,value,children:/* @__PURE__ */jsxRuntime.jsx(Compositor,{...props,hasFocusWithin,hotkeys,isActive,isFullscreen,onActivate:handleActivate,onItemRemove,onCopy,onInsert,onPaste,onToggleFullscreen:handleToggleFullscreen,renderBlockActions,renderCustomMarkers})})})})]});}function toFormPatches(patches){return patches.map(p=>({...p,patchType:SANITY_PATCH_TYPE}));}function focusRingBorderStyle(border){return"inset 0 0 0 ".concat(border.width,"px ").concat(border.color);}function focusRingStyle(opts){const{base,border,focusRing}=opts;const focusRingOutsetWidth=focusRing.offset+focusRing.width;const focusRingInsetWidth=0-focusRing.offset;const bgColor=base?base.bg:"var(--card-bg-color)";return[focusRingInsetWidth>0&&"inset 0 0 0 ".concat(focusRingInsetWidth,"px var(--card-focus-ring-color)"),border&&focusRingBorderStyle(border),focusRingInsetWidth<0&&"0 0 0 ".concat(0-focusRingInsetWidth,"px ").concat(bgColor),focusRingOutsetWidth>0&&"0 0 0 ".concat(focusRingOutsetWidth,"px var(--card-focus-ring-color)")].filter(Boolean).join(",");}var __freeze$13=Object.freeze;var __defProp$13=Object.defineProperty;var __template$13=(cooked,raw)=>__freeze$13(__defProp$13(cooked,"raw",{value:__freeze$13(raw||cooked.slice())}));var _a$13,_b$w;const Root$9=styled__default.default(ui.Card)(props=>{const{theme}=props;const{focusRing,input,radius}=theme.sanity;const color=theme.sanity.color.input;const space=ui.rem(theme.sanity.space[1]);return{position:"relative",borderRadius:"".concat(radius[1],"px"),color:color.default.enabled.fg,boxShadow:focusRingBorderStyle({color:color.default.enabled.border,width:input.border.width}),"& > .content":{position:"relative",lineHeight:0,margin:"-".concat(space," 0 0 -").concat(space)},"& > .content > div":{display:"inline-block",verticalAlign:"top",padding:"".concat(space," 0 0 ").concat(space)},// enabled
"&:not([data-read-only])":{cursor:"text"},// hovered
"@media(hover:hover):not([data-disabled]):not([data-read-only]):hover":{borderColor:color.default.hovered.border},// focused
"&:not([data-disabled]):not([data-read-only])[data-focused]":{boxShadow:focusRingStyle({border:{color:color.default.enabled.border,width:input.border.width},focusRing})},// disabled
"*:disabled + &":{color:color.default.disabled.fg,backgroundColor:color.default.disabled.bg,boxShadow:focusRingBorderStyle({color:color.default.disabled.border,width:input.border.width})}};});const Input=styled__default.default.input(props=>{const{theme}=props;const font=theme.sanity.fonts.text;const color=theme.sanity.color.input;const p=theme.sanity.space[2];const size=theme.sanity.fonts.text.sizes[2];return{appearance:"none",background:"none",border:0,borderRadius:0,outline:"none",fontSize:ui.rem(size.fontSize),lineHeight:size.lineHeight/size.fontSize,fontFamily:font.family,fontWeight:font.weights.regular,margin:0,display:"block",minWidth:"1px",maxWidth:"100%",boxSizing:"border-box",paddingTop:ui.rem(p-size.ascenderHeight),paddingRight:ui.rem(p),paddingBottom:ui.rem(p-size.descenderHeight),paddingLeft:ui.rem(p),// enabled
"&:not(:invalid):not(:disabled)":{color:color.default.enabled.fg},// disabled
"&:not(:invalid):disabled":{color:color.default.disabled.fg}};});const Placeholder=styled__default.default(ui.Box)(props=>{const{theme}=props;const color=theme.sanity.color.input;return styled.css(_a$13||(_a$13=__template$13(["\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    pointer-events: none;\n    --card-fg-color: ",";\n  "])),color.default.enabled.placeholder);});const TagBox=styled__default.default(ui.Box)(_b$w||(_b$w=__template$13(['\n  // This is needed to make textOverflow="ellipsis" work properly for the Text primitive\n  max-width: 100%;\n'])));const TagInput=React.forwardRef((props,ref)=>{const{disabled,onChange,onFocus,placeholder:placeholderProp,readOnly,value=[],...restProps}=props;const{t}=useTranslation(studioLocaleNamespace);const[inputValue,setInputValue]=React.useState("");const enabled=!disabled&&!readOnly;const[focused,setFocused]=React.useState(false);const forwardedRef=ui.useForwardedRef(ref);const rootRef=React.useRef(null);const handleRootPointerDown=React.useCallback(event=>{const isTagElement=ui.isHTMLElement(event.target)&&event.target.closest('[data-ui="Tag"]');if(isTagElement)return;const inputElement=forwardedRef.current;if(inputElement){setTimeout(()=>inputElement.focus(),0);}},[forwardedRef]);const handleInputBlur=React.useCallback(()=>{setFocused(false);},[]);const handleInputChange=React.useCallback(event=>{setInputValue(event.currentTarget.value);},[]);const handleInputFocus=React.useCallback(event=>{setFocused(true);if(onFocus)onFocus(event);},[onFocus]);const handleInputKeyDown=React.useCallback(event=>{if(event.key==="Enter"){event.preventDefault();event.stopPropagation();if(onChange&&inputValue){const newValue=value.concat([{value:inputValue}]);setInputValue("");if(onChange)onChange(newValue);}}},[inputValue,onChange,value]);const handleTagRemove=React.useCallback(index=>{if(!onChange)return;const newValue=value.slice(0);newValue.splice(index,1);onChange(newValue);},[onChange,value]);React.useEffect(()=>{const inputElement=forwardedRef.current;if(inputElement){inputElement.style.width="0";inputElement.style.width="".concat(inputElement.scrollWidth,"px");}},[forwardedRef,inputValue]);return/* @__PURE__ */jsxRuntime.jsxs(Root$9,{"data-disabled":disabled?"":void 0,"data-focused":focused?"":void 0,"data-read-only":readOnly?"":void 0,"data-ui":"TagInput",onPointerDown:handleRootPointerDown,overflow:"auto",padding:1,ref:rootRef,children:[enabled&&/* @__PURE__ */jsxRuntime.jsx(Placeholder,{hidden:Boolean(inputValue||value.length),padding:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{textOverflow:"ellipsis",children:placeholderProp?placeholderProp:t("inputs.tags.placeholder",{context:typeof window!=="undefined"&&"ontouchstart"in window?"touch":void 0})})}),/* @__PURE__ */jsxRuntime.jsxs("div",{className:"content",children:[value.map((tag,tagIndex)=>// eslint-disable-next-line react/no-array-index-key
/* @__PURE__ */jsxRuntime.jsx(TagBox,{children:/* @__PURE__ */jsxRuntime.jsx(Tag,{enabled,index:tagIndex,muted:!enabled,onRemove:handleTagRemove,tag})},"tag-".concat(tagIndex))),/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(Input,{...restProps,disabled:!enabled,onBlur:handleInputBlur,onChange:handleInputChange,onFocus:handleInputFocus,onKeyDown:handleInputKeyDown,ref:forwardedRef,type:"text",value:inputValue})},"tag-input")]})]});});TagInput.displayName="TagInput";function Tag(props){const{enabled,index,muted,onRemove,tag}=props;const handleRemoveClick=React.useCallback(()=>{onRemove(index);},[index,onRemove]);return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{"data-ui":"Tag",radius:2,tone:"transparent",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,paddingY:2,paddingLeft:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted,textOverflow:"ellipsis",children:tag.value})}),enabled&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.CloseIcon,mode:"bleed",onClick:handleRemoveClick,tooltipProps:{content:"Remove"}})]})});}function TagsArrayInput(props){const{onChange,readOnly,value=[],elementProps,path,changed}=props;const tagInputValue=React.useMemo(()=>value==null?void 0:value.map(v=>({value:v})),[value]);const handleChange=React.useCallback(nextValue=>{onChange(nextValue.length===0?unset():set(nextValue.map(v=>v.value)));},[onChange]);return/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path,isChanged:changed,hasFocus:false,children:/* @__PURE__ */jsxRuntime.jsx(TagInput,{onChange:handleChange,readOnly,value:tagInputValue,...elementProps})});}const PRIMITIVES=["string","number","boolean"];function isArrayOfPrimitives$1(type){return type.of.every(ofType=>PRIMITIVES.includes(ofType.jsonType));}function isStringArray(type){return type.of.length===1&&is$1("string",type.of[0]);}function isTagsArray(type){var _a;return((_a=type.options)==null?void 0:_a.layout)==="tags";}function isPortableText(type){return type.of.some(memberType=>is$1("block",memberType));}function hasListOptions(type){var _a;return Boolean((_a=type.options)==null?void 0:_a.list);}function resolveArrayInput(type){if(isStringArray(type)&&isTagsArray(type)){return TagsArrayInput;}if(hasListOptions(type)){return ArrayOfOptionsInput;}if(isArrayOfPrimitives$1(type)){return ArrayOfPrimitivesInput;}if(isPortableText(type)){return PortableTextInput;}return ArrayOfObjectsInput;}function toSelectItem$1(option){return types.isTitledListValue(option)?option:{title:capitalize__default.default("".concat(option)),value:option};}const EMPTY_ITEM={title:"",value:void 0};function SelectInput(props){var _a,_b;const{value,readOnly,validationError,schemaType,onChange,path,changed,focused,elementProps}=props;const items=React.useMemo(()=>{var _a2;return(((_a2=schemaType.options)==null?void 0:_a2.list)||[]).map(toSelectItem$1);},[(_a=schemaType.options)==null?void 0:_a.list]);const currentItem=items.find(item=>item.value===value);const isRadio=schemaType.options&&schemaType.options.layout==="radio";const itemFromOptionValue=React.useCallback(optionValue=>{const index=Number(optionValue);return items[index];},[items]);const optionValueFromItem=React.useCallback(item=>{return String(items.indexOf(item));},[items]);const inputId=React.useId();const handleChange=React.useCallback(nextItem=>{onChange(PatchEvent.from(typeof(nextItem==null?void 0:nextItem.value)==="undefined"?unset():set(nextItem.value)));},[onChange]);const handleSelectChange=React.useCallback(event=>{const nextItem=itemFromOptionValue(event.currentTarget.value);if(!nextItem){handleChange(EMPTY_ITEM);return;}handleChange(nextItem);},[handleChange,itemFromOptionValue]);const content=isRadio?/* @__PURE__ */jsxRuntime.jsx(RadioSelect,{...elementProps,value:currentItem,inputId,items,direction:((_b=schemaType.options)==null?void 0:_b.direction)||"vertical",customValidity:validationError,onChange:handleChange,readOnly}):/* @__PURE__ */jsxRuntime.jsx(ui.Select,{...elementProps,customValidity:validationError,value:optionValueFromItem(currentItem),readOnly,onChange:handleSelectChange,children:[EMPTY_ITEM,...items].map((item,i)=>/* @__PURE__ */jsxRuntime.jsx("option",{value:i-1,children:item.title},"".concat(i-1)))});return/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path,isChanged:changed,hasFocus:!!focused,children:content});}const RadioSelect=React.forwardRef(function RadioSelect2(props,ref){const{items,value,onChange,onFocus,readOnly,customValidity,direction,inputId}=props;const Layout=direction==="horizontal"?ui.Inline:ui.Stack;return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,padding:3,radius:2,children:/* @__PURE__ */jsxRuntime.jsx(Layout,{space:3,role:"group",children:items.map((item,index)=>/* @__PURE__ */jsxRuntime.jsx(RadioSelectItem,{customValidity,inputId,item,onChange,onFocus,readOnly,ref:index===0?ref:null,value},index))})});});const RadioSelectItem=React.forwardRef(function RadioSelectItem2(props,ref){const{customValidity,inputId,item,onChange,onFocus,readOnly,value}=props;const handleChange=React.useCallback(()=>{onChange(item);},[item,onChange]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{as:"label",align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Radio,{ref,checked:value===item,onChange:handleChange,onFocus,readOnly,customValidity,name:inputId}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:item.title})})]});});function resolveNumberInput(type){return getOption(type,"list")?SelectInput:NumberInput;}function resolveStringInput(type){return getOption(type,"list")?SelectInput:StringInput;}function resolveComponentFromTypeVariants(type){if(is$1("array",type)){return resolveArrayInput(type);}if(is$1("reference",type)){return StudioReferenceInput;}if(is$1("string",type)){return resolveStringInput(type);}if(is$1("number",type)){return resolveNumberInput(type);}return void 0;}function defaultResolveInputComponent(schemaType){var _a;if((_a=schemaType.components)==null?void 0:_a.input)return schemaType.components.input;const componentFromTypeVariants=resolveComponentFromTypeVariants(schemaType);if(componentFromTypeVariants){return componentFromTypeVariants;}const typeChain=getTypeChain$1(schemaType,/* @__PURE__ */new Set());const deduped=typeChain.reduce((acc,type)=>{acc[type.name]=type;return acc;},{});const subType=Object.values(deduped).find(t=>defaultInputs[t.name]);if(subType){return defaultInputs[subType.name];}throw new Error("Could not find input component for schema type `".concat(schemaType.name,"`"));}function defaultResolvePreviewComponent(schemaType){var _a;if((_a=schemaType.components)==null?void 0:_a.preview)return schemaType.components.preview;return SanityDefaultPreview;}function getTone$1(_ref246){let{readOnly,hasErrors,hasWarnings}=_ref246;if(readOnly){return"transparent";}if(hasErrors){return"critical";}return hasWarnings?"caution":"default";}const MENU_POPOVER_PROPS$2={portal:true,tone:"default"};const BUTTON_CARD_STYLE={position:"relative"};function PreviewItem(props){var _a,_b,_c,_d,_e,_f;const{schemaType,parentSchemaType,path,readOnly,onRemove,value,open,onInsert,onFocus,onOpen,onClose,changed,focused,children,inputProps:{renderPreview}}=props;const{t}=useTranslation();const sortable=!readOnly&&((_a=parentSchemaType.options)==null?void 0:_a.sortable)!==false;const insertableTypes=parentSchemaType.of;const previewCardRef=React.useRef(null);useScrollIntoViewOnFocusWithin(previewCardRef,open);useDidUpdate(focused,(hadFocus,hasFocus)=>{var _a2;if(!hadFocus&&hasFocus&&previewCardRef.current){(_a2=previewCardRef.current)==null?void 0:_a2.focus();}});const resolvingInitialValue=value._resolvingInitialValue;const handleDuplicate=React.useCallback(()=>{onInsert({items:[{...value,_key:randomKey()}],position:"after"});},[onInsert,value]);const handleInsert=React.useCallback((pos,insertType)=>{onInsert({items:[createProtoArrayValue(insertType)],position:pos});},[onInsert]);const childPresence=useChildPresence(path,true);const presence=React.useMemo(()=>{return childPresence.length===0?null:/* @__PURE__ */jsxRuntime.jsx(FieldPresence,{presence:childPresence,maxAvatars:1});},[childPresence]);const childValidation=useChildValidation(path,true);const validation=React.useMemo(()=>{return childValidation.length===0?null:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:1,paddingY:3,children:/* @__PURE__ */jsxRuntime.jsx(FormFieldValidationStatus,{validation:childValidation,__unstable_showSummary:true})});},[childValidation]);const hasErrors=childValidation.some(v=>v.level==="error");const hasWarnings=childValidation.some(v=>v.level==="warning");const menu=React.useMemo(()=>readOnly?null:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{paddingY:3}),id:"".concat(props.inputId,"-menuButton"),menu:/* @__PURE__ */jsxRuntime.jsxs(ui.Menu,{children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.array.action.remove"),tone:"critical",icon:icons.TrashIcon,onClick:onRemove}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.array.action.duplicate"),icon:icons.CopyIcon,onClick:handleDuplicate}),/* @__PURE__ */jsxRuntime.jsx(InsertMenu$1,{types:insertableTypes,onInsert:handleInsert})]}),popover:MENU_POPOVER_PROPS$2}),[handleDuplicate,handleInsert,onRemove,insertableTypes,props.inputId,readOnly,t]);const tone=getTone$1({readOnly,hasErrors,hasWarnings});const item=/* @__PURE__ */jsxRuntime.jsx(RowLayout,{menu,presence,validation,tone,focused,dragHandle:sortable,selected:open,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{as:"button",type:"button",tone:"inherit",radius:1,disabled:resolvingInitialValue,onClick:onOpen,ref:previewCardRef,onFocus,__unstable_focusRing:true,style:BUTTON_CARD_STYLE,children:[renderPreview({schemaType:props.schemaType,value:props.value,layout:"default",// Don't do visibility check for virtualized items as the calculation will be incorrect causing it to scroll
skipVisibilityCheck:true}),resolvingInitialValue&&/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{fill:true})]})});const itemTypeTitle=getSchemaTypeTitle(schemaType);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path,isChanged:changed,hasFocus:Boolean(focused),children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:1,children:item})}),open&&/* @__PURE__ */jsxRuntime.jsx(EditPortal,{header:readOnly?t("inputs.array.action.view",{itemTypeTitle}):t("inputs.array.action.edit",{itemTypeTitle}),type:((_c=(_b=parentSchemaType==null?void 0:parentSchemaType.options)==null?void 0:_b.modal)==null?void 0:_c.type)||"dialog",width:(_f=(_e=(_d=parentSchemaType==null?void 0:parentSchemaType.options)==null?void 0:_d.modal)==null?void 0:_e.width)!=null?_f:1,id:value._key,onClose,autofocus:focused,legacy_referenceElement:previewCardRef.current,children})]});}function ReferenceItemRefProvider(props){const{menuRef,containerRef}=props;return/* @__PURE__ */jsxRuntime.jsx(ReferenceItemRefContext.Provider,{value:{menuRef,containerRef},children:props.children});}function getTone(_ref247){let{readOnly,hasErrors,hasWarnings}=_ref247;if(readOnly){return"transparent";}if(hasErrors){return"critical";}return hasWarnings?"caution":"default";}const MENU_POPOVER_PROPS$1={portal:true,tone:"default"};function ReferenceItem(props){var _a,_b,_c,_d,_e,_f,_g;const{schemaType,parentSchemaType,path,readOnly,onRemove,value,open,onInsert,presence,validation,inputId,changed,focused,children,inputProps:{onChange,focusPath,onPathFocus,renderPreview,elementProps}}=props;const sortable=!readOnly&&((_a=parentSchemaType.options)==null?void 0:_a.sortable)!==false;const insertableTypes=parentSchemaType.of;const elementRef=React.useRef(null);const menuRef=React.useRef(null);const containerRef=React.useRef(null);const{EditReferenceLink,getReferenceInfo,selectedState,isCurrentDocumentLiveEdit}=useReferenceInput({path,schemaType,value});useScrollIntoViewOnFocusWithin(elementRef,open);useDidUpdate(focused,(hadFocus,hasFocus)=>{var _a2;if(!hadFocus&&hasFocus&&elementRef.current){(_a2=elementRef.current)==null?void 0:_a2.focus();}});const hasErrors=props.validation.some(v=>v.level==="error");const hasWarnings=props.validation.some(v=>v.level==="warning");const resolvingInitialValue=value._resolvingInitialValue;const handleDuplicate=React.useCallback(()=>{onInsert({items:[{...value,_key:randomKey()}],position:"after"});},[onInsert,value]);const handleInsert=React.useCallback((pos,insertType)=>{onInsert({items:[{...createProtoArrayValue(insertType),_key:randomKey()}],position:pos});},[onInsert]);const loadableReferenceInfo=useReferenceInfo$1(value==null?void 0:value._ref,getReferenceInfo);const hasRef=value._ref;const refTypeName=((_b=loadableReferenceInfo.result)==null?void 0:_b.type)||((_c=value==null?void 0:value._strengthenOnPublish)==null?void 0:_c.type);const publishedReferenceExists=hasRef&&((_f=(_e=(_d=loadableReferenceInfo.result)==null?void 0:_d.preview)==null?void 0:_e.published)==null?void 0:_f._id);const handleRemoveStrengthenOnPublish=React.useCallback(()=>{onChange([schemaType.weak===true?set(true,["_weak"]):unset(["_weak"]),unset(["_strengthenOnPublish"])]);},[onChange,schemaType.weak]);const refType=refTypeName?schemaType.to.find(toType=>toType.name===refTypeName):void 0;const pressed=selectedState==="pressed";const selected=selectedState==="selected";const tone=getTone({readOnly,hasErrors,hasWarnings});const isEditing=!hasRef||focusPath[0]==="_ref";const{t}=useTranslation();const OpenLink=React.useMemo(()=>// eslint-disable-next-line @typescript-eslint/no-shadow
React.forwardRef(function OpenLink2(restProps,_ref){return/* @__PURE__ */jsxRuntime.jsx(router.IntentLink,{...restProps,intent:"edit",params:{id:value==null?void 0:value._ref,type:refType==null?void 0:refType.name},target:"_blank",rel:"noopener noreferrer",ref:_ref});}),[refType==null?void 0:refType.name,value==null?void 0:value._ref]);const handleReplace=React.useCallback(()=>{if(hasRef&&isEditing){onPathFocus([]);}else{onPathFocus(["_ref"]);}},[hasRef,isEditing,onPathFocus]);const menu=React.useMemo(()=>readOnly?null:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{paddingY:3}),id:"".concat(inputId,"-menuButton"),menu:/* @__PURE__ */jsxRuntime.jsxs(ui.Menu,{ref:menuRef,children:[!readOnly&&/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.reference.action.remove"),tone:"critical",icon:icons.TrashIcon,onClick:onRemove}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t(hasRef&&isEditing?"inputs.reference.action.replace-cancel":"inputs.reference.action.replace"),icon:hasRef&&isEditing?icons.CloseIcon:icons.SyncIcon,onClick:handleReplace}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("inputs.reference.action.duplicate"),icon:icons.CopyIcon,onClick:handleDuplicate}),/* @__PURE__ */jsxRuntime.jsx(InsertMenu$1,{onInsert:handleInsert,types:insertableTypes})]}),!readOnly&&!isEditing&&hasRef&&/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{}),!isEditing&&hasRef&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:OpenLink,"data-as":"a",text:t("inputs.reference.action.open-in-new-tab"),icon:icons.LaunchIcon})]}),popover:MENU_POPOVER_PROPS$1}),[handleDuplicate,handleInsert,handleReplace,hasRef,inputId,insertableTypes,isEditing,onRemove,OpenLink,readOnly,t]);const handleFixStrengthMismatch=React.useCallback(()=>{onChange(schemaType.weak===true?set(true,["_weak"]):unset(["_weak"]));},[onChange,schemaType]);const actualStrength=(value==null?void 0:value._weak)?"weak":"strong";const weakShouldBe=schemaType.weak===true?"weak":"strong";const weakWarningOverride=hasRef&&!loadableReferenceInfo.isLoading&&(value==null?void 0:value._strengthenOnPublish);const showWeakRefMismatch=!loadableReferenceInfo.isLoading&&((_g=loadableReferenceInfo.result)==null?void 0:_g.availability.available)&&hasRef&&actualStrength!==weakShouldBe&&!weakWarningOverride;const issues=/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[isCurrentDocumentLiveEdit&&publishedReferenceExists&&value._strengthenOnPublish&&/* @__PURE__ */jsxRuntime.jsx(ReferenceFinalizeAlertStrip,{schemaType,handleRemoveStrengthenOnPublish}),showWeakRefMismatch&&/* @__PURE__ */jsxRuntime.jsx(ReferenceStrengthMismatchAlertStrip,{actualStrength,handleFixStrengthMismatch}),loadableReferenceInfo.error&&/* @__PURE__ */jsxRuntime.jsx(ReferenceMetadataLoadErrorAlertStrip,{errorMessage:loadableReferenceInfo.error.message,onHandleRetry:loadableReferenceInfo.retry})]});const item=/* @__PURE__ */jsxRuntime.jsx(ReferenceItemRefProvider,{menuRef,containerRef,children:/* @__PURE__ */jsxRuntime.jsx(RowLayout,{dragHandle:sortable,presence:!isEditing&&presence.length>0&&/* @__PURE__ */jsxRuntime.jsx(FieldPresence,{presence,maxAvatars:1}),validation:!isEditing&&validation.length>0&&/* @__PURE__ */jsxRuntime.jsx(FormFieldValidationStatus,{validation}),menu,footer:isEditing?void 0:issues,tone:isEditing?void 0:tone,focused,children:isEditing?/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:1,ref:containerRef,children:/* @__PURE__ */jsxRuntime.jsx(FormFieldSet,{title:schemaType.title,description:schemaType.description,__unstable_presence:presence,validation,inputId,deprecated:schemaType.deprecated,children})}):/* @__PURE__ */jsxRuntime.jsxs(ReferenceLinkCard,{as:EditReferenceLink,tone:"inherit",radius:2,documentId:value==null?void 0:value._ref,documentType:refType==null?void 0:refType.name,disabled:resolvingInitialValue,__unstable_focusRing:true,selected,pressed,"data-selected":selected?true:void 0,"data-pressed":pressed?true:void 0,...elementProps,children:[/* @__PURE__ */jsxRuntime.jsx(PreviewReferenceValue$1,{value,referenceInfo:loadableReferenceInfo,renderPreview,type:schemaType}),resolvingInitialValue&&/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{fill:true})]})})});return/* @__PURE__ */jsxRuntime.jsx(ChangeIndicator,{path,isChanged:changed,hasFocus:Boolean(focused),children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:1,children:item})});}function defaultResolveItemComponent(schemaType){var _a;if((_a=schemaType.components)==null?void 0:_a.item)return schemaType.components.item;if(types.isReferenceSchemaType(schemaType)){return ReferenceItem;}return PreviewItem;}const INITIAL_STATE$1={isLoading:true};const PENDING_STATE={isLoading:false};function useDocumentPreview(props){const{enabled=true,ordering,schemaType,value:previewValue}=props||{};const{observeForPreview}=useDocumentPreviewStore();return reactRx.useMemoObservable(()=>{if(!enabled||!previewValue||!schemaType)return rxjs.of(PENDING_STATE);return observeForPreview(previewValue,schemaType,{ordering}).pipe(operators.map(event=>({isLoading:false,value:event.snapshot||void 0})),operators.catchError(error=>rxjs.of({isLoading:false,error})));},[enabled,observeForPreview,ordering,schemaType,previewValue],INITIAL_STATE$1);}const orientationChange$=typeof window==="undefined"?rxjs.EMPTY:rxjs.fromEvent(window,"orientationchange").pipe(operators.shareReplay(1));const resize$=typeof window==="undefined"?rxjs.EMPTY:rxjs.fromEvent(window,"resize").pipe(operators.shareReplay(1));const scroll$=typeof window==="undefined"?rxjs.EMPTY:rxjs.fromEvent(window,"scroll",{passive:true,capture:true}).pipe(operators.shareReplay(1));const ROOT_MARGIN_PX=150;function isIntersectionObserverSupported(){if(typeof window!=="undefined"&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in IntersectionObserverEntry.prototype){if(!("isIntersecting"in IntersectionObserverEntry.prototype)){Object.defineProperty(IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0;}});}return true;}return false;}const intersectionObservableFor=isIntersectionObserverSupported()?createIntersectionObserverBased():createLegacyBased();function createIntersectionObserverBased(){const intersectionObserverEntriesSubject=new rxjs.Subject();const intersectionObserver=new IntersectionObserver(entries=>{entries.forEach(entry=>{intersectionObserverEntriesSubject.next(entry);});},{threshold:0,rootMargin:"".concat(ROOT_MARGIN_PX,"px")});return function intersectionObservableFor2(element){return new rxjs.Observable(observer=>{intersectionObserver.observe(element);observer.next();return()=>intersectionObserver.unobserve(element);}).pipe(operators.mergeMap(()=>intersectionObserverEntriesSubject.asObservable()),operators.filter(entry=>entry.target===element),operators.map(ev=>({isIntersecting:ev.isIntersecting})));};}function createLegacyBased(){function getViewport(){return{left:0,right:window.innerWidth,top:0,bottom:window.innerHeight};}function intersects(rect,viewport,margin){return rect.left<=viewport.right+margin&&rect.right>=viewport.left-margin&&rect.top<=viewport.bottom+margin&&rect.bottom>=viewport.top-margin;}function inViewport(element){return()=>intersects(element.getBoundingClientRect(),getViewport(),ROOT_MARGIN_PX);}return function intersectionObservableFor2(element){const isElementInViewport=inViewport(element);return rxjs.merge(rxjs.of(isElementInViewport()),resize$,scroll$,orientationChange$).pipe(// @todo: consider "faking" more of the IntersectionObserverEntry api if possible
operators.map(isElementInViewport),operators.map(isIntersecting=>({isIntersecting})));};}const visibilityChange$=typeof window==="undefined"?rxjs.EMPTY:rxjs.fromEvent(document,"visibilitychange").pipe(operators.shareReplay(1));function useVisibility(props){const{element,hideDelay=0}=props;const[visible,setVisible]=React.useState(false);React.useEffect(()=>{if(!element){return void 0;}const isDocumentVisible$=rxjs.concat(rxjs.of(!document.hidden),visibilityChange$.pipe(operators.map(event=>{var _a;return event.target instanceof Document?!((_a=event==null?void 0:event.target)==null?void 0:_a.hidden):false;}))).pipe(operators.distinctUntilChanged());const inViewport$=intersectionObservableFor(element).pipe(operators.map(event=>event.isIntersecting));const visible$=isDocumentVisible$.pipe(operators.switchMap(isDocumentVisible=>isDocumentVisible?inViewport$:rxjs.of(false)),operators.switchMap(isVisible=>isVisible?rxjs.of(true):rxjs.of(false).pipe(operators.delay(hideDelay))),operators.distinctUntilChanged());const sub=visible$.subscribe(setVisible);return()=>sub.unsubscribe();},[element,hideDelay]);return visible;}const _HIDE_DELAY=1e3*2;function _extractUploadState(value){return _resolveUploadValue(value==null?void 0:value._upload);}function getStringOrUndefined(value){return isString(value)?value:void 0;}function _resolveUploadValue(value){var _a,_b;if(!isRecord$4(value))return void 0;const progress=typeof value.progress==="number"?value.progress:0;const createdAt=getStringOrUndefined(value.initiated||value.createdAt);const updatedAt=getStringOrUndefined(value.updated||value.updatedAt);const fileName=getStringOrUndefined((_a=value==null?void 0:value.file)==null?void 0:_a.name);const fileType=getStringOrUndefined((_b=value==null?void 0:value.file)==null?void 0:_b.type);const previewImage=getStringOrUndefined(value.previewImage);if(createdAt&&updatedAt&&fileName&&fileType){return{progress,createdAt,updatedAt,file:{name:fileName,type:fileType},previewImage};}return void 0;}function PreviewLoader(props){const{layout,value,component,style:styleProp,schemaType,skipVisibilityCheck,...restProps}=props;const{t}=useTranslation();const[element,setElement]=React.useState(null);const isVisible=useVisibility({element:skipVisibilityCheck?null:element,hideDelay:_HIDE_DELAY});const preview=useDocumentPreview({enabled:skipVisibilityCheck||isVisible,schemaType,value});const style=React.useMemo(()=>({...styleProp,minWidth:(styleProp==null?void 0:styleProp.minWidth)||1,minHeight:(styleProp==null?void 0:styleProp.minHeight)||1}),[styleProp]);const uploadState=React.useMemo(()=>_extractUploadState(value),[value]);const media=React.useMemo(()=>{var _a,_b;if(uploadState==null?void 0:uploadState.previewImage){return/* @__PURE__ */jsxRuntime.jsx("img",{alt:t("preview.image.file-is-being-uploaded.alt-text"),src:uploadState.previewImage});}if(!((_a=preview==null?void 0:preview.value)==null?void 0:_a.media)){return schemaType.icon;}return(_b=preview==null?void 0:preview.value)==null?void 0:_b.media;},[preview,schemaType,uploadState,t]);return/* @__PURE__ */jsxRuntime.jsx("div",{ref:setElement,style,children:React.createElement(component,{...restProps,...((preview==null?void 0:preview.value)||{}),media,error:preview==null?void 0:preview.error,isPlaceholder:preview==null?void 0:preview.isLoading,layout,schemaType})});}var __freeze$12=Object.freeze;var __defProp$12=Object.defineProperty;var __template$12=(cooked,raw)=>__freeze$12(__defProp$12(cooked,"raw",{value:__freeze$12(raw||cooked.slice())}));var _a$12,_b$v,_c$h,_d$9,_e$5,_f$4,_g$3,_h$1,_i;const Root$8=styled__default.default(ui.Card)(props=>{const{color:color$1,radius,space}=props.theme.sanity;const overlay=styled.css(_a$12||(_a$12=__template$12(["\n    pointer-events: none;\n    content: '';\n    position: absolute;\n    top: -","px;\n    bottom: -","px;\n    left: -","px;\n    right: -","px;\n    border-radius: ","px;\n    mix-blend-mode: ",";\n  "])),space[1],space[1],space[1],space[1],radius[2],color$1.dark?"screen":"multiply");return styled.css(_b$v||(_b$v=__template$12(["\n    box-shadow: 0 0 0 1px var(--card-border-color);\n    border-radius: ","px;\n    pointer-events: all;\n    position: relative;\n\n    &[data-focused] {\n      --card-border-color: var(--card-focus-ring-color);\n    }\n\n    &:not([data-focused]):not([data-selected]) {\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ",";\n        }\n      }\n    }\n\n    &[data-markers] {\n      &:after {\n        ","\n        background-color: ",";\n      }\n    }\n\n    &[data-warning] {\n      &:after {\n        ","\n        background-color: ",";\n      }\n\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ",";\n        }\n      }\n    }\n\n    &[data-invalid] {\n      &:after {\n        ","\n        background-color: ",";\n      }\n\n      @media (hover: hover) {\n        &:hover {\n          --card-border-color: ",";\n        }\n      }\n    }\n  "])),radius[1],color$1.input.default.hovered.border,overlay,color$1.dark?color.hues.purple[950].hex:color.hues.purple[50].hex,overlay,color$1.muted.caution.hovered.bg,color$1.muted.caution.hovered.border,overlay,color$1.input.invalid.enabled.bg,color$1.input.invalid.hovered.border);});const PreviewContainer=styled__default.default(ui.Box)(_c$h||(_c$h=__template$12(["\n  display: block;\n  width: 100%;\n  user-select: none;\n  pointer-events: all;\n"])));const ChangeIndicatorWrapper=styled__default.default.div(_ref248=>{let{theme,$hasChanges}=_ref248;const{space}=theme.sanity;return styled.css(_e$5||(_e$5=__template$12(["\n      position: absolute;\n      width: ","px;\n      right: 0;\n      top: 0;\n      bottom: 0;\n      padding-left: ","px;\n      user-select: none;\n\n      ","\n\n      [data-dragged] & {\n        visibility: hidden;\n      }\n    "])),space[2],space[1],!$hasChanges&&styled.css(_d$9||(_d$9=__template$12(["\n        display: none;\n      "]))));});const InnerFlex=styled__default.default(ui.Flex)(_f$4||(_f$4=__template$12(["\n  position: relative;\n\n  [data-dragged] > & {\n    opacity: 0.5;\n  }\n"])));const BlockActionsOuter=styled__default.default(ui.Box)(_g$3||(_g$3=__template$12(["\n  width: 25px;\n  position: relative;\n\n  [data-dragged] & {\n    visibility: hidden;\n  }\n"])));const BlockActionsInner=styled__default.default(ui.Flex)(_h$1||(_h$1=__template$12(["\n  position: absolute;\n  right: 0;\n  [data-dragged] & {\n    visibility: hidden;\n  }\n"])));const TooltipBox=styled__default.default(ui.Box)(_i||(_i=__template$12(["\n  max-width: 250px;\n"])));const POPOVER_PROPS$1={constrainSize:true,placement:"bottom",portal:"default",tone:"default"};function BlockObjectActionsMenu(props){const{children,focused,isOpen,onOpen,onRemove,readOnly,value}=props;const{t}=useTranslation();const menuButtonId=React.useId();const menuButton=React.useRef(null);const isTabbing=React.useRef(false);const referenceLink=React.useMemo(()=>types.isReference(value)?React.forwardRef(function ReferenceLink(linkProps,ref){return/* @__PURE__ */jsxRuntime.jsx(router.IntentLink,{...linkProps,intent:"edit",params:{id:value._ref},ref});}):void 0,[value]);React.useEffect(()=>{if(isOpen){isTabbing.current=false;}},[isOpen]);ui.useGlobalKeyDown(React.useCallback(event=>{if(!focused){return;}if(event.key==="Tab"){if(menuButton.current&&!isTabbing.current&&!isOpen){event.preventDefault();event.stopPropagation();menuButton.current.focus();isTabbing.current=true;}}},[focused,isOpen]));const handleDelete=React.useCallback(event=>{event.preventDefault();event.stopPropagation();onRemove();},[onRemove]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("inputs.portable-text.block.open-menu-aria-label"),icon:icons.EllipsisHorizontalIcon,mode:"bleed",paddingY:3,tabIndex:focused?0:1,tooltipProps:{content:"Open menu"}}),ref:menuButton,id:menuButtonId,menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:["_ref"in value&&value._ref&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:referenceLink,"data-as":"a",icon:icons.LinkIcon,text:t("inputs.portable-text.block.open-reference")}),readOnly&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{icon:icons.EyeOpenIcon,onClick:onOpen,text:t("inputs.portable-text.block.view")}),!readOnly&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{icon:icons.EditIcon,onClick:onOpen,text:t("inputs.portable-text.block.edit")}),!readOnly&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{icon:icons.TrashIcon,onClick:handleDelete,text:t("inputs.portable-text.block.remove"),tone:"critical"})]})}),popover:POPOVER_PROPS$1})})]});}function BlockObject(props){var _a;const{floatingBoundary,focused,isFullscreen,onItemClose,onItemOpen,onPathFocus,path,readOnly,referenceBoundary,relativePath,renderAnnotation,renderBlock,renderBlockActions,renderCustomMarkers,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType,selected,value}=props;const{onChange}=useFormCallbacks();const{Markers}=useFormBuilder().__internal.components;const[reviewChangesHovered,setReviewChangesHovered]=React.useState(false);const markers=usePortableTextMarkers(path);const editor=portableTextEditor.usePortableTextEditor();const memberItem=usePortableTextMemberItem(pathToString$1(path));const isDeleting=React.useRef(false);const selfSelection=React.useMemo(()=>({anchor:{path:relativePath,offset:0},focus:{path:relativePath,offset:0}}),[relativePath]);const handleMouseOver=React.useCallback(()=>setReviewChangesHovered(true),[]);const handleMouseOut=React.useCallback(()=>setReviewChangesHovered(false),[]);const onOpen=React.useCallback(()=>{if(memberItem){portableTextEditor.PortableTextEditor.blur(editor);onItemOpen(memberItem.node.path);}},[editor,memberItem,onItemOpen]);const onClose=React.useCallback(()=>{onItemClose();portableTextEditor.PortableTextEditor.select(editor,selfSelection);portableTextEditor.PortableTextEditor.focus(editor);},[onItemClose,editor,selfSelection]);const onRemove=React.useCallback(()=>{if(isDeleting.current){return;}try{portableTextEditor.PortableTextEditor.delete(editor,selfSelection,{mode:"blocks"});}catch(err){console.error(err);}finally{isDeleting.current=true;}},[editor,selfSelection]);React.useEffect(()=>()=>{if(isDeleting.current){portableTextEditor.PortableTextEditor.focus(editor);}},[editor]);const innerPaddingProps=React.useMemo(()=>{if(isFullscreen&&!renderBlockActions){return{paddingX:5};}if(isFullscreen&&renderBlockActions){return{paddingLeft:5,paddingRight:2};}if(renderBlockActions){return{paddingLeft:3,paddingRight:2};}return{paddingX:3};},[isFullscreen,renderBlockActions]);const{validation,hasError,hasWarning,hasInfo}=useMemberValidation(memberItem==null?void 0:memberItem.node);const parentSchemaType=editor.schemaTypes.portableText;const hasMarkers=Boolean(markers.length>0);const presence=useChildPresence(path,true);const rootPresence=React.useMemo(()=>presence.filter(p=>PathUtils.isEqual(p.path,path)),[path,presence]);const tooltipEnabled=hasError||hasWarning||hasInfo||hasMarkers;const toolTipContent=React.useMemo(()=>tooltipEnabled&&/* @__PURE__ */jsxRuntime.jsx(TooltipBox,{children:/* @__PURE__ */jsxRuntime.jsx(Markers,{markers,validation,renderCustomMarkers})})||null,[Markers,markers,renderCustomMarkers,tooltipEnabled,validation]);const isOpen=Boolean(memberItem==null?void 0:memberItem.member.open);const input=memberItem==null?void 0:memberItem.input;const nodePath=(memberItem==null?void 0:memberItem.node.path)||EMPTY_ARRAY$9;const referenceElement=(_a=memberItem==null?void 0:memberItem.elementRef)==null?void 0:_a.current;const componentProps=React.useMemo(()=>({__unstable_floatingBoundary:floatingBoundary,__unstable_referenceBoundary:referenceBoundary,__unstable_referenceElement:referenceElement||null,children:input,focused,markers,onClose,onOpen,onPathFocus,onRemove,open:isOpen,parentSchemaType,path:nodePath,presence:rootPresence,readOnly:Boolean(readOnly),renderAnnotation,renderBlock,renderDefault:DefaultBlockObjectComponent,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType,selected,validation,value}),[floatingBoundary,referenceElement,input,focused,markers,onClose,onOpen,onPathFocus,onRemove,isOpen,parentSchemaType,nodePath,rootPresence,readOnly,referenceBoundary,renderAnnotation,renderBlock,renderField,renderInlineBlock,renderInput,renderItem,renderPreview,schemaType,selected,validation,value]);return React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx(ui.Box,{ref:memberItem==null?void 0:memberItem.elementRef,contentEditable:false,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{paddingBottom:1,marginY:3,style:debugRender(),children:/* @__PURE__ */jsxRuntime.jsxs(InnerFlex,{flex:1,children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{placement:"top",portal:"editor",disabled:isOpen?true:!tooltipEnabled,content:toolTipContent,children:/* @__PURE__ */jsxRuntime.jsx(PreviewContainer,{...innerPaddingProps,children:renderBlock&&renderBlock(componentProps)})}),/* @__PURE__ */jsxRuntime.jsx(BlockActionsOuter,{marginRight:1,children:/* @__PURE__ */jsxRuntime.jsx(BlockActionsInner,{children:renderBlockActions&&value&&focused&&!readOnly&&/* @__PURE__ */jsxRuntime.jsx(BlockActions,{block:value,onChange,renderBlockActions})})}),isFullscreen&&memberItem&&/* @__PURE__ */jsxRuntime.jsx(ChangeIndicatorWrapper,{$hasChanges:memberItem.member.item.changed,onMouseOut:handleMouseOut,onMouseOver:handleMouseOver,children:/* @__PURE__ */jsxRuntime.jsx(StyledChangeIndicatorWithProvidedFullPath,{hasFocus:focused,isChanged:memberItem.member.item.changed,path:memberItem.member.item.path,withHoverEffect:false})}),reviewChangesHovered&&/* @__PURE__ */jsxRuntime.jsx(ReviewChangesHighlightBlock,{})]})})}),[componentProps,focused,handleMouseOut,handleMouseOver,innerPaddingProps,isFullscreen,memberItem,onChange,readOnly,renderBlock,renderBlockActions,reviewChangesHovered,toolTipContent,tooltipEnabled,value,isOpen]);}const DefaultBlockObjectComponent=props=>{const{__unstable_floatingBoundary,__unstable_referenceBoundary,__unstable_referenceElement,children,focused,markers,onClose,onOpen,onRemove,open,readOnly,renderPreview,schemaType,selected,value,validation}=props;const{t}=useTranslation();const isImagePreview=types.isImage(value);const hasError=validation.filter(v=>v.level==="error").length>0;const hasWarning=validation.filter(v=>v.level==="warning").length>0;const hasMarkers=Boolean(markers.length>0);const tone=selected||focused?"primary":"default";const handleDoubleClickToOpen=React.useCallback(e=>{e.preventDefault();e.stopPropagation();onOpen();},[onOpen]);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(Root$8,{"aria-label":t("inputs.portable-text.block.aria-label"),"data-focused":focused?"":void 0,"data-image-preview":isImagePreview?"":void 0,"data-invalid":hasError?"":void 0,"data-markers":hasMarkers?"":void 0,"data-read-only":readOnly?"":void 0,"data-selected":selected?"":void 0,"data-testid":"pte-block-object","data-warning":hasWarning?"":void 0,flex:1,onDoubleClick:handleDoubleClickToOpen,padding:isImagePreview?0:1,tone,children:renderPreview({actions:/* @__PURE__ */jsxRuntime.jsx(BlockObjectActionsMenu,{isOpen:open,focused,onOpen,onRemove,readOnly,value}),layout:isImagePreview?"blockImage":"block",schemaType,skipVisibilityCheck:true,value})}),open&&/* @__PURE__ */jsxRuntime.jsx(ObjectEditModal,{floatingBoundary:__unstable_floatingBoundary,defaultType:"dialog",onClose,autoFocus:focused,schemaType,referenceBoundary:__unstable_referenceBoundary,referenceElement:__unstable_referenceElement,children})]});};function defaultResolveBlockComponent(schemaType){var _a;if((_a=schemaType.components)==null?void 0:_a.block)return schemaType.components.block;if(isBlockType(schemaType)){return DefaultComponent$1;}return DefaultBlockObjectComponent;}function defaultResolveInlineBlockComponent(schemaType){var _a;if((_a=schemaType.components)==null?void 0:_a.inlineBlock)return schemaType.components.inlineBlock;return DefaultInlineObjectComponent;}function defaultResolveAnnotationComponent(schemaType){var _a;if((_a=schemaType.components)==null?void 0:_a.annotation)return schemaType.components.annotation;return DefaultAnnotationComponent;}function useResolveDefaultComponent(props){const{componentResolver,componentProps}=props;if(!componentProps.schemaType){throw new Error("the `schemaType` property must be defined");}const defaultResolvedComponent=componentResolver(componentProps.schemaType);const renderDefault=React.useCallback(parentTypeProps=>{var _a;if(!((_a=parentTypeProps.schemaType)==null?void 0:_a.type)){throw new Error("Attempted to render form component of non-existent parent type");}const{components,...restSchemaType}=parentTypeProps.schemaType;const parentTypeResolvedComponent=componentResolver(restSchemaType);return React.createElement(parentTypeResolvedComponent,parentTypeProps);},[componentResolver]);return React.createElement(defaultResolvedComponent,{...componentProps,renderDefault});}function DefaultInput(props){return useResolveDefaultComponent({componentProps:props,componentResolver:defaultResolveInputComponent});}function DefaultField(props){return useResolveDefaultComponent({componentProps:props,componentResolver:defaultResolveFieldComponent});}function DefaultItem(props){return useResolveDefaultComponent({componentProps:props,componentResolver:defaultResolveItemComponent});}function DefaultPreview$1(props){return useResolveDefaultComponent({componentProps:props,componentResolver:defaultResolvePreviewComponent});}function DefaultBlock(props){return useResolveDefaultComponent({componentProps:props,componentResolver:defaultResolveBlockComponent});}function DefaultInlineBlock(props){return useResolveDefaultComponent({componentProps:props,componentResolver:defaultResolveInlineBlockComponent});}function DefaultAnnotation(props){return useResolveDefaultComponent({componentProps:props,componentResolver:defaultResolveAnnotationComponent});}function pickInputComponent(plugin){var _a,_b;return(_b=(_a=plugin.form)==null?void 0:_a.components)==null?void 0:_b.input;}function pickFieldComponent(plugin){var _a,_b;return(_b=(_a=plugin.form)==null?void 0:_a.components)==null?void 0:_b.field;}function pickPreviewComponent(plugin){var _a,_b;return(_b=(_a=plugin.form)==null?void 0:_a.components)==null?void 0:_b.preview;}function pickItemComponent(plugin){var _a,_b;return(_b=(_a=plugin.form)==null?void 0:_a.components)==null?void 0:_b.item;}function pickBlockComponent(plugin){var _a,_b;return(_b=(_a=plugin.form)==null?void 0:_a.components)==null?void 0:_b.block;}function pickInlineBlockComponent(plugin){var _a,_b;return(_b=(_a=plugin.form)==null?void 0:_a.components)==null?void 0:_b.inlineBlock;}function pickAnnotationComponent(plugin){var _a,_b;return(_b=(_a=plugin.form)==null?void 0:_a.components)==null?void 0:_b.annotation;}function useInputComponent(){return useMiddlewareComponents({defaultComponent:DefaultInput,pick:pickInputComponent});}function useFieldComponent(){return useMiddlewareComponents({defaultComponent:DefaultField,pick:pickFieldComponent});}function usePreviewComponent(){return useMiddlewareComponents({defaultComponent:DefaultPreview$1,pick:pickPreviewComponent});}function useItemComponent(){return useMiddlewareComponents({defaultComponent:DefaultItem,pick:pickItemComponent});}function useBlockComponent(){return useMiddlewareComponents({defaultComponent:DefaultBlock,pick:pickBlockComponent});}function useInlineBlockComponent(){return useMiddlewareComponents({defaultComponent:DefaultInlineBlock,pick:pickInlineBlockComponent});}function useAnnotationComponent(){return useMiddlewareComponents({defaultComponent:DefaultAnnotation,pick:pickAnnotationComponent});}function Preview(props){const PreviewComponent=usePreviewComponent();return/* @__PURE__ */jsxRuntime.jsx(PreviewLoader,{...props,component:PreviewComponent});}const _previewComponents={block:BlockPreview,blockImage:BlockImagePreview,compact:CompactPreview,default:DefaultPreview,detail:DetailPreview,inline:InlinePreview,media:MediaPreview};function FallbackIcon(){return/* @__PURE__ */jsxRuntime.jsx(icons.DocumentIcon,{className:"sanity-studio__preview-fallback-icon"});}function SanityDefaultPreview(props){const{icon,layout,media:mediaProp,imageUrl,title,tooltip,...restProps}=props;const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const imageBuilder=React.useMemo(()=>imageUrlBuilder__default.default(client),[client]);const renderMedia=React.useCallback(options=>{const{dimensions}=options;return/* @__PURE__ */jsxRuntime.jsx("img",{alt:isString(title)?title:void 0,referrerPolicy:"strict-origin-when-cross-origin",src:imageBuilder.image(mediaProp).width(dimensions.width||100).height(dimensions.height||100).fit(dimensions.fit).dpr(dimensions.dpr||1).url()||""});},[imageBuilder,mediaProp,title]);const renderIcon=React.useCallback(()=>{return React.createElement(icon||FallbackIcon);},[icon]);const media=React.useMemo(()=>{if(icon===false){return false;}if(reactIs.isValidElementType(mediaProp)){return mediaProp;}if(React.isValidElement(mediaProp)){return mediaProp;}if(assetUtils.isImageSource(mediaProp)){return renderMedia;}if(isString(imageUrl)){return/* @__PURE__ */jsxRuntime.jsx("img",{src:imageUrl,alt:isString(title)?title:void 0,referrerPolicy:"strict-origin-when-cross-origin"});}return renderIcon;},[icon,imageUrl,mediaProp,renderIcon,renderMedia,title]);const previewProps=React.useMemo(()=>({...restProps,// @todo: fix `TS2769: No overload matches this call.`
media,title}),[media,restProps,title]);const layoutComponent=_previewComponents[layout||"default"];const children=React.createElement(layoutComponent,previewProps);if(tooltip){return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:tooltip,disabled:!tooltip,fallbackPlacements:["top-end"],placement:"bottom-end",children:/* @__PURE__ */jsxRuntime.jsx("div",{children})});}return children;}const INCLUDE_FIELDS_QUERY=["_id","_rev","_type"];const INCLUDE_FIELDS=[...INCLUDE_FIELDS_QUERY,"_key"];const AVAILABILITY_READABLE={available:true,reason:"READABLE"};const AVAILABILITY_PERMISSION_DENIED={available:false,reason:"PERMISSION_DENIED"};const AVAILABILITY_NOT_FOUND={available:false,reason:"NOT_FOUND"};const INVALID_PREVIEW_FALLBACK={title:"Invalid preview config",subtitle:"Check the error log in the console",media:/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})};function debounceCollect(fn,wait){let timer;let queue={};let idx=0;return function debounced(){for(var _len5=arguments.length,args=new Array(_len5),_key6=0;_key6<_len5;_key6++){args[_key6]=arguments[_key6];}return new rxjs.Observable(obs=>{clearTimeout(timer);timer=setTimeout(flush,wait);const queueItem={args,observer:obs,completed:false};const id=idx++;queue[id]=queueItem;return()=>{queueItem.completed=true;};});};function flush(){const currentlyFlushingQueue=queue;queue={};const queueItemIds=Object.keys(currentlyFlushingQueue).filter(id=>{const queueItem=currentlyFlushingQueue[id];return queueItem&&!queueItem.completed;});if(queueItemIds.length===0){return;}const collectedArgs=queueItemIds.map(id=>{const queueItem=currentlyFlushingQueue[id];return queueItem&&queueItem.args;}).filter(isNonNullable$2);fn(collectedArgs).subscribe({next(results){results.forEach((result,i)=>{const queueItem=currentlyFlushingQueue[queueItemIds[i]];if(queueItem&&!queueItem.completed){queueItem.observer.next(results[i]);}});},complete(){queueItemIds.forEach(id=>{const entry=currentlyFlushingQueue[id];if(entry&&!entry.completed){entry.observer.complete();}});},error(err){queueItemIds.forEach(id=>{const entry=currentlyFlushingQueue[id];if(entry&&!entry.completed){entry.observer.error(err);}});}});}}const MAX_DOCUMENT_ID_CHUNK_SIZE=11164;function chunkDocumentIds(documentIds){let chunk=[];let chunkSize=0;const chunks=[];for(const documentId of documentIds){if(chunkSize+documentId.length+1>=MAX_DOCUMENT_ID_CHUNK_SIZE){chunks.push(chunk);chunk=[];chunkSize=0;}chunkSize+=documentId.length+1;chunk.push(documentId);}if(!chunks.includes(chunk)){chunks.push(chunk);}return chunks;}function mutConcat(array,chunks){array.push(...chunks);return array;}function create_preview_availability(versionedClient,observePaths){function observeDocumentPairAvailability(id){const draftId=getDraftId(id);const publishedId=getPublishedId(id);return rxjs.combineLatest([observeDocumentAvailability(draftId),observeDocumentAvailability(publishedId)]).pipe(operators.distinctUntilChanged(shallowEquals__default.default),operators.map(_ref249=>{let[draftReadability,publishedReadability]=_ref249;return{draft:draftReadability,published:publishedReadability};}));}function observeDocumentAvailability(id){return observePaths({_ref:id},[["_rev"]]).pipe(operators.map(res=>isRecord$4(res)&&Boolean("_rev"in res&&(res==null?void 0:res._rev))),operators.distinctUntilChanged(),operators.switchMap(hasRev=>{return hasRev?// short circuit: if we can read the _rev field we know it both exists and is readable
rxjs.of(AVAILABILITY_READABLE):// we can't read the _rev field for two possible reasons: 1) the document isn't readable or 2) the document doesn't exist
fetchDocumentReadability(id);}));}const fetchDocumentReadability=debounceCollect(function fetchDocumentReadability2(args){const uniqueIds=[...new Set(flatten__default.default(args))];return rxjs.from(chunkDocumentIds(uniqueIds)).pipe(operators.mergeMap(fetchDocumentReadabilityChunked,10),operators.reduce(mutConcat,[]),operators.map(res=>args.map(_ref250=>{let[id]=_ref250;return res[uniqueIds.indexOf(id)];})));},1);function fetchDocumentReadabilityChunked(ids){return rxjs.defer(()=>{const requestOptions={uri:versionedClient.getDataUrl("doc",ids.join(",")),json:true,query:{excludeContent:"true"},tag:"preview.documents-availability"};return versionedClient.observable.request(requestOptions).pipe(operators.map(response=>{const omitted=keyBy__default.default(response.omitted||[],entry=>entry.id);return ids.map(id=>{const omittedEntry=omitted[id];if(!omittedEntry){return AVAILABILITY_READABLE;}if(omittedEntry.reason==="existence"){return AVAILABILITY_NOT_FOUND;}if(omittedEntry.reason==="permission"){return AVAILABILITY_PERMISSION_DENIED;}throw new Error('Unexpected reason for omission: "'.concat(omittedEntry.reason,'"'));});}));});}return{observeDocumentPairAvailability};}function keysOf(value){return Object.keys(value);}function setKey(source,key,value){return{...source,[key]:value};}function props(){let options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return source=>{return new rxjs.Observable(observer=>source.subscribe(observer)).pipe(operators.switchMap(object=>{const keyObservables=keysOf(object).map(key=>{const value=object[key];return rxjs.isObservable(value)?rxjs.from(value).pipe(operators.map(val=>[key,val])):rxjs.of([key,value]);});return options.wait?rxjs.combineLatest(keyObservables).pipe(operators.map(pairs=>pairs.reduce((acc,_ref251)=>{let[key,value]=_ref251;return setKey(acc,key,value);},{}))):rxjs.from(keyObservables).pipe(operators.mergeAll(),operators.scan((acc,_ref252)=>{let[key,value]=_ref252;return setKey(acc,key,value);},{}));}));};}function createEmpty(fields){return fields.reduce((result,field)=>{result[field]=void 0;return result;},{});}function resolveMissingHeads(value,paths){return paths.filter(path=>!(path[0]in value));}function getDocumentId(value){if(types.isReference(value)){return value._ref;}return"_id"in value?value._id:void 0;}function observePaths(value,paths,observeFields,apiConfig){if(!value||typeof value!=="object"){return rxjs.of(value);}const id=getDocumentId(value);const currentValue=id?{...value,_id:id}:{...value};if(currentValue._type==="reference"){delete currentValue._type;delete currentValue._ref;delete currentValue._weak;delete currentValue._dataset;delete currentValue._projectId;delete currentValue._strengthenOnPublish;}const pathsWithMissingHeads=resolveMissingHeads(currentValue,paths);if(id&&pathsWithMissingHeads.length>0){const nextHeads=uniq__default.default(pathsWithMissingHeads.map(path=>path[0]));const refApiConfig=types.isCrossDatasetReference(value)?{projectId:value._projectId,dataset:value._dataset}:apiConfig;return observeFields(id,nextHeads,refApiConfig).pipe(operators.switchMap(snapshot=>{if(snapshot===null){return rxjs.of(null);}return observePaths({...createEmpty(nextHeads),...(types.isReference(value)?{...value,...refApiConfig}:value),...snapshot},paths,observeFields,refApiConfig);}));}const leads={};paths.forEach(path=>{const[head,...tail]=path;if(!leads[head]){leads[head]=[];}leads[head].push(tail);});const next=Object.keys(leads).reduce((res,head)=>{const tails=leads[head].filter(tail=>tail.length>0);if(tails.length===0){res[head]=isRecord$4(value)?value[head]:void 0;}else{res[head]=observePaths(value[head],tails,observeFields,apiConfig);}return res;},currentValue);return rxjs.of(next).pipe(props({wait:true}));}function normalizePaths(path){return path.map(segment=>typeof segment==="string"?segment.split("."):segment);}function createPathObserver(context){const{observeFields}=context;return{observePaths(value,paths,apiConfig){return observePaths(value,normalizePaths(paths),observeFields,apiConfig);}};}const DEFAULT_PREVIEW_PATHS=[["_createdAt"],["_updatedAt"]];function getPreviewPaths(preview){const selection=preview==null?void 0:preview.select;if(!selection)return void 0;const paths=Object.values(selection).map(value=>String(value).split("."))||[];return paths.concat(DEFAULT_PREVIEW_PATHS);}function isPortableTextPreviewValue(value){return Array.isArray(value)&&(value.length===0||value.some(types.isPortableTextTextBlock));}function extractTextFromBlocks(blocks){const firstBlock=Array.isArray(blocks)&&blocks.find(types.isPortableTextTextBlock);if(!firstBlock||!firstBlock.children){return"";}return firstBlock.children.filter(types.isPortableTextSpan).map(span=>span.text).join("");}const PRESERVE_KEYS=["_id","_type","_upload","_createdAt","_updatedAt"];const EMPTY=[];const errorCollector=/* @__PURE__ */(()=>{let errorsByType={};return{add:(type,value,error)=>{if(!errorsByType[type.name]){errorsByType[type.name]=[];}errorsByType[type.name].push({error,type,value});},getAll(){return errorsByType;},clear(){errorsByType={};}};})();const reportErrors=debounce__default.default(()=>{const errorsByType=errorCollector.getAll();const uniqueErrors=flatten__default.default(Object.keys(errorsByType).map(typeName=>{const entries=errorsByType[typeName];return uniqBy__default.default(entries,entry=>entry.error.message);}));const errorCount=uniqueErrors.length;if(errorCount===0){return;}console.groupCollapsed("%cHeads up! Got ".concat(errorCount===1?"error":"".concat(errorCount," errors")," while preparing data for preview. Click for details."),"color: #ff7e7c");Object.keys(errorsByType).forEach(typeName=>{const entries=errorsByType[typeName];const first=entries[0];console.group('Check the preview config for schema type "'.concat(typeName,'": %o'),first.type.preview);const uniqued=uniqBy__default.default(entries,entry=>entry.error.message);uniqued.forEach(entry=>{var _a;if(entry.error.type==="returnValueError"){const hasPrepare=typeof((_a=entry.type.preview)==null?void 0:_a.prepare)==="function";const{value,error}=entry;console.log("Encountered an invalid ".concat(hasPrepare?"return value when calling prepare(%o)":"value targeted by preview.select",":"),value);console.error(error);}if(entry.error.type==="prepareError"){const{value,error}=entry;console.log("Encountered an error when calling prepare(%o):",value);console.error(error);}});console.groupEnd();});console.groupEnd();errorCollector.clear();},1e3);const isRenderable=fieldName=>value=>{const type=typeof value;if(value===null||type==="undefined"||type==="string"||type==="number"||type==="boolean"){return EMPTY;}return[assignType("returnValueError",new Error('The "'.concat(fieldName,'" field should be a string, number, boolean, undefined or null, instead saw ').concat(inspect(value))))];};const FIELD_NAME_VALIDATORS={media:()=>{return EMPTY;},title:isRenderable("title"),subtitle:isRenderable("subtitle"),description:isRenderable("description"),imageUrl:isRenderable("imageUrl"),date:isRenderable("date")};function inspect(val){let prefixType=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(isRecord$4(val)){const keys=Object.keys(val);const ellipse=keys.length>3?"...":"";const prefix="object with keys ";return"".concat(prefixType?prefix:"","{").concat(keys.slice(0,3).join(", ")).concat(ellipse,"}");}if(Array.isArray(val)){const ellipse=val.length>3?"...":"";const prefix="array with ";return"".concat(prefixType?prefix:"","[").concat(val.map(v=>inspect(v,false))).concat(ellipse,"]");}return"the ".concat(typeof val," ").concat(val);}function validateFieldValue(fieldName,fieldValue){if(typeof fieldValue==="undefined"){return EMPTY;}const validator=FIELD_NAME_VALIDATORS[fieldName];return validator&&validator(fieldValue)||EMPTY;}function assignType(type,error){return Object.assign(error,{type});}function validatePreparedValue(preparedValue){if(!isPlainObject__default.default(preparedValue)||preparedValue===null){return[assignType("returnValueError",new Error("Invalid return value. Expected a plain object with at least a 'title' field, instead saw ".concat(inspect(preparedValue))))];}return Object.entries(preparedValue).reduce((acc,_ref253)=>{let[fieldName,fieldValue]=_ref253;return[...acc,...validateFieldValue(fieldName,fieldValue)];},EMPTY);}function validateReturnedPreview(result){return{...result,errors:[...(result.errors||[]),...validatePreparedValue(result.returnValue)]};}function defaultPrepare(value){return keysOf(value).reduce((acc,fieldName)=>{const val=value[fieldName];return{...acc,[fieldName]:isPortableTextPreviewValue(val)?extractTextFromBlocks(val):val};},{});}function invokePrepare(type,value){let viewOptions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var _a;const prepare=(_a=type.preview)==null?void 0:_a.prepare;try{return{returnValue:prepare?prepare(value,viewOptions):defaultPrepare(value),errors:EMPTY};}catch(error){return{returnValue:null,errors:[assignType("prepareError",error)]};}}function withErrors(result,type,selectedValue){result.errors.forEach(error=>errorCollector.add(type,selectedValue,error));reportErrors();return INVALID_PREVIEW_FALLBACK;}function hasEnumListOptions(type){const options=type.options&&typeof type.options==="object"?type.options:false;if(!options||!("list"in options)){return false;}const listOptions=options.list;return Array.isArray(listOptions);}function getListOptions(type){if(!hasEnumListOptions(type)){return void 0;}const listOptions=type.options.list;return listOptions.map(option=>types.isTitledListValue(option)?option:{title:option,value:option});}function prepareForPreview(rawValue,type){let viewOptions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var _a,_b;const hasCustomPrepare=typeof((_a=type.preview)==null?void 0:_a.prepare)==="function";const selection=((_b=type.preview)==null?void 0:_b.select)||{};const targetKeys=Object.keys(selection);const selectedValue=targetKeys.reduce((acc,key)=>{var _a2;const typeWithFields="fields"in type?type:null;const targetFieldName=selection[key];const valueField=(_a2=typeWithFields==null?void 0:typeWithFields.fields)==null?void 0:_a2.find(f=>f.name===targetFieldName);const listOptions=valueField&&getListOptions(valueField.type);if(!hasCustomPrepare&&listOptions){const selectedOption=listOptions&&listOptions.find(opt=>opt.value===get__default.default(rawValue,selection[key]));acc[key]=selectedOption?selectedOption.value:get__default.default(rawValue,selection[key]);}else{acc[key]=get__default.default(rawValue,selection[key]);}return acc;},{});const prepareResult=invokePrepare(type,selectedValue,viewOptions);if(prepareResult.errors.length>0){return withErrors(prepareResult,type,selectedValue);}const returnValueResult=validateReturnedPreview(invokePrepare(type,selectedValue,viewOptions));return returnValueResult.errors.length>0?withErrors(returnValueResult,type,selectedValue):{...pick__default.default(rawValue,PRESERVE_KEYS),...prepareResult.returnValue};}function isRecord$1(value){return isPlainObject__default.default(value);}function isReference(value){return isPlainObject__default.default(value);}function createPreviewObserver(context){const{observeDocumentTypeFromId,observePaths}=context;return function observeForPreview(value,type,viewOptions,apiConfig){if(types.isCrossDatasetReferenceSchemaType(type)){if(!types.isCrossDatasetReference(value)){return rxjs.of({snapshot:void 0});}const refApiConfig={projectId:value._projectId,dataset:value._dataset};return observeDocumentTypeFromId(value._ref,refApiConfig).pipe(operators.switchMap(typeName=>{if(typeName){const refType=type.to.find(toType=>toType.type===typeName);return observeForPreview(value,refType,{},refApiConfig);}return rxjs.of({snapshot:void 0});}));}if(types.isReferenceSchemaType(type)){if(!isReference(value)){return rxjs.of({snapshot:void 0});}return observeDocumentTypeFromId(value._ref).pipe(operators.switchMap(typeName=>{if(typeName){const refType=type.to.find(toType=>toType.name===typeName);return observeForPreview(value,refType);}return rxjs.of({snapshot:void 0});}));}const paths=getPreviewPaths(type.preview);if(paths){return observePaths(value,paths,apiConfig).pipe(operators.map(snapshot=>({type,snapshot:snapshot&&prepareForPreview(snapshot,type,viewOptions)})));}return rxjs.of({type,snapshot:value&&isRecord$1(value)?invokePrepare(type,value,viewOptions).returnValue:null});};}function create_preview_documentPair(versionedClient,observePaths){const{observeDocumentPairAvailability}=create_preview_availability(versionedClient,observePaths);const ALWAYS_INCLUDED_SNAPSHOT_PATHS=[["_updatedAt"],["_createdAt"],["_type"]];return{observePathsDocumentPair};function observePathsDocumentPair(id,paths){const{draftId,publishedId}=getIdPair(id);return observeDocumentPairAvailability(draftId).pipe(operators.switchMap(availability=>{if(!availability.draft.available&&!availability.published.available){return rxjs.of({id:publishedId,type:null,draft:{availability:availability.draft,snapshot:void 0},published:{availability:availability.published,snapshot:void 0}});}const snapshotPaths=[...paths,...ALWAYS_INCLUDED_SNAPSHOT_PATHS];return rxjs.combineLatest([observePaths({_type:"reference",_ref:draftId},snapshotPaths),observePaths({_type:"reference",_ref:publishedId},snapshotPaths)]).pipe(operators.map(_ref254=>{let[draftSnapshot,publishedSnapshot]=_ref254;const type=isRecord$4(draftSnapshot)&&"_type"in draftSnapshot&&draftSnapshot._type||isRecord$4(publishedSnapshot)&&"_type"in publishedSnapshot&&publishedSnapshot._type||null;return{id:publishedId,type:typeof type==="string"?type:null,draft:{availability:availability.draft,snapshot:draftSnapshot},published:{availability:availability.published,snapshot:publishedSnapshot}};}));}));}}function hasEqualFields(fields){return(object,otherObject)=>{if(object===otherObject){return true;}if(!object||!otherObject){return false;}if(typeof object!=="object"||typeof otherObject!=="object"){return false;}return fields.every(field=>object[field]===otherObject[field]);};}const id=value=>value;function isUniqueBy(array){let itemSelector=arguments.length>1&&arguments[1]!==undefined?arguments[1]:id;let prevItem;let currItem;for(let i=0;i<array.length;i++){if(i===0){prevItem=itemSelector(array[i]);continue;}currItem=itemSelector(array[i]);if(prevItem!==currItem){return false;}prevItem=currItem;}return true;}function combineSelections(selections){return values__default.default(selections.reduce((output,_ref255,index)=>{let[id,fields]=_ref255;const key=sortBy__default.default(fields.join(","),identity__default.default).join(".");if(!output[key]){output[key]={fields,ids:[],map:[]};}const idx=output[key].ids.length;output[key].ids[idx]=id;output[key].map[idx]=index;return output;},{}));}function stringifyId(id){return JSON.stringify(id);}const maybeEscape=fieldName=>fieldNeedsEscape(fieldName)?'"'.concat(fieldName,'": @').concat(escapeField(fieldName)):fieldName;function toSubQuery(_ref256){let{ids,fields}=_ref256;const allFields=[...INCLUDE_FIELDS_QUERY,...fields];return"*[_id in [".concat(ids.map(stringifyId).join(","),"]][0...").concat(ids.length,"]{").concat(allFields.map(maybeEscape).join(","),"}");}function toQuery(combinedSelections){return"[".concat(combinedSelections.map(toSubQuery).join(","),"][0...").concat(combinedSelections.length,"]");}function reassemble(queryResult,combinedSelections){return queryResult.reduce((reprojected,subResult,index)=>{const map=combinedSelections[index].map;map.forEach((resultIdx,i)=>{const id=combinedSelections[index].ids[i];const found=subResult.find(doc=>doc._id===id);reprojected[resultIdx]=found||null;});return reprojected;},[]);}function create_preview_observeFields(context){const{observePaths,versionedClient}=context;let _globalListener;const getGlobalEvents=()=>{if(!_globalListener){const allEvents$=rxjs.from(versionedClient.listen('*[!(_id in path("_.**"))]',{},{events:["welcome","mutation"],includeResult:false,visibility:"query",tag:"preview.global"})).pipe(operators.share());const welcome$=allEvents$.pipe(operators.filter(event=>event.type==="welcome"),operators.shareReplay({refCount:true,bufferSize:1}));welcome$.subscribe();const mutations$=allEvents$.pipe(operators.filter(event=>event.type==="mutation"));_globalListener={welcome$,mutations$};}return _globalListener;};function listen(id){const globalEvents=getGlobalEvents();return rxjs.merge(globalEvents.welcome$,globalEvents.mutations$.pipe(operators.filter(event=>event.documentId===id)));}function fetchAllDocumentPathsWith(client){return function fetchAllDocumentPath(selections){const combinedSelections=combineSelections(selections);return client.observable.fetch(toQuery(combinedSelections),{},{tag:"preview.document-paths"}).pipe(operators.map(result=>reassemble(result,combinedSelections)));};}const fetchDocumentPathsFast=debounceCollect(fetchAllDocumentPathsWith(versionedClient),100);const fetchDocumentPathsSlow=debounceCollect(fetchAllDocumentPathsWith(versionedClient),1e3);function currentDatasetListenFields(id,fields){return listen(id).pipe(operators.switchMap(event=>{if(event.type==="welcome"||event.visibility==="query"){return fetchDocumentPathsFast(id,fields).pipe(operators.mergeMap(result=>{return rxjs.concat(rxjs.of(result),result===void 0?// just been created and is not yet indexed. We therefore need to wait a bit
// and then re-fetch.
fetchDocumentPathsSlow(id,fields):[]);}));}return fetchDocumentPathsSlow(id,fields);}));}const CACHE={};const getBatchFetcherForDataset=memoize__default.default(function getBatchFetcherForDataset2(apiConfig){const client=versionedClient.withConfig(apiConfig);const fetchAll=fetchAllDocumentPathsWith(client);return debounceCollect(fetchAll,10);},apiConfig=>apiConfig.dataset+apiConfig.projectId);const CROSS_DATASET_PREVIEW_POLL_INTERVAL=1e4;const visiblePoll$=rxjs.fromEvent(document,"visibilitychange").pipe(operators.startWith(0),operators.map(()=>document.visibilityState==="visible"),operators.switchMap(visible=>visible?rxjs.timer(0,CROSS_DATASET_PREVIEW_POLL_INTERVAL):rxjs.EMPTY),operators.share());function crossDatasetListenFields(id,fields,apiConfig){return visiblePoll$.pipe(operators.startWith(0)).pipe(operators.switchMap(()=>{const batchFetcher=getBatchFetcherForDataset(apiConfig);return batchFetcher(id,fields);}));}function createCachedFieldObserver(id,fields,apiConfig){let latest=null;const changes$=rxjs.merge(rxjs.defer(()=>latest===null?rxjs.EMPTY:rxjs.of(latest)),apiConfig?crossDatasetListenFields(id,fields,apiConfig):currentDatasetListenFields(id,fields)).pipe(operators.tap(v=>latest=v),operators.shareReplay({refCount:true,bufferSize:1}));return{id,fields,changes$};}function cachedObserveFields(id,fields,apiConfig){const cacheKey=apiConfig?"".concat(apiConfig.projectId,":").concat(apiConfig.dataset,":").concat(id):"$current$-".concat(id);if(!(cacheKey in CACHE)){CACHE[cacheKey]=[];}const existingObservers=CACHE[cacheKey];const missingFields=difference__default.default(fields,flatten__default.default(existingObservers.map(cachedFieldObserver=>cachedFieldObserver.fields)));if(missingFields.length>0){existingObservers.push(createCachedFieldObserver(id,fields,apiConfig));}const cachedFieldObservers=existingObservers.filter(observer=>observer.fields.some(fieldName=>fields.includes(fieldName))).map(cached=>cached.changes$);return rxjs.combineLatest(cachedFieldObservers).pipe(// in the event that a document gets deleted, the cached values will be updated to store `undefined`
// if this happens, we should not pick any fields from it, but rather just return null
operators.map(snapshots=>snapshots.filter(Boolean)),// make sure all snapshots agree on same revision
operators.filter(snapshots=>isUniqueBy(snapshots,snapshot=>snapshot._rev)),// pass on value with the requested fields (or null if value is deleted)
operators.map(snapshots=>snapshots.length===0?null:pickFrom(snapshots,fields)),// emit values only if changed
operators.distinctUntilChanged(hasEqualFields(fields)));}return{observeFields:cachedObserveFields};function pickFrom(objects,fields){return[...INCLUDE_FIELDS,...fields].reduce((result,fieldName)=>{const value=getFirstFieldValue(objects,fieldName);if(value!==void 0){result[fieldName]=value;}return result;},{});}function getFirstFieldValue(objects,fieldName){let value;objects.some(object=>{if(fieldName in object){value=object[fieldName];return true;}return false;});return value;}}function createDocumentPreviewStore(_ref257){let{client}=_ref257;const versionedClient=client.withConfig({apiVersion:"1"});const __proxy_observePaths=(value,paths,apiConfig)=>{return observePaths(value,paths,apiConfig);};const{observeFields}=create_preview_observeFields({observePaths:__proxy_observePaths,versionedClient});const{observePaths}=createPathObserver({observeFields});function observeDocumentTypeFromId(id,apiConfig){return observePaths({_type:"reference",_ref:id},["_type"],apiConfig).pipe(operators.map(res=>isRecord$4(res)&&typeof res._type==="string"?res._type:void 0),operators.distinctUntilChanged());}const observeForPreview=createPreviewObserver({observeDocumentTypeFromId,observePaths});const{observeDocumentPairAvailability}=create_preview_availability(versionedClient,observePaths);const{observePathsDocumentPair}=create_preview_documentPair(versionedClient,observePaths);return{observePaths,observeForPreview,observeDocumentTypeFromId,// eslint-disable-next-line camelcase
unstable_observeDocumentPairAvailability:observeDocumentPairAvailability,unstable_observePathsDocumentPair:observePathsDocumentPair};}const isLiveEditEnabled$1=schemaType=>schemaType.liveEdit===true;function getPreviewStateObservable(documentPreviewStore,schemaType,documentId,title){const draft$=isLiveEditEnabled$1(schemaType)?rxjs.of({snapshot:null}):documentPreviewStore.observeForPreview({_type:"reference",_ref:getDraftId(documentId)},schemaType);const published$=documentPreviewStore.observeForPreview({_type:"reference",_ref:getPublishedId(documentId)},schemaType);return rxjs.combineLatest([draft$,published$]).pipe(operators.map(_ref258=>{let[draft,published]=_ref258;return{draft:draft.snapshot?{title,...(draft.snapshot||{})}:null,isLoading:false,published:published.snapshot?{title,...(published.snapshot||{})}:null};}),operators.startWith({draft:null,isLoading:true,published:null}));}const getMissingDocumentFallback=item=>({title:/* @__PURE__ */jsxRuntime.jsx("em",{children:item.title?String(item.title):"Missing document"}),subtitle:/* @__PURE__ */jsxRuntime.jsx("em",{children:item.title?"Missing document ID: ".concat(item._id):"Document ID: ".concat(item._id)}),media:()=>/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})});const getPreviewValueWithFallback=_ref259=>{let{value,draft,published}=_ref259;const snapshot=draft||published;if(!snapshot){return getMissingDocumentFallback(value);}return assignWith__default.default({},snapshot,value,(objValue,srcValue)=>{return typeof srcValue==="undefined"?objValue:srcValue;});};const useUserViaUserStore=createHookFromObservableFactory(_ref260=>{let[userStore,userId]=_ref260;return rxjs.from(userStore.getUser(userId).catch(err=>{console.error(err);return null;}));});function useUser(userId){const userStore=useUserStore();return useUserViaUserStore(React.useMemo(()=>[userStore,userId],[userId,userStore]));}function useCurrentUser(){const{currentUser}=useSource();return currentUser;}const getUpdatedSnapshot=bufferedDocument=>{const LOCAL=bufferedDocument.LOCAL;const HEAD=bufferedDocument.document.HEAD;if(!LOCAL){return LOCAL;}return{...LOCAL,_type:(HEAD||LOCAL)._type,_rev:(HEAD||LOCAL)._rev,_updatedAt:(/* @__PURE__ */new Date()).toISOString()};};const toSnapshotEvent=document=>({type:"snapshot",document});const getDocument=event=>event.document;const createObservableBufferedDocument=listenerEvent$=>{const actions$=new rxjs.Subject();const consistency$=new rxjs.BehaviorSubject(true);const mutations$=new rxjs.Subject();const rebase$=new rxjs.Subject();const remoteMutations=new rxjs.Subject();const commitRequests=new rxjs.Subject();const createInitialBufferedDocument=initialSnapshot=>{const bufferedDocument=new mutator.BufferedDocument(initialSnapshot);bufferedDocument.onMutation=_ref261=>{let{mutation,remote}=_ref261;mutations$.next({type:"mutation",document:getUpdatedSnapshot(bufferedDocument),mutations:mutation.mutations,origin:remote?"remote":"local"});};bufferedDocument.onRemoteMutation=mutation=>{remoteMutations.next({type:"remoteMutation",head:bufferedDocument.document.HEAD,transactionId:mutation.transactionId,timestamp:mutation.timestamp,author:mutation.identity,effects:mutation.effects});};bufferedDocument.onRebase=(edge,nextRemoteMutations,localMutations)=>{rebase$.next({type:"rebase",document:edge,remoteMutations:nextRemoteMutations,localMutations});};bufferedDocument.onConsistencyChanged=isConsistent=>{consistency$.next(isConsistent);};bufferedDocument.commitHandler=commitArg=>commitRequests.next(commitArg);return bufferedDocument;};const currentBufferedDocument$=listenerEvent$.pipe(operators.scan((bufferedDocument,listenerEvent)=>{if(listenerEvent.type==="snapshot"){if(bufferedDocument){bufferedDocument.commit();}return createInitialBufferedDocument(listenerEvent.document||null);}if(bufferedDocument===null){console.warn('Ignoring event of type "%s" since buffered document has not yet been set up with snapshot',listenerEvent.type);return null;}return bufferedDocument;},null),operators.filter(bufferedDocument=>bufferedDocument!==null),operators.distinctUntilChanged(),operators.publishReplay(1),operators.refCount());const snapshotAfterSync$=listenerEvent$.pipe(operators.filter(ev=>ev.type==="mutation"),operators.withLatestFrom(currentBufferedDocument$),operators.map(_ref262=>{let[mutationEvent,bufferedDocument]=_ref262;bufferedDocument.arrive(new mutator.Mutation(mutationEvent));return getUpdatedSnapshot(bufferedDocument);}));const actionHandler$=actions$.pipe(operators.withLatestFrom(currentBufferedDocument$),operators.tap(_ref263=>{let[action,bufferedDocument]=_ref263;if(action.type==="mutation"){bufferedDocument.add(new mutator.Mutation({mutations:action.mutations}));}if(action.type==="commit"){bufferedDocument.commit();}}),// We subscribe to this only for the side effects
operators.mergeMapTo(rxjs.EMPTY),operators.share());const emitAction=action=>actions$.next(action);const addMutations=mutations=>emitAction({type:"mutation",mutations});const addMutation=mutation=>addMutations([mutation]);const commit=()=>{currentBufferedDocument$.pipe(operators.take(1),operators.tap(bufferedDocument=>bufferedDocument.commit())).subscribe();};const snapshot$=rxjs.merge(currentBufferedDocument$.pipe(operators.map(bufferedDocument=>bufferedDocument.LOCAL)),mutations$.pipe(operators.map(getDocument)),rebase$.pipe(operators.map(getDocument)),snapshotAfterSync$).pipe(operators.map(toSnapshotEvent),operators.publishReplay(1),operators.refCount());const remoteSnapshot$=rxjs.merge(currentBufferedDocument$.pipe(operators.map(bufferedDocument=>bufferedDocument.document.HEAD),operators.map(toSnapshotEvent)),remoteMutations).pipe(operators.publishReplay(1),operators.refCount());return{updates$:rxjs.merge(snapshot$,actionHandler$,mutations$,rebase$),consistency$:consistency$.pipe(operators.distinctUntilChanged(),operators.publishReplay(1),operators.refCount()),remoteSnapshot$,commitRequest$:commitRequests,addMutation,addMutations,commit};};const prepare=id=>document=>{const{_id,_rev,_updatedAt,...rest}=document;return{_id:id,...rest};};const createBufferedDocument=(documentId,listenerEvent$)=>{const bufferedDocument=createObservableBufferedDocument(listenerEvent$);const prepareDoc=prepare(documentId);const DELETE={delete:{id:documentId}};return{events:bufferedDocument.updates$,consistency$:bufferedDocument.consistency$,remoteSnapshot$:bufferedDocument.remoteSnapshot$,commitRequest$:bufferedDocument.commitRequest$,patch:patches=>patches.map(patch=>({patch:{...patch,id:documentId}})),create:document=>({create:prepareDoc(document)}),createIfNotExists:document=>({createIfNotExists:prepareDoc(document)}),createOrReplace:document=>({createOrReplace:prepareDoc(document)}),delete:()=>DELETE,mutate:mutations=>bufferedDocument.addMutations(mutations),commit:()=>bufferedDocument.commit()};};const PENDING_START={type:"pending",phase:"begin"};const PENDING_END={type:"pending",phase:"end"};function isMutationEvent(msg){return msg.type==="mutation";}function isMultiTransactionEvent(msg){return msg.transactionTotalEvents>1;}function allPendingTransactionEventsReceived(listenerEvents){const groupedMutations=groupBy__default.default(listenerEvents.filter(ev=>ev.type==="mutation"),e=>e.transactionId);return Object.values(groupedMutations).every(mutations=>mutations.length===mutations[0].transactionTotalEvents);}function getPairListener(client,idPair){let options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};const{publishedId,draftId}=idPair;return rxjs.defer(()=>client.observable.listen("*[_id == $publishedId || _id == $draftId]",{publishedId,draftId},{includeResult:false,events:["welcome","mutation","reconnect"],effectFormat:"mendoza",tag:options.tag||"document.pair-listener"})).pipe(operators.concatMap(event=>event.type==="welcome"?fetchInitialDocumentSnapshots().pipe(operators.concatMap(snapshots=>[createSnapshotEvent(draftId,snapshots.draft),createSnapshotEvent(publishedId,snapshots.published)])):rxjs.of(event)),operators.scan((acc,msg)=>{if(!isMutationEvent(msg)){return{next:[msg],buffer:[]};}const isBuffering=acc.buffer.length>0;const isMulti=isMultiTransactionEvent(msg);if(!isMulti&&!isBuffering){return{next:[msg],buffer:[]};}if(!isMulti){return{next:[],buffer:acc.buffer.concat(msg)};}const nextBuffer=acc.buffer.concat(msg);if(allPendingTransactionEventsReceived(nextBuffer)){return{next:nextBuffer.concat(PENDING_END),buffer:[]};}return{next:nextBuffer.length===1?[PENDING_START]:[],buffer:nextBuffer};},{next:[],buffer:[]}),// note: this flattens the array, and in the case of an empty array, no event will be pushed downstream
operators.mergeMap(v=>v.next));function fetchInitialDocumentSnapshots(){return client.observable.getDocuments([draftId,publishedId],{tag:"document.snapshots"}).pipe(operators.map(_ref264=>{let[draft,published]=_ref264;return{draft,published};}));}}function createSnapshotEvent(documentId,document){return{type:"snapshot",documentId,document};}const isMutationEventForDocId=id=>event=>{return event.type!=="reconnect"&&event.type!=="pending"&&event.documentId===id;};function setVersion(version){return ev=>({...ev,version});}function commitMutations(client,mutationParams){const{resultRev,...mutation}=mutationParams;return client.dataRequest("mutate",mutation,{visibility:"async",returnDocuments:false,tag:"document.commit",// This makes sure the studio doesn't crash when a draft is crated
// because someone deleted a referenced document in the target dataset
skipCrossDatasetReferenceValidation:true});}function submitCommitRequest(client,request){return rxjs.from(commitMutations(client,request.mutation.params)).pipe(operators.tap({error:error=>{const isBadRequest="statusCode"in error&&typeof error.statusCode==="number"&&error.statusCode>=400&&error.statusCode<=500;if(isBadRequest){request.cancel(error);}else{request.failure(error);}},next:()=>request.success()}));}function checkoutPair(client,idPair){const{publishedId,draftId}=idPair;const listenerEvents$=getPairListener(client,idPair).pipe(operators.share());const reconnect$=listenerEvents$.pipe(operators.filter(ev=>ev.type==="reconnect"));const draft=createBufferedDocument(draftId,listenerEvents$.pipe(operators.filter(isMutationEventForDocId(draftId))));const published=createBufferedDocument(publishedId,listenerEvents$.pipe(operators.filter(isMutationEventForDocId(publishedId))));const transactionsPendingEvents$=listenerEvents$.pipe(operators.filter(ev=>ev.type==="pending"));const commits$=rxjs.merge(draft.commitRequest$,published.commitRequest$).pipe(operators.mergeMap(commitRequest=>submitCommitRequest(client,commitRequest)),operators.mergeMapTo(rxjs.EMPTY),operators.share());return{transactionsPendingEvents$,draft:{...draft,events:rxjs.merge(commits$,reconnect$,draft.events).pipe(operators.map(setVersion("draft"))),consistency$:draft.consistency$,remoteSnapshot$:draft.remoteSnapshot$.pipe(operators.map(setVersion("draft")))},published:{...published,events:rxjs.merge(commits$,reconnect$,published.events).pipe(operators.map(setVersion("published"))),consistency$:published.consistency$,remoteSnapshot$:published.remoteSnapshot$.pipe(operators.map(setVersion("published")))}};}function memoize(fn,keyGen){const MEMO=/* @__PURE__ */Object.create(null);return function(){const key=keyGen(...arguments);if(!(key in MEMO)){MEMO[key]=fn(...arguments);}return MEMO[key];};}function memoizeKeyGen(client,idPair,typeName){var _a,_b;const config=client.config();return"".concat((_a=config.dataset)!=null?_a:"","-").concat((_b=config.projectId)!=null?_b:"","-").concat(idPair.publishedId,"-").concat(typeName);}const memoizedPair=memoize((client,idPair,_typeName)=>{return new rxjs.Observable(subscriber=>{subscriber.next(checkoutPair(client,idPair));}).pipe(operators.publishReplay(1),operators.refCount());},memoizeKeyGen);function isSnapshotEvent(event){return event.type==="snapshot";}function withSnapshots(pair){return{snapshots$:pair.events.pipe(operators.filter(isSnapshotEvent),operators.map(event=>event.document),operators.publishReplay(1),operators.refCount()),patch:pair.patch,create:pair.create,createIfNotExists:pair.createIfNotExists,createOrReplace:pair.createOrReplace,delete:pair.delete,mutate:pair.mutate,commit:pair.commit};}const snapshotPair=memoize((client,idPair,typeName)=>{return memoizedPair(client,idPair,typeName).pipe(operators.map(_ref265=>{let{published,draft,transactionsPendingEvents$}=_ref265;return{transactionsPendingEvents$,published:withSnapshots(published),draft:withSnapshots(draft)};}),operators.publishReplay(1),operators.refCount());},(client,idPair,typeName)=>{var _a,_b;const config=client.config();return"".concat((_a=config.dataset)!=null?_a:"","-").concat((_b=config.projectId)!=null?_b:"","-").concat(idPair.publishedId,"-").concat(typeName);});const isLiveEditEnabled=(schema,typeName)=>{var _a;return((_a=schema.get(typeName))==null?void 0:_a.liveEdit)===true;};const LOCKED={enabled:true};const NOT_LOCKED={enabled:false};const editState=memoize((ctx,idPair,typeName)=>{const liveEdit=isLiveEditEnabled(ctx.schema,typeName);return snapshotPair(ctx.client,idPair,typeName).pipe(operators.switchMap(versions=>rxjs.combineLatest([versions.draft.snapshots$,versions.published.snapshots$,versions.transactionsPendingEvents$.pipe(operators.map(ev=>ev.phase==="begin"?LOCKED:NOT_LOCKED),operators.startWith(NOT_LOCKED))])),operators.map(_ref266=>{let[draftSnapshot,publishedSnapshot,transactionSyncLock]=_ref266;return{id:idPair.publishedId,type:typeName,draft:draftSnapshot,published:publishedSnapshot,liveEdit,ready:true,transactionSyncLock};}),operators.startWith({id:idPair.publishedId,type:typeName,draft:null,published:null,liveEdit,ready:false,transactionSyncLock:null}),operators.publishReplay(1),operators.refCount());},(ctx,idPair,typeName)=>memoizeKeyGen(ctx.client,idPair,typeName));const consistencyStatus=memoize((client,idPair,typeName)=>{return memoizedPair(client,idPair,typeName).pipe(operators.switchMap(_ref267=>{let{draft,published}=_ref267;return rxjs.combineLatest([draft.consistency$,published.consistency$]);}),operators.map(_ref268=>{let[draftIsConsistent,publishedIsConsistent]=_ref268;return draftIsConsistent&&publishedIsConsistent;}),operators.distinctUntilChanged(),operators.publishReplay(1),operators.refCount());},(client,idPair,typeName)=>{var _a,_b;const config=client.config();return"".concat((_a=config.dataset)!=null?_a:"","-").concat((_b=config.projectId)!=null?_b:"","-").concat(idPair.publishedId,"-").concat(typeName);});const operationArgs=memoize((ctx,idPair,typeName)=>{return snapshotPair(ctx.client,idPair,typeName).pipe(operators.switchMap(versions=>rxjs.combineLatest([versions.draft.snapshots$,versions.published.snapshots$]).pipe(operators.map(_ref269=>{let[draft,published]=_ref269;return{...ctx,idPair,typeName,snapshots:{draft,published},draft:versions.draft,published:versions.published};}))),operators.publishReplay(1),operators.refCount());},(ctx,idPair,typeName)=>{var _a,_b;const config=ctx.client.config();return"".concat((_a=config.dataset)!=null?_a:"","-").concat((_b=config.projectId)!=null?_b:"","-").concat(idPair.publishedId,"-").concat(typeName);});const commit={disabled:()=>false,execute:_ref270=>{let{draft,published}=_ref270;draft.commit();published.commit();return rxjs.EMPTY;}};const del={disabled:_ref271=>{let{snapshots}=_ref271;return snapshots.draft||snapshots.published?false:"NOTHING_TO_DELETE";},execute:_ref272=>{let{client,schema,idPair,typeName}=_ref272;const tx=client.observable.transaction().delete(idPair.publishedId);if(isLiveEditEnabled(schema,typeName)){return tx.commit({tag:"document.delete"});}return tx.delete(idPair.draftId).commit({tag:"document.delete",// this disables referential integrity for cross-dataset references. we
// have this set because we warn against deletes in the `ConfirmDeleteDialog`
// UI. This operation is run when "delete anyway" is clicked
skipCrossDatasetReferenceValidation:true});}};const discardChanges={disabled:_ref273=>{let{snapshots}=_ref273;if(!snapshots.draft){return"NO_CHANGES";}if(!snapshots.published){return"NOT_PUBLISHED";}return false;},execute:_ref274=>{let{client,idPair}=_ref274;return client.observable.transaction().delete(idPair.draftId).commit({tag:"document.discard-changes"});}};const omitProps=["_createdAt","_updatedAt"];const duplicate={disabled:_ref275=>{let{snapshots}=_ref275;return snapshots.published||snapshots.draft?false:"NOTHING_TO_DUPLICATE";},execute:(_ref276,dupeId)=>{let{schema,client,snapshots,typeName}=_ref276;const source=snapshots.draft||snapshots.published;if(!source){throw new Error("cannot execute on empty document");}return client.observable.create({...omit__default.default(source,omitProps),_id:isLiveEditEnabled(schema,typeName)?dupeId:getDraftId(dupeId),_type:source._type},{tag:"document.duplicate"});}};const patch={disabled:()=>false,execute:function(_ref277){let{schema,snapshots,idPair,draft,published,typeName}=_ref277;let patches=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];let initialDocument=arguments.length>2?arguments[2]:undefined;if(isLiveEditEnabled(schema,typeName)){published.mutate([published.createIfNotExists({_type:typeName,...initialDocument}),...published.patch(patches)]);}else{draft.mutate([draft.createIfNotExists({...initialDocument,...snapshots.published,_id:idPair.draftId,_type:typeName}),...draft.patch(patches)]);}}};function strengthenOnPublish(obj){if(types.isReference(obj)){if(obj._strengthenOnPublish){return omit__default.default(obj,["_strengthenOnPublish"].concat(obj._strengthenOnPublish.weak?[]:["_weak"]));}return obj;}if(typeof obj!=="object"||!obj)return obj;if(Array.isArray(obj))return obj.map(strengthenOnPublish);return Object.fromEntries(Object.entries(obj).map(_ref278=>{let[key,value]=_ref278;return[key,strengthenOnPublish(value)];}));}const publish={disabled:_ref279=>{let{schema,typeName,snapshots}=_ref279;if(isLiveEditEnabled(schema,typeName)){return"LIVE_EDIT_ENABLED";}if(!snapshots.draft){return snapshots.published?"ALREADY_PUBLISHED":"NO_CHANGES";}return false;},execute:_ref280=>{let{client,idPair,snapshots}=_ref280;if(!snapshots.draft){throw new Error('cannot execute "publish" when draft is missing');}const value=strengthenOnPublish(omit__default.default(snapshots.draft,"_updatedAt"));const tx=client.observable.transaction();if(!snapshots.draft){throw new Error('cannot execute "publish" when draft is missing');}if(snapshots.published){tx.patch(idPair.publishedId,{// Hack until other mutations support revision locking
unset:["_revision_lock_pseudo_field_"],ifRevisionID:snapshots.published._rev});tx.createOrReplace({...value,_id:idPair.publishedId,_type:snapshots.draft._type});}else{tx.create({...value,_id:idPair.publishedId,_type:snapshots.draft._type});}tx.delete(idPair.draftId);return tx.commit({tag:"document.publish",visibility:"async"});}};const restore$1={disabled:()=>false,execute:(_ref281,fromRevision)=>{let{historyStore,schema,idPair,typeName}=_ref281;const targetId=isLiveEditEnabled(schema,typeName)?idPair.publishedId:idPair.draftId;return historyStore.restore(idPair.publishedId,targetId,fromRevision);}};const unpublish={disabled:_ref282=>{let{schema,snapshots,typeName}=_ref282;if(isLiveEditEnabled(schema,typeName)){return"LIVE_EDIT_ENABLED";}return snapshots.published?false:"NOT_PUBLISHED";},execute:_ref283=>{let{client,idPair,snapshots}=_ref283;let tx=client.observable.transaction().delete(idPair.publishedId);if(snapshots.published){tx=tx.createIfNotExists({...omit__default.default(snapshots.published,"_updatedAt"),_id:idPair.draftId,_type:snapshots.published._type});}return tx.commit({tag:"document.unpublish",visibility:"async",// this disables referential integrity for cross-dataset references. we
// have this set because we warn against unpublishes in the `ConfirmDeleteDialog`
// UI. This operation is run when "unpublish anyway" is clicked
skipCrossDatasetReferenceValidation:true});}};function maybeObservable(v){return typeof v==="undefined"?rxjs.of(null):v;}const operationImpls={del,delete:del,publish,patch,commit,discardChanges,unpublish,duplicate,restore:restore$1};const execute=(operationName,operationArguments,extraArgs)=>{const operation=operationImpls[operationName];return rxjs.defer(()=>rxjs.merge(rxjs.of(null),maybeObservable(operation.execute(operationArguments,...extraArgs)))).pipe(operators.last());};const operationCalls$=new rxjs.Subject();function emitOperation(operationName,idPair,typeName,extraArgs){operationCalls$.next({operationName,idPair,typeName,extraArgs});}const REQUIRES_CONSISTENCY=["publish","unpublish","discardChanges","delete"];const operationEvents=memoize(ctx=>{const result$=operationCalls$.pipe(operators.groupBy(op=>op.idPair.publishedId),operators.mergeMap(groups$=>groups$.pipe(// although it might look like a bug, dropping pending async operations here is actually a feature
// E.g. if the user types `publish` which is async and then starts patching (sync) then the publish
// should be cancelled
operators.switchMap(args=>operationArgs(ctx,args.idPair,args.typeName).pipe(operators.take(1),operators.switchMap(operationArguments=>{const requiresConsistency=REQUIRES_CONSISTENCY.includes(args.operationName);if(requiresConsistency){operationArguments.published.commit();operationArguments.draft.commit();}const isConsistent$=consistencyStatus(ctx.client,args.idPair,args.typeName).pipe(operators.filter(Boolean));const ready$=requiresConsistency?isConsistent$.pipe(operators.take(1)):rxjs.of(true);return ready$.pipe(operators.switchMap(()=>execute(args.operationName,operationArguments,args.extraArgs)));}),operators.map(()=>({type:"success",args})),operators.catchError(err=>rxjs.of({type:"error",args,error:err})))))),operators.share());const AUTOCOMMIT_INTERVAL=1e3;const autoCommit$=result$.pipe(operators.filter(result=>result.type==="success"&&result.args.operationName==="patch"),operators.throttleTime(AUTOCOMMIT_INTERVAL,rxjs.asyncScheduler,{leading:true,trailing:true}),operators.tap(result=>{emitOperation("commit",result.args.idPair,result.args.typeName,[]);}));return rxjs.merge(result$,autoCommit$.pipe(operators.mergeMapTo(rxjs.EMPTY)));},ctx=>{var _a,_b;const config=ctx.client.config();return"".concat((_a=config.dataset)!=null?_a:"","-").concat((_b=config.projectId)!=null?_b:"");});const INITIAL_VALIDATION_STATUS={isValidating:true,validation:[]};function findReferenceIds(obj){return jsonReduce.reduce(obj,(acc,node)=>{if(types.isReference(node)){acc.add(node._ref);}return acc;},/* @__PURE__ */new Set());}const EMPTY_VALIDATION=[];const listenDocumentExists=(observeDocumentAvailability,id)=>observeDocumentAvailability(id).pipe(operators.map(_ref284=>{let{published}=_ref284;return published.available;}));const DOC_UPDATE_DELAY=200;const REF_UPDATE_DELAY=1e3;function shareLatestWithRefCount(){return operators.shareReplay({bufferSize:1,refCount:true});}const validation=memoize((ctx,_ref285,typeName)=>{let{draftId,publishedId}=_ref285;const document$=editState(ctx,{draftId,publishedId},typeName).pipe(operators.map(_ref286=>{let{draft,published}=_ref286;return draft||published;}),operators.throttleTime(DOC_UPDATE_DELAY,rxjs.asyncScheduler,{trailing:true}),operators.distinctUntilChanged((prev,next)=>{if((prev==null?void 0:prev._rev)===(next==null?void 0:next._rev)){return true;}return shallowEquals__default.default(omit__default.default(prev,"_rev","_updatedAt"),omit__default.default(next,"_rev","_updatedAt"));}),shareLatestWithRefCount());const referenceIds$=document$.pipe(operators.map(document=>findReferenceIds(document)),operators.mergeMap(ids=>rxjs.from(ids)));const referenceExistence$=referenceIds$.pipe(operators.groupBy(id=>id,{duration:()=>rxjs.timer(1e3*60*30)}),operators.mergeMap(id$=>id$.pipe(operators.distinct(),operators.mergeMap(id=>listenDocumentExists(ctx.observeDocumentPairAvailability,id).pipe(operators.map(// eslint-disable-next-line max-nested-callbacks
result=>[id,result]))))),operators.scan((acc,_ref287)=>{let[id,result]=_ref287;if(acc[id]===result){return acc;}return{...acc,[id]:result};},{}),operators.distinctUntilChanged(shallowEquals__default.default),shareLatestWithRefCount());const getDocumentExists=_ref288=>{let{id}=_ref288;return rxjs.lastValueFrom(referenceExistence$.pipe(// If the id is not present as key in the `referenceExistence` map it means it's existence status
// isn't yet loaded, so we want to wait until it is
operators.first(referenceExistence=>id in referenceExistence),operators.map(referenceExistence=>referenceExistence[id])));};const referenceDocumentUpdates$=referenceExistence$.pipe(// we'll skip the first emission since the document already gets an initial validation pass
// we're only interested in updates in referenced documents after that
operators.skip(1),operators.throttleTime(REF_UPDATE_DELAY,rxjs.asyncScheduler,{leading:true,trailing:true}));return rxjs.combineLatest([document$,rxjs.concat(rxjs.of(null),referenceDocumentUpdates$)]).pipe(operators.map(_ref289=>{let[document]=_ref289;return document;}),rxjsExhaustmapWithTrailing.exhaustMapWithTrailing(document=>{return rxjs.defer(()=>{if(!(document==null?void 0:document._type)){return rxjs.of({validation:EMPTY_VALIDATION,isValidating:false});}return rxjs.concat(rxjs.of({isValidating:true,revision:document._rev}),validateDocumentObservable({document,getClient:ctx.getClient,getDocumentExists,i18n:ctx.i18n,schema:ctx.schema,environment:"studio"}).pipe(operators.map(validationMarkers=>({validation:validationMarkers,isValidating:false}))));});}),operators.scan((acc,next)=>({...acc,...next}),INITIAL_VALIDATION_STATUS),shareLatestWithRefCount());},(ctx,idPair,typeName)=>{var _a,_b;const config=ctx.client.config();return"".concat((_a=config.dataset)!=null?_a:"","-").concat((_b=config.projectId)!=null?_b:"","-").concat(idPair.publishedId,"-").concat(typeName);});const documentEvents=memoize((client,idPair,typeName)=>{return memoizedPair(client,idPair,typeName).pipe(operators.switchMap(_ref290=>{let{draft,published}=_ref290;return rxjs.merge(draft.events,published.events);}));},memoizeKeyGen);function createOperationGuard(opName){return{disabled:"NOT_READY",execute:()=>{throw new Error("Called ".concat(opName," before it was ready."));}};}const GUARDED={commit:createOperationGuard("commit"),delete:createOperationGuard("delete"),del:createOperationGuard("del"),publish:createOperationGuard("publish"),patch:createOperationGuard("patch"),discardChanges:createOperationGuard("discardChanges"),unpublish:createOperationGuard("unpublish"),duplicate:createOperationGuard("duplicate"),restore:createOperationGuard("restore")};const createEmitter=(operationName,idPair,typeName)=>function(){for(var _len6=arguments.length,executeArgs=new Array(_len6),_key7=0;_key7<_len6;_key7++){executeArgs[_key7]=arguments[_key7];}return emitOperation(operationName,idPair,typeName,executeArgs);};function wrap(opName,op,operationArgs){const disabled=op.disabled(operationArgs);return{disabled,execute:createEmitter(opName,operationArgs.idPair,operationArgs.typeName)};}function createOperationsAPI(args){return{commit:wrap("commit",commit,args),delete:wrap("delete",del,args),del:wrap("delete",del,args),publish:wrap("publish",publish,args),patch:wrap("patch",patch,args),discardChanges:wrap("discardChanges",discardChanges,args),unpublish:wrap("unpublish",unpublish,args),duplicate:wrap("duplicate",duplicate,args),restore:wrap("restore",restore$1,args)};}const editOperations=memoize((ctx,idPair,typeName)=>{const operationEvents$=operationEvents(ctx);const operationArgs$=operationArgs(ctx,idPair,typeName);const operations$=operationArgs$.pipe(operators.map(createOperationsAPI));return rxjs.concat(rxjs.of(GUARDED),rxjs.merge(operationEvents$.pipe(operators.mergeMap(()=>rxjs.EMPTY)),operations$)).pipe(operators.shareReplay({refCount:true,bufferSize:1}));},(ctx,idPair,typeName)=>memoizeKeyGen(ctx.client,idPair,typeName));function isRecord(value){return isPlainObject__default.default(value);}function deepAssign(target,source){const result={...target,...source};Object.keys(result).forEach(key=>{const sourceVal=source[key];const targetVal=target[key];if(isRecord(sourceVal)&&isRecord(targetVal)){result[key]=deepAssign(targetVal,sourceVal);}});return result;}const ALLOWED_REF_PROPS=["_key","_ref","_weak","_type"];const REQUIRED_TEMPLATE_PROPS=["id","title","schemaType","value"];function templateId(template,i){return quote(template.id||template.title)||typeof i==="number"&&"at index ".concat(i)||"";}function quote(str){return str&&str.length>0?'"'.concat(str,'"'):str;}function validateTemplates(schema,templates){const idMap=/* @__PURE__ */new Map();templates.forEach((template,i)=>{const id=templateId(template,i);if(typeof template.values!=="undefined"&&!template.value){throw new Error("Template ".concat(id,' is missing "value" property, but contained "values". Typo?'));}const missing=REQUIRED_TEMPLATE_PROPS.filter(prop=>!template[prop]);if(missing.length>0){throw new Error("Template ".concat(id," is missing required properties: ").concat(missing.join(", ")));}if(typeof template.value!=="function"&&!isRecord(template.value)){throw new Error("Template ".concat(id,' has an invalid "value" property; should be a function or an object'));}if(typeof template.parameters!=="undefined"){if(Array.isArray(template.parameters)){template.parameters.forEach((param,j)=>validateParameter(schema,param,template,j));}else{throw new Error("Template ".concat(id,' has an invalid "parameters" property; must be an array'));}}if(idMap.has(template.id)){const dupeIndex=idMap.get(template.id);const dupe="".concat(quote(templates[dupeIndex].title)," at index ").concat(dupeIndex);throw new Error('Template "'.concat(template.title,'" at index ').concat(i,' has the same ID ("').concat(template.id,'") as template ').concat(dupe));}idMap.set(template.id,i);});return templates;}function validateInitialObjectValue(value,template){const contextError=msg=>'Template "'.concat(template.id,'" initial value: ').concat(msg);if(!isRecord(value)){throw new Error(contextError("resolved to a non-object"));}if(value._type&&template.schemaType!==value._type){throw new Error(contextError('includes "_type"-property ('.concat(value._type,") that does not match template (").concat(template.schemaType,")")));}try{return validateValue(value);}catch(err){err.message=contextError(err.message);throw err;}}function validateValue(value){let path=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];let parentIsArray=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(Array.isArray(value)){return value.map((item,i)=>{if(Array.isArray(item)){throw new Error('multidimensional arrays are not supported (at path "'.concat(PathUtils.toString(path),'")'));}return validateValue(item,path.concat(i),true);});}if(!isRecord(value)){return value;}const initial=parentIsArray&&!value._key?{_key:content.randomKey()}:{};if(path.length>0&&!value._type){if(value._ref){initial._type="reference";}}if(value._ref){validateReference(value,path);}return Object.keys(value).reduce((acc,key)=>{acc[key]=validateValue(value[key],path.concat([key]));return acc;},initial);}function validateParameter(schema,parameter,template,index){if(!parameter.name){throw new Error("Template ".concat(template.id," has a parameter at index ").concat(index,' that is missing its "name"-property'));}if(parameter.name==="template"){throw new Error('Template parameters cannot be named "template", see parameter #'.concat(index," for template ").concat(template.id));}if(!schema.get(parameter.type)){throw new Error('Template parameter "'.concat(parameter.name,'" has an invalid/unknown type: "').concat(parameter.type,'"'));}}function validateReference(value){let path=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(!value._type&&value.type){throw new Error('Reference is missing "_type", but has a "type" property at path "'.concat(PathUtils.toString(path),'"'));}const disallowed=Object.keys(value).filter(key=>!ALLOWED_REF_PROPS.includes(key));if(disallowed.length>0){const plural=disallowed.length>1?"properties":"property";throw new Error("Disallowed ".concat(plural," found in reference: ").concat(disallowed.map(quote).join(", "),' at path "').concat(PathUtils.toString(path),'"'));}}function isBuilder(template){return isRecord(template)&&typeof template.serialize==="function";}async function resolveValue(initialValueOpt,params,context){return typeof initialValueOpt==="function"?initialValueOpt(params,context):initialValueOpt;}async function resolveInitialValue(schema,template){let params=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};let context=arguments.length>3?arguments[3]:undefined;if(isBuilder(template)){return resolveInitialValue(schema,template.serialize(),params,context);}const{id,schemaType:schemaTypeName,value}=template;if(!value){throw new Error('Template "'.concat(id,'" has invalid "value" property'));}let resolvedValue=await resolveValue(value,params,context);if(!isRecord(resolvedValue)){throw new Error('Template "'.concat(id,'" has invalid "value" property - must be a plain object or a resolver function returning a plain object'));}if(isRecord(resolvedValue)&&!Object.keys(resolvedValue).length){resolvedValue={_type:schemaTypeName};}resolvedValue=validateInitialObjectValue(resolvedValue,template);const schemaType=schema.get(schemaTypeName);if(!schemaType){throw new Error('Could not find schema type with name "'.concat(schemaTypeName,'".'));}const newValue=deepAssign((await resolveInitialValueForType(schemaType,params,DEFAULT_MAX_RECURSION_DEPTH,context))||{},resolvedValue);return validateInitialObjectValue(newValue,template);}function getItemType(arrayType,item){const itemTypeName=content.resolveTypeName(item);return itemTypeName==="object"&&arrayType.of.length===1?arrayType.of[0]:arrayType.of.find(memberType=>memberType.name===itemTypeName);}const DEFAULT_MAX_RECURSION_DEPTH=10;function resolveInitialValueForType(type,params){let maxDepth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:DEFAULT_MAX_RECURSION_DEPTH;let context=arguments.length>3?arguments[3]:undefined;if(maxDepth<=0){return Promise.resolve(void 0);}if(types.isObjectSchemaType(type)){return resolveInitialObjectValue(type,params,maxDepth,context);}if(types.isArraySchemaType(type)){return resolveInitialArrayValue(type,params,maxDepth,context);}return resolveValue(type.initialValue,params,context);}async function resolveInitialArrayValue(type,params,maxDepth,context){const initialArray=await resolveValue(type.initialValue,void 0,context);if(!Array.isArray(initialArray)){return void 0;}return Promise.all(initialArray.map(async initialItem=>{const itemType=getItemType(type,initialItem);return types.isObjectSchemaType(itemType)?{...initialItem,...(await resolveInitialValueForType(itemType,params,maxDepth-1,context)),_key:content.randomKey()}:initialItem;}));}async function resolveInitialObjectValue(type,params,maxDepth,context){const initialObject={...((await resolveValue(type.initialValue,params,context))||{})};const fieldValues={};await Promise.all(type.fields.map(async field=>{const initialFieldValue=await resolveInitialValueForType(field.type,params,maxDepth-1,context);if(initialFieldValue!==void 0&&initialFieldValue!==null){fieldValues[field.name]=initialFieldValue;}}));const merged=deepAssign(fieldValues,initialObject);if(content.isDeepEmpty(merged)){return void 0;}if(type.name!=="object"){merged._type=type.name;}return merged;}const LOADING_MSG={type:"loading"};function getInitialValueStream(schema,initialValueTemplates,documentPreviewStore,opts,context){const draft$=documentPreviewStore.observePaths({_type:"reference",_ref:getDraftId(opts.documentId)},["_type"]);const published$=documentPreviewStore.observePaths({_type:"reference",_ref:getPublishedId(opts.documentId)},["_type"]);const value$=rxjs.merge(draft$.pipe(operators.map(draft=>({draft}))),published$.pipe(operators.map(published=>({published})))).pipe(operators.scan((prev,res)=>({...prev,...res}),{}),// Wait until we know the state of both draft and published
operators.filter(res=>"draft"in res&&"published"in res),operators.map(res=>res.draft||res.published),// Only update if we didn't previously have a document but we now do
operators.distinctUntilChanged((prev,next)=>Boolean(prev)!==Boolean(next)),// Prevent rapid re-resolving when transitioning between different templates
operators.debounceTime(25));return value$.pipe(operators.switchMap(document=>{if(document){return rxjs.of({type:"success",value:null});}if(!opts.templateName){return rxjs.of({isResolving:false,initialValue:void 0});}const template=initialValueTemplates.find(t=>t.id===opts.templateName);if(!template){console.warn('Template "%s" not defined, using empty initial value',opts.templateName);return rxjs.of({isResolving:false,initialValue:void 0});}const initialValueWithParams$=rxjs.from(resolveInitialValue(schema,template,opts.templateParams,context)).pipe(operators.map(initialValue=>({isResolving:false,initialValue}))).pipe(operators.catchError(resolveError=>{console.group("Failed to resolve initial value");console.error(resolveError);console.error("Template ID: %s",opts.templateName);console.error("Parameters: %o",opts.templateParams);console.groupEnd();const msg={type:"error",error:resolveError};return rxjs.of(msg);}));return rxjs.merge(rxjs.of({isResolving:true}),initialValueWithParams$).pipe(operators.switchMap(_ref291=>{let{isResolving,initialValue,resolveError}=_ref291;if(resolveError){return rxjs.of({type:"error",message:"Failed to resolve initial value"});}if(isResolving){return rxjs.of(LOADING_MSG);}const msg={type:"success",value:initialValue};return rxjs.of(msg);}));}),operators.startWith(LOADING_MSG),operators.distinctUntilChanged());}const fetch$1=(client,query,params,options)=>rxjs.defer(()=>client.observable.fetch(query,params,{tag:options.tag,filterResponse:true,perspective:options.perspective}));const listen=(client,query,params,options)=>rxjs.defer(()=>client.listen(query,params,{events:["welcome","mutation","reconnect"],includeResult:false,visibility:"query",tag:options.tag}));function isWelcomeEvent(event){return event.type==="welcome";}function listenQuery(client,query){let params=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};let options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};const fetchQuery=typeof query==="string"?query:query.fetch;const listenerQuery=typeof query==="string"?query:query.listen;const events$=listen(client,listenerQuery,params,options).pipe(operators.mergeMap((ev,i)=>{const isFirst=i===0;if(isFirst&&!isWelcomeEvent(ev)){return rxjs.throwError(()=>new Error(ev.type==="reconnect"?"Could not establish EventSource connection":'Received unexpected type of first event "'.concat(ev.type,'"')));}return rxjs.of(ev);}),operators.share());const[welcome$,mutationAndReconnect$]=rxjs.partition(events$,isWelcomeEvent);const isRelevantEvent=event=>{if(!options.transitions||event.type!=="mutation"){return true;}return options.transitions.includes(event.transition);};const doFetch=()=>fetch$1(client,fetchQuery,params,options);return rxjs.merge(welcome$.pipe(operators.take(1)),mutationAndReconnect$.pipe(operators.filter(isRelevantEvent),operators.throttleTime(options.throttleTime||1e3,rxjs.asyncScheduler,{leading:true,trailing:true}))).pipe(rxjsExhaustmapWithTrailing.exhaustMapWithTrailing(event=>{if(event.type==="mutation"&&event.visibility!=="query"){return rxjs.timer(1200).pipe(operators.mergeMap(doFetch));}return doFetch();}));}function resolveTypeForDocument(client,id){let specifiedType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"*";if(specifiedType&&specifiedType!=="*"){return rxjs.of(specifiedType);}const query="*[_id in [$documentId, $draftId]]._type";const documentId=getPublishedId(id);const draftId=getDraftId(documentId);return client.observable.fetch(query,{documentId,draftId}).pipe(operators.map(types=>types[0]));}function getIdPairFromPublished(publishedId){if(isDraftId(publishedId)){throw new Error("editOpsOf does not expect a draft id.");}return{publishedId,draftId:getDraftId(publishedId)};}function createDocumentStore(_ref292){let{getClient,documentPreviewStore,historyStore,initialValueTemplates,schema,i18n}=_ref292;const observeDocumentPairAvailability=documentPreviewStore.unstable_observeDocumentPairAvailability;const client=getClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const ctx={client,getClient,observeDocumentPairAvailability,historyStore,schema,i18n};return{// Public API
checkoutPair(idPair){return checkoutPair(client,idPair);},initialValue(opts,context){return getInitialValueStream(schema,initialValueTemplates,documentPreviewStore,opts,context);},listenQuery(query,params,options){return listenQuery(client,query,params,options);},resolveTypeForDocument(id,specifiedType){return resolveTypeForDocument(client,id,specifiedType);},pair:{consistencyStatus(publishedId,type){return consistencyStatus(ctx.client,getIdPairFromPublished(publishedId),type);},documentEvents(publishedId,type){return documentEvents(ctx.client,getIdPairFromPublished(publishedId),type);},editOperations(publishedId,type){return editOperations(ctx,getIdPairFromPublished(publishedId),type);},editState(publishedId,type){return editState(ctx,getIdPairFromPublished(publishedId),type);},operationEvents(publishedId,type){return operationEvents({client,historyStore,schema}).pipe(operators.filter(result=>result.args.idPair.publishedId===publishedId&&result.args.typeName===type),operators.map(result=>{const{operationName,idPair:documentIds}=result.args;return result.type==="success"?{type:"success",op:operationName,id:documentIds.publishedId}:{type:"error",op:operationName,id:documentIds.publishedId,error:result.error};}));},validation(publishedId,type){return validation(ctx,getIdPairFromPublished(publishedId),type);}}};}function useDocumentValues(documentId,paths){const documentPreviewStore=useDocumentPreviewStore();const documentValues$=React.useMemo(()=>documentId?documentPreviewStore.observePaths({_type:"reference",_ref:documentId},paths):rxjs.of(void 0),[documentId,documentPreviewStore,paths]);return useLoadable(documentValues$);}function useInitialValue(props){const{documentId,documentType,templateName,templateParams:templateParamsRaw}=props;const templateParams=useUnique(templateParamsRaw);const documentStore=useDocumentStore();const context=useInitialValueResolverContext();const defaultValue=React.useMemo(()=>({_id:documentId,_type:documentType}),[documentId,documentType]);const[state,setState]=React.useState({loading:false,error:null,value:defaultValue});React.useEffect(()=>{const initialValueOptions={documentId,documentType,templateName,templateParams};if(!templateName){setState({loading:true,error:null,value:defaultValue});return void 0;}const initialValueMsg$=documentStore.initialValue(initialValueOptions,context);const sub=initialValueMsg$.subscribe(msg=>{if(msg.type==="loading"){setState({loading:true,error:null,value:defaultValue});}if(msg.type==="success"){setState({loading:false,error:null,value:msg.value?{...defaultValue,...msg.value}:defaultValue});}if(msg.type==="error"){setState({loading:false,error:msg.error,value:defaultValue});}});setState({loading:true,error:null,value:defaultValue});return()=>sub.unsubscribe();},[defaultValue,documentId,documentStore,documentType,templateName,templateParams,context]);return state;}function useInitialValueResolverContext(){const source=useSource();const schema=useSchema();const currentUser=useCurrentUser();const projectId=useProjectId();const dataset=useDataset();const getClient=source.getClient;return React.useMemo(()=>{return{projectId,dataset,getClient,schema,currentUser};},[getClient,schema,currentUser,projectId,dataset]);}function useResolveInitialValueForType(){const initialValueContext=useInitialValueResolverContext();return React.useCallback((type,params)=>{return resolveInitialValueForType(type,params,DEFAULT_MAX_RECURSION_DEPTH,initialValueContext);},[initialValueContext]);}function getSchemaType(schema,typeName){const type=schema.get(typeName);if(!type){throw new Error("No such schema type: ".concat(typeName));}return type;}function getPairPermissions(_ref293){let{grantsStore,permission,draft,published,liveEdit}=_ref293;const effectiveVersion=draft||published;const effectiveVersionType=effectiveVersion===draft?"draft":"published";const{checkDocumentPermission}=grantsStore;switch(permission){case"delete":{if(liveEdit){return[["delete published document (live-edit)",checkDocumentPermission("update",published)]];}return[["delete draft document",checkDocumentPermission("update",draft)],["delete published document",checkDocumentPermission("update",published)]];}case"discardDraft":{if(liveEdit)return[];return[["delete draft document",checkDocumentPermission("update",draft)]];}case"publish":{if(liveEdit)return[];return[// precondition
["update published document at its current state",checkDocumentPermission("update",published)],// post condition
["delete draft document",checkDocumentPermission("update",draft)],["create published document from draft",checkDocumentPermission("create",draft&&{...draft,_id:getPublishedId(draft._id)})]];}case"unpublish":{if(liveEdit)return[];return[// precondition
["update draft document at its current state",checkDocumentPermission("create",draft)],// post condition
["delete published document",checkDocumentPermission("update",published)],["create draft document from published version",checkDocumentPermission("create",published&&{...published,_id:getDraftId(published._id)})]];}case"update":{if(liveEdit){return[["update published document (live-edit)",checkDocumentPermission("update",published)]];}return[["update ".concat(effectiveVersionType," document"),checkDocumentPermission("update",effectiveVersion)]];}case"duplicate":{if(liveEdit){return[["create new published document from existing document (live-edit)",checkDocumentPermission("create",{...published,_id:"dummy-id"})]];}return[["create new draft document from existing ".concat(effectiveVersionType," document"),checkDocumentPermission("create",{...effectiveVersion,_id:getDraftId("dummy-id")})]];}default:{throw new Error("Could not match permission: ".concat(permission));}}}function getDocumentPairPermissions(_ref294){let{client,grantsStore,schema,id,permission,type}=_ref294;if(type==="*"){return rxjs.of({granted:false,reason:"Type specified was `*`"});}const liveEdit=Boolean(getSchemaType(schema,type).liveEdit);return snapshotPair(client,{draftId:getDraftId(id),publishedId:getPublishedId(id)},type).pipe(operators.switchMap(pair=>rxjs.combineLatest([pair.draft.snapshots$,pair.published.snapshots$]).pipe(operators.map(_ref295=>{let[draft,published]=_ref295;return{draft,published};}))),operators.switchMap(_ref296=>{let{draft,published}=_ref296;const pairPermissions=getPairPermissions({grantsStore,permission,draft,published,liveEdit}).map(_ref297=>{let[label,observable]=_ref297;return observable.pipe(operators.map(_ref298=>{let{granted,reason}=_ref298;return{granted,reason:granted?"":"not allowed to ".concat(label,": ").concat(reason),label,permission};}));});if(!pairPermissions.length)return rxjs.of({granted:true,reason:""});return rxjs.combineLatest(pairPermissions).pipe(operators.map(permissionResults=>{const granted=permissionResults.every(permissionResult=>permissionResult.granted);const reason=granted?"":"Unable to ".concat(permission,":\n	").concat(permissionResults.filter(permissionResult=>!permissionResult.granted).map(permissionResult=>permissionResult.reason).join("\n	"));return{granted,reason};}));}));}const useDocumentPairPermissionsFromHookFactory=createHookFromObservableFactory(getDocumentPairPermissions);function useDocumentPairPermissions(_ref299){let{id,type,permission,client:overrideClient,schema:overrideSchema,grantsStore:overrideGrantsStore}=_ref299;const defaultClient=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const defaultSchema=useSchema();const defaultGrantsStore=useGrantsStore();const client=React.useMemo(()=>overrideClient||defaultClient,[defaultClient,overrideClient]);const schema=React.useMemo(()=>overrideSchema||defaultSchema,[defaultSchema,overrideSchema]);const grantsStore=React.useMemo(()=>overrideGrantsStore||defaultGrantsStore,[defaultGrantsStore,overrideGrantsStore]);return useDocumentPairPermissionsFromHookFactory(React.useMemo(()=>({client,schema,grantsStore,id,permission,type}),[client,grantsStore,id,permission,schema,type]));}function getDocumentValuePermissions(_ref300){let{grantsStore,document,permission}=_ref300;const{checkDocumentPermission}=grantsStore;return checkDocumentPermission(permission,document);}const useDocumentValuePermissionsFromHookFactory=createHookFromObservableFactory(getDocumentValuePermissions);function useDocumentValuePermissions(_ref301){let{document,permission,...rest}=_ref301;const grantsStore=useGrantsStore();return useDocumentValuePermissionsFromHookFactory({grantsStore:rest.grantsStore||grantsStore,document,permission});}const DEBUG_PREFIX="_debug_";const hashchange$=typeof window==="undefined"?rxjs.of({}):rxjs.fromEvent(window,"hashchange");const debugParams$=rxjs.concat(rxjs.of(0),hashchange$).pipe(operators.map(()=>typeof document==="undefined"?"#":document.location.hash),operators.distinctUntilChanged(),operators.map(hash=>hash.substring(1).split(";").filter(p=>p.toLowerCase().startsWith(DEBUG_PREFIX)).map(param=>param.substring(DEBUG_PREFIX.length))));const debugRolesParam$=debugParams$.pipe(operators.map(args=>args.find(arg=>arg.startsWith("roles="))),operators.map(arg=>(arg==null?void 0:arg.split("roles=")[1].split(",").map(r=>r.trim()))||[]));const administrator=[{filter:'_id in path("**")',permissions:["read","create","history","update"]}];const editor=[{filter:'_id in path("**")',permissions:["read","create","history","update"]}];const developer=[{filter:'_id in path("**")',permissions:["read","create","history","update"]}];const contributor=[{filter:'_id in path("**")',permissions:["read"]},{filter:'_id in path("drafts.**")',permissions:["create","history","update"]}];const viewer=[{filter:'_id in path("**")',permissions:["read","history"]}];const requiresApproval=[{filter:"!locked",permissions:["read","create","update"]}];const restricted=[{filter:'_id in path("drafts.**") && _type in ["stringsTest", "book", "author", "referenceTest"]',permissions:["read","create","history","update"]},{filter:'_id in path("**")',permissions:["read"]}];const DEBUG_ROLE_GRANTS_MAP={// basic
administrator:administrator,editor:editor,developer:developer,contributor:contributor,viewer:viewer,// custom
restricted:restricted,requiresApproval:requiresApproval,// legacy
read:viewer,write:editor};const debugGrants$=debugRolesParam$.pipe(operators.map(roles=>{if(!roles.length)return null;return roles.filter(value=>Boolean(value)&&value in DEBUG_ROLE_GRANTS_MAP).flatMap(roleName=>DEBUG_ROLE_GRANTS_MAP[roleName]||[]);}));async function getDatasetGrants(client,projectId,dataset){const grants=await client.request({uri:"/projects/".concat(projectId,"/datasets/").concat(dataset,"/acl"),tag:"acl.get",withCredentials:true});return grants;}function getParams(userId){const params={};if(userId!==null){params.identity=userId;}return params;}const PARSED_FILTERS_MEMO=/* @__PURE__ */new Map();async function matchesFilter(userId,filter,document){if(!PARSED_FILTERS_MEMO.has(filter)){PARSED_FILTERS_MEMO.set(filter,groqJs.parse("*[".concat(filter,"]")));}const parsed=PARSED_FILTERS_MEMO.get(filter);const evalParams=getParams(userId);const{identity}=evalParams;const params={...evalParams};const data=await(await groqJs.evaluate(parsed,{dataset:[document],identity,params})).get();return(data==null?void 0:data.length)===1;}function createGrantsStore(opts){var _a;const{client}=opts;const versionedClient=client.withConfig({apiVersion:"2021-06-07"});const userId="userId"in opts?opts.userId:((_a=opts==null?void 0:opts.currentUser)==null?void 0:_a.id)||null;const datasetGrants$=rxjs.defer(()=>rxjs.of(versionedClient.config())).pipe(operators.switchMap(_ref302=>{let{projectId,dataset}=_ref302;if(!projectId||!dataset){throw new Error("Missing projectId or dataset");}return getDatasetGrants(versionedClient,projectId,dataset);}));const currentUserDatasetGrants=debugGrants$.pipe(operators.switchMap(debugGrants=>debugGrants?rxjs.of(debugGrants):datasetGrants$),operators.publishReplay(1),operators$1.refCountDelay(1e3));return{checkDocumentPermission(permission,document){return currentUserDatasetGrants.pipe(operators.switchMap(grants=>grantsPermissionOn(userId,grants,permission,document)),operators.distinctUntilChanged(shallowEquals__default.default));}};}async function grantsPermissionOn(userId,grants,permission,document){if(!document){return{granted:true,reason:"Null document, nothing to check"};}if(!grants.length){return{granted:false,reason:"No document grants"};}const matchingGrants=[];for(const grant of grants){if(await matchesFilter(userId,grant.filter,document)){matchingGrants.push(grant);}}const foundMatch=matchingGrants.some(grant=>grant.permissions.some(p=>p===permission));return{granted:foundMatch,reason:foundMatch?"Matching grant":"No matching grants found"};}function serialize(item){if(typeof item==="object"&&item!==null&&"serialize"in item){return serialize(item.serialize());}return item;}function getTemplatePermissions(_ref303){let{grantsStore,templateItems,templates,schema,context}=_ref303;if(!(templateItems==null?void 0:templateItems.length))return rxjs.of([]);return rxjs.combineLatest(templateItems.map(serialize).map(async item=>{const template=templates.find(t=>t.id===item.templateId);if(!template){throw new Error('template not found: "'.concat(item.templateId,'"'));}const resolvedInitialValue=await resolveInitialValue(schema,template,item.parameters,context);return{template,item,resolvedInitialValue};}).map(promise=>rxjs.from(promise).pipe(operators.switchMap(_ref304=>{let{item,resolvedInitialValue,template}=_ref304;const schemaType=schema.get(template.schemaType);if(!schemaType){throw new Error('schema type not found: "'.concat(template.schemaType,'"'));}const liveEdit=schemaType==null?void 0:schemaType.liveEdit;const{initialDocumentId="dummy-id"}=item;return getDocumentValuePermissions({grantsStore,permission:"create",document:{_id:liveEdit?getPublishedId(initialDocumentId):getDraftId(initialDocumentId),...resolvedInitialValue}}).pipe(operators.map(_ref305=>{let{granted,reason}=_ref305;const title=item.title||template.title;const result={...item,i18n:item.i18n||template.i18n,granted,reason,resolvedInitialValue,template,title,subtitle:schemaType.title===title?void 0:schemaType.title,description:item.description||template.description,icon:item.icon||template.icon};return result;}));}))));}const useTemplatePermissionsFromHookFactory=createHookFromObservableFactory(getTemplatePermissions);function useTemplatePermissions(_ref306){let{templateItems,...rest}=_ref306;const schema=useSchema();const templates=useTemplates();const grantsStore=useGrantsStore();const initialValueContext=useInitialValueResolverContext();return useTemplatePermissionsFromHookFactory({templateItems,grantsStore:rest.grantsStore||grantsStore,schema:rest.schema||schema,templates:rest.templates||templates,context:initialValueContext});}function canMergeEdit(type){return type==="create"||type==="editDraft";}const CHUNK_WINDOW=5*60*1e3;function isWithinMergeWindow(a,b){return Date.parse(b)-Date.parse(a)<CHUNK_WINDOW;}function mergeChunk(left,right){if(left.end!==right.start)throw new Error("chunks are not next to each other");const draftState=combineState(left.draftState,right.draftState);const publishedState=combineState(left.publishedState,right.publishedState);if(left.type==="delete"&&right.type==="editDraft"){return[left,{...right,type:"create",draftState,publishedState}];}if(right.type==="delete"){if(draftState==="missing"&&publishedState==="present"){return[left,{...right,type:"discardDraft",draftState,publishedState}];}if(draftState==="present"&&publishedState==="missing"){return[left,{...right,type:"unpublish",draftState,publishedState}];}}if(canMergeEdit(left.type)&&right.type==="editDraft"&&isWithinMergeWindow(left.endTimestamp,right.startTimestamp)){const authors=/* @__PURE__ */new Set();for(const author of left.authors)authors.add(author);for(const author of right.authors)authors.add(author);return{index:0,id:right.id,type:left.type,start:left.start,end:right.end,startTimestamp:left.startTimestamp,endTimestamp:right.endTimestamp,authors,draftState,publishedState};}return[left,{...right,draftState,publishedState}];}function getChunkState(effect){const modified=Boolean(effect);const deleted=effect&&isDeletePatch(effect==null?void 0:effect.apply);if(deleted){return"deleted";}if(modified){return"upsert";}return"unedited";}function getChunkType(transaction){const draftState=getChunkState(transaction.draftEffect);const publishedState=getChunkState(transaction.publishedEffect);if(publishedState==="unedited"){if(draftState==="deleted"){return"delete";}if(draftState==="upsert"){return"editDraft";}}if(publishedState==="deleted"){return"delete";}if(publishedState==="upsert"){if(draftState==="unedited"){return"editLive";}if(draftState==="deleted"){return"publish";}if(draftState==="upsert"){return"editLive";}}return"editLive";}function chunkFromTransaction(transaction){const modifiedDraft=Boolean(transaction.draftEffect);const modifiedPublished=Boolean(transaction.publishedEffect);const draftDeleted=transaction.draftEffect&&isDeletePatch(transaction.draftEffect.apply);const publishedDeleted=transaction.publishedEffect&&isDeletePatch(transaction.publishedEffect.apply);const type=getChunkType(transaction);return{index:0,id:transaction.id,type,start:transaction.index,end:transaction.index+1,startTimestamp:transaction.timestamp,endTimestamp:transaction.timestamp,authors:/* @__PURE__ */new Set([transaction.author]),draftState:modifiedDraft?draftDeleted?"missing":"present":"unknown",publishedState:modifiedPublished?publishedDeleted?"missing":"present":"unknown"};}function combineState(left,right){return right==="unknown"?left:right;}function isDeletePatch(patch){return patch[0]===0&&patch[1]===null;}function isSameAnnotation(a,b){if(a&&b){return a.author===b.author&&a.chunk===b.chunk;}if(!a&&!b){return true;}return false;}function getAttrs$1(doc){return doc.draft||doc.published;}class ArrayContentWrapper{constructor(content,value,annotation,extractor){this.type="array";this.elements=[];this.content=content;this.value=value;this.annotation=annotation;this.extractor=extractor;this.length=content.elements.length;}at(idx){if(idx>=this.length)throw new Error("out of bounds");const input=this.elements[idx];if(input){return input;}return this.elements[idx]=wrapValue(this.content.elements[idx],this.value[idx],this.extractor);}annotationAt(idx){const meta=this.content.metas[idx];return this.extractor.fromMeta(meta);}}class ObjectContentWrapper{constructor(content,value,annotation,extractor){this.type="object";this.fields={};this.content=content;this.value=value;this.annotation=annotation;this.extractor=extractor;this.keys=Object.keys(content.fields);}get(key){const input=this.fields[key];if(input){return input;}const value=this.content.fields[key];if(!value)return void 0;return this.fields[key]=wrapValue(value,this.value[key],this.extractor);}}class StringContentWrapper{constructor(content,value,annotation,extractor){this.type="string";this.content=content;this.value=value;this.annotation=annotation;this.extractor=extractor;}sliceAnnotation(start,end){const result=[];let idx=0;function push(text,annotation){if(result.length>0){const lst=result[result.length-1];if(isSameAnnotation(lst.annotation,annotation)){lst.text+=text;return;}}result.push({text,annotation});}for(const part of this.content.parts){const length=part.value.length;const subStart=Math.max(0,start-idx);if(subStart<length){const subEnd=Math.min(length,end-idx);if(subEnd<=0)break;push(part.value.slice(subStart,subEnd),this.extractor.fromValue(part));}idx+=length;}return result;}}function wrapValue(value,raw,extractor){const annotation=extractor.fromValue(value);if(value.content){switch(value.content.type){case"array":return new ArrayContentWrapper(value.content,raw,annotation,extractor);case"object":return new ObjectContentWrapper(value.content,raw,annotation,extractor);case"string":return new StringContentWrapper(value.content,raw,annotation,extractor);}}return diff.wrap(raw,annotation);}function extractAnnotationForFromInput(timeline,firstChunk,meta){if(meta){return annotationForTransactionIndex(timeline,meta.transactionIndex+1,meta.chunk.index);}else if(firstChunk){return annotationForTransactionIndex(timeline,firstChunk.start,firstChunk.index);}return null;}function extractAnnotationForToInput(timeline,meta){if(meta){return annotationForTransactionIndex(timeline,meta.transactionIndex,meta.chunk.index);}return null;}function annotationForTransactionIndex(timeline,idx,chunkIdx){const tx=timeline.transactionByIndex(idx);if(!tx)return null;const chunk=timeline.chunkByTransactionIndex(idx,chunkIdx);if(!chunk)return null;return{chunk,timestamp:tx.timestamp,author:tx.author};}function diffValue(timeline,firstChunk,from,fromRaw,to,toRaw){const fromInput=wrapValue(from,fromRaw,{fromValue(value){return extractAnnotationForFromInput(timeline,firstChunk,value.endMeta);},fromMeta(meta){return extractAnnotationForFromInput(timeline,firstChunk,meta);}});const toInput=wrapValue(to,toRaw,{fromValue(value){return extractAnnotationForToInput(timeline,value.startMeta);},fromMeta(meta){return extractAnnotationForToInput(timeline,meta);}});return diff.diffInput(fromInput,toInput);}class TwoEndedArray{constructor(){this._postive=[];this._negative=[];}addToEnd(elem){elem.index=this._postive.length;this._postive.push(elem);}addToBeginning(elem){if(this.length==0){this.addToEnd(elem);return;}elem.index=-(this._negative.length+1);this._negative.push(elem);}mergeAtEnd(value,merger){if(this.length===0){this.addToEnd(value);return;}const idx=this.lastIdx;const result=merger(this.get(idx),value);if(Array.isArray(result)){this.set(idx,result[0]);this.addToEnd(result[1]);}else{this.set(idx,result);}}mergeAtBeginning(value,merger){if(this.length===0){this.addToEnd(value);return;}const idx=this.firstIdx;const result=merger(value,this.get(idx));if(Array.isArray(result)){this.set(idx,result[1]);this.addToBeginning(result[0]);}else{this.set(idx,result);}}removeFromEnd(){if(this._postive.length===0){this._negative.shift();}else{this._postive.pop();}}has(idx){if(idx>=0){return idx<this._postive.length;}return-(idx+1)<this._negative.length;}get(idx){if(idx>=0){return this._postive[idx];}return this._negative[-(idx+1)];}set(idx,value){if(idx>=0){value.index=idx;this._postive[idx]=value;}else{value.index=idx;this._negative[-(idx+1)]=value;}}get lastIdx(){return this._postive.length-1;}get last(){return this.get(this.lastIdx);}get firstIdx(){return-this._negative.length;}get first(){return this.get(this.firstIdx);}get length(){return this._postive.length+this._negative.length;}}class Timeline{constructor(opts){this.reachedEarliestEntry=false;this._transactions=new TwoEndedArray();this._chunks=new TwoEndedArray();// These two properties are here to handle the case
this._possiblePendingTransactions=/* @__PURE__ */new Map();this.publishedId=opts.publishedId;this.draftId="drafts.".concat(opts.publishedId);if(opts.enableTrace){this._trace=[];this._trace.push({type:"initial",publishedId:opts.publishedId});window.__sanityTimelineTrace=this._trace;}}get chunkCount(){return this._chunks.length;}/** Maps over the chunk from newest to oldest. */mapChunks(mapper){const result=[];const firstIdx=this._chunks.firstIdx;const lastIdx=this._chunks.lastIdx;for(let idx=lastIdx;idx>=firstIdx;idx--){result.push(mapper(this._chunks.get(idx),idx));}return result;}reset(){this._transactions=new TwoEndedArray();this._chunks=new TwoEndedArray();this._possiblePendingTransactions=/* @__PURE__ */new Map();this._recreateTransactionsFrom=void 0;this.reachedEarliestEntry=false;}/**
   * Adds a remote mutation to the timeline. This methods assumes that the remote mutations
   * come in correct order for their respective version, but has no ordering requirements
   * across draft/published.
   *
   * Example: [D1, D2, P1] (where D1 and P1 were mutations done to the draft and published
   * version in the same transaction) is a valid input. [P1, D2, D1] is _not_ valid since
   * the mutation for the draft is out of order.
   */addRemoteMutation(entry){if(this._trace)this._trace.push({type:"addRemoteMutation",event:entry});const pending=this._possiblePendingTransactions.get(entry.transactionId);const transaction=pending?pending.transaction:{index:0,id:entry.transactionId,timestamp:entry.timestamp.toISOString(),author:entry.author};if(entry.version==="draft"){transaction.draftEffect=entry.effects;}else{transaction.publishedEffect=entry.effects;}if(pending){this._possiblePendingTransactions.delete(entry.transactionId);this._invalidateTransactionFrom(pending.idx);}else{this._transactions.addToEnd(transaction);this._possiblePendingTransactions.set(entry.transactionId,{transaction,idx:this._transactions.lastIdx});}}addTranslogEntry(event){if(this._trace)this._trace.push({type:"addTranslogEntry",event});this._transactions.addToBeginning({index:0,id:event.id,author:event.author,timestamp:event.timestamp,draftEffect:event.effects[this.draftId],publishedEffect:event.effects[this.publishedId]});}/** Mark that we've reached the earliest entry. */didReachEarliestEntry(){if(this._trace)this._trace.push({type:"didReachEarliestEntry"});this.reachedEarliestEntry=true;}/**
   * updateChunks synchronizes the chunks to match the current state
   * of the transactions array. After calling this method you need
   * to invalidate all Chunks.
   */updateChunks(){if(this._trace)this._trace.push({type:"updateChunks"});this._removeInvalidatedChunks();this._addChunksFromTransactions();this._createInitialChunk();}_removeInvalidatedChunks(){if(this._recreateTransactionsFrom){while(this._chunks.length>0){const chunk=this._chunks.last;if(this._recreateTransactionsFrom<chunk.end){this._chunks.removeFromEnd();}else{break;}}this._recreateTransactionsFrom=void 0;}}_addChunksFromTransactions(){const firstIdx=this._transactions.firstIdx;const lastIdx=this._transactions.lastIdx;const nextTransactionToChunk=this._chunks.length>0?this._chunks.last.end:firstIdx;for(let idx=nextTransactionToChunk;idx<=lastIdx;idx++){const transaction=this._transactions.get(idx);this._chunks.mergeAtEnd(chunkFromTransaction(transaction),mergeChunk);}if(this._chunks.length==0)return;const firstTransactionChunked=this._chunks.first.start;for(let idx=firstTransactionChunked-1;idx>=firstIdx;idx--){const transaction=this._transactions.get(idx);this._chunks.mergeAtBeginning(chunkFromTransaction(transaction),mergeChunk);}}_invalidateTransactionFrom(idx){if(this._recreateTransactionsFrom===void 0||idx<this._recreateTransactionsFrom){this._recreateTransactionsFrom=idx;}}_createInitialChunk(){var _a;if(this.reachedEarliestEntry){if(((_a=this._chunks.first)==null?void 0:_a.type)==="initial")return;const firstTx=this._transactions.first;if(!firstTx)return;const initialChunk=chunkFromTransaction(firstTx);initialChunk.type="initial";initialChunk.id="@initial";initialChunk.end=initialChunk.start;this._chunks.addToBeginning(initialChunk);}}/**
   * Resolves a time reference.
   *
   * Note that the chunk returned is only valid if the timeline stays constant.
   * Once the timeline is updated, you must re-parse all references.
   */parseTimeId(id){if(this._chunks.length===0){return this.reachedEarliestEntry?"invalid":"loading";}const idSegments=id.split("/",3);const timestampStr=idSegments.shift();const chunkId=idSegments.shift();const timestamp=Number(timestampStr);for(let idx=this._chunks.lastIdx;idx>=this._chunks.firstIdx;idx--){const chunk=this._chunks.get(idx);if(chunk.id===chunkId){return chunk;}if(Date.parse(chunk.endTimestamp)+60*60*1e3<timestamp){return"invalid";}}return this.reachedEarliestEntry?"invalid":"loading";}findLastPublishedBefore(chunk){for(let chunkIdx=chunk?chunk.index-1:this._chunks.lastIdx;chunkIdx>=this._chunks.firstIdx;chunkIdx--){const currentChunk=this._chunks.get(chunkIdx);if(currentChunk.type==="publish"||currentChunk.type==="initial"){return currentChunk;}}if(!this.reachedEarliestEntry)return"loading";return this._chunks.first;}isLatestChunk(chunk){return chunk===this._chunks.last;}// eslint-disable-next-line class-methods-use-this
createTimeId(chunk){return"".concat(chunk.endTimestamp.valueOf(),"/").concat(chunk.id);}lastChunk(){return this._chunks.last;}transactionByIndex(idx){if(!this._transactions.has(idx))return null;return this._transactions.get(idx);}chunkByTransactionIndex(idx){let startChunkIdx=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;let chunkIdx=startChunkIdx;for(;;){const chunk=this._chunks.get(chunkIdx);if(!chunk)throw new Error("transaction does not belong in any chunk");if(idx>=chunk.end){chunkIdx++;}else if(idx<chunk.start){chunkIdx--;}else{return chunk;}}}replayBackwardsBetween(firstIdx,lastIdx,doc){let draft=doc.draft;let published=doc.published;for(let idx=lastIdx;idx>=firstIdx;idx--){const transaction=this._transactions.get(idx);if(transaction.draftEffect){draft=mendoza.applyPatch(draft,transaction.draftEffect.revert);}if(transaction.publishedEffect){published=mendoza.applyPatch(published,transaction.publishedEffect.revert);}}return{draft,published};}replayBackwardsUntil(firstIdx,doc){return this.replayBackwardsBetween(firstIdx,this._transactions.lastIdx,doc);}calculateDiff(initialDoc,finalDoc,firstIdx,lastIdx){let draftValue=mendoza.incremental.wrap(initialDoc.draft,null);let publishedValue=mendoza.incremental.wrap(initialDoc.published,null);const initialValue=getValue(draftValue,publishedValue);const initialAttributes=getAttrs$1(initialDoc);let firstChunk=null;for(let chunkIdx=firstIdx;chunkIdx<=lastIdx;chunkIdx++){const chunk=this._chunks.get(chunkIdx);if(!firstChunk)firstChunk=chunk;for(let idx=chunk.start;idx<chunk.end;idx++){const transaction=this._transactions.get(idx);const meta={chunk,transactionIndex:idx};const preDraftValue=draftValue;const prePublishedValue=publishedValue;if(transaction.draftEffect){draftValue=mendoza.incremental.applyPatch(draftValue,transaction.draftEffect.apply,meta);}if(transaction.publishedEffect){publishedValue=mendoza.incremental.applyPatch(publishedValue,transaction.publishedEffect.apply,meta);}const didHaveDriaft=mendoza.incremental.getType(preDraftValue)!=="null";const haveDraft=mendoza.incremental.getType(draftValue)!=="null";const havePublished=mendoza.incremental.getType(publishedValue)!=="null";if(havePublished&&!haveDraft){publishedValue=mendoza.incremental.rebaseValue(preDraftValue,publishedValue);}if(haveDraft&&!didHaveDriaft){draftValue=mendoza.incremental.rebaseValue(prePublishedValue,draftValue);}}}const finalValue=mendoza.incremental.getType(draftValue)==="null"?publishedValue:draftValue;const finalAttributes=getAttrs$1(finalDoc);return diffValue(this,firstChunk,initialValue,initialAttributes,finalValue,finalAttributes);}}function getValue(draftValue,publishedValue){return mendoza.incremental.getType(draftValue)==="null"?publishedValue:draftValue;}function emptyVersionState(id){return{id,hasAttrs:false,attrs:null,rev:null,events:[],aligned:false};}function align(history,state){const idx=state.events.findIndex(evt=>history.id===evt.transactionId);if(idx>=0){return idx+1;}if(state.rev){return state.rev===history.id?0:-1;}return 0;}function startFromSnapshot(state,doc){state.hasAttrs=true;if(doc){state.attrs={...doc};if(typeof state.attrs._rev!="string")throw new Error("snapshot has no _rev");state.rev=state.attrs._rev;delete state.attrs._rev;}else{state.attrs=null;state.rev=null;}state.events=[];}class Aligner{constructor(timeline){this.earliestTransactionId=null;this.timeline=timeline;this._states={draft:emptyVersionState(timeline.draftId),published:emptyVersionState(timeline.publishedId)};}appendRemoteSnapshotEvent(evt){const state=this._states[evt.version];if(evt.type==="snapshot"){this._maybeInvalidateHistory();startFromSnapshot(state,evt.document);return;}if(evt.type==="remoteMutation"){if(state.aligned){this._apply(state,evt);this.timeline.addRemoteMutation(evt);}else if(state.hasAttrs){state.events.push(evt);}else{startFromSnapshot(state,evt.head);}}}prependHistoryEvent(evt){if(!this.acceptsHistory)throw new Error("cannot prepend history at this point");for(const state of Object.values(this._states)){if(!state.aligned){const idx=align(evt,state);if(idx>=0){this._alignAtIndex(state,idx);}}}this.timeline.addTranslogEntry(evt);this.earliestTransactionId=evt.id;}didReachEarliestEntry(){for(const state of Object.values(this._states)){if(!state.aligned){if(state.attrs!==null)throw new Error("unable to find translog entry to align to");this._alignAtIndex(state,0);}}this.timeline.didReachEarliestEntry();}get isAligned(){return Object.values(this._states).every(state=>state.aligned);}get acceptsHistory(){return this._isComplete;}get currentDocument(){return{draft:this._states.draft.attrs,published:this._states.published.attrs};}_alignAtIndex(state,idx){for(const mutEvt of state.events.slice(0,idx)){this._apply(state,mutEvt);}for(const mutEvt of state.events.slice(idx)){this._apply(state,mutEvt);this.timeline.addRemoteMutation(mutEvt);}state.events=[];state.aligned=true;}get _isComplete(){return Object.values(this._states).every(state=>state.hasAttrs);}// eslint-disable-next-line class-methods-use-this
_apply(state,evt){state.attrs=mendoza.applyPatch(state.attrs,evt.effects.apply);state.rev=evt.transactionId;}_maybeInvalidateHistory(){if(this._isComplete){for(const state of Object.values(this._states)){state.aligned=false;}this.earliestTransactionId=null;this.timeline.reset();}}}async function getJsonStream(url,token){const options=token?{headers:{Authorization:"Bearer ".concat(token)}}:{credentials:"include"};const response=await fetch(url,options);return getStream(response);}function getStream(response){const body=response.body;if(!body){throw new Error("Failed to read body from response");}let reader;let cancelled=false;return new ReadableStream({start(controller){reader=body.getReader();const decoder=new TextDecoder();let buffer="";reader.read().then(function processResult(result){if(result.done){if(cancelled){return;}buffer=buffer.trim();if(buffer.length===0){controller.close();return;}controller.enqueue(JSON.parse(buffer));controller.close();return;}buffer+=decoder.decode(result.value,{stream:true});const lines=buffer.split("\n");for(let i=0;i<lines.length-1;++i){const line=lines[i].trim();if(line.length===0){continue;}try{controller.enqueue(JSON.parse(line));}catch(err){controller.error(err);cancelled=true;reader.cancel();return;}}buffer=lines[lines.length-1];return reader.read().then(processResult).catch(err=>controller.error(err));}).catch(err=>controller.error(err));},cancel(){cancelled=true;reader.cancel();}});}class Reconstruction{constructor(timeline,doc,start,end){this.timeline=timeline;this.start=start;this.end=end;this.doc=doc;}same(start,end){return this.start===start&&this.end===end;}/** Returns the attributes as seen at the end of the range. */endAttributes(){return getAttrs(this.endDocument());}endDocument(){if(!this._endDocument){this._endDocument=this.timeline.replayBackwardsUntil(this.end.end,this.doc);}return this._endDocument;}/** Returns the attributes as seen at the end of the range. */startAttributes(){return getAttrs(this.startDocument());}startDocument(){if(!this.start)throw new Error("start required");if(!this._startDocument){this._startDocument=this.timeline.replayBackwardsBetween(this.start.end,this.end.end-1,this.endDocument());}return this._startDocument;}diff(){if(!this._diff){if(!this.start)throw new Error("start required");this._diff=this.timeline.calculateDiff(this.startDocument(),this.endDocument(),this.start.index+1,this.end.index);}return this._diff;}}function getAttrs(doc){return doc.draft||doc.published;}const TRANSLOG_ENTRY_LIMIT=50;class TimelineController{constructor(options){this.version=0;/**
     * The selection state represents the  different states of the current selection:
     * - inactive: No selection is active.
     * - rev: A selection is active for a single revision.
     * - range: A selection is active for a range and we have all the data needed to render it.
     * - loading: A selection is active, but we don't have the entries yet.
     * - invalid: The selection picked is invalid.
     */this.selectionState="inactive";this._fetchMore=false;this._fetchAtLeast=0;this._isRunning=false;this._isSuspended=false;this._didErr=false;this._since=null;this._sinceTime=null;this._rev=null;this._revTime=null;this.timeline=options.timeline;this.client=options.client;this.handler=options.handler;this._aligner=new Aligner(this.timeline);this.markChange();}clearRange(){this.setRange(null,null);}setRange(since,rev){if(rev!==this._rev)this.setRevTime(rev);if(since!==this._since)this.setSinceTime(since);let _fetchAtLeast=10;if(this._sinceTime==="loading"||this._revTime==="loading"||!this._aligner.isAligned){this.selectionState="loading";}else if(this._sinceTime==="invalid"||this._revTime==="invalid"){this.selectionState="invalid";}else if(this._sinceTime){this.selectionState="range";const targetRev=this._revTime||this.timeline.lastChunk();if(this._sinceTime.index>targetRev.index){this._revTime="invalid";this.selectionState="invalid";}else{this.setReconstruction(this._sinceTime,targetRev);}}else if(this._revTime){this.selectionState="rev";this.setReconstruction(null,this._revTime);}else{this.selectionState="inactive";_fetchAtLeast=0;}this._fetchAtLeast=_fetchAtLeast;this.start();}setLoadMore(flag){this._fetchMore=flag;this.start();}get sinceTime(){return this._sinceTime&&typeof this._sinceTime==="object"?this._sinceTime:null;}get revTime(){return this._revTime&&typeof this._revTime==="object"?this._revTime:null;}get realRevChunk(){return this.revTime||this.timeline.lastChunk();}/** Returns true when there's an older revision we want to render. */onOlderRevision(){return Boolean(this._rev)&&(this.selectionState==="range"||this.selectionState==="rev");}findRangeForNewRev(rev){const revTimeId=this.timeline.isLatestChunk(rev)?null:this.timeline.createTimeId(rev);if(!this._since){return[null,revTimeId];}const sinceChunk=this.sinceTime;if(sinceChunk&&sinceChunk.index<rev.index){return[this._since,revTimeId];}return["@lastPublished",revTimeId];}findRangeForNewSince(since){const revChunk=this.revTime;if(revChunk&&since.index<revChunk.index){return[this.timeline.createTimeId(since),this._rev];}return[this.timeline.createTimeId(since),null];}setRevTime(rev){this._rev=rev;this._revTime=rev?this.timeline.parseTimeId(rev):null;if(this._since==="@lastPublished"){this._since=null;this._sinceTime=null;}}setSinceTime(since){if(since==="@lastPublished"){if(typeof this._revTime==="string"){this._sinceTime=this._revTime;}else{this._sinceTime=this.timeline.findLastPublishedBefore(this._revTime);}}else{this._sinceTime=since?this.timeline.parseTimeId(since):null;}this._since=since;}sinceAttributes(){return this._sinceTime&&this._reconstruction?this._reconstruction.startAttributes():null;}displayed(){return this._revTime&&this._reconstruction?this._reconstruction.endAttributes():null;}setReconstruction(since,rev){if(this._reconstruction&&this._reconstruction.same(since,rev))return;this._reconstruction=new Reconstruction(this.timeline,this._aligner.currentDocument,since,rev);}currentDiff(){return this._reconstruction?this._reconstruction.diff():null;}currentObjectDiff(){const diff=this.currentDiff();if(diff){if(diff.type==="null")return null;if(diff.type!=="object")throw new Error("ObjectDiff expected, got ".concat(diff.type));}return diff;}handleRemoteMutation(ev){this._aligner.appendRemoteSnapshotEvent(ev);this.markChange();if(this._aligner.acceptsHistory)this.start();}start(){if(this._didErr)return;if(!this._isRunning){this._isRunning=true;this.tick().then(()=>{this._isRunning=false;});}}resume(){this._isSuspended=false;}suspend(){this._isSuspended=true;}async tick(){var _a;const shouldFetchMore=this._aligner.acceptsHistory&&!this.timeline.reachedEarliestEntry&&(this.selectionState==="loading"||this._fetchMore||this.timeline.chunkCount<=this._fetchAtLeast)&&!this._isSuspended;if(!shouldFetchMore){return;}try{await this.fetchMoreTransactions();}catch(err){this._didErr=true;(_a=this.handler)==null?void 0:_a.call(this,err,this);return;}await this.tick();}async fetchMoreTransactions(){const publishedId=this.timeline.publishedId;const draftId=this.timeline.draftId;const clientConfig=this.client.config();const limit=TRANSLOG_ENTRY_LIMIT;let queryParams="tag=sanity.studio.structure.history&effectFormat=mendoza&excludeContent=true&excludeMutations=true&includeIdentifiedDocumentsOnly=true&reverse=true&limit=".concat(limit);let tid=this._aligner.earliestTransactionId;if(tid){queryParams+="&toTransaction=".concat(tid);}const transactionsUrl=this.client.getUrl("/data/history/".concat(clientConfig.dataset,"/transactions/").concat(publishedId,",").concat(draftId,"?").concat(queryParams));const stream=await getJsonStream(transactionsUrl,clientConfig.token);const reader=stream.getReader();let count=0;for(;;){const result=await reader.read();if(result.done)break;if("error"in result.value){throw new Error(result.value.error.description||result.value.error.type);}count++;if(result.value.id===tid){continue;}if(this._aligner.earliestTransactionId!==tid||!this._aligner.acceptsHistory){return;}this._aligner.prependHistoryEvent(result.value);tid=this._aligner.earliestTransactionId;}if(this._aligner.earliestTransactionId!==tid||!this._aligner.acceptsHistory){return;}if(count<limit){this._aligner.didReachEarliestEntry();}this.markChange();}markChange(){var _a;this.timeline.updateChunks();this.setRevTime(this._rev);this.setSinceTime(this._rev);this.version++;(_a=this.handler)==null?void 0:_a.call(this,null,this);}}const documentRevisionCache=/* @__PURE__ */Object.create(null);const getHistory=function(client,documentIds){let options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};const ids=Array.isArray(documentIds)?documentIds:[documentIds];const{time,revision}=options;if(time&&revision){throw new Error("getHistory can't handle both time and revision parameters");}const dataset=client.config().dataset;let url="/data/history/".concat(dataset,"/documents/").concat(ids.join(","));if(revision){url="".concat(url,"?revision=").concat(revision);}else{const timestamp=time||(/* @__PURE__ */new Date()).toISOString();url="".concat(url,"?time=").concat(timestamp);}return client.request({url});};const getDocumentAtRevision=(client,documentId,revision)=>{const publishedId=getPublishedId(documentId);const draftId=getDraftId(documentId);const cacheKey="".concat(publishedId,"@").concat(revision);const cached=documentRevisionCache[cacheKey];if(cached){return cached;}const dataset=client.config().dataset;const url="/data/history/".concat(dataset,"/documents/").concat(publishedId,",").concat(draftId,"?revision=").concat(revision);const entry=client.request({url}).then(result=>{const documents=result.documents||[];const published=documents.find(res=>res._id===publishedId);const draft=documents.find(res=>res._id===draftId);return draft||published;});documentRevisionCache[cacheKey]=entry;return entry;};const getTimelineController=_ref307=>{let{client,documentId,documentType}=_ref307;const timeline=new Timeline({enableTrace:isDev,publishedId:documentId});return new TimelineController({client,documentId,documentType,timeline});};const getTransactions=async(client,documentIds)=>{const ids=Array.isArray(documentIds)?documentIds:[documentIds];const dataset=client.config().dataset;const query={excludeContent:"true",includeIdentifiedDocumentsOnly:"true"};const url="/data/history/".concat(dataset,"/transactions/").concat(ids.join(","));const result=await client.request({url,query});const transactions=result.toString("utf8").split("\n").filter(Boolean).map(line=>JSON.parse(line));return transactions;};const getAllRefIds=doc=>jsonReduce.reduce(doc,(acc,node)=>types.isReference(node)&&!acc.includes(node._ref)?[...acc,node._ref]:acc,[]);function jsonMap(value,mapFn){if(Array.isArray(value)){return mapFn(value.map(item=>jsonMap(item,mapFn)).filter(item=>typeof item!=="undefined"));}if(isRecord$4(value)){return mapFn(Object.keys(value).reduce((res,key)=>{const mappedValue=jsonMap(value[key],mapFn);if(typeof mappedValue!=="undefined"){res[key]=mappedValue;}return res;},{}));}return mapFn(value);}const mapRefNodes=(doc,mapFn)=>jsonMap(doc,node=>types.isReference(node)?mapFn(node):node);const removeMissingReferences=(doc,existingIds)=>mapRefNodes(doc,refNode=>{const documentExists=existingIds[refNode._ref];return documentExists?refNode:void 0;});function restore(client,documentId,targetDocumentId,rev){return rxjs.from(getDocumentAtRevision(client,documentId,rev)).pipe(operators.mergeMap(documentAtRevision=>{if(!documentAtRevision){throw new Error("Unable to find document with ID ".concat(documentId," at revision ").concat(rev));}const existingIdsQuery=getAllRefIds(documentAtRevision).map(refId=>'"'.concat(refId,'": defined(*[_id=="').concat(refId,'"]._id)')).join(",");return client.observable.fetch("{".concat(existingIdsQuery,"}")).pipe(operators.map(existingIds=>removeMissingReferences(documentAtRevision,existingIds)));}),operators.map(documentAtRevision=>{const{_updatedAt,...document}=documentAtRevision;return{...document,_id:targetDocumentId};}),operators.mergeMap(restoredDraft=>client.observable.createOrReplace(restoredDraft,{visibility:"async"})));}function createHistoryStore(_ref308){let{client}=_ref308;return{getDocumentAtRevision:(documentId,revision)=>getDocumentAtRevision(client,documentId,revision),getHistory:(documentIds,options)=>getHistory(client,documentIds,options),getTransactions:documentIds=>getTransactions(client,documentIds),restore:(id,targetId,rev)=>restore(client,id,targetId,rev),getTimelineController};}const handleIncomingMessage=event=>{if(event.type==="rollCall"){return{type:"rollCall",userId:event.i,sessionId:event.session};}if(event.type==="state"){const{sessionId,locations}=event.m;return{type:"state",userId:event.i,sessionId,timestamp:(/* @__PURE__ */new Date()).toISOString(),locations};}if(event.type==="disconnect"){return{type:"disconnect",userId:event.i,sessionId:event.m.session,timestamp:(/* @__PURE__ */new Date()).toISOString()};}throw new Error("Got unknown presence event: ".concat(JSON.stringify(event)));};const createBifurTransport=(bifur,sessionId)=>{const incomingEvents$=bifur.request("presence").pipe(operators.map(handleIncomingMessage));const dispatchMessage=message=>{if(message.type==="rollCall"){return bifur.request("presence_rollcall",{session:sessionId});}if(message.type==="state"){return bifur.request("presence_announce",{data:{locations:message.locations,sessionId}});}if(message.type==="disconnect"){return bifur.request("presence_disconnect",{session:sessionId});}return rxjs.EMPTY;};return[incomingEvents$.pipe(operators.share()),dispatchMessage];};const USERIDS=["pqSMwf6hH","pnLYqNfv5","priDVVmy8","p0NFOU0j8","pTDl2jw8d","pHMeQnTse","pDQYzJbyS","pZyoPHKUs","p4Tyi2Be5","pb9vii060","pE8yhOisw","p7Fd2C6Cj","p3exSgYCx","pbIQRYViC","p8GJaTEhN","p27ewL8aM","pYg97z75S","pdLr4quHv","pkJXiDgg6","pkl4UAKcA",// Included to ensure we handle the case when a user profile cannot
// be fetched due to insufficient privileges or similar
"pNoExists"];const PATHS=[["nested","first"],["nested","second"],["nestedArray",{_key:"565c867c8dac"},"arrayNo1",{_key:"a645548a8f01"},"arrayNo1",{_key:"1685e372c40f"},"fieldNo0"],["nestedArray",{_key:"565c867c8dac"},"fieldNo0"],["nestedArray",{_key:"565c867c8dac"},"arrayNo19",{_key:"a02e7a93e2a2"},"fieldNo0"],["nestedArray",{_key:"565c867c8dac"},"arrayNo19",{_key:"a02e7a93e2a2"},"fieldNo19"],["address","country"],["address","street"],["customInputWithDefaultPresence","row3","cell3"]];const mock$=rxjs.defer(()=>rxjs.timer(0,1e4)).pipe(operators.mergeMapTo(USERIDS),operators.map((id,n)=>({type:"state",userId:id,sessionId:id+n,timestamp:(/* @__PURE__ */new Date()).toISOString(),locations:[{type:"document",documentId:"presence-debug",lastActiveAt:(/* @__PURE__ */new Date()).toISOString(),path:sample__default.default(PATHS)}]})),operators.shareReplay());const KEY="presence_session_id";const generate=()=>nanoid.nanoid(16);function getSessionId(){try{return window.sessionStorage.getItem(KEY);}catch(err){}return null;}function setSessionId(id){try{window.sessionStorage.setItem(KEY,id);}catch(err){}return id;}const SESSION_ID=getSessionId()||setSessionId(generate());function __tmp_wrap_presenceStore(context){const{bifur,connectionStatusStore,userStore}=context;const[presenceEvents$,sendMessage]=createBifurTransport(bifur,SESSION_ID);const currentLocation$=new rxjs.BehaviorSubject([]);const locationChange$=currentLocation$.pipe(operators.distinctUntilChanged());const setLocation=nextLocation=>{currentLocation$.next(nextLocation);};const reportLocations=locations=>sendMessage({type:"state",locations});const requestRollCall=()=>sendMessage({type:"rollCall"});const rollCallRequests$=presenceEvents$.pipe(operators.filter(event=>event.type==="rollCall"),// do not respond to my own rollcall requests
operators.filter(event=>event.sessionId!==SESSION_ID));const REPORT_MIN_INTERVAL=3e4;const reportLocationInterval$=rxjs.timer(0,REPORT_MIN_INTERVAL);const reportLocation$=rxjs.defer(()=>rxjs.merge(locationChange$,rollCallRequests$)).pipe(operators.switchMap(()=>reportLocationInterval$),operators.withLatestFrom(currentLocation$),operators.map(_ref309=>{let[,locations]=_ref309;return locations;}),operators.auditTime(200),operators.switchMap(locations=>reportLocations(locations)),operators.mergeMapTo(rxjs.EMPTY),operators.share());const myRollCall$=rxjs.defer(()=>requestRollCall()).pipe(operators.mergeMapTo(rxjs.EMPTY));const connectionChange$=connectionStatusStore.connectionStatus$.pipe(operators.map(status=>status.type),operators.filter(statusType=>statusType==="connected"||statusType==="error"),operators.distinctUntilChanged());const debugPresenceParam$=debugParams$.pipe(operators.map(args=>args.find(arg=>arg.startsWith("presence="))),operators.map(arg=>(arg==null?void 0:arg.split("presence=")[1].split(",").map(r=>r.trim()))||[]));const useMock$=debugPresenceParam$.pipe(operators.filter(args=>args.includes("fake_others")),operators.tap(()=>{console.log('Faking other users present in the studio. They will hang out in the document with _type: "presence" and _id: "presence-debug"');}),operators.switchMapTo(mock$));const debugIntrospect$=debugPresenceParam$.pipe(operators.map(args=>args.includes("show_own")));const syncEvent$=rxjs.merge(myRollCall$,presenceEvents$).pipe(operators.filter(event=>event.type==="state"||event.type==="disconnect"));const stateEventToSession=stateEvent=>{return{lastActiveAt:stateEvent.timestamp,locations:stateEvent.locations,sessionId:stateEvent.sessionId,userId:stateEvent.userId};};const states$=rxjs.merge(syncEvent$,useMock$).pipe(operators.scan((keyed,event)=>event.type==="disconnect"?omit__default.default(keyed,event.sessionId):{...keyed,[event.sessionId]:stateEventToSession(event)},{}));const allSessions$=connectionChange$.pipe(operators.switchMap(status=>status==="connected"?rxjs.merge(states$,reportLocation$):rxjs.NEVER),operators.map(keyedSessions=>Object.values(keyedSessions)),operators.switchMap(sessions=>{const userIds=uniq__default.default(sessions.map(sess=>sess.userId));return rxjs.from(userStore.getUsers(userIds)).pipe(operators.map(users=>sessions.map(session=>({// eslint-disable-next-line max-nested-callbacks
user:users.find(res=>res.id===session.userId),session})).filter(userSessionPairHasUser)));}),operators.takeUntil(rxjs.fromEvent(window,"beforeunload").pipe(operators.switchMap(()=>sendMessage({type:"disconnect"})))),operators.shareReplay({refCount:true,bufferSize:1}));function userSessionPairHasUser(pair){return Boolean(pair.user&&pair.session);}const globalPresence$=allSessions$.pipe(operators.map(sessions=>{const grouped=groupBy__default.default(sessions.map(s=>s.session),e=>e.userId);return Object.keys(grouped).map(userId=>{var _a;return{user:(_a=sessions.find(s=>s.user.id===userId))==null?void 0:_a.user,sessions:grouped[userId]};});}),operators.withLatestFrom(debugIntrospect$),operators.map(_ref310=>{let[userAndSessions,debugIntrospect]=_ref310;return userAndSessions.filter(userAndSession=>{if(debugIntrospect){return true;}const isCurrent=userAndSession.sessions.some(sess=>sess.sessionId===SESSION_ID);return!isCurrent;});}),operators.map(userAndSessions=>userAndSessions.map(userAndSession=>{var _a;return{user:userAndSession.user,status:"online",lastActiveAt:(_a=userAndSession.sessions.sort()[0])==null?void 0:_a.lastActiveAt,locations:flatten__default.default((userAndSession.sessions||[]).map(session=>session.locations||[])).map(location=>({type:location.type,documentId:location.documentId,path:location.path,lastActiveAt:location.lastActiveAt})).reduce((prev,curr)=>prev.concat(curr),[])};})));const documentPresence=documentId=>{return allSessions$.pipe(operators.withLatestFrom(debugIntrospect$),operators.switchMap(_ref311=>{let[userAndSessions,debugIntrospect]=_ref311;return rxjs.from(userAndSessions).pipe(operators.filter(userAndSession=>debugIntrospect||userAndSession.session.sessionId!==SESSION_ID),operators.flatMap(userAndSession=>(userAndSession.session.locations||[]).filter(item=>item.documentId===documentId).map(location=>({user:userAndSession.user,lastActiveAt:userAndSession.session.lastActiveAt,path:location.path||[],sessionId:userAndSession.session.sessionId}))),operators.toArray());}));};return{setLocation,reportLocations,debugPresenceParam$,globalPresence$,documentPresence};}function createProjectStore(context){const{client}=context;const projectId=client.config().projectId;const versionedClient=client.withConfig({apiVersion:"2021-12-15"});function get(){return versionedClient.observable.request({url:"/projects/".concat(projectId)});}function getDatasets(){return versionedClient.observable.request({url:"/projects/".concat(projectId,"/datasets")});}return{get,getDatasets};}function createMultiKeyWeakMap(){const rootMap=/* @__PURE__ */new WeakMap();const idCache=/* @__PURE__ */new WeakMap();function randomId(){return Array.from({length:10}).map(()=>Math.floor(Math.random()*255).toString(16).padStart(2,"0")).join("");}function assignId(key){const cachedId=idCache.get(key);if(cachedId)return cachedId;const id=randomId();idCache.set(key,id);return id;}function arrangeKeys(keys){return Array.from(new Set(keys)).map(key=>[assignId(key),key]).sort((_ref312,_ref313)=>{let[a]=_ref312;let[b]=_ref313;return a.localeCompare(b,"en");}).map(_ref314=>{let[,key]=_ref314;return key;});}function getDeep(keys,map){if(!keys.length)return void 0;const[firstKey,...restOfKeys]=keys;const node=map.get(firstKey);if(!node)return void 0;if(!restOfKeys.length)return node.value;return getDeep(restOfKeys,node.next);}function setDeep(keys,map,value){if(!keys.length)return;const[firstKey,...restOfKeys]=keys;const node=map.get(firstKey)||{type:"multi-key-weak-map-node",value:void 0,next:/* @__PURE__ */new WeakMap()};map.set(firstKey,node);if(!restOfKeys.length){node.value=value;return;}setDeep(restOfKeys,node.next,value);}function get(keys){return getDeep(arrangeKeys(keys),rootMap);}function set(keys,value){setDeep(arrangeKeys(keys),rootMap,value);}return{get,set};}const ResourceCacheContext=React.createContext(null);function ResourceCacheProvider(_ref315){let{children}=_ref315;const resourceCache=React.useMemo(()=>{const namespaces=/* @__PURE__ */new Map();const nullReplacer={};return{get:_ref316=>{let{namespace,dependencies}=_ref316;const dependenciesWithoutNull=dependencies.map(dep=>dep===null?nullReplacer:dep);const namespaceMap=namespaces.get(namespace);return namespaceMap==null?void 0:namespaceMap.get(dependenciesWithoutNull);},set:_ref317=>{let{namespace,dependencies,value}=_ref317;const namespaceMap=namespaces.get(namespace)||createMultiKeyWeakMap();const dependenciesWithoutNull=dependencies.map(dep=>dep===null?nullReplacer:dep);namespaces.set(namespace,namespaceMap);namespaceMap.set(dependenciesWithoutNull,value);}};},[]);return/* @__PURE__ */jsxRuntime.jsx(ResourceCacheContext.Provider,{value:resourceCache,children});}function useResourceCache(){const cache=React.useContext(ResourceCacheContext);if(!cache)throw new Error("Could not find `cache` context");return cache;}const INTERNAL_USER_IDS=[{id:"<system>",displayName:"Sanity",imageUrl:"https://public.sanity.io/logos/favicon-192.png"}];function createUserStore(_ref318){let{client:_client,currentUser}=_ref318;const client=_client.withConfig({apiVersion:"2021-06-07"});const userLoader=new DataLoader__default.default(async userIds=>{const value=await client.request({uri:"/users/".concat(userIds.join(",")),withCredentials:true,tag:"users.get"});const response=Array.isArray(value)?value:[value];const users=response.reduce((acc,next)=>{if(next==null?void 0:next.id){acc[next.id]=next;}return acc;},{});return userIds.map(id=>users[id]||null);},{batchScheduleFn:cb=>raf__default.default(cb)});const userFromCurrentUser=currentUser&&{id:currentUser.id,displayName:currentUser.name,imageUrl:currentUser.profileImage};userLoader.prime("me",userFromCurrentUser);if(userFromCurrentUser==null?void 0:userFromCurrentUser.id){userLoader.prime(userFromCurrentUser.id,userFromCurrentUser);}INTERNAL_USER_IDS.forEach(user=>userLoader.prime(user.id,user));return{getUser:async userId=>{try{return await userLoader.load(userId);}catch(err){if(err.statusCode===403){return Promise.resolve(null);}throw err;}},getUsers:async userIds=>{const results=await userLoader.loadMany(userIds);return results.filter(result=>isRecord$4(result)&&typeof result.id==="string");}};}function useUserStore(){const{getClient,currentUser}=useSource();const resourceCache=useResourceCache();const client=getClient(DEFAULT_STUDIO_CLIENT_OPTIONS);return React.useMemo(()=>{const userStore=resourceCache.get({namespace:"userStore",dependencies:[client,currentUser]})||createUserStore({client,currentUser});resourceCache.set({namespace:"userStore",dependencies:[client,currentUser],value:userStore});return userStore;},[client,currentUser,resourceCache]);}function useGrantsStore(){const{getClient}=useSource();const client=getClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const currentUser=useCurrentUser();const resourceCache=useResourceCache();return React.useMemo(()=>{const grantsStore=resourceCache.get({namespace:"grantsStore",dependencies:[client,currentUser]})||createGrantsStore({client,userId:(currentUser==null?void 0:currentUser.id)||null});resourceCache.set({namespace:"grantsStore",dependencies:[client,currentUser],value:grantsStore});return grantsStore;},[client,currentUser,resourceCache]);}function useHistoryStore(){const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const resourceCache=useResourceCache();return React.useMemo(()=>{const historyStore=resourceCache.get({namespace:"historyStore",dependencies:[client]})||createHistoryStore({client});resourceCache.set({namespace:"historyStore",dependencies:[client],value:historyStore});return historyStore;},[client,resourceCache]);}function useDocumentPreviewStore(){const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const resourceCache=useResourceCache();return React.useMemo(()=>{const documentPreviewStore=resourceCache.get({namespace:"documentPreviewStore",dependencies:[client]})||createDocumentPreviewStore({client});resourceCache.set({namespace:"documentPreviewStore",dependencies:[client],value:documentPreviewStore});return documentPreviewStore;},[client,resourceCache]);}function useDocumentStore(){const{getClient,i18n}=useSource();const schema=useSchema();const templates=useTemplates();const resourceCache=useResourceCache();const historyStore=useHistoryStore();const documentPreviewStore=useDocumentPreviewStore();return React.useMemo(()=>{const documentStore=resourceCache.get({namespace:"documentStore",dependencies:[getClient,documentPreviewStore,historyStore,schema,i18n]})||createDocumentStore({getClient,documentPreviewStore,historyStore,initialValueTemplates:templates,schema,i18n});resourceCache.set({namespace:"documentStore",dependencies:[getClient,documentPreviewStore,historyStore,schema,i18n],value:documentStore});return documentStore;},[getClient,documentPreviewStore,historyStore,resourceCache,schema,templates,i18n]);}function useConnectionStatusStore(){const{bifur}=useSource().__internal;const resourceCache=useResourceCache();return React.useMemo(()=>{const connectionStatusStore=resourceCache.get({namespace:"connectionStatusStore",dependencies:[bifur]})||createConnectionStatusStore({bifur});resourceCache.set({namespace:"connectionStatusStore",dependencies:[bifur],value:connectionStatusStore});return connectionStatusStore;},[bifur,resourceCache]);}function usePresenceStore(){const{__internal:{bifur}}=useSource();const resourceCache=useResourceCache();const userStore=useUserStore();const connectionStatusStore=useConnectionStatusStore();return React.useMemo(()=>{const presenceStore=resourceCache.get({namespace:"presenceStore",dependencies:[bifur,connectionStatusStore,userStore]})||__tmp_wrap_presenceStore({bifur,connectionStatusStore,userStore});resourceCache.set({namespace:"presenceStore",dependencies:[bifur,connectionStatusStore,userStore],value:presenceStore});return presenceStore;},[bifur,connectionStatusStore,resourceCache,userStore]);}function useProjectStore(){const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const resourceCache=useResourceCache();return React.useMemo(()=>{const projectStore=resourceCache.get({namespace:"projectStore",dependencies:[client]})||createProjectStore({client});resourceCache.set({namespace:"projectStore",dependencies:[client],value:projectStore});return projectStore;},[client,resourceCache]);}function useKeyValueStore(){const resourceCache=useResourceCache();const workspace=useWorkspace();return React.useMemo(()=>{const keyValueStore=resourceCache.get({dependencies:[workspace],namespace:"KeyValueStore"})||createKeyValueStore();resourceCache.set({dependencies:[workspace],namespace:"KeyValueStore",value:keyValueStore});return keyValueStore;},[resourceCache,workspace]);}function useDocumentPresence(documentId){const presenceStore=usePresenceStore();const[presence,setPresence]=React.useState([]);React.useEffect(()=>{const subscription=presenceStore.documentPresence(documentId).subscribe(setPresence);return()=>{subscription.unsubscribe();};},[documentId,presenceStore]);return presence;}function useGlobalPresence(){const[presence,setPresence]=React.useState([]);const presenceStore=usePresenceStore();React.useEffect(()=>{const subscription=presenceStore.globalPresence$.subscribe(setPresence);return()=>{subscription.unsubscribe();};},[presenceStore]);return presence;}const INITIAL_STATE={referringDocuments:[],isLoading:true};function useReferringDocuments(id){const documentStore=useDocumentStore();return reactRx.useMemoObservable(()=>documentStore.listenQuery("*[references($docId)] [0...101]",{docId:id},{tag:"use-referring-documents"}).pipe(operators.map(docs=>({referringDocuments:docs,isLoading:false})),operators.startWith(INITIAL_STATE)),[documentStore,id],INITIAL_STATE);}const AssetUsageList=_ref319=>{let{asset,assetType,referringDocuments}=_ref319;const{t}=useTranslation();const count=referringDocuments.length;return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderBottom:count>0,marginTop:2,paddingBottom:2,marginBottom:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,as:"h2",weight:"medium",children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"asset-source.usage-list.documents-using-".concat(assetType),context:asset.originalFilename?"named":"unnamed",values:{filename:asset.originalFilename,count}})})}),referringDocuments.map(document=>/* @__PURE__ */jsxRuntime.jsx(DocumentLink,{document},document._id))]});};const DocumentLink=_ref320=>{let{document}=_ref320;const schema=useSchema();const LinkComponent=React.useCallback(linkProps=>/* @__PURE__ */jsxRuntime.jsx(router.IntentLink,{...linkProps,params:{id:document._id,type:document._type},intent:"edit"}),[document]);return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{as:LinkComponent,radius:2,"data-as":"a",tabIndex:0,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",gap:2,children:/* @__PURE__ */jsxRuntime.jsx(Preview,{layout:"default",value:{_type:"reference",_ref:document._id},schemaType:schema.get(document._type)})})},document._id);};const STYLE_ASSET_IMAGE={maxWidth:"100%",height:"120px",objectFit:"contain",objectPosition:"center"};const STYLE_CONFIRM_CARD={gridColumn:"span 1",overflow:"hidden",display:"flex",alignSelf:"center",justifyContent:"center"};const STYLE_IMAGE_WRAPPER={height:"100%"};const ConfirmMessage=_ref321=>{let{asset,assetType,hasResults=false}=_ref321;const isImage=assetType==="image";const{t}=useTranslation();if(hasResults){return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{tone:"caution",padding:[3,3,4],border:true,radius:2,marginBottom:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Grid,{columns:3,gap:[2,3,4],children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:[3,4],align:"center",style:{gridColumn:isImage?"span 2":"span 3"},children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:t("asset-source.delete-dialog.usage-list.warning-".concat(assetType,"-is-in-use"),{context:asset.originalFilename?"named":"unnamed",filename:asset.originalFilename})})]}),isImage&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{__unstable_checkered:true,border:true,radius:1,style:STYLE_CONFIRM_CARD,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",justify:"center",style:STYLE_IMAGE_WRAPPER,children:/* @__PURE__ */jsxRuntime.jsx("img",{src:"".concat(asset.url,"?w=200"),style:STYLE_ASSET_IMAGE,alt:t("asset-source.usage-list.image-alt"),referrerPolicy:"strict-origin-when-cross-origin"})})})]})});}return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{paddingX:[2,3,4],paddingY:[3,3,3,4],children:/* @__PURE__ */jsxRuntime.jsxs(ui.Grid,{columns:3,gap:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{style:{gridColumn:isImage?"span 2":"span 3"},align:"center",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"asset-source.delete-dialog.usage-list.confirm-delete-".concat(assetType),context:asset.originalFilename?"named":"unnamed",values:{filename:asset.originalFilename}})})}),isImage&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{__unstable_checkered:true,border:true,radius:1,style:STYLE_CONFIRM_CARD,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",justify:"center",style:STYLE_IMAGE_WRAPPER,children:/* @__PURE__ */jsxRuntime.jsx("img",{src:"".concat(asset.url,"?w=200"),style:STYLE_ASSET_IMAGE,alt:t("asset-source.asset-list.table.preview-alt"),referrerPolicy:"strict-origin-when-cross-origin"})})})]})});};function AssetDeleteDialog(_ref322){let{asset,assetType,isDeleting=false,onClose,onDelete}=_ref322;const{isLoading,referringDocuments}=useReferringDocuments(asset._id);const publishedDocuments=React.useMemo(()=>{const drafts=referringDocuments.reduce((acc,doc)=>doc._id.startsWith("drafts.")?acc.concat(doc._id.slice(7)):acc,[]);return referringDocuments.filter(doc=>!drafts.includes(doc._id));},[referringDocuments]);const hasResults=publishedDocuments.length>0;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Dialog,{__unstable_autoFocus:isLoading,footer:{cancelButton:{onClick:onClose,text:t("asset-source.delete-dialog.action.cancel")},confirmButton:{disabled:hasResults,icon:icons.TrashIcon,loading:isDeleting,onClick:onDelete,text:t("asset-source.delete-dialog.action.delete")}},header:t("asset-source.delete-dialog.header",{context:assetType}),id:"asset-dialog",onClickOutside:onClose,onClose,width:1,children:isLoading?/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:4,children:/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{showText:true})}):/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{paddingX:hasResults?[2,3,4]:0,paddingY:hasResults?[3,3,3,4]:0,space:1,children:[/* @__PURE__ */jsxRuntime.jsx(ConfirmMessage,{asset,assetType,hasResults}),hasResults&&/* @__PURE__ */jsxRuntime.jsx(AssetUsageList,{asset,referringDocuments:publishedDocuments,assetType})]})});}const MENU_POPOVER_PROPS={portal:true,placement:"right"};function AssetMenu(_ref323){let{isSelected,border=true,onAction}=_ref323;const triggerButtonMode=isSelected?"default":"bleed";const triggerButtonTone=isSelected?"primary":"default";const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{mode:border?"ghost":triggerButtonMode,tone:border?"default":triggerButtonTone}),id:"asset-menu",menu:/* @__PURE__ */jsxRuntime.jsxs(ui.Menu,{children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("asset-source.asset-list.menu.show-usage"),icon:icons.LinkIcon,onClick:()=>{onAction({type:"showUsage"});}}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:t("asset-source.asset-list.menu.delete"),icon:icons.TrashIcon,tone:"critical",onClick:()=>{onAction({type:"delete"});}})]}),popover:MENU_POPOVER_PROPS});}function AssetUsageDialog(_ref324){let{asset,assetType,onClose}=_ref324;const{isLoading,referringDocuments}=useReferringDocuments(asset._id);const publishedDocuments=React.useMemo(()=>{const drafts=referringDocuments.reduce((acc,doc)=>doc._id.startsWith("drafts.")?acc.concat(doc._id.slice(7)):acc,[]);return referringDocuments.filter(doc=>!drafts.includes(doc._id));},[referringDocuments]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Dialog,{__unstable_autoFocus:true,header:t("asset-source.asset-usage-dialog.header",{context:assetType}),id:"asset-dialog",onClickOutside:onClose,onClose,width:1,children:isLoading?/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{showText:true}):/* @__PURE__ */jsxRuntime.jsx(AssetUsageList,{asset,referringDocuments:publishedDocuments,assetType})});}const MIME_TYPES={// Images
"image/bmp":{title:"Bitmap Image"},"image/jpeg":{title:"JPEG Image"},"image/gif":{title:"GIF Image"},"image/vnd.microsoft.icon":{title:"Icon"},"image/png":{title:"PNG Image"},"image/svg+xml":{title:"SVG Image"},"image/webp":{title:"WebP Image"},"image/tiff":{title:"TIFF Image"},"image/heic":{title:"HEIC Image"},// Audio
"audio/midi":{title:"MIDI Audio"},"audio/midi-x":{title:"MIDI Audio"},"audio/mpeg":{title:"MP3 Audio"},"audio/ogg":{title:"OGG Audio"},"audio/wav":{title:"WAV Audio"},"audio/webm":{title:"WebM Audio"},"audio/aac":{title:"AAC Audio"},// Video
"video/x-msvideo":{title:"AVI Video"},"video/mp4":{title:"MP4 Video"},"video/mpeg":{title:"MPEG Video"},"video/ogg":{title:"OGG Video"},"video/webm":{title:"WebM Video"},"video/quicktime":{title:"QuickTime Video"},// Documents
"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{title:"Excel Spreadsheet"},"application/vnd.ms-excel":{title:"Excel Spreadsheet"},"text/plain":{title:"Text"},"text/javascript":{title:"JavaScript"},"text/markdown":{title:"Markdown"},"text/csv":{title:"CSV"},"text/css":{title:"CSS"},"application/pdf":{title:"PDF Document"},"application/xml":{title:"XML Document"},"text/xml":{title:"XML Document"},"application/zip":{title:"ZIP Archive"},"application/vnd.rar":{title:"RAR Archive"},"application/x-7z-compressed":{title:"7-zip Archive"},"application/octet-stream":{title:"Binary"}};function convertMimeTypeToSomethingNice(mimeType){const part=mimeType.replace("x-","").split("/")[1];return part.charAt(0).toUpperCase()+part.slice(1);}function formatMimeType(mimeType){if(MIME_TYPES==null?void 0:MIME_TYPES[mimeType]){return MIME_TYPES[mimeType].title;}return convertMimeTypeToSomethingNice(mimeType);}var __freeze$11=Object.freeze;var __defProp$11=Object.defineProperty;var __template$11=(cooked,raw)=>__freeze$11(__defProp$11(cooked,"raw",{value:__freeze$11(raw||cooked.slice())}));var _a$11,_b$u,_c$g,_d$8,_e$4,_f$3,_g$2,_h;const CardIconWrapper=styled__default.default.span(_a$11||(_a$11=__template$11(["\n  background-color: transparent;\n  flex-shrink: 0;\n"])));const CustomFlex=styled__default.default(ui.Flex)(_b$u||(_b$u=__template$11([""])));const CustomCard$1=styled__default.default(ui.Card)(_d$8||(_d$8=__template$11(["\n  ","\n"])),props=>props.isSelected&&styled.css(_c$g||(_c$g=__template$11(["\n      --card-muted-fg-color: var(--card-bg-color);\n      --card-fg-color: var(--card-bg-color);\n    "]))));const RowButton=styled__default.default(ui.Button)(_g$2||(_g$2=__template$11(["\n  box-shadow: none;\n  min-width: 0;\n  cursor: pointer;\n  position: initial;\n\n  &:before,\n  &:after {\n    content: '';\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 2;\n  }\n\n  &:before {\n    z-index: 0;\n    pointer-events: none;\n    border-radius: inherit;\n  }\n\n  ","\n\n  ","\n"])),props=>props.isSelected&&styled.css(_e$4||(_e$4=__template$11(["\n      --card-muted-fg-color: var(--card-bg-color);\n      --card-fg-color: var(--card-bg-color);\n\n      &:before {\n        background-color: var(--card-focus-ring-color);\n      }\n\n      "," {\n        --card-muted-fg-color: var(--card-bg-color);\n      }\n\n      "," {\n        --card-muted-fg-color: var(--card-bg-color);\n        --card-fg-color: var(--card-bg-color);\n      }\n    "])),CardIconWrapper,CustomFlex),props=>!props.isSelected&&styled.css(_f$3||(_f$3=__template$11(["\n      &:hover:before {\n        background-color: var(--card-bg-color);\n      }\n\n      &:focus:before {\n        background-color: var(--card-code-bg-color);\n      }\n\n      &:focus-within:before {\n        background-color: var(--card-bg-color);\n      }\n    "]))));const TypeText=styled__default.default(ui.Text)(_h||(_h=__template$11(["\n  overflow-wrap: anywhere;\n"])));const STYLES_ROW_CARD={position:"relative"};const STYLES_ICON_CARD={flexShrink:0};const STYLES_BUTTON_TEXT={minWidth:0};const STYLES_ASSETMENU_WRAPPER={zIndex:3,marginTop:"-0.5rem",marginBottom:"-0.5rem"};const AssetRow=props=>{const versionedClient=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const toast=ui.useToast();const deleteRef$=React.useRef();const[showUsageDialog,setShowUsageDialog]=React.useState(false);const[showDeleteDialog,setShowDeleteDialog]=React.useState(false);const[isDeleting,setIsDeleting]=React.useState(false);const[isOpen,setIsOpen]=React.useState(false);const{asset,onClick,onKeyPress,onDeleteFinished,isSelected,isMobile}=props;const{originalFilename,_id,mimeType,size,_createdAt}=asset;const formattedTime=useRelativeTime(_createdAt,{useTemporalPhrase:true});const formattedMimeType=formatMimeType(mimeType);const formatUnit=useUnitFormatter({unitDisplay:"short",maximumFractionDigits:2});const formattedSize=getHumanFriendlyBytes(size,formatUnit);const showTooltip=(originalFilename||"").length>37;const{t}=useTranslation();const handleConfirmDelete=React.useCallback(()=>{setShowDeleteDialog(true);},[]);const handleDeleteError=React.useCallback(error=>{toast.push({closable:true,status:"error",title:t("asset-source.file.asset-list.delete-failed"),description:error.message});},[t,toast]);const handleDeleteSuccess=React.useCallback(()=>{toast.push({status:"success",title:t("asset-source.file.asset-list.delete-successful")});},[t,toast]);const handleDeleteAsset=React.useCallback(()=>{setIsDeleting(true);deleteRef$.current=versionedClient.observable.delete(asset._id).subscribe({next:()=>{setIsDeleting(false);onDeleteFinished==null?void 0:onDeleteFinished(asset._id);setShowDeleteDialog(false);handleDeleteSuccess();},error:err=>{setIsDeleting(false);handleDeleteError(err);console.error("Could not delete asset",err);}});},[asset._id,handleDeleteError,handleDeleteSuccess,onDeleteFinished,versionedClient.observable]);const handleDialogClose=()=>{setShowUsageDialog(false);setShowDeleteDialog(false);};const handleToggleUsageDialog=()=>{setShowUsageDialog(true);};const handleToggleOpen=()=>{setIsOpen(!isOpen);};const handleMenuAction=action=>{if(action.type==="delete"){handleConfirmDelete();}if(action.type==="showUsage"){handleToggleUsageDialog();}};const usageDialog=React.useMemo(()=>{return showUsageDialog&&/* @__PURE__ */jsxRuntime.jsx(AssetUsageDialog,{assetType:"file",asset,onClose:handleDialogClose});},[asset,showUsageDialog]);const deleteDialog=React.useMemo(()=>{return showDeleteDialog&&/* @__PURE__ */jsxRuntime.jsx(AssetDeleteDialog,{assetType:"file",asset,onClose:handleDialogClose,onDelete:handleDeleteAsset,isDeleting});},[asset,handleDeleteAsset,isDeleting,showDeleteDialog]);if(isMobile){return/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{paddingBottom:2,style:STYLES_ROW_CARD,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Grid,{columns:4,gap:1,style:{position:"relative",gridTemplateColumns:"1fr 30px",opacity:isDeleting?0.5:1},children:[/* @__PURE__ */jsxRuntime.jsx(RowButton,{asset,mode:"bleed",padding:0,"data-id":_id,onClick,paddingY:1,radius:2,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:2,flex:2,align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{as:CardIconWrapper,padding:2,tone:"transparent",radius:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:2,style:STYLES_ICON_CARD,children:/* @__PURE__ */jsxRuntime.jsx(icons.DocumentIcon,{})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,align:"left",textOverflow:"ellipsis",style:STYLES_BUTTON_TEXT,children:originalFilename})]})}),/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{justify:"flex-end",align:"center",paddingRight:1,style:STYLES_ASSETMENU_WRAPPER,children:/* @__PURE__ */jsxRuntime.jsx(ui.Button,{mode:"bleed",fontSize:1,padding:2,onClick:handleToggleOpen,icon:isOpen?icons.ChevronUpIcon:icons.ChevronDownIcon})})]}),isOpen&&/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Grid,{marginTop:3,columns:3,gap:1,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,weight:"medium",children:t("asset-source.file.asset-list.header.size")}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,children:formattedSize})]}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,weight:"medium",children:t("asset-source.file.asset-list.header.type")}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,children:formattedMimeType})]}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,weight:"medium",children:t("asset-source.file.asset-list.header.date-added")}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,children:formattedTime})]})]}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,marginTop:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Button,{fontSize:1,tone:"default",mode:"ghost",text:t("asset-source.file.asset-list.action.show-usage.title"),onClick:handleToggleUsageDialog,icon:icons.LinkIcon}),/* @__PURE__ */jsxRuntime.jsx(ui.Button,{fontSize:1,tone:"critical",mode:"ghost",text:t("asset-source.file.asset-list.action.delete.title"),icon:icons.TrashIcon,disabled:isSelected,title:t(isSelected?"asset-source.file.asset-list.action.delete.disabled-cannot-delete-current-file":"asset-source.file.asset-list.action.delete.title"),onClick:handleConfirmDelete})]})]}),usageDialog||deleteDialog]});}return/* @__PURE__ */jsxRuntime.jsxs(CustomCard$1,{asset,paddingBottom:1,style:STYLES_ROW_CARD,radius:0,overflow:"hidden",isSelected,"aria-selected":"true",children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Grid,{columns:4,gap:1,"data-id":_id,paddingY:1,style:{position:"relative",gridTemplateColumns:"3fr 1fr 1fr 2fr 30px",opacity:isDeleting?0.5:1},children:[/* @__PURE__ */jsxRuntime.jsx(RowButton,{asset,mode:"bleed","data-id":_id,onClick,padding:0,onKeyPress,title:t("asset-source.file.asset-list.item.select-file-tooltip",{filename:originalFilename}),isSelected,radius:2,children:/* @__PURE__ */jsxRuntime.jsxs(CustomFlex,{gap:2,flex:2,paddingRight:1,align:"center",onClick,onKeyPress,"data-id":_id,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{as:CardIconWrapper,padding:2,tone:"transparent",radius:2,style:STYLES_ICON_CARD,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:2,children:/* @__PURE__ */jsxRuntime.jsx(icons.DocumentIcon,{})})}),showTooltip&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:originalFilename,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,align:"left",textOverflow:"ellipsis",style:STYLES_BUTTON_TEXT,children:originalFilename})}),!showTooltip&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,align:"left",textOverflow:"ellipsis",style:STYLES_BUTTON_TEXT,children:originalFilename})]})}),/* @__PURE__ */jsxRuntime.jsx(CustomFlex,{align:"center",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,children:formattedSize})}),/* @__PURE__ */jsxRuntime.jsx(CustomFlex,{align:"center",children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(TypeText,{size:1,muted:true,textOverflow:"ellipsis",children:formattedMimeType})})}),/* @__PURE__ */jsxRuntime.jsx(CustomFlex,{align:"center",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"time",size:1,muted:true,dateTime:_createdAt,children:formattedTime})}),/* @__PURE__ */jsxRuntime.jsx(CustomFlex,{justify:"flex-end",align:"center",paddingX:1,paddingY:1,style:STYLES_ASSETMENU_WRAPPER,children:/* @__PURE__ */jsxRuntime.jsx(AssetMenu,{border:false,isSelected:false,onAction:handleMenuAction})})]}),usageDialog||deleteDialog]});};const STYLES_FILENAME={paddingLeft:"2.2rem"};const STYLES_GRID={gridTemplateColumns:"3fr 1fr 1fr 2fr 30px"};function FileListView(props){const mediaIndex=ui.useMediaIndex();const isMobile=mediaIndex<2;const{assets,onClick,onKeyPress,onDeleteFinished,selectedAssets,isLoading}=props;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderBottom:true,paddingBottom:2,marginBottom:1,children:isMobile?/* @__PURE__ */jsxRuntime.jsx(ui.Grid,{style:STYLES_GRID,children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:2,paddingLeft:5,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:t("asset-source.file.asset-list.header.filename")})})}):/* @__PURE__ */jsxRuntime.jsxs(ui.Grid,{gap:1,style:STYLES_GRID,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:2,style:STYLES_FILENAME,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:t("asset-source.file.asset-list.header.filename")})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:t("asset-source.file.asset-list.header.size")})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:t("asset-source.file.asset-list.header.type")})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:t("asset-source.file.asset-list.header.date-added")})})]})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{children:[isLoading&&assets.length===0&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingTop:4,paddingBottom:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{justify:"center",children:/* @__PURE__ */jsxRuntime.jsx(ui.Spinner,{muted:true})})}),assets.map(asset=>/* @__PURE__ */jsxRuntime.jsx(AssetRow,{asset,isMobile,isSelected:selectedAssets.some(selected=>selected._id===asset._id),onClick,onKeyPress,onDeleteFinished},asset._id))]})]});}var __freeze$10=Object.freeze;var __defProp$10=Object.defineProperty;var __template$10=(cooked,raw)=>__freeze$10(__defProp$10(cooked,"raw",{value:__freeze$10(raw||cooked.slice())}));var _a$10,_b$t,_c$f,_d$7;const DPI=typeof window==="undefined"||!window.devicePixelRatio?1:Math.round(window.devicePixelRatio);const Image$4=styled__default.default.img(_a$10||(_a$10=__template$10(["\n  position: absolute;\n  z-index: 1;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: block;\n  object-fit: contain;\n"])));const Container$1=styled__default.default(ui.Card)(_b$t||(_b$t=__template$10(["\n  position: relative;\n  z-index: 1;\n  padding-bottom: 100%;\n"])));const Root$7=styled__default.default.div(_c$f||(_c$f=__template$10(["\n  position: relative;\n  display: inherit;\n"])));const MenuContainer=styled__default.default.div(_d$7||(_d$7=__template$10(["\n  box-sizing: border-box;\n  position: absolute;\n  z-index: 2;\n  top: 3px;\n  right: 3px;\n\n  & button[data-selected] {\n    display: block;\n  }\n\n  @media (hover: hover) {\n    // If hover is supported, hide the buttons until the user hovers or focuses the asset\n    // Use opacity to enable the buttons to still be focusable\n    & button {\n      opacity: 0;\n    }\n\n    ",":hover & {\n      button {\n        opacity: 1;\n      }\n    }\n\n    ",":focus-within & {\n      button {\n        opacity: 1;\n      }\n    }\n  }\n"])),Root$7,Root$7);const AssetThumb=React.memo(function AssetThumb2(props){const versionedClient=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const toast=ui.useToast();const deleteRef$=React.useRef();const{asset,onClick,onKeyPress,onDeleteFinished,isSelected}=props;const[showUsageDialog,setShowUsageDialog]=React.useState(false);const[showDeleteDialog,setShowDeleteDialog]=React.useState(false);const[isDeleting,setIsDeleting]=React.useState(false);const{t}=useTranslation();React.useEffect(()=>{return()=>{if(deleteRef$.current){deleteRef$.current.unsubscribe();}};},[]);const handleConfirmDelete=React.useCallback(()=>{setShowDeleteDialog(true);},[setShowDeleteDialog]);const handleDialogClose=React.useCallback(()=>{setShowUsageDialog(false);setShowDeleteDialog(false);},[setShowUsageDialog,setShowDeleteDialog]);const handleToggleUsageDialog=React.useCallback(()=>{setShowUsageDialog(true);},[setShowUsageDialog]);const handleDeleteError=React.useCallback(error=>{toast.push({closable:true,status:"error",title:t("asset-source.image.asset-list.delete-failed"),description:error.message});},[t,toast]);const handleDeleteSuccess=React.useCallback(()=>{toast.push({status:"success",title:t("asset-source.image.asset-list.delete-successful")});},[t,toast]);const handleDeleteAsset=React.useCallback(()=>{setIsDeleting(true);deleteRef$.current=versionedClient.observable.delete(asset._id).subscribe({next:()=>{setIsDeleting(false);onDeleteFinished(asset._id);setShowDeleteDialog(false);handleDeleteSuccess();},error:err=>{setIsDeleting(false);handleDeleteError(err);console.error("Could not delete asset",err);}});},[asset._id,handleDeleteError,handleDeleteSuccess,onDeleteFinished,versionedClient.observable]);const handleMenuAction=React.useCallback(action=>{if(action.type==="delete"){handleConfirmDelete();}if(action.type==="showUsage"){handleToggleUsageDialog();}},[handleConfirmDelete,handleToggleUsageDialog]);const usageDialog=React.useMemo(()=>{return showUsageDialog&&/* @__PURE__ */jsxRuntime.jsx(AssetUsageDialog,{assetType:"file",asset,onClose:handleDialogClose});},[asset,handleDialogClose,showUsageDialog]);const deleteDialog=React.useMemo(()=>{return showDeleteDialog&&/* @__PURE__ */jsxRuntime.jsx(AssetDeleteDialog,{assetType:"file",asset,onClose:handleDialogClose,onDelete:handleDeleteAsset,isDeleting});},[asset,handleDeleteAsset,handleDialogClose,isDeleting,showDeleteDialog]);const{originalFilename,_id,url}=asset;const imgH=200*Math.max(1,DPI);const imageUrl=url.includes(".gif")?"".concat(url,"?h=").concat(imgH,"&fit=max&fm=jpg"):"".concat(url,"?h=").concat(imgH,"&fit=max");return/* @__PURE__ */jsxRuntime.jsxs(Root$7,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Button,{selected:isSelected,tabIndex:0,"data-id":_id,mode:"ghost",onKeyPress,padding:0,style:{padding:2},children:/* @__PURE__ */jsxRuntime.jsxs(Container$1,{__unstable_checkered:true,children:[/* @__PURE__ */jsxRuntime.jsx(Image$4,{alt:originalFilename,src:imageUrl,onClick,"data-id":_id}),isDeleting&&/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{})]})}),/* @__PURE__ */jsxRuntime.jsx(MenuContainer,{children:/* @__PURE__ */jsxRuntime.jsx(AssetMenu,{isSelected,onAction:handleMenuAction})}),usageDialog||deleteDialog]});});var __freeze$$=Object.freeze;var __defProp$$=Object.defineProperty;var __template$$=(cooked,raw)=>__freeze$$(__defProp$$(cooked,"raw",{value:__freeze$$(raw||cooked.slice())}));var _a$$;const ThumbGrid=styled__default.default(ui.Grid)(_a$$||(_a$$=__template$$(["\n  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));\n"])));function ImageListView(props){const{isLoading,assets,selectedAssets,onItemClick,onItemKeyPress,onDeleteFinished}=props;return/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{padding:4,children:[/* @__PURE__ */jsxRuntime.jsx(ThumbGrid,{gap:2,children:assets.map(asset=>/* @__PURE__ */jsxRuntime.jsx(AssetThumb,{asset,isSelected:selectedAssets.some(selected=>selected._id===asset._id),onClick:onItemClick,onKeyPress:onItemKeyPress,onDeleteFinished},asset._id))}),isLoading&&assets.length===0&&/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{justify:"center",children:/* @__PURE__ */jsxRuntime.jsx(ui.Spinner,{muted:true})}),!isLoading&&assets.length===0&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",muted:true})]});}var __freeze$_=Object.freeze;var __defProp$_=Object.defineProperty;var __template$_=(cooked,raw)=>__freeze$_(__defProp$_(cooked,"raw",{value:__freeze$_(raw||cooked.slice())}));var _a$_;const PER_PAGE=200;const ASSET_TYPE_IMAGE="sanity.imageAsset";const ASSET_TYPE_FILE="sanity.fileAsset";const buildFilterQuery=acceptParam=>{const WILDCARD_ACCEPT=["image/*","audio/*","video/*"];const acceptItems=acceptParam.split(",").map(accept=>accept.trim());const typesForFilter=acceptItems.reduce((acceptTypes,acceptValue)=>{if(WILDCARD_ACCEPT.includes(acceptValue)){return{...acceptTypes,wildcards:"mimeType match '".concat(acceptValue,"' || ").concat(acceptTypes.wildcards)};}if(acceptValue.indexOf(".")===0){return{...acceptTypes,extensions:"'".concat(acceptValue.replace(".",""),"', ").concat(acceptTypes.extensions)};}return{...acceptTypes,mimes:"'".concat(acceptValue,"', ").concat(acceptTypes.mimes)};},{mimes:"",extensions:"",wildcards:""});return"&&\n  (\n    ".concat(typesForFilter.wildcards,"\n    extension in [").concat(typesForFilter.extensions,"] ||\n    mimeType in [").concat(typesForFilter.mimes,"]\n  )");};const buildQuery=function(){let start=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;let end=arguments.length>1&&arguments[1]!==undefined?arguments[1]:PER_PAGE;let assetType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:ASSET_TYPE_IMAGE;let acceptParam=arguments.length>3?arguments[3]:undefined;const hasAccept=acceptParam.length>0;const filterCondition=hasAccept?buildFilterQuery(acceptParam):"";return'\n  *[_type == "'.concat(assetType,'" ').concat(filterCondition,"] | order(_updatedAt desc) [").concat(start,"...").concat(end,"] {\n    _id,\n    _updatedAt,\n    _createdAt,\n    url,\n    originalFilename,\n    mimeType,\n    extension,\n    size,\n    metadata {dimensions}\n  }\n");};const CardLoadMore=styled__default.default(ui.Card)(_a$_||(_a$_=__template$_(["\n  border-top: 1px solid var(--card-border-color);\n  position: sticky;\n  bottom: 0;\n  z-index: 200;\n"])));const DefaultAssetSource=function DefaultAssetSource2(props,ref){const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const versionedClient=React.useMemo(()=>client.withConfig({apiVersion:"2023-02-14"}),[client]);const _elementId=React.useRef("default-asset-source-".concat(uniqueId__default.default()));const currentPageNumber=React.useRef(0);const{t}=useTranslation();const fetch$=React.useRef();const[assets,setAssets]=React.useState([]);const[isLastPage,setIsLastPage]=React.useState(false);const[hasResetAutoFocus,setHasResetFocus]=React.useState(false);const[isLoading,setIsLoading]=React.useState(true);const{selectedAssets,assetType="image",dialogHeaderTitle,onClose,onSelect,accept}=props;const isImageOnlyWildCard=accept&&accept==="image/*"&&assetType==="image";const fetchPage=React.useCallback(pageNumber=>{const start=pageNumber*PER_PAGE;const end=start+PER_PAGE;const isImageAssetType=assetType==="image";const tag=isImageAssetType?"asset.image-list":"asset.file-list";const assetTypeParam=isImageAssetType?ASSET_TYPE_IMAGE:ASSET_TYPE_FILE;setIsLoading(true);if(typeof accept!=="undefined"){fetch$.current=versionedClient.observable.fetch(buildQuery(start,end,assetTypeParam,accept),{},{tag}).subscribe(result=>{setIsLastPage(result.length<PER_PAGE);setAssets(prevState=>prevState.concat(result));setIsLoading(false);});}},[assetType,accept,versionedClient]);const handleDeleteFinished=React.useCallback(id=>{setAssets(prevState=>prevState.filter(asset=>asset._id!==id));},[setAssets]);const select=React.useCallback(id=>{const selected=assets.find(doc=>doc._id===id);if(selected){const selectedSource=[{kind:"assetDocumentId",value:id}];onSelect(selectedSource);}},[assets,onSelect]);const handleItemClick=React.useCallback(event=>{event.preventDefault();const id=event.currentTarget.getAttribute("data-id");if(!id){throw new Error("Missing data-id attribute on item");}select(id);},[select]);const handleItemKeyPress=React.useCallback(event=>{if(event.key==="Enter"){event.preventDefault();const id=event.currentTarget.getAttribute("data-id");if(!id){throw new Error("Missing data-id attribute on item");}select(id);}},[select]);const handleClose=React.useCallback(()=>{if(onClose){onClose();}},[onClose]);const handleFetchNextPage=React.useCallback(event=>{event.preventDefault();fetchPage(++currentPageNumber.current);},[fetchPage]);React.useEffect(()=>{fetchPage(currentPageNumber.current);return()=>{if(fetch$.current){fetch$.current.unsubscribe();}};},[fetchPage]);React.useEffect(()=>{if(!isLoading&&(!currentPageNumber.current||currentPageNumber.current===0)){setHasResetFocus(true);}},[isLoading]);const listFormat=useListFormat({style:"narrow"});return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Dialog,{__unstable_autoFocus:hasResetAutoFocus,header:dialogHeaderTitle||t("asset-source.dialog.default-title",{context:assetType}),id:_elementId.current,onClickOutside:handleClose,onClose:handleClose,ref,width:2,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:5,children:[!isImageOnlyWildCard&&!isLoading&&(accept==null?void 0:accept.length)>0&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{tone:"primary",padding:3,border:true,radius:2,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:3,align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.InfoOutlineIcon,{})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"asset-source.dialog.accept-message",values:{acceptTypes:listFormat.format(accept.split(",").map(type=>type.trim()))}})})]})}),assetType==="file"&&/* @__PURE__ */jsxRuntime.jsx(FileListView,{assets,onDeleteFinished:handleDeleteFinished,onClick:handleItemClick,onKeyPress:handleItemKeyPress,isLoading,selectedAssets}),assetType==="image"&&/* @__PURE__ */jsxRuntime.jsx(ImageListView,{assets,onDeleteFinished:handleDeleteFinished,onItemClick:handleItemClick,onItemKeyPress:handleItemKeyPress,isLoading,selectedAssets}),assets.length>0&&!isLastPage&&/* @__PURE__ */jsxRuntime.jsx(CardLoadMore,{tone:"default",padding:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{direction:"column",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{type:"button",icon:icons.DownloadIcon,loading:isLoading,onClick:handleFetchNextPage,size:"large",text:t("asset-source.dialog.load-more"),tone:"primary"})})})]})});};const DefaultSource=React.memo(React.forwardRef(DefaultAssetSource));const FileSource={name:"sanity-default",title:"Uploaded files",i18nKey:"asset-source.file.title",component:DefaultSource,icon:icons.DocumentsIcon};const ImageSource={name:"sanity-default",title:"Uploaded images",i18nKey:"asset-source.image.title",component:DefaultSource,icon:icons.ImageIcon};const initialDocumentBadges=[];const initialDocumentActions=[];const initialLanguageFilter=[];const schemaTypesReducer=(prev,_ref325,context)=>{let{schema}=_ref325;const schemaTypes=schema==null?void 0:schema.types;if(!schemaTypes)return prev;if(typeof schemaTypes==="function")return schemaTypes(prev,context);if(Array.isArray(schemaTypes))return[...prev,...schemaTypes];throw new Error("Expected `schema.types` to be an array or a function, but received ".concat(getPrintableType(schemaTypes)));};const resolveProductionUrlReducer=async(prev,_ref326,context)=>{let{document}=_ref326;const resolveProductionUrl=document==null?void 0:document.productionUrl;if(resolveProductionUrl)return await resolveProductionUrl(prev,context);return prev;};const toolsReducer=(prev,_ref327,context)=>{let{tools}=_ref327;if(!tools)return prev;if(typeof tools==="function")return tools(prev,context);if(Array.isArray(tools))return[...prev,...tools];throw new Error("Expected `tools` to be an array or a function, but received ".concat(getPrintableType(tools)));};const schemaTemplatesReducer=(prev,_ref328,context)=>{let{schema}=_ref328;const schemaTemplates=schema==null?void 0:schema.templates;if(!schemaTemplates)return prev;if(typeof schemaTemplates==="function")return schemaTemplates(prev,context);if(Array.isArray(schemaTemplates))return[...prev,...schemaTemplates];throw new Error("Expected `schema.templates` to be an array or a function, but received ".concat(getPrintableType(schemaTemplates)));};const localeDefReducer=(prev,_ref329,context)=>{let{i18n}=_ref329;const locales=i18n==null?void 0:i18n.locales;if(!locales)return prev;if(typeof locales==="function")return locales(prev,context);if(Array.isArray(locales))return[...prev,...locales];throw new Error("Expected `i18n.locales` to be an array or a function, but received ".concat(getPrintableType(locales)));};const localeBundlesReducer=(prev,_ref330,context)=>{let{i18n}=_ref330;const bundles=i18n==null?void 0:i18n.bundles;if(!bundles)return prev;if(Array.isArray(bundles))return[...prev,...bundles];if(typeof bundles==="function")return bundles(prev,context);throw new Error("Expected `i18n.bundles` to be an array or a function, but received ".concat(typeof bundles));};const documentBadgesReducer=(prev,_ref331,context)=>{let{document}=_ref331;const documentBadges=document==null?void 0:document.badges;if(!documentBadges)return prev;if(typeof documentBadges==="function")return documentBadges(prev,context);if(Array.isArray(documentBadges))return[...prev,...documentBadges];throw new Error("Expected `document.badges` to be an array or a function, but received ".concat(getPrintableType(documentBadges)));};const documentActionsReducer=(prev,_ref332,context)=>{let{document}=_ref332;const documentActions=document==null?void 0:document.actions;if(!documentActions)return prev;if(typeof documentActions==="function")return documentActions(prev,context);if(Array.isArray(documentActions))return[...prev,...documentActions];throw new Error("Expected `document.actions` to be an array or a function, but received ".concat(getPrintableType(documentActions)));};const newDocumentOptionsResolver=(prev,_ref333,context)=>{let{document}=_ref333;const resolveNewDocumentOptions=document==null?void 0:document.newDocumentOptions;if(!resolveNewDocumentOptions)return prev;if(typeof resolveNewDocumentOptions!=="function"){throw new Error("Expected `document.resolveNewDocumentOptions` to be a function, but received ".concat(getPrintableType(resolveNewDocumentOptions)));}return resolveNewDocumentOptions(prev,context);};const fileAssetSourceResolver=(prev,_ref334,context)=>{let{form}=_ref334;var _a;const assetSources=(_a=form==null?void 0:form.file)==null?void 0:_a.assetSources;if(!assetSources)return prev;if(typeof assetSources==="function")return assetSources(prev,context);if(Array.isArray(assetSources))return[...prev,...assetSources];throw new Error("Expected `form.file.assetSources` to be an array or a function, but received ".concat(getPrintableType(assetSources)));};const imageAssetSourceResolver=(prev,_ref335,context)=>{let{form}=_ref335;var _a;const assetSources=(_a=form==null?void 0:form.image)==null?void 0:_a.assetSources;if(!assetSources)return prev;if(typeof assetSources==="function")return assetSources(prev,context);if(Array.isArray(assetSources))return[...prev,...assetSources];throw new Error("Expected `form.image.assetSources` to be an array or a function, but received ".concat(getPrintableType(assetSources)));};const documentLanguageFilterReducer=(prev,_ref336,context)=>{let{document}=_ref336;const resolveDocumentLanguageFilter=document==null?void 0:document.unstable_languageFilter;if(!resolveDocumentLanguageFilter)return prev;if(typeof resolveDocumentLanguageFilter==="function")return resolveDocumentLanguageFilter(prev,context);if(Array.isArray(resolveDocumentLanguageFilter))return[...prev,...resolveDocumentLanguageFilter];throw new Error("Expected `document.unstable_languageFilter` to be an array or a function, but received ".concat(getPrintableType(resolveDocumentLanguageFilter)));};const documentInspectorsReducer=(prev,_ref337,context)=>{let{document}=_ref337;const resolveInspectorsFilter=document==null?void 0:document.inspectors;if(!resolveInspectorsFilter)return prev;if(typeof resolveInspectorsFilter==="function")return resolveInspectorsFilter(prev,context);if(Array.isArray(resolveInspectorsFilter))return[...prev,...resolveInspectorsFilter];throw new Error("Expected `document.inspectors` to be an array or a function, but received ".concat(getPrintableType(resolveInspectorsFilter)));};const documentCommentsEnabledReducer=opts=>{const{config,context,initialValue}=opts;const flattenedConfig=flattenConfig(config,[]);const result=flattenedConfig.reduce((acc,_ref338)=>{let{config:innerConfig}=_ref338;var _a,_b;const resolver=(_b=(_a=innerConfig.document)==null?void 0:_a.unstable_comments)==null?void 0:_b.enabled;if(!resolver&&typeof resolver!=="boolean")return acc;if(typeof resolver==="function")return resolver(context);if(typeof resolver==="boolean")return resolver;throw new Error("Expected `document.unstable_comments.enabled` to be a boolean or a function, but received ".concat(getPrintableType(resolver)));},initialValue);return result;};const partialIndexingEnabledReducer=opts=>{const{config,initialValue}=opts;const flattenedConfig=flattenConfig(config,[]);const result=flattenedConfig.reduce((acc,_ref339)=>{let{config:innerConfig}=_ref339;var _a,_b;const resolver=(_b=(_a=innerConfig.search)==null?void 0:_a.unstable_partialIndexing)==null?void 0:_b.enabled;if(!resolver&&typeof resolver!=="boolean")return acc;if(typeof resolver==="boolean")return resolver;throw new Error("Expected `search.unstable_partialIndexing.enabled` to be a boolean, but received ".concat(getPrintableType(resolver)));},initialValue);return result;};function resolveConfigProperty(_ref340){let{config:inputConfig,context,initialValue,propertyName,...reducers}=_ref340;const configs=flattenConfig(inputConfig,[]);if("reducer"in reducers){return configs.reduce((acc,_ref341)=>{let{config,path}=_ref341;try{return reducers.reducer(acc,config,context);}catch(e){throw new ConfigPropertyError({propertyName,path,cause:e});}},initialValue);}const reducer=reducers.asyncReducer;return(async()=>{let current=initialValue;for(const{config,path}of configs){try{current=await reducer(current,config,context);}catch(e){throw new ConfigPropertyError({propertyName,path,cause:e});}}return current;})();}function createSanityI18nBackend(options){const{bundles}=options;function init(){}function read(locale,namespace,callback){const loadable=bundles.filter(bundle=>bundle.locale===locale&&bundle.namespace===namespace);if(loadable.length===0){callback('No translations found for namespace "'.concat(namespace,'", language "').concat(locale,'"'),void 0// Returning undefined here will i18next _not_ retry
);return;}loadBundles(loadable).then(resources=>callback(null,resources)).catch(err=>callback(err,true));}return{type:"backend",init,read};}async function loadBundles(bundles){var _a,_b;const resolved=await Promise.all(bundles.map(async bundle=>({...bundle,resources:await loadBundleResources(bundle)})));const base={};for(const item of resolved){const deep=(_a=item.deep)!=null?_a:true;const overwrite=(_b=item.overwrite)!=null?_b:true;if(deep){deepExtend(base,item.resources,overwrite);}else if(overwrite){Object.assign(base,item.resources);}else{Object.assign({},item.resources,base);}}return base;}async function loadBundleResources(bundle){if(typeof bundle.resources!=="function"){return bundle.resources;}const resources=await bundle.resources();return maybeUnwrapModule(resources);}function deepExtend(target,source){let overwrite=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;for(const prop in source){if(prop==="__proto__"||prop==="constructor"){continue;}if(!(prop in target)){target[prop]=source[prop];continue;}const targetLeaf=target[prop];const sourceLeaf=source[prop];const targetIsString=isStringLeaf(targetLeaf);const sourceIsString=isStringLeaf(sourceLeaf);if((targetIsString||sourceIsString)&&overwrite){target[prop]=source[prop];continue;}if(targetIsString||sourceIsString){continue;}const sourceIsArray=Array.isArray(sourceLeaf);const targetIsArray=Array.isArray(targetLeaf);if(sourceIsArray||targetIsArray){if(overwrite){target[prop]=sourceLeaf;}continue;}deepExtend(targetLeaf,sourceLeaf,overwrite);}return target;}function isStringLeaf(target){return typeof target==="string"||target instanceof String;}function maybeUnwrapModule(maybeModule){return isWrappedModule(maybeModule)?maybeModule.default:maybeModule;}function isWrappedModule(mod){return"default"in mod&&typeof mod.default==="object"&&isPlainObject__default.default(mod.default);}function prepareI18n(source){const{projectId,dataset,name:sourceName}=source;const context={projectId,dataset};const locales=resolveConfigProperty({config:source,context,propertyName:"i18n.locales",reducer:localeDefReducer,initialValue:[defaultLocale]});const bundles=resolveConfigProperty({config:source,context,propertyName:"i18n.bundles",reducer:localeBundlesReducer,initialValue:normalizeResourceBundles(locales)});return createI18nApi({locales,bundles,projectId,sourceName});}function createI18nApi(_ref342){let{locales,bundles,projectId,sourceName}=_ref342;const namespaceNames=new Set(bundles.map(bundle=>bundle.namespace));const options=getI18NextOptions(projectId,sourceName,locales,namespaceNames);const i18nInstance=i18next.createInstance().use(createSanityI18nBackend({bundles})).use(reactI18next.initReactI18next);i18nInstance.init(options).catch(err=>{console.error("Failed to initialize i18n backend: %s",err);});const reducedLocales=locales.map(reduceLocaleDefinition);return{/** @public */source:{get currentLocale(){var _a;return(_a=reducedLocales.find(locale=>locale.id===i18nInstance.language))!=null?_a:defaultLocale;},loadNamespaces(namespaces){const missing=namespaces.filter(ns=>!i18nInstance.hasLoadedNamespace(ns));return missing.length===0?Promise.resolve():i18nInstance.loadNamespaces(missing);},locales:reducedLocales,t:maybeWrapT(i18nInstance.t)},/** @internal */i18next:i18nInstance};}function normalizeResourceBundles(locales){const normalized=[];for(const lang of locales){if(lang.bundles&&!Array.isArray(lang.bundles)){throw new Error("Resource bundle for locale ".concat(lang.id," is not an array"));}if(!lang.bundles){continue;}for(const bundle of lang.bundles){if("locale"in bundle&&bundle.locale!==lang.id){throw new Error("Resource bundle inside locale ".concat(lang.id," has mismatching locale id"));}const ns=bundle.namespace;if(!ns){throw new Error("Resource bundle for locale ".concat(lang.id," is missing namespace"));}normalized.push("locale"in bundle?bundle:{...bundle,locale:lang.id});}}return normalized;}const defaultOptions={/**
   * Even though we're only defining the studio namespace, i18next will still load requested
   * namespaces through the backend. The reason why we're defining the namespace at all is to
   * prevent i18next from (trying) to load the i18next default `translation` namespace.
   */ns:[studioLocaleNamespace],defaultNS:studioLocaleNamespace,partialBundledLanguages:true,// Fall back to English (US) locale
fallbackLng:defaultLocale.id,// This will be overriden with the users detected/preferred locale before initing,
// but to satisfy the init options and prevent mistakes, we include a default here.
lng:defaultLocale.id,// In rare cases we'll want to be able to debug i18next - there is a `debug` option
// in the studio i18n configuration for that, which will override this value.
debug:DEBUG_I18N,// When specifying language 'en-US', do not load 'en-US', 'en', 'dev' - only `en-US`.
load:"currentOnly",// We always use our "backend" for loading translations, allowing us to handle i18n resources
// in a single place with a single approach. This means we shouldn't need to wait for the init,
// as any missing translations will be loaded async (through react suspense).
initImmediate:true,// Because we use i18next-react, we do not need to escale values
interpolation:{escapeValue:false},// Theoretically, if the framework somehow gets new translations added, re-render.
// Note that this shouldn't actually happen, as we only use the Sanity backend
react:{bindI18nStore:"added"}};function getI18NextOptions(projectId,sourceName,locales,namespaces){var _a,_b;const preferredLocaleId=getPreferredLocale(projectId,sourceName);const preferredLocale=locales.find(l=>l.id===preferredLocaleId);const lastLocale=locales[locales.length-1];const locale=(_b=(_a=preferredLocale==null?void 0:preferredLocale.id)!=null?_a:lastLocale.id)!=null?_b:defaultOptions.lng;return{...defaultOptions,ns:Array.from(namespaces),// For now, let us load all namespaces. We can optimize later.
lng:locale,supportedLngs:locales.map(def=>def.id)};}function reduceLocaleDefinition(definition){const{bundles,...locale}=definition;return locale;}function createFilterDefinitionDictionary(filterDefinitions){return filterDefinitions.reduce((acc,val)=>{acc[val.name]=val;return acc;},{});}function defineSearchFilter(filterDef){return filterDef;}function defineSearchFilterOperators(operators){return operators;}function getFilterDefinition(definitions,filterName){return definitions[filterName];}function getSupportedFieldTypes(filterDefs){return filterDefs.reduce((acc,val)=>{if(val.type==="field"){acc.push(val.fieldType);}return acc;},[]);}const filterDefinitions=[// 'Pinned' filters
defineSearchFilter({fieldPath:"_updatedAt",icon:icons.CalendarIcon,operators:[{name:"dateTimeLast",type:"item"},{type:"divider"},{name:"dateTimeRange",type:"item"},{name:"dateTimeAfter",type:"item"},{name:"dateTimeBefore",type:"item"},{type:"divider"},{name:"dateTimeEqual",type:"item"},{name:"dateTimeNotEqual",type:"item"}],title:"Edited at",name:"updatedAt",type:"pinned"}),defineSearchFilter({fieldPath:"_createdAt",icon:icons.CalendarIcon,operators:[{name:"dateTimeLast",type:"item"},{type:"divider"},{name:"dateTimeRange",type:"item"},{name:"dateTimeAfter",type:"item"},{name:"dateTimeBefore",type:"item"},{type:"divider"},{name:"dateTimeEqual",type:"item"},{name:"dateTimeNotEqual",type:"item"}],title:"Created at",name:"createdAt",type:"pinned"}),defineSearchFilter({icon:icons.LinkIcon,operators:[{name:"referencesDocument",type:"item"},{name:"referencesAssetImage",type:"item"},{name:"referencesAssetFile",type:"item"}],title:"Contains document, image or file",name:"references",type:"pinned"}),// 'Field' filters
defineSearchFilter({fieldType:"array",icon:icons.UlistIcon,name:"array",operators:[{name:"defined",type:"item"},{name:"notDefined",type:"item"},{type:"divider"},{name:"arrayCountEqual",type:"item"},{name:"arrayCountNotEqual",type:"item"},{type:"divider"},{name:"arrayCountGt",type:"item"},{name:"arrayCountGte",type:"item"},{name:"arrayCountLt",type:"item"},{name:"arrayCountLte",type:"item"},{type:"divider"},{name:"arrayCountRange",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"array",icon:icons.UlistIcon,name:"arrayList",operators:[{name:"arrayListIncludes",type:"item"},{name:"arrayListNotIncludes",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"},{type:"divider"},{name:"arrayCountEqual",type:"item"},{name:"arrayCountNotEqual",type:"item"},{type:"divider"},{name:"arrayCountGt",type:"item"},{name:"arrayCountGte",type:"item"},{name:"arrayCountLt",type:"item"},{name:"arrayCountLte",type:"item"},{type:"divider"},{name:"arrayCountRange",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"array",icon:icons.UlistIcon,name:"arrayReferences",operators:[{name:"arrayReferenceIncludes",type:"item"},{name:"arrayReferenceNotIncludes",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"},{type:"divider"},{name:"arrayCountEqual",type:"item"},{name:"arrayCountNotEqual",type:"item"},{type:"divider"},{name:"arrayCountGt",type:"item"},{name:"arrayCountGte",type:"item"},{name:"arrayCountLt",type:"item"},{name:"arrayCountLte",type:"item"},{type:"divider"},{name:"arrayCountRange",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"boolean",icon:icons.CheckmarkCircleIcon,name:"boolean",operators:[{name:"booleanEqual",type:"item"},{type:"divider"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"date",icon:icons.CalendarIcon,name:"date",operators:[{name:"dateLast",type:"item"},{type:"divider"},{name:"dateRange",type:"item"},{name:"dateAfter",type:"item"},{name:"dateBefore",type:"item"},{type:"divider"},{name:"dateEqual",type:"item"},{name:"dateNotEqual",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"datetime",icon:icons.CalendarIcon,name:"datetime",operators:[{name:"dateTimeLast",type:"item"},{type:"divider"},{name:"dateTimeRange",type:"item"},{name:"dateTimeAfter",type:"item"},{name:"dateTimeBefore",type:"item"},{type:"divider"},{name:"dateTimeEqual",type:"item"},{name:"dateTimeNotEqual",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"email",icon:icons.StringIcon,name:"email",operators:[{name:"stringMatches",type:"item"},{name:"stringNotMatches",type:"item"},{type:"divider"},{name:"stringEqual",type:"item"},{name:"stringNotEqual",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"file",icon:icons.DocumentIcon,name:"file",operators:[{name:"assetFileEqual",type:"item"},{name:"assetFileNotEqual",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"image",icon:icons.ImageIcon,name:"image",operators:[{name:"assetImageEqual",type:"item"},{name:"assetImageNotEqual",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"number",icon:icons.NumberIcon,name:"number",operators:[{name:"numberEqual",type:"item"},{name:"numberNotEqual",type:"item"},{type:"divider"},{name:"numberGt",type:"item"},{name:"numberGte",type:"item"},{name:"numberLt",type:"item"},{name:"numberLte",type:"item"},{type:"divider"},{name:"numberRange",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"array",icon:icons.BlockContentIcon,name:"portableText",operators:[{name:"portableTextMatches",type:"item"},{name:"portableTextNotMatches",type:"item"},{type:"divider"},{name:"portableTextEqual",type:"item"},{name:"portableTextNotEqual",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"reference",icon:icons.LinkIcon,name:"reference",operators:[{name:"referenceEqual",type:"item"},{name:"referenceNotEqual",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"slug",icon:icons.StringIcon,name:"slug",operators:[{name:"slugMatches",type:"item"},{name:"slugNotMatches",type:"item"},{type:"divider"},{name:"slugEqual",type:"item"},{name:"slugNotEqual",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"string",icon:icons.StringIcon,name:"string",operators:[{name:"stringMatches",type:"item"},{name:"stringNotMatches",type:"item"},{type:"divider"},{name:"stringEqual",type:"item"},{name:"stringNotEqual",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"string",icon:icons.ChevronDownIcon,name:"stringList",operators:[{name:"stringListEqual",type:"item"},{name:"stringListNotEqual",type:"item"},{type:"divider"},{name:"stringMatches",type:"item"},{name:"stringNotMatches",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"text",icon:icons.StringIcon,name:"text",operators:[{name:"stringMatches",type:"item"},{name:"stringNotMatches",type:"item"},{type:"divider"},{name:"stringEqual",type:"item"},{name:"stringNotEqual",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"}),defineSearchFilter({fieldType:"url",icon:icons.StringIcon,name:"url",operators:[{name:"stringMatches",type:"item"},{name:"stringNotMatches",type:"item"},{type:"divider"},{name:"stringEqual",type:"item"},{name:"stringNotEqual",type:"item"},{type:"divider"},{name:"defined",type:"item"},{name:"notDefined",type:"item"}],type:"field"})];const intlCache=(()=>{const caches={dateTimeFormat:createCache(),listFormat:createCache(),numberFormat:createCache(),relativeTimeFormat:createCache()};function dateTimeFormat(locale,options){const key=getCacheId(locale,options);let instance=caches.dateTimeFormat[key];if(instance){return instance;}instance=new Intl.DateTimeFormat(locale,options);caches.dateTimeFormat[key]=instance;return instance;}function listFormat(locale,options){const key=getCacheId(locale,options);let instance=caches.listFormat[key];if(instance){return instance;}instance=new Intl.ListFormat(locale,options);caches.listFormat[key]=instance;return instance;}function numberFormat(locale,options){const key=getCacheId(locale,options);let instance=caches.numberFormat[key];if(instance){return instance;}instance=new Intl.NumberFormat(locale,options);caches.numberFormat[key]=instance;return instance;}function relativeTimeFormat(locale,options){const key=getCacheId(locale,options);let instance=caches.relativeTimeFormat[key];if(instance){return instance;}instance=new Intl.RelativeTimeFormat(locale,options);caches.relativeTimeFormat[key]=instance;return instance;}return{dateTimeFormat,listFormat,numberFormat,relativeTimeFormat};})();function createCache(){return/* @__PURE__ */Object.create(null);}function getCacheId(locale,options){return"".concat(locale,"-").concat(JSON.stringify(orderedProps(options)));}function orderedProps(obj){const segments=[];for(const[key,value]of Object.entries(obj)){segments.push("".concat(key,"=").concat(JSON.stringify(value)));}return segments.sort().join("\n");}function useDateTimeFormat(){let options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const currentLocale=useCurrentLocale().id;return intlCache.dateTimeFormat(currentLocale,options);}function useUnitFormatter(){let options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const currentLocale=useCurrentLocale().id;const defaultOptions={unitDisplay:"long",...options,style:"unit"};return function format(value,unit){const formatter=intlCache.numberFormat(currentLocale,{...defaultOptions,unit});return formatter.format(value);};}function ReferencePreviewTitle(_ref343){let{documentId,schemaType}=_ref343;const documentPreviewStore=useDocumentPreviewStore();const{draft,published,isLoading}=reactRx.useMemoObservable(()=>getPreviewStateObservable(documentPreviewStore,schemaType,documentId,""),[documentId,documentPreviewStore,schemaType]);const sanityDocument=React.useMemo(()=>{return{_id:documentId,_type:schemaType.name};},[documentId,schemaType.name]);const previewValue=getPreviewValueWithFallback({draft,published,value:sanityDocument});if(isLoading){return/* @__PURE__ */jsxRuntime.jsx(ui.Skeleton,{animated:true,marginLeft:1,radius:2,style:{width:"10ch",height:"1em"}});}return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:previewValue.title||documentId.slice(0,8)});}function SearchButtonValueDate(_ref344){let{value}=_ref344;const dateFormat=useDateTimeFormat({dateStyle:"medium",timeStyle:value.includeTime?"short":void 0});const date=(value==null?void 0:value.date)?new Date(value.date):null;if(!date||!dateFns.isValid(date)){return null;}return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:dateFormat.format(date)});}function SearchButtonValueDateLast(_ref345){let{value}=_ref345;var _a;const formatUnit=useUnitFormatter();return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:formatUnit(Math.floor((_a=value==null?void 0:value.unitValue)!=null?_a:0),value.unit)});}function SearchButtonValueDateRange(_ref346){let{value}=_ref346;const dateFormat=useDateTimeFormat({dateStyle:"medium",timeStyle:value.includeTime?"short":void 0});const startDate=(value==null?void 0:value.from)?new Date(value.from):null;const endDate=(value==null?void 0:value.to)?new Date(value.to):null;if(!endDate||!startDate||!dateFns.isValid(endDate)||!dateFns.isValid(startDate)){return null;}const from=dateFormat.format(startDate);const to=dateFormat.format(endDate);return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:"".concat(from," \u2192 ").concat(to)});}function SearchButtonValueReference(_ref347){let{value}=_ref347;const schema=useSchema();const documentId=value._ref;const schemaType=schema.get(value._type);if(!schemaType){return null;}return/* @__PURE__ */jsxRuntime.jsx(ReferencePreviewTitle,{documentId,schemaType});}const SearchContext=React.createContext(void 0);function useSearchState(){const context=React.useContext(SearchContext);if(context===void 0){throw new Error("useSearchState must be used within an SearchProvider");}return context;}function SearchFilterNumberInput(_ref348){let{value,onChange}=_ref348;const[uncontrolledValue,setUncontrolledValue]=React.useState(value!=null?value:"");const{state:{fullscreen}}=useSearchState();const{t}=useTranslation();const handleChange=React.useCallback(event=>{setUncontrolledValue(event.currentTarget.value);const numValue=parseFloat(event.currentTarget.value);onChange(Number.isFinite(numValue)?numValue:null);},[onChange]);return/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{fontSize:fullscreen?2:1,onChange:handleChange,placeholder:t("search.filter-number-value-placeholder"),radius:2,step:"any",type:"number",value:uncontrolledValue});}function SearchFilterNumberRangeInput(_ref349){let{onChange,value}=_ref349;var _a,_b;const[to,setTo]=React.useState((_a=value==null?void 0:value.to)!=null?_a:"");const[from,setFrom]=React.useState((_b=value==null?void 0:value.from)!=null?_b:"");const{state:{fullscreen}}=useSearchState();const{t}=useTranslation();const handleToChange=React.useCallback(event=>{var _a2;setTo(event.currentTarget.value);const numValue=parseFloat(event.currentTarget.value);onChange({to:Number.isFinite(numValue)?numValue:null,from:(_a2=value==null?void 0:value.from)!=null?_a2:null});},[value==null?void 0:value.from,onChange]);const handleFromChange=React.useCallback(event=>{var _a2;setFrom(event.currentTarget.value);const numValue=parseFloat(event.currentTarget.value);onChange({to:(_a2=value==null?void 0:value.to)!=null?_a2:null,from:Number.isFinite(numValue)?numValue:null});},[value==null?void 0:value.to,onChange]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{fontSize:fullscreen?2:1,onChange:handleFromChange,placeholder:t("search.filter-number-min-value-placeholder"),radius:2,step:"any",type:"number",value:from})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{fontSize:fullscreen?2:1,onChange:handleToChange,placeholder:t("search.filter-number-max-value-placeholder"),radius:2,step:"any",type:"number",value:to})})]});}function getSchemaField(schemaType,fieldPath){const paths=fieldPath.split(".");const firstPath=paths[0];if(firstPath&&types.isObjectSchemaType(schemaType)){const field=schemaType.fields.find(f=>f.name===firstPath);if(field){const nextPath=paths.slice(1).join(".");if(nextPath){return getSchemaField(field.type,nextPath);}return field;}}return void 0;}var __freeze$Z=Object.freeze;var __defProp$Z=Object.defineProperty;var __template$Z=(cooked,raw)=>__freeze$Z(__defProp$Z(cooked,"raw",{value:__freeze$Z(raw||cooked.slice())}));var _a$Z;const SearchResultItemPreviewBox=styled__default.default(ui.Box)(_a$Z||(_a$Z=__template$Z(["\n  @supports (-webkit-overflow-scrolling: touch) {\n    * [data-ui='Box'] {\n      background-attachment: scroll;\n    }\n  }\n"])));function SearchResultItemPreview(_ref350){let{documentId,layout,presence,schemaType}=_ref350;const documentPreviewStore=useDocumentPreviewStore();const{draft,published,isLoading}=reactRx.useMemoObservable(()=>getPreviewStateObservable(documentPreviewStore,schemaType,documentId,""),[documentId,documentPreviewStore,schemaType]);const sanityDocument=React.useMemo(()=>{return{_id:documentId,_type:schemaType.name};},[documentId,schemaType.name]);const status=React.useMemo(()=>{if(isLoading)return null;return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:3,children:[presence&&presence.length>0&&/* @__PURE__ */jsxRuntime.jsx(DocumentPreviewPresence,{presence}),/* @__PURE__ */jsxRuntime.jsx(ui.Badge,{children:schemaType.title}),/* @__PURE__ */jsxRuntime.jsx(DocumentStatusIndicator,{draft,published})]});},[draft,isLoading,presence,published,schemaType.title]);const tooltip=/* @__PURE__ */jsxRuntime.jsx(DocumentStatus,{draft,published});return/* @__PURE__ */jsxRuntime.jsx(SearchResultItemPreviewBox,{children:/* @__PURE__ */jsxRuntime.jsx(SanityDefaultPreview,{...getPreviewValueWithFallback({draft,published,value:sanityDocument}),isPlaceholder:isLoading!=null?isLoading:true,layout:layout||"default",icon:schemaType.icon,status,tooltip})});}function SearchResultItem(_ref351){let{disableIntentLink,documentId,documentType,layout,onClick,...rest}=_ref351;const schema=useSchema();const type=schema.get(documentType);const documentPresence=useDocumentPresence(documentId);const params=React.useMemo(()=>({id:documentId,type:type==null?void 0:type.name}),[documentId,type==null?void 0:type.name]);const{onClick:onIntentClick,href}=router.useIntentLink({intent:"edit",params});const handleClick=React.useCallback(e=>{if(!disableIntentLink){onIntentClick(e);}onClick==null?void 0:onClick();},[disableIntentLink,onClick,onIntentClick]);if(!type)return null;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{...rest,children:/* @__PURE__ */jsxRuntime.jsx(PreviewCard,{as:"a","data-as":"a",flex:1,href:disableIntentLink?void 0:href,onClick:handleClick,radius:2,tabIndex:-1,children:/* @__PURE__ */jsxRuntime.jsx(SearchResultItemPreview,{documentId,layout,presence:documentPresence,schemaType:type})})});}const IS_MAC=typeof window!="undefined"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform);const DEBUG_FRAGMENT="_debug_search_score";const DEBUG_MODE=false;const SEARCH_LIMIT=1e3;const GLOBAL_SEARCH_KEY="k";const GLOBAL_SEARCH_KEY_MODIFIER=IS_MAC?"Cmd":"Ctrl";const POPOVER_INPUT_PADDING=ui.studioTheme.space[4];const POPOVER_MAX_HEIGHT=735;const POPOVER_MAX_WIDTH=800;const POPOVER_VERTICAL_MARGIN=5;const POPOVER_RADIUS=3;function hasSearchableTerms(_ref352){let{allowEmptyQueries,terms}=_ref352;const hasQuery=allowEmptyQueries?true:terms.query.length>0;const hasFilter=!!terms.filter;const hasSelectedTypes=terms.types.length>0;return hasQuery||hasFilter||hasSelectedTypes;}function getSelectableOmnisearchTypes(schema,typeFilter){return getSearchableOmnisearchTypes(schema).filter(type=>inTypeFilter(type,typeFilter)).sort(sortTypes);}function getSearchableOmnisearchTypes(schema){return getSearchableTypes(schema).filter(type=>!(type.__experimental_omnisearch_visibility===false));}function sortTypes(a,b){var _a,_b;return((_a=a.title)!=null?_a:a.name).localeCompare((_b=b.title)!=null?_b:b.name);}function inTypeFilter(type,typeFilter){var _a;return!typeFilter||((_a=type.title)!=null?_a:type.name).toLowerCase().includes(typeFilter==null?void 0:typeFilter.toLowerCase());}const DEFAULT_DEBOUNCE_TIME=300;const INITIAL_SEARCH_STATE={error:null,hits:[],loading:false,terms:{query:"",types:[]}};function nonNullable(v){return v!==null;}function sanitizeRequest(request){var _a;return{...request,terms:{...request.terms,filter:(_a=request.terms.filter)==null?void 0:_a.trim(),query:request.terms.query.trim()}};}function useSearch(_ref353){let{allowEmptyQueries,initialState,onComplete,onError,onStart,schema}=_ref353;const[searchState,setSearchState]=React.useState(initialState);const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const maxFieldDepth=useSearchMaxFieldDepth();const searchWeighted=React.useMemo(()=>createWeightedSearch(getSearchTypesWithMaxDepth(getSearchableOmnisearchTypes(schema),maxFieldDepth),client,{tag:"search.global",unique:true}),[client,schema,maxFieldDepth]);const handleQueryChange=reactRx.useObservableCallback(inputValue$=>{return inputValue$.pipe(// Ignore null values
operators.filter(nonNullable),// Sanitize request (trim query and filter)
operators.map(sanitizeRequest),// Only emit when values have changed
operators.distinctUntilChanged(isEqual__default$1.default),// Debounce requests
operators.debounce(request=>rxjs.timer((request==null?void 0:request.debounceTime)||DEFAULT_DEBOUNCE_TIME)),// Trigger `onStart` callback
operators.tap(onStart),operators.switchMap(request=>{return rxjs.concat(// Emit loading start
rxjs.of({...INITIAL_SEARCH_STATE,loading:true,options:request.options,terms:request.terms}),// Conditionally trigger search ONLY if we have valid searchable terms.
// Typically, search terms are valid if either query, filter or selected types is non-empty.
// There are exceptions (e.g. searching within <AutoComplete> components) where empty queries are permitted,
// which is what `allowEmptyQueries` is used for.
rxjs.iif(()=>hasSearchableTerms({allowEmptyQueries,terms:request.terms}),// If we have a valid search, run async fetch, map results and trigger `onComplete` / `onError` callbacks
searchWeighted(request.terms,request.options).pipe(operators.map(hits=>({hits})),operators.tap(_ref354=>{let{hits}=_ref354;return onComplete==null?void 0:onComplete(hits);}),operators.catchError(error=>{onError==null?void 0:onError(error);return rxjs.of({...INITIAL_SEARCH_STATE,error,loading:false,options:request.options,terms:request.terms});})),// If there is no valid search, emit an empty observable and trigger `onComplete` event
rxjs.of(rxjs.EMPTY).pipe(operators.tap(()=>onComplete==null?void 0:onComplete([])))),// Emit loading completed
rxjs.of({loading:false}));}),operators.scan((prevState,nextState)=>{return{...prevState,...nextState};},INITIAL_SEARCH_STATE),// Update local search state
operators.tap(setSearchState));},// eslint-disable-next-line react-hooks/exhaustive-deps -- @todo: add onComplete, onError and onStart to the deps list when it's verified that it's safe to do so
[allowEmptyQueries,searchWeighted]);const handleSearch=React.useCallback(searchRequest=>handleQueryChange(searchRequest),[handleQueryChange]);return{handleSearch,searchState};}const DEFAULT_AVAILABLE_CHARS=40;function getDocumentTypesTruncated(_ref355){let{availableCharacters=DEFAULT_AVAILABLE_CHARS,types}=_ref355;if(types.length===0){return{remainingCount:0,types:[]};}const visibleTypes=types.reduce(/* @__PURE__ */function(){let remaining=availableCharacters;return function(acc,val,index){const title=typeTitle(val);remaining-=title.length;if(index===0){acc.push(val);}else if(availableCharacters>title.length&&remaining>title.length){acc.push(val);}return acc;};}(),[]);return{remainingCount:types.length-visibleTypes.length,types:visibleTypes.map(typeTitle)};}function documentTypesTruncated(_ref356){let{t,availableCharacters,types}=_ref356;if(types.length===0){return t("search.document-type-list-all-types");}const{remainingCount,types:visibleTypes}=getDocumentTypesTruncated({availableCharacters,types});const key=remainingCount>0?"search.document-type-list-truncated":"search.document-type-list";return t(key,{count:remainingCount,types:visibleTypes,formatParams:{types:{style:"short",type:"unit"}}});}function typeTitle(schemaType){var _a;return(_a=schemaType.title)!=null?_a:schemaType.name;}var __freeze$Y=Object.freeze;var __defProp$Y=Object.defineProperty;var __template$Y=(cooked,raw)=>__freeze$Y(__defProp$Y(cooked,"raw",{value:__freeze$Y(raw||cooked.slice())}));var _a$Y;const NO_FILTER=()=>true;const StyledText$2=styled__default.default(ui.Text)(_a$Y||(_a$Y=__template$Y(["\n  word-break: break-word;\n"])));const ReferenceAutocomplete=React.forwardRef(function ReferenceAutocomplete2(_ref357,ref){let{onSelect,types=[],value}=_ref357;const autocompletePopoverReferenceElementRef=React.useRef(null);const schema=useSchema();const{state:{fullscreen}}=useSearchState();const{t}=useTranslation();const autocompleteId=React.useId();const[hits,setHits]=React.useState([]);const{handleSearch,searchState}=useSearch({allowEmptyQueries:true,initialState:{hits:[],loading:false,error:null,terms:{query:"",types}},onComplete:weightedHits=>{setHits(weightedHits.map(weightedHit=>({hit:weightedHit,value:weightedHit.hit._id})));},schema});const handleAutocompleteOpenButtonClick=React.useCallback(()=>{handleSearch({debounceTime:0,options:{limit:100},terms:{query:"",types}});},[handleSearch,types]);const handleQueryChange=React.useCallback(query=>{if(query){handleSearch({options:{limit:100},terms:{query:query||"",types}});}else{handleSearch({debounceTime:0,options:{limit:0},terms:{query:"",types}});}},[handleSearch,types]);const handleSelect=React.useCallback(val=>{var _a2;const hit=(_a2=hits.find(h=>h.value===val))==null?void 0:_a2.hit.hit;if(hit){onSelect==null?void 0:onSelect({_ref:getPublishedId(hit._id),_type:hit._type});}},[hits,onSelect]);const placeholderText=React.useMemo(()=>{if(types.length===0){return t("search.action.search-all-types");}const{remainingCount,types:visibleTypes}=getDocumentTypesTruncated({types});const key=remainingCount>0?"search.action.search-specific-types-truncated":"search.action.search-specific-types";return t(key,{count:remainingCount,types:visibleTypes,formatParams:{types:{style:"short",type:"unit"}}});},[types,t]);const renderOption=React.useCallback(option=>{const documentType=option.hit.hit._type;return/* @__PURE__ */jsxRuntime.jsx(SearchResultItem,{disableIntentLink:true,documentId:option.value,documentType,layout:"compact"});},[]);const renderPopover=React.useCallback((props,contentRef)=>{const{content,hidden,onMouseEnter,onMouseLeave}=props;const hasResults=hits&&hits.length>0;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{constrainSize:true,content:/* @__PURE__ */jsxRuntime.jsx("div",{ref:contentRef,children:hasResults?content:searchState.terms.query&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",height:"fill",justify:"center",children:/* @__PURE__ */jsxRuntime.jsx(StyledText$2,{align:"center",muted:true,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"new-document.no-results",values:{searchQuery:searchState.terms.query}})})})})}),fallbackPlacements:["bottom","bottom-end"],matchReferenceWidth:true,onMouseEnter,onMouseLeave,open:!searchState.loading&&!hidden,overflow:"auto",placement:"bottom-start",radius:POPOVER_RADIUS,referenceElement:autocompletePopoverReferenceElementRef.current});},[hits,searchState.loading,searchState.terms.query,t]);return/* @__PURE__ */jsxRuntime.jsx("div",{ref:autocompletePopoverReferenceElementRef,children:/* @__PURE__ */jsxRuntime.jsx(ui.Autocomplete,{"aria-label":placeholderText,filterOption:NO_FILTER,fontSize:fullscreen?2:1,id:autocompleteId,loading:searchState.loading,openButton:{onClick:handleAutocompleteOpenButtonClick},options:hits,onQueryChange:handleQueryChange,onSelect:handleSelect,placeholder:placeholderText,radius:2,ref,renderOption,renderPopover,value:value==null?void 0:value._ref})});});function SearchFilterReferenceInput(_ref358){let{fieldDefinition,onChange,value}=_ref358;const{onClose,state:{documentTypesNarrowed}}=useSearchState();const schema=useSchema();const{t}=useTranslation();const handleChange=React.useCallback(referenceValue=>onChange(referenceValue),[onChange]);const searchableTypes=React.useMemo(()=>{if(!fieldDefinition){return[];}return fieldDefinition.documentTypes.filter(d=>documentTypesNarrowed.includes(d)).flatMap(type=>{const schemaType=schema.get(type);if(schemaType){const field=getSchemaField(schemaType,fieldDefinition.fieldPath);if(types.isArraySchemaType(field==null?void 0:field.type)){return field==null?void 0:field.type.of.filter(types.isReferenceSchemaType).flatMap(i=>i.to);}if(types.isReferenceSchemaType(field==null?void 0:field.type)){return field==null?void 0:field.type.to;}}return[];}).reduce((acc,val)=>{if(acc.findIndex(v=>v.name===(val==null?void 0:val.name))<0){acc.push(val);}return acc;},[]);},[documentTypesNarrowed,fieldDefinition,schema]);const handleClear=React.useCallback(()=>handleChange(null),[handleChange]);const handleClick=React.useCallback(()=>{onClose==null?void 0:onClose();},[onClose]);return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{style:{width:"min(calc(100vw - 40px), 420px)"},children:(value==null?void 0:value._ref)&&(value==null?void 0:value._type)?/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:1,radius:1,shadow:1,children:/* @__PURE__ */jsxRuntime.jsx(SearchResultItem,{documentId:value._ref,documentType:value._type,layout:"compact",onClick:handleClick})}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",onClick:handleClear,text:t("search.filter-reference-clear"),tone:"critical"})]}):/* @__PURE__ */jsxRuntime.jsx(ReferenceAutocomplete,{onSelect:handleChange,types:searchableTypes,value})});}function CustomMenuItem$2(_ref359){let{onClick,selected,title,value}=_ref359;const handleClick=React.useCallback(()=>onClick(value),[onClick,value]);let menuItemText="".concat(title);if(typeof value!=="undefined"&&title!==value){menuItemText+=" (".concat(value,")");}return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{onClick:handleClick,pressed:selected,tone:"default",text:menuItemText});}function SearchFilterStringListInput(_ref360){let{fieldDefinition,onChange,value}=_ref360;const menuButtonId=React.useId();const{state:{documentTypesNarrowed}}=useSearchState();const{t}=useTranslation();const schema=useSchema();const items=React.useMemo(()=>{if(!fieldDefinition){return[];}const options=fieldDefinition.documentTypes.filter(d=>documentTypesNarrowed.includes(d)).map(type=>{const schemaType=schema.get(type);if(schemaType){const field=getSchemaField(schemaType,fieldDefinition.fieldPath);return field==null?void 0:field.type.options;}return null;}).filter(isNonNullable$2);const selectOptions=options.map(o=>o.list).flatMap(list=>list==null?void 0:list.map(l=>toSelectItem(l))).filter(isNonNullable$2);return selectOptions.reduce((acc,val)=>{const prevIndex=acc.findIndex(v=>v.value===(val==null?void 0:val.value));if(prevIndex>-1){const prevValue=acc[prevIndex];acc[prevIndex]={...acc[prevIndex],title:uniq__default.default([...prevValue.title,val.title]).sort()};}else{acc.push({...val,title:[val.title]});}return acc;},[]);},[documentTypesNarrowed,fieldDefinition,schema]);const handleClick=React.useCallback(v=>{onChange(v);},[onChange]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",iconRight:icons.ChevronDownIcon,text:value?String(value):t("search.filter-string-value-select-predefined-value")}),id:menuButtonId||"",menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:items.map((item,index)=>/* @__PURE__ */jsxRuntime.jsx(CustomMenuItem$2,{onClick:handleClick,selected:item.value===value,title:item.title.join(", "),value:item.value||""},index))}),popover:{constrainSize:true,placement:"bottom-start",portal:false,radius:2}});}function toSelectItem(option){return types.isTitledListValue(option)?option:{title:capitalize__default.default("".concat(option)),value:option};}const GteIcon=()=>/* @__PURE__ */jsxRuntime.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 25 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:/* @__PURE__ */jsxRuntime.jsx("path",{d:"M7.04 19V17.512H17.36V19H7.04ZM7.04 15.328V13.624L12.08 11.872L15.32 10.816V10.72L12.08 9.664L7.04 7.912V6.208L17.36 9.88V11.656L7.04 15.328Z",fill:"currentColor"})});const GtIcon=()=>/* @__PURE__ */jsxRuntime.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 25 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:/* @__PURE__ */jsxRuntime.jsx("path",{d:"M7.568 18.848V16.952L14.792 12.08V11.984L7.568 7.112V5.216L16.52 11.288V12.776L7.568 18.848Z",fill:"currentColor"})});const LteIcon=()=>/* @__PURE__ */jsxRuntime.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 25 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:/* @__PURE__ */jsxRuntime.jsx("path",{d:"M7.04 19V17.512H17.36V19H7.04ZM17.36 15.328L7.04 11.656V9.88L17.36 6.208V7.912L12.32 9.664L9.08 10.72V10.816L12.32 11.872L17.36 13.624V15.328Z",fill:"currentColor"})});const LtIcon=()=>/* @__PURE__ */jsxRuntime.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 25 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:/* @__PURE__ */jsxRuntime.jsx("path",{d:"M16.952 19.632L8 13.56V12.072L16.952 6V7.896L9.728 12.768V12.864L16.952 17.736V19.632Z",fill:"currentColor"})});function defineSearchOperator(definition){return definition;}function toJSON(val){return JSON.stringify(val);}const arrayOperators={arrayCountEqual:defineSearchOperator({nameKey:"search.operator.array-count-equal.name",descriptionKey:"search.operator.array-count-equal.description",groqFilter:_ref361=>{let{fieldPath,value}=_ref361;return Number.isFinite(value)&&fieldPath?"count(".concat(fieldPath,") == ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterNumberInput,type:"arrayCountEqual"}),arrayCountGt:defineSearchOperator({nameKey:"search.operator.array-count-gt.name",descriptionKey:"search.operator.array-count-gt.description",groqFilter:_ref362=>{let{fieldPath,value}=_ref362;return Number.isFinite(value)&&fieldPath?"count(".concat(fieldPath,") > ").concat(toJSON(value)):null;},icon:GtIcon,initialValue:null,inputComponent:SearchFilterNumberInput,type:"arrayCountGt"}),arrayCountGte:defineSearchOperator({nameKey:"search.operator.array-count-gte.name",descriptionKey:"search.operator.array-count-gte.description",groqFilter:_ref363=>{let{fieldPath,value}=_ref363;return Number.isFinite(value)&&fieldPath?"count(".concat(fieldPath,") >= ").concat(toJSON(value)):null;},icon:GteIcon,initialValue:null,inputComponent:SearchFilterNumberInput,type:"arrayCountGte"}),arrayCountLt:defineSearchOperator({nameKey:"search.operator.array-count-lt.name",descriptionKey:"search.operator.array-count-lt.description",groqFilter:_ref364=>{let{fieldPath,value}=_ref364;return Number.isFinite(value)&&fieldPath?"count(".concat(fieldPath,") < ").concat(toJSON(value)):null;},icon:LtIcon,initialValue:null,inputComponent:SearchFilterNumberInput,type:"arrayCountLt"}),arrayCountLte:defineSearchOperator({nameKey:"search.operator.array-count-lte.name",descriptionKey:"search.operator.array-count-lte.description",groqFilter:_ref365=>{let{fieldPath,value}=_ref365;return Number.isFinite(value)&&fieldPath?"count(".concat(fieldPath,") <= ").concat(toJSON(value)):null;},icon:LteIcon,initialValue:null,inputComponent:SearchFilterNumberInput,type:"arrayCountLte"}),arrayCountNotEqual:defineSearchOperator({nameKey:"search.operator.array-count-not-equal.name",descriptionKey:"search.operator.array-count-not-equal.description",groqFilter:_ref366=>{let{fieldPath,value}=_ref366;return Number.isFinite(value)&&fieldPath?"count(".concat(fieldPath,") != ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterNumberInput,type:"arrayCountNotEqual"}),arrayCountRange:defineSearchOperator({nameKey:"search.operator.array-count-range.name",descriptionKey:"search.operator.array-count-range.description",groqFilter:_ref367=>{let{fieldPath,value}=_ref367;return Number.isFinite(value==null?void 0:value.to)&&Number.isFinite(value==null?void 0:value.from)&&fieldPath?"count(".concat(fieldPath,") > ").concat(toJSON(value==null?void 0:value.from)," && count(").concat(fieldPath,") < ").concat(toJSON(value==null?void 0:value.to)):"";},initialValue:null,inputComponent:SearchFilterNumberRangeInput,type:"arrayCountRange"}),arrayListIncludes:defineSearchOperator({nameKey:"search.operator.array-list-includes.name",descriptionKey:"search.operator.array-list-includes.description",groqFilter:_ref368=>{let{fieldPath,value}=_ref368;return value&&fieldPath?"".concat(toJSON(value)," in ").concat(fieldPath):null;},initialValue:null,inputComponent:SearchFilterStringListInput,type:"arrayListIncludes"}),arrayListNotIncludes:defineSearchOperator({nameKey:"search.operator.array-list-not-includes.name",descriptionKey:"search.operator.array-list-not-includes.description",groqFilter:_ref369=>{let{fieldPath,value}=_ref369;return value&&fieldPath?"!(".concat(toJSON(value)," in ").concat(fieldPath,")"):null;},initialValue:null,inputComponent:SearchFilterStringListInput,type:"arrayListNotIncludes"}),arrayReferenceIncludes:defineSearchOperator({nameKey:"search.operator.array-reference-includes.name",descriptionKey:"search.operator.array-reference-includes.description",buttonValueComponent:SearchButtonValueReference,groqFilter:_ref370=>{let{fieldPath,value}=_ref370;return(value==null?void 0:value._ref)&&fieldPath?"".concat(toJSON(value._ref)," in ").concat(fieldPath,"[]._ref"):null;},initialValue:null,inputComponent:SearchFilterReferenceInput,type:"arrayReferenceIncludes"}),arrayReferenceNotIncludes:defineSearchOperator({nameKey:"search.operator.array-reference-not-includes.name",descriptionKey:"search.operator.array-reference-not-includes.description",buttonValueComponent:SearchButtonValueReference,groqFilter:_ref371=>{let{fieldPath,value}=_ref371;return(value==null?void 0:value._ref)&&fieldPath?"!(".concat(toJSON(value._ref)," in ").concat(fieldPath,"[]._ref)"):null;},initialValue:null,inputComponent:SearchFilterReferenceInput,type:"arrayReferenceNotIncludes"})};const SourceContext=React.createContext(null);function SourceProvider(_ref372){let{children,...props}=_ref372;const parentSource=React.useContext(SourceContext);const{unstable_sources:sources}=useWorkspace();if("source"in props){const{source}=props;return/* @__PURE__ */jsxRuntime.jsx(SourceContext.Provider,{value:source,children});}if("name"in props){const{name}=props;const source=sources.find(s=>s.name===name);if(!source){throw new Error("Could not find source with name `".concat(name,"` in current workspace"));}if(parentSource===source)return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children});return/* @__PURE__ */jsxRuntime.jsx(SourceContext.Provider,{value:source,children});}throw new Error("Invalid props passed into SourceProvider. A `name` or a `source` object is required.");}function useSource(){const source=React.useContext(SourceContext);if(!source)throw new Error("Could not find `source` context");return source;}function AssetSourceError(props){const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{...props,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"flex-start",gap:3,children:[/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{tone:"caution",children:/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{size:1,tone:"caution",weight:"medium",children:t("search.error.no-valid-asset-source-title")}),/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{size:1,tone:"caution",children:t("search.error.no-valid-asset-source-only-default-description")}),/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{size:1,tone:"caution",children:t("search.error.no-valid-asset-source-check-config-description")})]})]})});}function FileReferencePreview(_ref373){let{reference}=_ref373;const documentPreviewStore=useDocumentPreviewStore();const observeAsset=React.useCallback(id=>observeFileAsset(documentPreviewStore,id),[documentPreviewStore]);return/* @__PURE__ */jsxRuntime.jsx(WithReferencedAsset,{observeAsset,reference,waitPlaceholder:/* @__PURE__ */jsxRuntime.jsx(FileSkeleton,{}),children:asset=>/* @__PURE__ */jsxRuntime.jsx(FilePreview,{asset})});}function FilePreview(_ref374){let{asset}=_ref374;return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:2,shadow:1,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",justify:"space-between",wrap:"nowrap",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:3,radius:1,shadow:1,tone:"transparent",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:/* @__PURE__ */jsxRuntime.jsx(icons.BinaryDocumentIcon,{})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{flex:1,space:2,marginLeft:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",weight:"medium",children:(asset==null?void 0:asset.originalFilename)||asset._id}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,children:formatBytes(asset.size)})]})]})});}function FileSkeleton(){return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:2,shadow:1,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",justify:"flex-start",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:3,radius:1,shadow:1,tone:"transparent",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:/* @__PURE__ */jsxRuntime.jsx(icons.BinaryDocumentIcon,{})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{flex:1,space:2,marginLeft:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.TextSkeleton,{animated:true,style:{width:"100%"},radius:1}),/* @__PURE__ */jsxRuntime.jsx(ui.TextSkeleton,{animated:true,style:{width:"100%"},radius:1})]})]})});}var __freeze$X=Object.freeze;var __defProp$X=Object.defineProperty;var __template$X=(cooked,raw)=>__freeze$X(__defProp$X(cooked,"raw",{value:__freeze$X(raw||cooked.slice())}));var _a$X,_b$s;const Container=styled__default.default(ui.Card)(_a$X||(_a$X=__template$X(["\n  position: relative;\n  padding-bottom: 100%;\n"])));const Image$3=styled__default.default.img(_b$s||(_b$s=__template$X(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: block;\n  object-fit: contain;\n"])));function ImageReferencePreview(_ref375){let{reference}=_ref375;const documentPreviewStore=useDocumentPreviewStore();const observeAsset=React.useCallback(id=>observeImageAsset(documentPreviewStore,id),[documentPreviewStore]);return/* @__PURE__ */jsxRuntime.jsx(WithReferencedAsset,{observeAsset,reference,children:asset=>/* @__PURE__ */jsxRuntime.jsx(ImagePreview,{asset})});}function ImagePreview(_ref376){let{asset}=_ref376;const[loaded,setLoaded]=React.useState(false);const imageUrl="".concat(asset.url,"?h=800&fit=max");const handleLoad=React.useCallback(()=>setLoaded(true),[]);return/* @__PURE__ */jsxRuntime.jsxs(Container,{__unstable_checkered:true,border:true,children:[!loaded&&/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{fill:true,showText:true}),/* @__PURE__ */jsxRuntime.jsx(Image$3,{onLoad:handleLoad,src:imageUrl})]});}function AssetPreview(_ref377){let{reference}=_ref377;if(!reference){return null;}if(reference._type.startsWith("sanity.fileAsset")){return/* @__PURE__ */jsxRuntime.jsx(FileReferencePreview,{reference});}if(reference._type.startsWith("sanity.imageAsset")){return/* @__PURE__ */jsxRuntime.jsx(ImageReferencePreview,{reference});}return null;}var __freeze$W=Object.freeze;var __defProp$W=Object.defineProperty;var __template$W=(cooked,raw)=>__freeze$W(__defProp$W(cooked,"raw",{value:__freeze$W(raw||cooked.slice())}));var _a$W;const ASSET_TYPE={file:"sanity.fileAsset",image:"sanity.imageAsset"};const ContainerBox=styled__default.default(ui.Box)(_a$W||(_a$W=__template$W(["\n  width: min(calc(100vw - 40px), 320px);\n"])));function SearchFilterAssetInput(type){return function FieldInputAssetWithType(_ref378){let{onChange,value}=_ref378;const[selectedAssetSource,setSelectedAssetSource]=React.useState(null);const[selectedAssetFromSource,setSelectedAssetFromSource]=React.useState(null);useSearchState();const{file,image}=useSource().form;const{t}=useTranslation();const assetSources=React.useMemo(()=>{switch(type){case"file":return file.assetSources.filter(a=>a.name===FileSource.name);case"image":return image.assetSources.filter(a=>a.name===ImageSource.name);default:throw Error("Unknown asset source found");}},[file.assetSources,image.assetSources]);const menuButtonId=React.useId();const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const handleClear=React.useCallback(()=>{setSelectedAssetFromSource(null);onChange(null);},[onChange]);const handleCloseAssetSource=React.useCallback(()=>{setSelectedAssetSource(null);},[]);const handleSelectAssetFromSource=React.useCallback(assetFromSource=>{const firstAsset=assetFromSource[0];setSelectedAssetFromSource(firstAsset);handleCloseAssetSource();},[handleCloseAssetSource]);const handleSelectAssetSource=React.useCallback(source=>setSelectedAssetSource(source),[]);React.useEffect(()=>{if((selectedAssetFromSource==null?void 0:selectedAssetFromSource.kind)==="assetDocumentId"&&typeof(selectedAssetFromSource==null?void 0:selectedAssetFromSource.value)==="string"){if(type){onChange({_ref:selectedAssetFromSource.value,_type:ASSET_TYPE[type]});}}},[client,onChange,selectedAssetFromSource]);const AssetSourceComponent=selectedAssetSource==null?void 0:selectedAssetSource.component;const buttonText=t(value?"search.filter-asset-change":"search.filter-asset-select",{context:type});const accept=get__default.default(type,"options.accept",type==="image"?"image/*":"");return/* @__PURE__ */jsxRuntime.jsx(ContainerBox,{children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[selectedAssetSource&&AssetSourceComponent&&/* @__PURE__ */jsxRuntime.jsx(ui.Portal,{children:/* @__PURE__ */jsxRuntime.jsx(AssetSourceComponent,{assetType:type,dialogHeaderTitle:t("search.action.select-asset",{context:type}),onClose:handleCloseAssetSource,onSelect:handleSelectAssetFromSource,selectedAssets:[],selectionType:"single",accept})}),value&&/* @__PURE__ */jsxRuntime.jsx(AssetPreview,{reference:value}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:2,children:[assetSources.length===0&&/* @__PURE__ */jsxRuntime.jsx(AssetSourceError,{padding:2}),assetSources.length>0&&/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:assetSources.length>1?/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:value?icons.UndoIcon:icons.SearchIcon,iconRight:icons.ChevronDownIcon,mode:"ghost",width:value?"fill":void 0,text:buttonText}),id:menuButtonId,menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:assetSources.map(source=>/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{icon:source.icon||icons.ImageIcon,onClick:()=>handleSelectAssetSource(source),text:(source.i18nKey?t(source.i18nKey):source.title)||startCase__default.default(source.name)},source.name))}),popover:{constrainSize:true,portal:false,radius:2}}):/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:value?icons.UndoIcon:icons.SearchIcon,mode:"ghost",onClick:()=>handleSelectAssetSource(assetSources[0]),width:value?"fill":void 0,text:buttonText})}),value&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",onClick:handleClear,width:"fill",text:t("search.filter-asset-clear"),tone:"critical"})]})]})});};}const assetOperators={assetFileEqual:defineSearchOperator({nameKey:"search.operator.asset-file-equal.name",descriptionKey:"search.operator.asset-file-equal.description",buttonValueComponent:SearchButtonValueReference,groqFilter:_ref379=>{let{fieldPath,value}=_ref379;return(value==null?void 0:value._ref)&&fieldPath?"".concat(fieldPath,".asset._ref == ").concat(toJSON(value._ref)):null;},initialValue:null,inputComponent:SearchFilterAssetInput("file"),label:"is",type:"assetFileEqual"}),assetFileNotEqual:defineSearchOperator({nameKey:"search.operator.asset-file-not-equal.name",descriptionKey:"search.operator.asset-file-not-equal.description",buttonValueComponent:SearchButtonValueReference,groqFilter:_ref380=>{let{fieldPath,value}=_ref380;return(value==null?void 0:value._ref)&&fieldPath?"".concat(fieldPath,".asset._ref != ").concat(toJSON(value._ref)):null;},initialValue:null,inputComponent:SearchFilterAssetInput("file"),label:"is not",type:"assetFileNotEqual"}),assetImageEqual:defineSearchOperator({nameKey:"search.operator.asset-image-equal.name",descriptionKey:"search.operator.asset-image-equal.description",buttonValueComponent:SearchButtonValueReference,groqFilter:_ref381=>{let{fieldPath,value}=_ref381;return(value==null?void 0:value._ref)&&fieldPath?"".concat(fieldPath,".asset._ref == ").concat(toJSON(value._ref)):null;},initialValue:null,inputComponent:SearchFilterAssetInput("image"),label:"is",type:"assetImageEqual"}),assetImageNotEqual:defineSearchOperator({nameKey:"search.operator.asset-image-not-equal.name",descriptionKey:"search.operator.asset-image-not-equal.description",buttonValueComponent:SearchButtonValueReference,groqFilter:_ref382=>{let{fieldPath,value}=_ref382;return(value==null?void 0:value._ref)&&fieldPath?"".concat(fieldPath,".asset._ref != ").concat(toJSON(value._ref)):null;},initialValue:null,inputComponent:SearchFilterAssetInput("image"),label:"is not",type:"assetImageNotEqual"})};function SearchFilterBooleanInput(_ref383){let{onChange,value}=_ref383;const{state:{fullscreen}}=useSearchState();const{t}=useTranslation();const handleChange=React.useCallback(event=>{onChange(event.currentTarget.value==="true");},[onChange]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Select,{fontSize:fullscreen?2:1,onChange:handleChange,radius:2,value:String(value!=null?value:true),children:[/* @__PURE__ */jsxRuntime.jsx("option",{value:"true",children:t("search.filter-boolean-true")}),/* @__PURE__ */jsxRuntime.jsx("option",{value:"false",children:t("search.filter-boolean-false")})]});}const booleanOperators={booleanEqual:defineSearchOperator({nameKey:"search.operator.boolean-equal.name",descriptionKey:"search.operator.boolean-equal.description",groqFilter:_ref384=>{let{fieldPath,value}=_ref384;return typeof value!=="undefined"&&fieldPath?"".concat(fieldPath," == ").concat(toJSON(value)):null;},initialValue:true,inputComponent:SearchFilterBooleanInput,type:"booleanEqual"})};var __freeze$V=Object.freeze;var __defProp$V=Object.defineProperty;var __template$V=(cooked,raw)=>__freeze$V(__defProp$V(cooked,"raw",{value:__freeze$V(raw||cooked.slice())}));var _a$V;const TimeLabelText=styled__default.default(ui.Text)(_a$V||(_a$V=__template$V(["\n  cursor: default;\n"])));function DateIncludeTimeFooter(_ref385){let{onChange,value}=_ref385;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:2,justify:"flex-end",marginTop:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{children:/* @__PURE__ */jsxRuntime.jsx(TimeLabelText,{muted:true,onClick:onChange,size:1,weight:"medium",children:t("calendar.action.include-time-label")})}),/* @__PURE__ */jsxRuntime.jsx(ui.Switch,{checked:value,label:t("calendar.action.include-time-label"),onChange})]});}const CalendarContext=React.createContext(void 0);function useCalendar(){const context=React.useContext(CalendarContext);if(context===void 0){throw new Error("useCalendar must be used within an CalendarContext.Provider");}return context;}function CalendarHeader(props){const{t}=useTranslation();const monthFormatter=useDateTimeFormat({month:"long",year:"numeric"});const{focusedDate}=useCalendar();const{moveFocusedDate,onNowClick}=props;const handlePrevMonthClick=React.useCallback(()=>moveFocusedDate(-1),[moveFocusedDate]);const handleNextMonthClick=React.useCallback(()=>moveFocusedDate(1),[moveFocusedDate]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",flex:1,justify:"space-between",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Inline,{paddingLeft:2,space:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:upperFirst__default.default(monthFormatter.format(focusedDate))})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("calendar.action.go-to-today-aria-label"),mode:"bleed",onClick:onNowClick,text:t("calendar.action.go-to-today")}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.ChevronLeftIcon,mode:"bleed",onClick:handlePrevMonthClick,tooltipProps:{content:t("calendar.action.go-to-previous-month")}}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.ChevronRightIcon,mode:"bleed",onClick:handleNextMonthClick,tooltipProps:{content:t("calendar.action.go-to-next-month")}})]})]});}var __freeze$U=Object.freeze;var __defProp$U=Object.defineProperty;var __template$U=(cooked,raw)=>__freeze$U(__defProp$U(cooked,"raw",{value:__freeze$U(raw||cooked.slice())}));var _a$U,_b$r;const CircleSvg=styled__default.default.svg(_ref386=>{let{theme}=_ref386;return styled.css(_a$U||(_a$U=__template$U(["\n    bottom: 0;\n    left: 0;\n    position: absolute;\n    right: 0;\n    top: 0;\n\n    circle {\n      stroke: ",";\n      stroke-width: 3;\n      fill: none;\n    }\n  "])),theme.sanity.color.card.enabled.border);});const CustomCard=styled__default.default(ui.Card)(_b$r||(_b$r=__template$U(["\n  position: relative;\n\n  &[data-focused='true'] {\n    z-index: 1;\n  }\n\n  &[data-start-date='true'] {\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n  }\n\n  &[data-end-date='true'] {\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n  }\n\n  &[data-within-range='true'] {\n    border-radius: 0;\n  }\n"])));function CalendarDay(_ref387){let{date,onSelect}=_ref387;const handleClick=React.useCallback(()=>{onSelect(date);},[date,onSelect]);const{date:selectedDate,endDate:selectedEndDate,focusedDate,selectRange}=useCalendar();const isSelected=selectedDate&&dateFns.isSameDay(date,selectedDate);const isStartDate=selectRange&&selectedDate&&dateFns.isSameDay(date,selectedDate);const isEndDate=selectRange&&selectedEndDate&&dateFns.isSameDay(date,selectedEndDate);const isCurrentMonth=dateFns.isSameMonth(date,focusedDate);const isFocused=focusedDate&&dateFns.isSameDay(date,focusedDate);const isToday=dateFns.isSameDay(date,/* @__PURE__ */new Date());const isWithinRange=selectedDate&&selectedEndDate&&!isStartDate&&!isEndDate&&dateFns.isAfter(date,selectedDate)&&dateFns.isBefore(date,selectedEndDate);return/* @__PURE__ */jsxRuntime.jsxs(CustomCard,{__unstable_focusRing:true,"aria-label":date.toDateString(),"aria-pressed":isSelected,"data-end-date":isEndDate?true:void 0,"data-focused":isFocused?"true":"","data-ui":"CalendarDay","aria-selected":isSelected,"data-start-date":isStartDate?true:void 0,"data-within-range":isWithinRange?true:void 0,forwardedAs:"button",onClick:handleClick,paddingX:3,paddingY:2,radius:2,role:"button",selected:isSelected||isStartDate||isEndDate,tabIndex:-1,tone:isWithinRange?"primary":"default",children:[isToday&&/* @__PURE__ */jsxRuntime.jsx(CircleSvg,{height:"100%",preserveAspectRatio:"xMidYMid meet",vectorEffect:"non-scaling-stroke",viewBox:"0 0 100 100",width:"100%",children:/* @__PURE__ */jsxRuntime.jsx("circle",{cx:"50",cy:"50",r:"40%"})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",muted:!isSelected&&!isCurrentMonth,size:1,weight:isCurrentMonth?"medium":"regular",children:date.getDate()})]});}const SHORT_WEEK_DAY_KEYS=["calendar.weekday-names.short.monday","calendar.weekday-names.short.tuesday","calendar.weekday-names.short.wednesday","calendar.weekday-names.short.thursday","calendar.weekday-names.short.friday","calendar.weekday-names.short.saturday","calendar.weekday-names.short.sunday"];range__default.default(0,24);const ARROW_KEYS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];const TAIL_WEEKDAYS=[1,2,3,4,5,6];const getWeekStartsOfMonth=(date,weekStartsOn)=>{const firstDay=dateFns.startOfMonth(date);return dateFns.eachWeekOfInterval({start:firstDay,end:dateFns.lastDayOfMonth(firstDay)},{weekStartsOn:weekStartsOn===7?0:weekStartsOn});};const getWeekDaysFromWeekStarts=weekStarts=>{return weekStarts.map(weekStart=>[weekStart,...TAIL_WEEKDAYS.map(d=>dateFns.addDays(weekStart,d))]);};const useWeeksOfMonth=date=>{const{weekInfo}=useCurrentLocale();return getWeekDaysFromWeekStarts(getWeekStartsOfMonth(date,weekInfo.firstDay)).map(days=>({number:dateFns.getWeek(days[0]),days}));};var __freeze$T=Object.freeze;var __defProp$T=Object.defineProperty;var __template$T=(cooked,raw)=>__freeze$T(__defProp$T(cooked,"raw",{value:__freeze$T(raw||cooked.slice())}));var _a$T;const WEEK_DAY_NAME_KEYS={// Monday is start of the week
1:SHORT_WEEK_DAY_KEYS,// Sunday is start of the week
7:[SHORT_WEEK_DAY_KEYS[6],...SHORT_WEEK_DAY_KEYS.slice(0,6)]};const CustomGrid=styled__default.default(ui.Grid)(_a$T||(_a$T=__template$T(["\n  grid-template-columns: repeat(7, minmax(44px, auto));\n"])));function CalendarMonth(_ref388){let{hidden,onSelect}=_ref388;const{focusedDate,firstWeekDay}=useCalendar();const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{"aria-hidden":hidden||false,"data-ui":"CalendarMonth",children:/* @__PURE__ */jsxRuntime.jsxs(CustomGrid,{gapY:1,children:[WEEK_DAY_NAME_KEYS[firstWeekDay].map(weekdayDay=>/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingBottom:3,paddingTop:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",size:1,weight:"medium",children:t(weekdayDay)})},weekdayDay)),useWeeksOfMonth(focusedDate).map((week,weekIdx)=>week.days.map((weekDayDate,dayIdx)=>{return/* @__PURE__ */jsxRuntime.jsx(CalendarDay,{date:weekDayDate,onSelect},"".concat(weekIdx,"-").concat(dayIdx));}))]})});}const PRESERVE_FOCUS_ELEMENT=/* @__PURE__ */jsxRuntime.jsx("span",{"data-preserve-focus":true,style:{overflow:"hidden",position:"absolute",outline:"none"},tabIndex:-1});function Calendar(props){const{date,endDate,onSelect,selectRange,selectTime}=props;const[calendarElement,setCalendarElement]=React.useState(null);const[selectEndValue,setSelectEndValue]=React.useState(false);const[focusedDate,setFocusedDate]=React.useState(date||/* @__PURE__ */new Date());const previousDate=React.useRef(date||null);const previousEndDate=React.useRef(endDate||null);const{weekInfo:{firstDay:firstWeekDay}}=useCurrentLocale();const focusCurrentWeekDay=React.useCallback(()=>{var _a;(_a=calendarElement==null?void 0:calendarElement.querySelector('[data-focused="true"]'))==null?void 0:_a.focus();},[calendarElement]);const handleDateChange=React.useCallback(d=>{const selectedDate=dateFns.set(d,{hours:d.getHours(),minutes:d.getMinutes(),seconds:0,milliseconds:0});const dateIsBeforeStartDate=date&&dateFns.isBefore(selectedDate,date);const dateIsAfterEndDate=endDate&&dateFns.isAfter(selectedDate,endDate);if(selectRange){if(dateIsBeforeStartDate||dateIsAfterEndDate){onSelect({date:selectedDate,endDate:null});return;}if(selectEndValue){onSelect({date:date||null,endDate:selectedDate});}else{onSelect({date:selectedDate,endDate:date?null:endDate||null});}}else{onSelect({date:selectedDate});}},[date,endDate,onSelect,selectEndValue,selectRange]);const handleNowClick=React.useCallback(()=>{const now=/* @__PURE__ */new Date();if(selectRange){setFocusedDate(now);}else{onSelect({date:now});}},[onSelect,selectRange,setFocusedDate]);const handleKeyDown=React.useCallback(event=>{var _a;if(!ARROW_KEYS.includes(event.key)){return;}event.preventDefault();if(event.target.hasAttribute("data-calendar-grid")){focusCurrentWeekDay();return;}if(event.key==="ArrowUp"){setFocusedDate(dateFns.addDays(focusedDate,-7));}if(event.key==="ArrowDown"){setFocusedDate(dateFns.addDays(focusedDate,7));}if(event.key==="ArrowLeft"){setFocusedDate(dateFns.addDays(focusedDate,-1));}if(event.key==="ArrowRight"){setFocusedDate(dateFns.addDays(focusedDate,1));}(_a=calendarElement==null?void 0:calendarElement.querySelector("[data-preserve-focus]"))==null?void 0:_a.focus();},[calendarElement,focusCurrentWeekDay,focusedDate,setFocusedDate]);const moveFocusedDate=React.useCallback(by=>setFocusedDate(dateFns.addMonths(focusedDate,by)),[focusedDate,setFocusedDate]);React.useEffect(()=>{focusCurrentWeekDay();},[focusCurrentWeekDay]);React.useEffect(()=>{var _a;const currentFocusInCalendarGrid=(_a=document.activeElement)==null?void 0:_a.matches("[data-calendar-grid], [data-calendar-grid] [data-preserve-focus]");if(// Only move focus if it's currently in the calendar grid
currentFocusInCalendarGrid){focusCurrentWeekDay();}},[focusCurrentWeekDay,focusedDate]);React.useEffect(()=>{var _a,_b;const dateChanged=(date==null?void 0:date.getTime())!==((_a=previousDate.current)==null?void 0:_a.getTime());const endDateChanged=(endDate==null?void 0:endDate.getTime())!==((_b=previousEndDate.current)==null?void 0:_b.getTime());const onlyDateChanged=dateChanged&&!endDateChanged;const onlyEndDateChanged=!dateChanged&&endDateChanged;const dateIsAfterEndDate=date&&endDate&&dateFns.isAfter(date,endDate);if(onlyDateChanged){if(dateIsAfterEndDate){setSelectEndValue(true);onSelect({date,endDate:null});}setSelectEndValue(!!date);if(date)setFocusedDate(date);}if(onlyEndDateChanged){if(dateIsAfterEndDate){setSelectEndValue(true);onSelect({date:endDate,endDate:null});}setSelectEndValue(!!date&&!endDate);if(endDate)setFocusedDate(endDate);}if(dateChanged&&endDateChanged){setSelectEndValue(true);if(date)setFocusedDate(date);}previousDate.current=date||null;previousEndDate.current=endDate||null;},[date,endDate,onSelect]);return/* @__PURE__ */jsxRuntime.jsx(CalendarContext.Provider,{value:{date,endDate,focusedDate,selectRange,selectTime,firstWeekDay},children:/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{"data-ui":"Calendar",ref:setCalendarElement,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(CalendarHeader,{moveFocusedDate,onNowClick:handleNowClick})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{"data-calendar-grid":true,onKeyDown:handleKeyDown,marginTop:2,overflow:"hidden",tabIndex:0,children:[/* @__PURE__ */jsxRuntime.jsx(CalendarMonth,{onSelect:handleDateChange}),PRESERVE_FOCUS_ELEMENT]})]})});}function DatePicker(_ref389){let{date,endDate,onChange,selectRange,selectTime}=_ref389;const handleSelect=React.useCallback(dates=>{onChange(dates);},[onChange]);return/* @__PURE__ */jsxRuntime.jsx(Calendar,{date,endDate,onSelect:handleSelect,selectRange,selectTime});}var __freeze$S=Object.freeze;var __defProp$S=Object.defineProperty;var __template$S=(cooked,raw)=>__freeze$S(__defProp$S(cooked,"raw",{value:__freeze$S(raw||cooked.slice())}));var _a$S;const CustomTextInputBox=styled__default.default(ui.Box)(_ref390=>{let{$background,$smallClearButton}=_ref390;return styled.css(_a$S||(_a$S=__template$S(["\n    width: 100%;\n\n    input + span {\n      background: ",";\n    }\n\n    [data-qa='clear-button'] {\n      background: none;\n      box-shadow: none;\n      display: flex; /* TODO: hack, currently used to vertically center <TextInput>'s clearButton */\n      transform: ",";\n      &:hover {\n        opacity: 0.5;\n      }\n    }\n  "])),_ref391=>{let{theme}=_ref391;return $background?theme.sanity.color.card.disabled.bg2:"transparent";},$smallClearButton?"scale(0.8)":"scale(1)");});const CustomTextInput=React.forwardRef(function CustomTextInput2(props,ref){const{$background,$smallClearButton,...rest}=props;return/* @__PURE__ */jsxRuntime.jsx(CustomTextInputBox,{$background,$smallClearButton,children:/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{...rest,ref})});});function getDateISOString(_ref392){let{date,dateOnly,roundDay}=_ref392;let adjustedDate;switch(roundDay){case"end":adjustedDate=dateFns.endOfDay(date);break;case"start":adjustedDate=dateFns.startOfDay(date);break;default:adjustedDate=date;break;}return dateOnly?adjustedDate.toISOString().split("T")[0]:adjustedDate.toISOString();}const FORMAT={date:{exampleDate:"Jan 1, 2000",pattern:"MMM d, yyyy"},datetime:{exampleDate:"Jan 1, 2000 12:00 AM",pattern:"MMM d, yyyy p"}};function ParsedDateTextInput(_ref393){let{isDateTime,onChange,placeholderDate,isDateTimeFormat,value,...rest}=_ref393;const{t}=useTranslation();const dateFormat=isDateTimeFormat?FORMAT.datetime.pattern:FORMAT.date.pattern;const[customValidity,setCustomValidity]=React.useState(void 0);const[inputValue,setInputValue]=React.useState(()=>{if(!value){return"";}const inputValueDate=new Date(value);return dateFns.format(inputValueDate,dateFormat);});const formattedPlaceholder=React.useMemo(()=>{const date=placeholderDate||/* @__PURE__ */new Date();return dateFns.format(date,dateFormat);},[dateFormat,placeholderDate]);const processInputString=React.useCallback(_ref394=>{let{dateString,triggerOnChange}=_ref394;if(!dateString){return;}const dateParsed=dateFns.parse(dateString,dateFormat,/* @__PURE__ */new Date());const validDate=dateFns.isValid(dateParsed);if(validDate){if(triggerOnChange){onChange(getDateISOString({date:dateParsed,dateOnly:!isDateTime}));}setInputValue(dateFns.format(dateParsed,dateFormat));}setCustomValidity(validDate?void 0:"Invalid ".concat(isDateTime?"datetime":"date"));},[dateFormat,isDateTime,onChange]);const handleTextInputBlur=React.useCallback(()=>{processInputString({dateString:inputValue,triggerOnChange:true});},[inputValue,processInputString]);const handleTextInputChange=React.useCallback(event=>{setInputValue(event.currentTarget.value);},[]);const handleTextInputClear=React.useCallback(()=>{onChange(null);setCustomValidity(void 0);setInputValue("");},[onChange]);const handleTextInputKeyDown=React.useCallback(event=>{if(event.key==="Enter"){processInputString({dateString:inputValue,triggerOnChange:true});}},[inputValue,processInputString]);React.useEffect(()=>{const updatedDate=value&&new Date(value);if(updatedDate){processInputString({dateString:dateFns.format(updatedDate,dateFormat),triggerOnChange:false});}},[dateFormat,processInputString,isDateTimeFormat,value]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:t("calendar.error.must-be-in-format",{exampleDate:isDateTimeFormat?FORMAT.datetime.exampleDate:FORMAT.date.exampleDate}),disabled:!customValidity,placement:"top",portal:true,children:/* @__PURE__ */jsxRuntime.jsx(CustomTextInput,{...rest,clearButton:!!inputValue,customValidity,onBlur:handleTextInputBlur,onChange:handleTextInputChange,onClear:handleTextInputClear,onKeyDown:handleTextInputKeyDown,placeholder:formattedPlaceholder,value:inputValue})});}function CommonDateDirectionInput(_ref395){let{direction,isDateTime,onChange,value}=_ref395;const{state:{fullscreen}}=useSearchState();const{t}=useTranslation();const roundDay=React.useMemo(()=>{switch(direction){case"after":return"end";case"before":return"start";default:return void 0;}},[direction]);const handleDatePickerChange=React.useCallback(_ref396=>{let{date}=_ref396;let dateISOString=null;if(date){dateISOString=getDateISOString({date,dateOnly:!isDateTime,roundDay:(value==null?void 0:value.includeTime)?void 0:roundDay});}onChange({includeTime:value==null?void 0:value.includeTime,date:dateISOString});},[isDateTime,onChange,roundDay,value==null?void 0:value.includeTime]);const handleIncludeTimeChange=React.useCallback(()=>{const includeTime=!(value==null?void 0:value.includeTime);const date=(value==null?void 0:value.date)?new Date(value.date):null;let dateISOString=null;if(date){dateISOString=getDateISOString({date,dateOnly:!isDateTime,roundDay:includeTime?"start":roundDay});}onChange({includeTime,date:dateISOString});},[isDateTime,onChange,roundDay,value]);const handleTextDateChange=React.useCallback(date=>{onChange({includeTime:value==null?void 0:value.includeTime,date:date||null});},[onChange,value==null?void 0:value.includeTime]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ParsedDateTextInput,{"aria-label":t("search.filter-date-aria-label"),fontSize:fullscreen?2:1,isDateTime,isDateTimeFormat:isDateTime&&(value==null?void 0:value.includeTime),onChange:handleTextDateChange,radius:2,value:value==null?void 0:value.date}),/* @__PURE__ */jsxRuntime.jsx(DatePicker,{date:(value==null?void 0:value.date)?new Date(value.date):void 0,onChange:handleDatePickerChange,selectTime:isDateTime}),isDateTime&&/* @__PURE__ */jsxRuntime.jsx(DateIncludeTimeFooter,{onChange:handleIncludeTimeChange,value:!!(value==null?void 0:value.includeTime)})]});}function SearchFilterDateAfterInput(props){return/* @__PURE__ */jsxRuntime.jsx(CommonDateDirectionInput,{...props,direction:"after",isDateTime:false});}function SearchFilterDateBeforeInput(props){return/* @__PURE__ */jsxRuntime.jsx(CommonDateDirectionInput,{...props,direction:"before",isDateTime:false});}function CommonDateEqualInput(_ref397){let{isDateTime,onChange,value}=_ref397;const{state:{fullscreen}}=useSearchState();const{t}=useTranslation();const handleDatePickerChange=React.useCallback(_ref398=>{let{date}=_ref398;if(date){const dateISOString=getDateISOString({date,dateOnly:!isDateTime});onChange({includeTime:value==null?void 0:value.includeTime,date:dateISOString});}else{onChange(null);}},[isDateTime,onChange,value==null?void 0:value.includeTime]);const handleIncludeTimeChange=React.useCallback(()=>{const includeTime=!(value==null?void 0:value.includeTime);const date=(value==null?void 0:value.date)?new Date(value.date):null;let dateISOString=null;if(date){dateISOString=getDateISOString({date,dateOnly:!isDateTime});}onChange({includeTime,date:dateISOString});},[isDateTime,onChange,value]);const handleTextDateChange=React.useCallback(date=>{onChange({includeTime:value==null?void 0:value.includeTime,date:date||null});},[onChange,value==null?void 0:value.includeTime]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ParsedDateTextInput,{"aria-label":t("search.filter-date-aria-label"),fontSize:fullscreen?2:1,isDateTime,isDateTimeFormat:isDateTime&&(value==null?void 0:value.includeTime),onChange:handleTextDateChange,radius:2,value:value==null?void 0:value.date}),/* @__PURE__ */jsxRuntime.jsx(DatePicker,{date:(value==null?void 0:value.date)?new Date(value.date):void 0,onChange:handleDatePickerChange,selectTime:isDateTime}),isDateTime&&/* @__PURE__ */jsxRuntime.jsx(DateIncludeTimeFooter,{onChange:handleIncludeTimeChange,value:!!(value==null?void 0:value.includeTime)})]});}function SearchFilterDateEqualInput(props){return/* @__PURE__ */jsxRuntime.jsx(CommonDateEqualInput,{...props,isDateTime:false});}const UNIT_CHOICES=[{unit:"day",key:"search.filter-date-unit_days"},{unit:"month",key:"search.filter-date-unit_months"},{unit:"year",key:"search.filter-date-unit_years"}];function SearchFilterDateLastInput(_ref399){let{onChange,value}=_ref399;const[uncontrolledValue,setUncontrolledValue]=React.useState((value==null?void 0:value.unitValue)||"");const dateUnit=React.useRef("day");const dateValue=React.useRef((value==null?void 0:value.unitValue)||null);const{t}=useTranslation();const{state:{fullscreen}}=useSearchState();const handleChange=React.useCallback(()=>{onChange({unit:dateUnit==null?void 0:dateUnit.current,unitValue:dateValue==null?void 0:dateValue.current});},[onChange]);const handleUnitChange=React.useCallback(event=>{dateUnit.current=event.currentTarget.value;handleChange();},[handleChange]);const handleValueChange=React.useCallback(event=>{setUncontrolledValue(event.currentTarget.value);const numValue=parseFloat(event.currentTarget.value);dateValue.current=Number.isFinite(numValue)?numValue:null;handleChange();},[handleChange]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{"aria-label":t("search.filter-date-value-aria-label"),fontSize:fullscreen?2:1,onChange:handleValueChange,pattern:"\\d*",radius:2,step:"1",type:"number",value:uncontrolledValue})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Select,{"aria-label":t("search.filter-date-unit-aria-label"),fontSize:fullscreen?2:1,onChange:handleUnitChange,radius:2,value:value==null?void 0:value.unit,children:UNIT_CHOICES.map(choice=>/* @__PURE__ */jsxRuntime.jsx("option",{value:choice.unit,children:t(choice.key)},choice.key))})})]});}const PLACEHOLDER_START_DATE_OFFSET=-7;function CommonDateRangeInput(_ref400){let{isDateTime,onChange,value}=_ref400;const{t}=useTranslation();const{state:{fullscreen}}=useSearchState();const placeholderStartDate=React.useMemo(()=>dateFns.addDays(/* @__PURE__ */new Date(),PLACEHOLDER_START_DATE_OFFSET),[]);const placeholderEndDate=React.useMemo(()=>/* @__PURE__ */new Date(),[]);const handleDatePickerChange=React.useCallback(_ref401=>{let{date,endDate}=_ref401;onChange(getStartAndEndDate({date,endDate,includeTime:value==null?void 0:value.includeTime,isDateTime}));},[isDateTime,onChange,value==null?void 0:value.includeTime]);const handleIncludeTimeChange=React.useCallback(()=>{const includeTime=!(value==null?void 0:value.includeTime);onChange(getStartAndEndDate({date:(value==null?void 0:value.from)?new Date(value.from):null,endDate:(value==null?void 0:value.to)?new Date(value.to):null,includeTime,isDateTime}));},[isDateTime,onChange,value]);const handleTextEndDateChange=React.useCallback(date=>{onChange({includeTime:value==null?void 0:value.includeTime,to:date||null,from:(value==null?void 0:value.from)||null});},[onChange,value]);const handleTextStartDateChange=React.useCallback(date=>{onChange({includeTime:value==null?void 0:value.includeTime,to:(value==null?void 0:value.to)||null,from:date||null});},[onChange,value]);return/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{direction:"column",gap:3,children:[/* @__PURE__ */jsxRuntime.jsx(ParsedDateTextInput,{"aria-label":t("search.filter-date-range-start-date-aria-label"),fontSize:fullscreen?2:1,isDateTime,isDateTimeFormat:isDateTime&&(value==null?void 0:value.includeTime),onChange:handleTextStartDateChange,placeholderDate:placeholderStartDate,radius:2,value:value==null?void 0:value.from}),/* @__PURE__ */jsxRuntime.jsx(ParsedDateTextInput,{"aria-label":t("search.filter-date-range-end-date-aria-label"),fontSize:fullscreen?2:1,isDateTime,isDateTimeFormat:isDateTime&&(value==null?void 0:value.includeTime),onChange:handleTextEndDateChange,placeholderDate:placeholderEndDate,radius:2,value:value==null?void 0:value.to})]}),/* @__PURE__ */jsxRuntime.jsx(DatePicker,{date:(value==null?void 0:value.from)?new Date(value.from):void 0,endDate:(value==null?void 0:value.to)?new Date(value.to):void 0,onChange:handleDatePickerChange,selectRange:true,selectTime:isDateTime}),isDateTime&&/* @__PURE__ */jsxRuntime.jsx(DateIncludeTimeFooter,{onChange:handleIncludeTimeChange,value:!!(value==null?void 0:value.includeTime)})]})});}function getStartAndEndDate(_ref402){let{date,endDate,includeTime,isDateTime}=_ref402;if(includeTime){return{includeTime,to:endDate?getDateISOString({date:endDate,dateOnly:!isDateTime,roundDay:"start"}):null,from:date?getDateISOString({date,dateOnly:!isDateTime,roundDay:"start"}):null};}return{includeTime,to:endDate?getDateISOString({date:endDate,dateOnly:!isDateTime,roundDay:"end"}):null,from:date?getDateISOString({date,dateOnly:!isDateTime,roundDay:"start"}):null};}function SearchFilterDateRangeInput(props){return/* @__PURE__ */jsxRuntime.jsx(CommonDateRangeInput,{...props,isDateTime:false});}function SearchFilterDateTimeAfterInput(props){return/* @__PURE__ */jsxRuntime.jsx(CommonDateDirectionInput,{...props,direction:"after",isDateTime:true});}function SearchFilterDateTimeBeforeInput(props){return/* @__PURE__ */jsxRuntime.jsx(CommonDateDirectionInput,{...props,direction:"before",isDateTime:true});}function SearchFilterDateTimeEqualInput(props){return/* @__PURE__ */jsxRuntime.jsx(CommonDateEqualInput,{...props,isDateTime:true});}function SearchFilterDateTimeRangeInput(props){return/* @__PURE__ */jsxRuntime.jsx(CommonDateRangeInput,{...props,isDateTime:true});}const COMMON={dateAfter:{buttonValueComponent:SearchButtonValueDate,initialValue:null},dateBefore:{buttonValueComponent:SearchButtonValueDate,initialValue:null},dateEqual:{buttonValueComponent:SearchButtonValueDate,initialValue:{date:null,includeTime:false}},dateLast:{buttonValueComponent:SearchButtonValueDateLast},dateNotEqual:{buttonValueComponent:SearchButtonValueDate,initialValue:{date:null,includeTime:false}},dateRange:{initialValue:null}};const dateOperators={dateAfter:defineSearchOperator({...COMMON.dateAfter,nameKey:"search.operator.date-after.name",descriptionKey:"search.operator.date-after.description",groqFilter:_ref403=>{let{fieldPath,value}=_ref403;return(value==null?void 0:value.date)&&fieldPath?"".concat(fieldPath," > ").concat(toJSON(value==null?void 0:value.date)):null;},inputComponent:SearchFilterDateAfterInput,type:"dateAfter"}),dateBefore:defineSearchOperator({...COMMON.dateBefore,nameKey:"search.operator.date-before.name",descriptionKey:"search.operator.date-before.description",groqFilter:_ref404=>{let{fieldPath,value}=_ref404;return(value==null?void 0:value.date)&&fieldPath?"".concat(fieldPath," < ").concat(toJSON(value==null?void 0:value.date)):null;},inputComponent:SearchFilterDateBeforeInput,type:"dateBefore"}),dateEqual:defineSearchOperator({...COMMON.dateEqual,nameKey:"search.operator.date-equal.name",descriptionKey:"search.operator.date-equal.description",groqFilter:_ref405=>{let{fieldPath,value}=_ref405;return(value==null?void 0:value.date)&&fieldPath?"".concat(fieldPath," == ").concat(toJSON(value.date)):null;},inputComponent:SearchFilterDateEqualInput,type:"dateEqual"}),dateLast:defineSearchOperator({...COMMON.dateLast,nameKey:"search.operator.date-last.name",descriptionKey:"search.operator.date-last.description",groqFilter:_ref406=>{let{fieldPath,value}=_ref406;const flooredValue=typeof(value==null?void 0:value.unitValue)==="number"?Math.floor(value.unitValue):void 0;const timestampAgo=Number.isFinite(flooredValue)?dateFns.sub(/* @__PURE__ */new Date(),{days:(value==null?void 0:value.unit)==="day"?flooredValue:0,months:(value==null?void 0:value.unit)==="month"?flooredValue:0,years:(value==null?void 0:value.unit)==="year"?flooredValue:0}).toISOString().split("T")[0]:null;return timestampAgo&&fieldPath?"".concat(fieldPath," > ").concat(toJSON(timestampAgo)):null;},inputComponent:SearchFilterDateLastInput,initialValue:{unit:"day",unitValue:7},type:"dateLast"}),dateNotEqual:defineSearchOperator({...COMMON.dateNotEqual,nameKey:"search.operator.date-not-equal.name",descriptionKey:"search.operator.date-not-equal.description",groqFilter:_ref407=>{let{fieldPath,value}=_ref407;return(value==null?void 0:value.date)&&fieldPath?"".concat(fieldPath," != ").concat(toJSON(value.date)):null;},inputComponent:SearchFilterDateEqualInput,type:"dateNotEqual"}),dateRange:defineSearchOperator({...COMMON.dateRange,nameKey:"search.operator.date-range.name",descriptionKey:"search.operator.date-range.description",buttonValueComponent:SearchButtonValueDateRange,groqFilter:_ref408=>{let{fieldPath,value}=_ref408;return(value==null?void 0:value.to)&&(value==null?void 0:value.from)&&fieldPath?"".concat(fieldPath," >= ").concat(toJSON(value.from)," && ").concat(fieldPath," <= ").concat(toJSON(value.to)):null;},initialValue:{includeTime:false,to:dateFns.startOfToday().toISOString(),from:null},inputComponent:SearchFilterDateRangeInput,type:"dateRange"}),dateTimeAfter:defineSearchOperator({...COMMON.dateAfter,nameKey:"search.operator.date-time-after.name",descriptionKey:"search.operator.date-time-after.description",groqFilter:_ref409=>{let{fieldPath,value}=_ref409;return(value==null?void 0:value.date)&&fieldPath?"dateTime(".concat(fieldPath,") > dateTime(").concat(toJSON(value.date),")"):null;},inputComponent:SearchFilterDateTimeAfterInput,type:"dateTimeAfter"}),dateTimeBefore:defineSearchOperator({...COMMON.dateBefore,nameKey:"search.operator.date-time-before.name",descriptionKey:"search.operator.date-time-before.description",groqFilter:_ref410=>{let{fieldPath,value}=_ref410;return(value==null?void 0:value.date)&&fieldPath?"dateTime(".concat(fieldPath,") < dateTime(").concat(toJSON(value.date),")"):null;},inputComponent:SearchFilterDateTimeBeforeInput,type:"dateTimeBefore"}),dateTimeEqual:defineSearchOperator({...COMMON.dateEqual,nameKey:"search.operator.date-time-equal.name",descriptionKey:"search.operator.date-time-equal.description",groqFilter:_ref411=>{let{fieldPath,value}=_ref411;const date=(value==null?void 0:value.date)&&new Date(value.date);if(!date||!dateFns.isValid(date)||!fieldPath){return null;}const dateStart=((value==null?void 0:value.includeTime)?dateFns.startOfMinute(date):dateFns.startOfDay(date)).toISOString();const dateEnd=((value==null?void 0:value.includeTime)?dateFns.endOfMinute(date):dateFns.endOfDay(date)).toISOString();return"dateTime(".concat(fieldPath,") > dateTime(").concat(toJSON(dateStart),") && dateTime(").concat(fieldPath,") < dateTime(").concat(toJSON(dateEnd),")");},inputComponent:SearchFilterDateTimeEqualInput,type:"dateTimeEqual"}),dateTimeLast:defineSearchOperator({...COMMON.dateLast,nameKey:"search.operator.date-time-last.name",descriptionKey:"search.operator.date-time-last.description",groqFilter:_ref412=>{let{fieldPath,value}=_ref412;const flooredValue=typeof(value==null?void 0:value.unitValue)==="number"?Math.floor(value.unitValue):void 0;const timestampAgo=Number.isFinite(flooredValue)?dateFns.sub(/* @__PURE__ */new Date(),{days:(value==null?void 0:value.unit)==="day"?flooredValue:0,months:(value==null?void 0:value.unit)==="month"?flooredValue:0,years:(value==null?void 0:value.unit)==="year"?flooredValue:0}).toISOString():null;return timestampAgo&&fieldPath?"dateTime(".concat(fieldPath,") > dateTime(").concat(toJSON(timestampAgo),")"):null;},initialValue:{unit:"day",unitValue:7},inputComponent:SearchFilterDateLastInput,type:"dateTimeLast"}),dateTimeNotEqual:defineSearchOperator({...COMMON.dateNotEqual,nameKey:"search.operator.date-time-not-equal.name",descriptionKey:"search.operator.date-time-not-equal.description",groqFilter:_ref413=>{let{fieldPath,value}=_ref413;const date=(value==null?void 0:value.date)&&new Date(value.date);if(!date||!dateFns.isValid(date)||!fieldPath){return null;}const dateStart=((value==null?void 0:value.includeTime)?dateFns.startOfMinute(date):dateFns.startOfDay(date)).toISOString();const dateEnd=((value==null?void 0:value.includeTime)?dateFns.endOfMinute(date):dateFns.endOfDay(date)).toISOString();return"dateTime(".concat(fieldPath,") < dateTime(").concat(toJSON(dateStart),") || dateTime(").concat(fieldPath,") > dateTime(").concat(toJSON(dateEnd),")");},inputComponent:SearchFilterDateTimeEqualInput,type:"dateTimeNotEqual"}),dateTimeRange:defineSearchOperator({...COMMON.dateRange,nameKey:"search.operator.date-time-range.name",descriptionKey:"search.operator.date-time-range.description",buttonValueComponent:SearchButtonValueDateRange,groqFilter:_ref414=>{let{fieldPath,value}=_ref414;return(value==null?void 0:value.to)&&(value==null?void 0:value.from)&&fieldPath?"dateTime(".concat(fieldPath,") >= dateTime(").concat(toJSON(value.from),") && dateTime(").concat(fieldPath,") <= dateTime(").concat(toJSON(value.to),")"):null;},initialValue:{includeTime:false,to:dateFns.startOfToday().toISOString(),from:null},inputComponent:SearchFilterDateTimeRangeInput,type:"dateTimeRange"})};const definedOperators={defined:defineSearchOperator({nameKey:"search.operator.defined.name",descriptionKey:"search.operator.defined.description",groqFilter:_ref415=>{let{fieldPath}=_ref415;return fieldPath?"defined(".concat(fieldPath,")"):null;},type:"defined"}),notDefined:defineSearchOperator({nameKey:"search.operator.not-defined.name",descriptionKey:"search.operator.not-defined.description",i18nKey:"search.operator.not-defined",groqFilter:_ref416=>{let{fieldPath}=_ref416;return fieldPath?"!defined(".concat(fieldPath,")"):null;},type:"notDefined"})};const numberOperators={numberEqual:defineSearchOperator({nameKey:"search.operator.number-equal.name",descriptionKey:"search.operator.number-equal.description",groqFilter:_ref417=>{let{fieldPath,value}=_ref417;return Number.isFinite(value)&&fieldPath?"".concat(fieldPath," == ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterNumberInput,type:"numberEqual"}),numberGt:defineSearchOperator({nameKey:"search.operator.number-gt.name",descriptionKey:"search.operator.number-gt.description",groqFilter:_ref418=>{let{fieldPath,value}=_ref418;return Number.isFinite(value)&&fieldPath?"".concat(fieldPath," > ").concat(toJSON(value)):null;},icon:GtIcon,initialValue:null,inputComponent:SearchFilterNumberInput,type:"numberGt"}),numberGte:defineSearchOperator({nameKey:"search.operator.number-gte.name",descriptionKey:"search.operator.number-gte.description",groqFilter:_ref419=>{let{fieldPath,value}=_ref419;return Number.isFinite(value)&&fieldPath?"".concat(fieldPath," >= ").concat(toJSON(value)):null;},icon:GteIcon,initialValue:null,inputComponent:SearchFilterNumberInput,type:"numberGte"}),numberLt:defineSearchOperator({nameKey:"search.operator.number-lt.name",descriptionKey:"search.operator.number-lt.description",groqFilter:_ref420=>{let{fieldPath,value}=_ref420;return Number.isFinite(value)&&fieldPath?"".concat(fieldPath," < ").concat(toJSON(value)):null;},icon:LtIcon,initialValue:null,inputComponent:SearchFilterNumberInput,type:"numberLt"}),numberLte:defineSearchOperator({nameKey:"search.operator.number-lte.name",descriptionKey:"search.operator.number-lte.description",groqFilter:_ref421=>{let{fieldPath,value}=_ref421;return Number.isFinite(value)&&fieldPath?"".concat(fieldPath," <= ").concat(toJSON(value)):null;},icon:LteIcon,initialValue:null,inputComponent:SearchFilterNumberInput,type:"numberLte"}),numberNotEqual:defineSearchOperator({nameKey:"search.operator.number-not-equal.name",descriptionKey:"search.operator.number-not-equal.description",groqFilter:_ref422=>{let{fieldPath,value}=_ref422;return Number.isFinite(value)&&fieldPath?"".concat(fieldPath," != ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterNumberInput,type:"numberNotEqual"}),numberRange:defineSearchOperator({nameKey:"search.operator.number-range.name",descriptionKey:"search.operator.number-range.description",groqFilter:_ref423=>{let{fieldPath,value}=_ref423;return Number.isFinite(value==null?void 0:value.to)&&Number.isFinite(value==null?void 0:value.from)&&fieldPath?"".concat(fieldPath," > ").concat(toJSON(value==null?void 0:value.from)," && ").concat(fieldPath," < ").concat(toJSON(value==null?void 0:value.to)):"";},initialValue:null,inputComponent:SearchFilterNumberRangeInput,type:"numberRange"})};function SearchFilterStringInput(_ref424){let{onChange,value}=_ref424;const{state:{fullscreen}}=useSearchState();const{t}=useTranslation();const handleChange=React.useCallback(event=>onChange(event.currentTarget.value||null),[onChange]);return/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{fontSize:fullscreen?2:1,onChange:handleChange,placeholder:t("search.filter-string-value-placeholder"),radius:2,value:value||""});}const portableTextOperators={portableTextEqual:defineSearchOperator({nameKey:"search.operator.portable-text-equal.name",descriptionKey:"search.operator.portable-text-equal.description",groqFilter:_ref425=>{let{fieldPath,value}=_ref425;return value&&fieldPath?"pt::text(".concat(fieldPath,") == ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterStringInput,type:"portableTextEqual"}),portableTextMatches:defineSearchOperator({nameKey:"search.operator.portable-text-contains.name",descriptionKey:"search.operator.portable-text-contains.description",groqFilter:_ref426=>{let{fieldPath,value}=_ref426;return value&&fieldPath?"pt::text(".concat(fieldPath,") match ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterStringInput,type:"portableTextMatches"}),portableTextNotEqual:defineSearchOperator({nameKey:"search.operator.portable-text-not-equal.name",descriptionKey:"search.operator.portable-text-not-equal.description",groqFilter:_ref427=>{let{fieldPath,value}=_ref427;return value&&fieldPath?"pt::text(".concat(fieldPath,") != ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterStringInput,type:"portableTextNotEqual"}),portableTextNotMatches:defineSearchOperator({nameKey:"search.operator.portable-text-not-contains.name",descriptionKey:"search.operator.portable-text-not-contains.description",groqFilter:_ref428=>{let{fieldPath,value}=_ref428;return value&&fieldPath?"!(pt::text(".concat(fieldPath,") match ").concat(toJSON(value),")"):null;},initialValue:null,inputComponent:SearchFilterStringInput,type:"portableTextNotMatches"})};const referenceOperators={referenceEqual:defineSearchOperator({nameKey:"search.operator.reference-equal.name",descriptionKey:"search.operator.reference-equal.description",buttonValueComponent:SearchButtonValueReference,groqFilter:_ref429=>{let{fieldPath,value}=_ref429;return(value==null?void 0:value._ref)&&fieldPath?"".concat(fieldPath,"._ref == ").concat(toJSON(value._ref)):null;},initialValue:null,inputComponent:SearchFilterReferenceInput,type:"referenceEqual"}),referenceNotEqual:defineSearchOperator({nameKey:"search.operator.reference-not-equal.name",descriptionKey:"search.operator.reference-not-equal.description",buttonValueComponent:SearchButtonValueReference,groqFilter:_ref430=>{let{fieldPath,value}=_ref430;return(value==null?void 0:value._ref)&&fieldPath?"".concat(fieldPath,"._ref != ").concat(toJSON(value._ref)):null;},initialValue:null,inputComponent:SearchFilterReferenceInput,type:"referenceNotEqual"}),referencesAssetFile:defineSearchOperator({nameKey:"search.operator.reference-asset-file.name",descriptionKey:"search.operator.reference-asset-file.description",buttonValueComponent:SearchButtonValueReference,groqFilter:_ref431=>{let{value}=_ref431;return(value==null?void 0:value._ref)?"references(".concat(toJSON(value._ref),")"):null;},initialValue:null,inputComponent:SearchFilterAssetInput("file"),type:"referencesAssetFile"}),referencesAssetImage:defineSearchOperator({nameKey:"search.operator.reference-asset-image.name",descriptionKey:"search.operator.reference-asset-image.description",buttonValueComponent:SearchButtonValueReference,groqFilter:_ref432=>{let{value}=_ref432;return(value==null?void 0:value._ref)?"references(".concat(toJSON(value._ref),")"):null;},initialValue:null,inputComponent:SearchFilterAssetInput("image"),type:"referencesAssetImage"}),referencesDocument:defineSearchOperator({nameKey:"search.operator.reference-document.name",descriptionKey:"search.operator.reference-document.description",buttonValueComponent:SearchButtonValueReference,groqFilter:_ref433=>{let{value}=_ref433;return(value==null?void 0:value._ref)?"references(".concat(toJSON(value._ref),")"):null;},initialValue:null,inputComponent:SearchFilterReferenceInput,type:"referencesDocument"})};const slugOperators={slugEqual:defineSearchOperator({nameKey:"search.operator.slug-equal.name",descriptionKey:"search.operator.slug-equal.description",groqFilter:_ref434=>{let{fieldPath,value}=_ref434;return value&&fieldPath?"".concat(fieldPath,".current == ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterStringInput,type:"slugEqual"}),slugMatches:defineSearchOperator({nameKey:"search.operator.slug-contains.name",descriptionKey:"search.operator.slug-contains.description",groqFilter:_ref435=>{let{fieldPath,value}=_ref435;return value&&fieldPath?"".concat(fieldPath,".current match ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterStringInput,label:"contains",type:"slugMatches"}),slugNotEqual:defineSearchOperator({nameKey:"search.operator.slug-not-equal.name",descriptionKey:"search.operator.slug-not-equal.description",groqFilter:_ref436=>{let{fieldPath,value}=_ref436;return value&&fieldPath?"".concat(fieldPath,".current != ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterStringInput,type:"slugNotEqual"}),slugNotMatches:defineSearchOperator({nameKey:"search.operator.slug-not-contains.name",descriptionKey:"search.operator.slug-not-contains.description",groqFilter:_ref437=>{let{fieldPath,value}=_ref437;return value&&fieldPath?"!(".concat(fieldPath,".current match ").concat(toJSON(value),")"):null;},initialValue:null,inputComponent:SearchFilterStringInput,type:"slugNotMatches"})};const stringOperators={stringEqual:defineSearchOperator({nameKey:"search.operator.string-equal.name",descriptionKey:"search.operator.string-equal.description",groqFilter:_ref438=>{let{fieldPath,value}=_ref438;return value&&fieldPath?"".concat(fieldPath," == ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterStringInput,type:"stringEqual"}),stringListEqual:defineSearchOperator({nameKey:"search.operator.string-list-equal.name",descriptionKey:"search.operator.string-list-equal.description",groqFilter:_ref439=>{let{fieldPath,value}=_ref439;return value&&fieldPath?"".concat(fieldPath," == ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterStringListInput,type:"stringListEqual"}),stringListNotEqual:defineSearchOperator({nameKey:"search.operator.string-list-not-equal.name",descriptionKey:"search.operator.string-list-not-equal.description",groqFilter:_ref440=>{let{fieldPath,value}=_ref440;return value&&fieldPath?"".concat(fieldPath," != ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterStringListInput,type:"stringListNotEqual"}),stringMatches:defineSearchOperator({nameKey:"search.operator.string-contains.name",descriptionKey:"search.operator.string-contains.description",groqFilter:_ref441=>{let{fieldPath,value}=_ref441;return value&&fieldPath?"".concat(fieldPath," match ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterStringInput,type:"stringMatches"}),stringNotEqual:defineSearchOperator({nameKey:"search.operator.string-not-equal.name",descriptionKey:"search.operator.string-not-equal.description",groqFilter:_ref442=>{let{fieldPath,value}=_ref442;return value&&fieldPath?"".concat(fieldPath," != ").concat(toJSON(value)):null;},initialValue:null,inputComponent:SearchFilterStringInput,type:"stringNotEqual"}),stringNotMatches:defineSearchOperator({nameKey:"search.operator.string-not-contains.name",descriptionKey:"search.operator.string-not-contains.description",groqFilter:_ref443=>{let{fieldPath,value}=_ref443;return value&&fieldPath?"!(".concat(fieldPath," match ").concat(toJSON(value),")"):null;},initialValue:null,inputComponent:SearchFilterStringInput,type:"stringNotMatches"})};const searchOperators={...arrayOperators,...assetOperators,...booleanOperators,...dateOperators,...definedOperators,...numberOperators,...portableTextOperators,...referenceOperators,...slugOperators,...stringOperators};const operatorDefinitions=Object.values(searchOperators);var __freeze$R=Object.freeze;var __defProp$R=Object.defineProperty;var __template$R=(cooked,raw)=>__freeze$R(__defProp$R(cooked,"raw",{value:__freeze$R(raw||cooked.slice())}));var _a$R;function pseudoRandomNumber(seed){const hashCode=seed.split("").reduce((prevHash,currVal)=>(prevHash<<5)-prevHash+currVal.charCodeAt(0)|0,0);return Math.abs(hashCode*16807%2147483647)/2147483647;}const SvgText=styled__default.default.text(_a$R||(_a$R=__template$R(["\n  font-family: ",";\n  font-weight: ",";\n  font-size: ","px;\n  transform: translateY(1px);\n"])),_ref444=>{let{theme}=_ref444;return theme.sanity.fonts.text.family;},_ref445=>{let{theme}=_ref445;return theme.sanity.fonts.text.weights.medium;},_ref446=>{let{theme}=_ref446;return theme.sanity.fonts.text.sizes[1].fontSize;});function createDefaultIcon(title,subtitle){const rng1=pseudoRandomNumber("".concat(title," ").concat(subtitle));const huesWithoutGray=color.COLOR_HUES.filter(hue=>hue!=="gray");const colorHue=huesWithoutGray[Math.floor(rng1*huesWithoutGray.length)];const possibleTints=["300","400","500","600","700"];const rng2=pseudoRandomNumber(rng1.toString());const tint=possibleTints[Math.floor(rng2*possibleTints.length)];const color$1=color.hues[colorHue][tint].hex;const letters=title.split(/\s/g).map(word=>word.replace(/\\W/g,"")).filter(Boolean).slice(0,2).map(i=>i.charAt(0).toUpperCase());const darkened=color2k.darken(color$1,0.4);const lightened=color2k.lighten(color$1,0.4);const textColor=!color2k.hasBadContrast(color$1,"readable",darkened)?darkened:!color2k.hasBadContrast(color$1,"readable",lightened)?lightened:color2k.readableColor(color$1);return/* @__PURE__ */jsxRuntime.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:[/* @__PURE__ */jsxRuntime.jsx("rect",{width:32,height:32,rx:2,fill:color$1}),/* @__PURE__ */jsxRuntime.jsx(SvgText,{x:"50%",y:"50%",textAnchor:"middle",alignmentBaseline:"middle",dominantBaseline:"middle",fill:textColor,children:letters})]});}function resolveSchemaTypes(_ref447){let{config,context}=_ref447;return resolveConfigProperty({propertyName:"schema.types",config,context,initialValue:[],reducer:schemaTypesReducer});}class SchemaError extends Error{constructor(schema){super("SchemaError");this.schema=schema;}}const isError=p=>p.severity==="error";function normalizeIcon(icon,title){let subtitle=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";if(reactIs.isValidElementType(icon))return React.createElement(icon);if(React.isValidElement(icon))return icon;return createDefaultIcon(title,subtitle);}const preparedWorkspaces=/* @__PURE__ */new WeakMap();function prepareConfig(config,options){if(!Array.isArray(config)&&"missingConfigFile"in config){throw new ConfigResolutionError({name:"",type:"configuration file",causes:["No `sanity.config.ts` file found","No `sanity.config.js` file found"]});}const rootPath=getRootPath(options==null?void 0:options.basePath);const workspaceOptions=Array.isArray(config)?config:[config];try{validateWorkspaces({workspaces:workspaceOptions});}catch(e){throw new ConfigResolutionError({name:"",type:"workspace",causes:[e.message]});}const workspaces=workspaceOptions.map(rawWorkspace=>{if(preparedWorkspaces.has(rawWorkspace)){return preparedWorkspaces.get(rawWorkspace);}const{unstable_sources:nestedSources=[],...rootSource}=rawWorkspace;const sources=[rootSource,...nestedSources];const resolvedSources=sources.map(source=>{const{projectId,dataset}=source;let schemaTypes;try{schemaTypes=resolveSchemaTypes({config:source,context:{projectId,dataset}});}catch(e){throw new ConfigResolutionError({name:source.name,type:"source",causes:[e]});}const schema=createSchema({name:source.name,types:schemaTypes});const schemaValidationProblemGroups=schema._validation;const schemaErrors=schemaValidationProblemGroups==null?void 0:schemaValidationProblemGroups.filter(msg=>msg.problems.some(isError));if(schemaValidationProblemGroups&&(schemaErrors==null?void 0:schemaErrors.length)){throw new SchemaError(schema);}const auth=getAuthStore(source);const i18n=prepareI18n(source);const source$=auth.state.pipe(operators.map(_ref448=>{let{client,authenticated,currentUser}=_ref448;return resolveSource({config:source,client,currentUser,schema,authenticated,auth,i18n});}),operators.shareReplay(1));return{name:source.name,projectId:source.projectId,dataset:source.dataset,title:source.title||startCase__default.default(source.name),auth,schema,i18n:i18n.source,source:source$};});const title=rootSource.title||startCase__default.default(rootSource.name);const workspaceSummary={type:"workspace-summary",auth:resolvedSources[0].auth,basePath:joinBasePath(rootPath,rootSource.basePath),dataset:rootSource.dataset,schema:resolvedSources[0].schema,i18n:resolvedSources[0].i18n,customIcon:!!rootSource.icon,icon:normalizeIcon(rootSource.icon,title,"".concat(rootSource.projectId," ").concat(rootSource.dataset)),name:rootSource.name||"default",projectId:rootSource.projectId,theme:rootSource.theme||ui.studioTheme,title,subtitle:rootSource.subtitle,__internal:{sources:resolvedSources}};preparedWorkspaces.set(rawWorkspace,workspaceSummary);return workspaceSummary;});return{type:"prepared-config",workspaces};}function getAuthStore(source){if(isAuthStore(source.auth)){return source.auth;}const clientFactory=source.unstable_clientFactory||client.createClient;const{projectId,dataset,apiHost}=source;return createAuthStore({apiHost,...source.auth,clientFactory,dataset,projectId});}function getBifurClient(client,auth){const bifurVersionedClient=client.withConfig({apiVersion:"2022-06-30"});const{dataset,url:baseUrl,requestTagPrefix="sanity.studio"}=bifurVersionedClient.config();const url="".concat(baseUrl.replace(/\/+$/,""),"/socket/").concat(dataset).replace(/^http/,"ws");const urlWithTag="".concat(url,"?tag=").concat(requestTagPrefix);const options=auth.token?{token$:auth.token}:{};return bifurClient.fromUrl(urlWithTag,options);}function resolveSource(_ref449){let{config,client,currentUser,schema,authenticated,auth,i18n}=_ref449;var _a,_b,_c,_d,_e,_f,_g;const{dataset,projectId}=config;const bifur=getBifurClient(client,auth);const errors=[];const clients={};const getClient=options=>{if(!options||!options.apiVersion){throw new Error("Missing required `apiVersion` option");}if(!clients[options.apiVersion]){clients[options.apiVersion]=client.withConfig(options);}return clients[options.apiVersion];};const context={client,getClient,currentUser,dataset,projectId,schema,i18n:i18n.source};const wrappedClient=client;context.client=[...Object.keys(client),...Object.keys(wrappedClient.__proto__)].reduce((acc,key)=>{const original=Object.hasOwnProperty.call(client,key)?wrappedClient[key]:wrappedClient.__proto__[key];return Object.defineProperty(acc,key,{get(){console.warn('`configContext.client` is deprecated and will be removed in the next release! Use `context.getClient({apiVersion: "2021-06-07"})` instead');return original;}});},{});let templates;try{templates=resolveConfigProperty({config,context,propertyName:"schema.templates",reducer:schemaTemplatesReducer,initialValue:schema.getTypeNames().filter(typeName=>!/^sanity\./.test(typeName)).map(typeName=>schema.get(typeName)).filter(isNonNullable$2).filter(schemaType=>{var _a2;return((_a2=schemaType.type)==null?void 0:_a2.name)==="document";}).map(schemaType=>{const template={id:schemaType.name,schemaType:schemaType.name,title:schemaType.title||schemaType.name,icon:schemaType.icon,value:schemaType.initialValue||{_type:schemaType.name}};return template;})});}catch(e){throw new ConfigResolutionError({name:config.name,type:"source",causes:[e]});}let tools;try{tools=resolveConfigProperty({config,context,initialValue:[],propertyName:"tools",reducer:toolsReducer});}catch(e){throw new ConfigResolutionError({name:config.name,type:"source",causes:[e]});}if(tools.some(_ref450=>{let{name}=_ref450;return name==="tool";})){throw new Error('A tool cannot have the name "tool". Please enter a different name.');}const initialTemplatesResponses=templates.filter(template=>{var _a2;return!((_a2=template.parameters)==null?void 0:_a2.length);}).map(template=>({templateId:template.id,description:template.description,icon:template.icon,title:template.title}));const templateMap=templates.reduce((acc,template)=>{acc.set(template.id,template);return acc;},/* @__PURE__ */new Map());const resolveNewDocumentOptions=creationContext=>{const{schemaType:schemaTypeName}=creationContext;const templateResponses=resolveConfigProperty({config,context:{...context,creationContext},initialValue:initialTemplatesResponses,propertyName:"document.resolveNewDocumentOptions",reducer:newDocumentOptionsResolver});const templateErrors=[];if(templateErrors.length){throw new ConfigResolutionError({name:config.name,type:"source",causes:templateErrors});}return templateResponses.map((response,index)=>{const template=templateMap.get(response.templateId);if(!template){throw new Error("Could not find template with ID `".concat(response.templateId,"`"));}const schemaType=schema.get(template.schemaType);if(!schemaType){throw new Error("Could not find matching schema type `".concat(template.schemaType,"` for template `").concat(template.id,"`"));}const title=response.title||template.title;const defaultSubtitle=(schemaType==null?void 0:schemaType.title)===title?void 0:schemaType==null?void 0:schemaType.title;return{id:"".concat(response.templateId,"-").concat(index),templateId:response.templateId,type:"initialValueTemplateItem",title,i18n:response.i18n||template.i18n,subtitle:response.subtitle||defaultSubtitle,description:response.description||template.description,icon:response.icon||template.icon||(schemaType==null?void 0:schemaType.icon),initialDocumentId:response.initialDocumentId,parameters:response.parameters,schemaType:template.schemaType};}).filter(item=>{var _a2;if(!schemaTypeName)return true;if(creationContext.type==="document")return true;return schemaTypeName===((_a2=templateMap.get(item.templateId))==null?void 0:_a2.schemaType);});};let staticInitialValueTemplateItems;try{staticInitialValueTemplateItems=resolveNewDocumentOptions({type:"global"});}catch(e){errors.push(e);}if(errors.length){throw new ConfigResolutionError({name:config.name,type:"source",causes:errors});}const source={type:"source",name:config.name,title:config.title||startCase__default.default(config.name),schema,getClient,dataset,projectId,tools,currentUser,authenticated,templates,auth,i18n:i18n.source,document:{actions:partialContext=>resolveConfigProperty({config,context:{...context,...partialContext},initialValue:initialDocumentActions,propertyName:"document.actions",reducer:documentActionsReducer}),badges:partialContext=>resolveConfigProperty({config,context:{...context,...partialContext},initialValue:initialDocumentBadges,propertyName:"document.badges",reducer:documentBadgesReducer}),unstable_fieldActions:partialContext=>resolveConfigProperty({config,context:{...context,...partialContext},initialValue:initialDocumentFieldActions,propertyName:"document.unstable_fieldActions",reducer:documentFieldActionsReducer}),inspectors:partialContext=>resolveConfigProperty({config,context:{...context,...partialContext},initialValue:EMPTY_ARRAY$9,propertyName:"document.inspectors",reducer:documentInspectorsReducer}),resolveProductionUrl:partialContext=>resolveConfigProperty({config,context:{...context,...partialContext},initialValue:void 0,propertyName:"resolveProductionUrl",asyncReducer:resolveProductionUrlReducer}),resolveNewDocumentOptions,unstable_languageFilter:partialContext=>resolveConfigProperty({config,context:{...context,...partialContext},initialValue:initialLanguageFilter,propertyName:"document.unstable_languageFilter",reducer:documentLanguageFilterReducer}),unstable_comments:{enabled:partialContext=>{return documentCommentsEnabledReducer({context:partialContext,config,initialValue:true});}}},form:{file:{assetSources:resolveConfigProperty({config,context,initialValue:[FileSource],propertyName:"formBuilder.file.assetSources",reducer:fileAssetSourceResolver}),directUploads:// TODO: consider refactoring this to `noDirectUploads` or similar
// default value for this is `true`
((_b=(_a=config.form)==null?void 0:_a.file)==null?void 0:_b.directUploads)===void 0?true:config.form.file.directUploads},image:{assetSources:resolveConfigProperty({config,context,initialValue:[ImageSource],propertyName:"formBuilder.image.assetSources",reducer:imageAssetSourceResolver}),directUploads:// TODO: consider refactoring this to `noDirectUploads` or similar
// default value for this is `true`
((_d=(_c=config.form)==null?void 0:_c.image)==null?void 0:_d.directUploads)===void 0?true:config.form.image.directUploads}},search:{filters:filterDefinitions,operators:operatorDefinitions,unstable_partialIndexing:{enabled:partialIndexingEnabledReducer({config,initialValue:(_g=(_f=(_e=config.search)==null?void 0:_e.unstable_partialIndexing)==null?void 0:_f.enabled)!=null?_g:false})}// we will use this when we add search config to PluginOptions
/*filters: resolveConfigProperty({
        config,
        context: context,
        initialValue: filterDefinitions,
        propertyName: 'search.filters',
        reducer: searchFilterReducer,
      }),
      operators: resolveConfigProperty({
        config,
        context: context,
        initialValue: operatorDefinitions as SearchOperatorDefinition[],
        propertyName: 'search.operators',
        reducer: searchOperatorsReducer,
      }),*/},__internal:{bifur,i18next:i18n.i18next,staticInitialValueTemplateItems,options:config}};return source;}function getRootPath(basePath){const rootPath=basePath||"";if(typeof rootPath!=="string"||rootPath.length>0&&!rootPath.startsWith("/")){throw new ConfigResolutionError({name:"",type:"options",causes:["basePath must be a string, and must start with a slash"]});}return rootPath==="/"?"":rootPath;}function joinBasePath(rootPath,basePath){const joined=[rootPath,basePath||""].map(path=>path.replace(/^\/+/g,"").replace(/\/+$/g,"")).filter(Boolean).join("/");return"/".concat(joined);}function WorkspacesProvider(_ref451){let{config,children,basePath}=_ref451;const{workspaces}=React.useMemo(()=>prepareConfig(config,{basePath}),[config,basePath]);return/* @__PURE__ */jsxRuntime.jsx(WorkspacesContext.Provider,{value:workspaces,children});}const RouterHistoryContext=React.createContext(null);function RouterHistoryProvider(_ref452){let{children,history}=_ref452;return/* @__PURE__ */jsxRuntime.jsx(RouterHistoryContext.Provider,{value:history,children});}function useRouterHistory(){const value=React.useContext(RouterHistoryContext);if(!value)throw new Error("Could not find `RouterHistoryProvider` context");return value;}const ActiveWorkspaceMatcherContext=React.createContext(null);const ActiveWorkspaceMatcherProvider=React.memo(function ActiveWorkspaceMatcherContextProvider(_ref453){let{children,history,activeWorkspace,setActiveWorkspace}=_ref453;const value=React.useMemo(()=>({activeWorkspace,setActiveWorkspace}),[activeWorkspace,setActiveWorkspace]);return/* @__PURE__ */jsxRuntime.jsx(ActiveWorkspaceMatcherContext.Provider,{value,children:/* @__PURE__ */jsxRuntime.jsx(RouterHistoryProvider,{history,children})});});function createCommonBasePathRegex(workspaces){const workspaceSegments=workspaces.map(workspace=>// gets the segments from the basePath
workspace.basePath.substring(1).split("/"));const commonBasePath=workspaceSegments.reduce((commonSegments,segments)=>{for(let i=0;i<commonSegments.length;i++){const commonSegment=commonSegments[i];const segment=segments[i].toLowerCase();if(commonSegment!==segment){return commonSegments.slice(0,i);}}return commonSegments;});function createCommonBasePathRegexRecursively(_ref454){let[first,...rest]=_ref454;if(!first)return"";return"(\\/".concat(escapeRegExp__default.default(first)).concat(createCommonBasePathRegexRecursively(rest),"(\\/|$))?");}return new RegExp("^".concat(createCommonBasePathRegexRecursively(commonBasePath),"$"),"i");}function matchWorkspace(_ref455){let{pathname,workspaces,basePathRegex}=_ref455;const[firstWorkspace]=workspaces;for(const{workspace,basePath,basePathRegex:basePathRegex2}of workspaces){if(basePathRegex2.test(pathname)||basePath==="/"){return{type:"match",workspace};}}if(pathname==="/"){return{type:"redirect",pathname:firstWorkspace.basePath};}if(basePathRegex.test(pathname)){return{type:"redirect",pathname:firstWorkspace.basePath};}return{type:"not-found"};}function useNormalizedWorkspaces(workspaces){return React.useMemo(()=>normalizedWorkspaces(workspaces),[workspaces]);}function normalizedWorkspaces(workspaces){return workspaces.map(workspace=>{const basePath=workspace.basePath||"/";return{workspace,name:workspace.name,basePath,// this regex ends with a `(\\/|$)` (forward slash or end) to prevent false
// matches where the pathname is a false subset of the current pathname.
// e.g. if the `workspace.basePath` is `/base/foobar` and the current
// pathname is `/base/foo`, then that should not be a match
basePathRegex:new RegExp("^".concat(escapeRegExp__default.default(basePath),"(\\/|$)"),"i")};});}function useSyncPathnameWithWorkspace(history,_workspaces){const workspaces=useNormalizedWorkspaces(_workspaces);const basePathRegex=React.useMemo(()=>createCommonBasePathRegex(workspaces),[workspaces]);const[serverSnapshot]=React.useState(()=>history.location.pathname);const store=React.useMemo(()=>{return{subscribe:onStoreChange=>history.listen(onStoreChange),getSnapshot:()=>history.location.pathname,getServerSnapshot:()=>serverSnapshot,selector:pathname=>matchWorkspace({basePathRegex,pathname,workspaces}),isEqual:(a,b)=>{if(a.type!==b.type)return false;switch(a.type){case"match":return a.workspace===b.workspace;case"redirect":return a.pathname===b.pathname;case"not-found":return true;default:throw new Error("Unknown type: ".concat(a.type));}}};},[basePathRegex,history,serverSnapshot,workspaces]);return withSelector.useSyncExternalStoreWithSelector(store.subscribe,store.getSnapshot,store.getServerSnapshot,store.selector,store.isEqual);}const createHistory=()=>typeof document==="undefined"?history$1.createMemoryHistory():history$1.createBrowserHistory();function ActiveWorkspaceMatcher(_ref456){let{children,LoadingComponent,NotFoundComponent,unstable_history:historyProp}=_ref456;const workspaces=useWorkspaces();const history=React.useMemo(()=>historyProp||createHistory(),[historyProp]);const setActiveWorkspaceName=React.useCallback(workspaceName=>{const foundWorkspace=workspaces.find(workspace=>workspace.name===workspaceName);if(foundWorkspace){history.push(foundWorkspace.basePath);}},[history,workspaces]);const handleNavigateToDefaultWorkspace=React.useCallback(()=>{setActiveWorkspaceName(workspaces[0].name);},[setActiveWorkspaceName,workspaces]);const result=useSyncPathnameWithWorkspace(history,workspaces);React.useEffect(()=>{if(result.type==="redirect"){history.replace(result.pathname);}},[history,result]);switch(result.type){case"match":return/* @__PURE__ */jsxRuntime.jsx(ActiveWorkspaceMatcherProvider,{activeWorkspace:result.workspace,history,setActiveWorkspace:setActiveWorkspaceName,children});case"redirect":return/* @__PURE__ */jsxRuntime.jsx(LoadingComponent,{});case"not-found":return/* @__PURE__ */jsxRuntime.jsx(NotFoundComponent,{onNavigateToDefaultWorkspace:handleNavigateToDefaultWorkspace});default:throw new Error("Unknown type: ".concat(result.type));}}function useActiveWorkspace(){const value=React.useContext(ActiveWorkspaceMatcherContext);if(!value)throw new Error("Could not find `ActiveWorkspaceMatcher` context");return value;}const AddonDatasetContext=React.createContext(null);const ColorSchemeValueContext=React.createContext(null);const ColorSchemeSetValueContext=React.createContext(null);function useSystemScheme(){const prefersDark=ui.usePrefersDark();return prefersDark?"dark":"light";}function ColorThemeProvider(_ref457){let{children,scheme:_scheme}=_ref457;const systemScheme=useSystemScheme();const scheme=_scheme==="system"?systemScheme:_scheme;return/* @__PURE__ */jsxRuntime.jsx(ui.ThemeProvider,{scheme,theme:ui.studioTheme,children});}const LOCAL_STORAGE_KEY="sanityStudio:ui:colorScheme";function ColorSchemeProvider(_ref458){let{children,onSchemeChange,scheme:schemeProp}=_ref458;if(schemeProp){return/* @__PURE__ */jsxRuntime.jsx(ColorSchemeCustomProvider,{scheme:schemeProp,onSchemeChange,children});}return/* @__PURE__ */jsxRuntime.jsx(ColorSchemeLocalStorageProvider,{onSchemeChange,children});}function ColorSchemeLocalStorageProvider(_ref459){let{children,onSchemeChange}=_ref459;const store=React.useMemo(()=>{let snapshot;const subscribers=/* @__PURE__ */new Set();return{subscribe:onStoreChange=>{if(!snapshot){snapshot=getScheme(localStorage.getItem(LOCAL_STORAGE_KEY))||"system";}subscribers.add(onStoreChange);return()=>{subscribers.delete(onStoreChange);};},getSnapshot:()=>snapshot,setSnapshot:nextScheme=>{snapshot=getScheme(nextScheme);for(const subscription of subscribers){subscription();}},// Only called during server-side rendering, and hydration if using hydrateRoot
// https://beta.reactjs.org/apis/react/useSyncExternalStore#adding-support-for-server-rendering
getServerSnapshot:()=>"system"};},[]);const scheme=React.useSyncExternalStore(store.subscribe,store.getSnapshot,store.getServerSnapshot);React.useEffect(()=>{if(typeof onSchemeChange==="function"){onSchemeChange(scheme);}localStorage.setItem(LOCAL_STORAGE_KEY,scheme);},[onSchemeChange,scheme]);return/* @__PURE__ */jsxRuntime.jsx(ColorSchemeSetValueContext.Provider,{value:store.setSnapshot,children:/* @__PURE__ */jsxRuntime.jsx(ColorSchemeValueContext.Provider,{value:scheme,children:/* @__PURE__ */jsxRuntime.jsx(ColorThemeProvider,{scheme,children})})});}function getScheme(scheme){switch(scheme){case"dark":case"light":return scheme;default:return"system";}}function ColorSchemeCustomProvider(_ref460){let{children,onSchemeChange,scheme}=_ref460;return/* @__PURE__ */jsxRuntime.jsx(ColorSchemeSetValueContext.Provider,{value:typeof onSchemeChange==="function"?onSchemeChange:false,children:/* @__PURE__ */jsxRuntime.jsx(ColorSchemeValueContext.Provider,{value:scheme,children:/* @__PURE__ */jsxRuntime.jsx(ColorThemeProvider,{scheme,children})})});}function useColorSchemeSetValue(){const setValue=React.useContext(ColorSchemeSetValueContext);if(setValue===null)throw new Error("Could not find `ColorSchemeSetValueContext` context");return setValue;}function _useColorSchemeInternalValue(){const value=React.useContext(ColorSchemeValueContext);if(value===null)throw new Error("Could not find `ColorSchemeValueContext` context");return value;}function useColorSchemeValue(){const scheme=_useColorSchemeInternalValue();const systemScheme=useSystemScheme();return scheme==="system"?systemScheme:scheme;}function useColorScheme(){const scheme=useColorSchemeValue();const setScheme=useColorSchemeSetValue();return React.useMemo(()=>({scheme,setScheme}),[scheme,setScheme]);}function useColorSchemeOptions(setScheme,t){const scheme=_useColorSchemeInternalValue();return React.useMemo(()=>{return[{title:t("user-menu.color-scheme.system-title"),name:"system",label:t("user-menu.color-scheme.system-description"),selected:scheme==="system",onSelect:()=>setScheme("system"),icon:icons.DesktopIcon},{title:t("user-menu.color-scheme.dark-title"),name:"dark",label:t("user-menu.color-scheme.dark-description"),selected:scheme==="dark",onSelect:()=>setScheme("dark"),icon:icons.MoonIcon},{title:t("user-menu.color-scheme.light-title"),name:"light",label:t("user-menu.color-scheme.light-description"),selected:scheme==="light",onSelect:()=>setScheme("light"),icon:icons.SunIcon}];},[scheme,setScheme,t]);}const SearchButton=React.forwardRef(function SearchButton2(_ref461,ref){let{onClick}=_ref461;const{t}=reactI18next.useTranslation();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("search.action-open-aria-label"),"data-testid":"studio-search",icon:icons.SearchIcon,tooltipProps:{content:t("search.button.tooltip"),hotkeys:[GLOBAL_SEARCH_KEY_MODIFIER,GLOBAL_SEARCH_KEY.toUpperCase()],portal:true},onClick,mode:"bleed",ref});});const isSearchHotKey=isHotkey__default.default("mod+".concat(GLOBAL_SEARCH_KEY));const isEscape$1=isHotkey__default.default("escape");function useSearchHotkeys(_ref462){let{open,onClose,onOpen}=_ref462;const{isTopLayer}=ui.useLayer();const handleClose=React.useCallback(()=>{onClose==null?void 0:onClose();},[onClose]);const handleGlobalKeyDown=React.useCallback(event=>{if(isSearchHotKey(event)){event.preventDefault();if(open){handleClose();}else{onOpen==null?void 0:onOpen();}}if(isEscape$1(event)&&open&&isTopLayer){handleClose();}},[handleClose,isTopLayer,open,onOpen]);ui.useGlobalKeyDown(handleGlobalKeyDown);}function SearchWrapper(_ref463){let{children,hasValidTerms,onClose,onOpen,open}=_ref463;const isMountedRef=React.useRef(false);const{dispatch,searchCommandList,setOnClose,state:{result}}=useSearchState();const handleClose=React.useCallback(()=>{var _a;dispatch({index:(_a=searchCommandList==null?void 0:searchCommandList.getTopIndex())!=null?_a:-1,type:"LAST_ACTIVE_INDEX_SET"});onClose();},[dispatch,onClose,searchCommandList]);useSearchHotkeys({onClose:handleClose,onOpen,open});React.useEffect(()=>{setOnClose(handleClose);},[handleClose,setOnClose]);React.useEffect(()=>{if((!hasValidTerms||result.loaded)&&isMountedRef.current){dispatch({index:0,type:"LAST_ACTIVE_INDEX_SET"});}},[dispatch,hasValidTerms,result.loaded]);React.useEffect(()=>{if(!hasValidTerms&&isMountedRef.current&&!open){dispatch({type:"ORDERING_RESET"});}},[dispatch,hasValidTerms,open]);React.useEffect(()=>{if(!(isMountedRef==null?void 0:isMountedRef.current)){isMountedRef.current=true;}},[]);return children;}function createOperatorDefinitionDictionary(operatorDefinitions){return operatorDefinitions.reduce((acc,val)=>{acc[val.type]=val;return acc;},{});}function getOperatorDefinition(operators,operatorType){return operatorType?operators[operatorType]:void 0;}function getOperatorInitialValue(operators,operatorType){var _a;return(_a=getOperatorDefinition(operators,operatorType))==null?void 0:_a.initialValue;}function buildSearchFilter(filterDefinition,fieldId){var _a;return{fieldId,filterName:filterDefinition.name,operatorType:((_a=filterDefinition==null?void 0:filterDefinition.operators.find(operator=>{return operator.type==="item";}))==null?void 0:_a.name)||""};}function generateFilterQuery(_ref464){let{fieldDefinitions,filterDefinitions,filters,operatorDefinitions}=_ref464;return filters.filter(filter=>validateFilter({filter,filterDefinitions,fieldDefinitions,operatorDefinitions})).map(filter=>{var _a;return(_a=getOperatorDefinition(operatorDefinitions,filter.operatorType))==null?void 0:_a.groqFilter({fieldPath:resolveFieldPath({filter,fieldDefinitions,filterDefinitions}),value:filter==null?void 0:filter.value});}).filter(filter=>!isEmpty__default.default(filter)).filter(isNonNullable$2).join(" && ");}function getFieldFromFilter(fields,filter){return(filter==null?void 0:filter.fieldId)?fields[filter.fieldId]:void 0;}function getFilterKey(filter){return[filter.filterName,...(filter.fieldId?[filter.fieldId]:[])].join("-");}function narrowDocumentTypes(_ref465){let{fieldDefinitions,filters,types}=_ref465;const selectedDocumentTypes=types.map(type=>type.name);const filteredDocumentTypes=Object.values(fieldDefinitions).filter(field=>filters.map(filter=>filter==null?void 0:filter.fieldId).includes(field.id)).filter(field=>field.documentTypes.length>0).map(field=>field.documentTypes);const intersectingDocumentTypes=intersection__default$1.default(...filteredDocumentTypes);const documentTypes=[];if(selectedDocumentTypes.length>0){documentTypes.push(selectedDocumentTypes);}if(intersectingDocumentTypes.length>0){documentTypes.push(intersectingDocumentTypes);}return intersection__default$1.default(...documentTypes).sort();}function resolveFieldPath(_ref466){let{filter,fieldDefinitions,filterDefinitions}=_ref466;const fieldDefinition=getFieldFromFilter(fieldDefinitions,filter);const filterDefinition=getFilterDefinition(filterDefinitions,filter.filterName);if(!filterDefinition){return void 0;}switch(filterDefinition.type){case"field":return fieldDefinition==null?void 0:fieldDefinition.fieldPath;case"pinned":return filterDefinition==null?void 0:filterDefinition.fieldPath;default:return void 0;}}function validateFilter(_ref467){let{filter,filterDefinitions,fieldDefinitions,operatorDefinitions}=_ref467;const filterDef=getFilterDefinition(filterDefinitions,filter.filterName);const operatorDef=getOperatorDefinition(operatorDefinitions,filter.operatorType);const fieldDef=getFieldFromFilter(fieldDefinitions,filter);if(!filterDef){return false;}if(!operatorDef){return false;}if(filter.fieldId){if(!fieldDef){return false;}}if(filterDef.type==="field"){if(!(fieldDef==null?void 0:fieldDef.fieldPath)){return false;}if(!filter.fieldId){return false;}const hasFilterValue=operatorDef.groqFilter({fieldPath:fieldDef.fieldPath,value:filter.value});if(!hasFilterValue){return false;}}if(filterDef.type==="pinned"){const hasFilterValue=operatorDef.groqFilter({fieldPath:filterDef.fieldPath,value:filter.value});if(!hasFilterValue){return false;}}return true;}var __freeze$Q=Object.freeze;var __defProp$Q=Object.defineProperty;var __template$Q=(cooked,raw)=>__freeze$Q(__defProp$Q(cooked,"raw",{value:__freeze$Q(raw||cooked.slice())}));var _a$Q;const isEscape=isHotkey__default.default("escape");const MAX_HEIGHT=500;const HiddenOverlay=styled__default.default.div(_a$Q||(_a$Q=__template$Q(["\n  background: transparent;\n  height: 100%;\n  left: 0;\n  position: fixed;\n  top: 0;\n  width: 100%;\n  z-index: -1;\n"])));function FilterPopoverWrapper(_ref468){let{anchorElement,children,onClose}=_ref468;const{isTopLayer}=ui.useLayer();const handleGlobalKeyDown=React.useCallback(event=>{if(isEscape(event)&&isTopLayer){onClose();}},[isTopLayer,onClose]);ui.useGlobalKeyDown(handleGlobalKeyDown);const popoverOffset=usePopoverOffset(anchorElement||null);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(HiddenOverlay,{onClick:onClose}),/* @__PURE__ */jsxRuntime.jsx(FocusLock__default.default,{autoFocus:false,returnFocus:true,children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{display:"flex",overflow:"hidden",radius:POPOVER_RADIUS,style:{maxHeight:"min(calc(100vh - ".concat(popoverOffset,"px - ").concat(POPOVER_VERTICAL_MARGIN,"px - ").concat(POPOVER_INPUT_PADDING,"px), ").concat(MAX_HEIGHT,"px"),zIndex:1},children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{children})})})]});}function calcPopoverOffset(element){const rect=element.getBoundingClientRect();const offset=rect.y+rect.height+POPOVER_VERTICAL_MARGIN;return offset;}function usePopoverOffset(element){const[offset,setOffset]=React.useState(element&&calcPopoverOffset(element));const handleWindowResize=React.useCallback(()=>{if(element){setOffset(calcPopoverOffset(element));}},[element]);React.useEffect(()=>{if(element){setOffset(calcPopoverOffset(element));}},[element]);React.useEffect(()=>{window.addEventListener("resize",handleWindowResize);return()=>window.removeEventListener("resize",handleWindowResize);},[handleWindowResize]);return offset;}var __freeze$P=Object.freeze;var __defProp$P=Object.defineProperty;var __template$P=(cooked,raw)=>__freeze$P(__defProp$P(cooked,"raw",{value:__freeze$P(raw||cooked.slice())}));var _a$P,_b$q;const SearchHeaderBox=styled__default.default(ui.Box)(_a$P||(_a$P=__template$P(["\n  border-bottom: 1px solid ",";\n  flex-shrink: 0;\n"])),_ref469=>{let{theme}=_ref469;return theme.sanity.color.base.border;});const SearchHeaderContentFlex=styled__default.default(ui.Flex)(_b$q||(_b$q=__template$P(["\n  box-sizing: border-box;\n"])));const FilterPopoverContentHeader=React.forwardRef(function FilterPopoverContentHeader2(_ref470,ref){let{ariaInputLabel,onChange,onClear,typeFilter}=_ref470;const{state:{fullscreen}}=useSearchState();const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(SearchHeaderBox,{children:/* @__PURE__ */jsxRuntime.jsx(SearchHeaderContentFlex,{align:"center",flex:1,padding:1,children:/* @__PURE__ */jsxRuntime.jsx(CustomTextInput,{__unstable_disableFocusRing:true,$smallClearButton:true,"aria-label":ariaInputLabel,autoComplete:"off",border:false,clearButton:!!typeFilter,fontSize:fullscreen?2:1,icon:icons.SearchIcon,muted:true,onChange,onClear,placeholder:t("search.filter-placeholder"),ref,spellCheck:false,radius:2,value:typeFilter})})});});function createFilterMenuItems(_ref471){let{documentTypesNarrowed,fieldDefinitions,filterDefinitions,schema,titleFilter,types,t}=_ref471;const fieldFilters=Object.values(fieldDefinitions).filter(fieldDef=>includesTitleInFieldDefinition(fieldDef,titleFilter)).map(fieldDef=>{const filterDef=getFilterDefinition(filterDefinitions,fieldDef.filterName);if(filterDef){return buildSearchFilter(filterDef,fieldDef.id);}return null;}).filter(isNonNullable$2);const pinnedItems=buildPinnedMenuItems({fieldDefinitions,filterDefinitions,titleFilter});if(documentTypesNarrowed.length===0){return[...pinnedItems,// All fields
...filterGroup({fieldDefinitions,filterDefinitions,filters:fieldFilters,headerTitle:t("search.filter-all-fields-header"),id:"field"})];}return[...pinnedItems,// All shared / narrowed items
...buildFieldMenuItemsNarrowed({documentTypesNarrowed,fieldDefinitions,filterDefinitions,filters:fieldFilters,schema,types,t})];}function filterGroup(_ref472){let{fieldDefinitions,filterDefinitions,filters,id,headerTitle,tone}=_ref472;const header={title:headerTitle||"",tone:tone||"default",type:"header"};const filterItems=filters.map(filter=>({fieldDefinition:getFieldFromFilter(fieldDefinitions,filter),filterDefinition:getFilterDefinition(filterDefinitions,filter.filterName),filter,group:id,tone:tone||"default",type:"filter"}));return filterItems.length>0?[...(headerTitle?[header]:[]),//
...filterItems]:[];}function buildFieldMenuItemsNarrowed(_ref473){let{documentTypesNarrowed,fieldDefinitions,filterDefinitions,filters,schema,types,t}=_ref473;const sharedFilters=filters.filter(filter=>{const fieldDefinition=getFieldFromFilter(fieldDefinitions,filter);return sharesDocumentTypes(documentTypesNarrowed,fieldDefinition);});const sharedItems=documentTypesNarrowed.length>1&&types.length>1?filterGroup({fieldDefinitions,filterDefinitions,filters:sharedFilters,headerTitle:t("search.filter-shared-fields-header"),id:"shared",tone:"primary"}):[];const groupedItems=documentTypesNarrowed.map(documentType=>{const docType=schema.get(documentType);return{// Note: it shouldn't be possible to select document types that do not exist in schema,
// and there is no way to inject it into state (eg not persisted in URL), thus we leave
// this fallback (`Unknown type`) only as a edge-case safety net and will not translate it.
title:(docType==null?void 0:docType.title)||startCase__default.default(docType==null?void 0:docType.name)||"(Unknown type)",documentType};}).sort((a,b)=>a.title.localeCompare(b.title)).map(_ref474=>{let{documentType,title}=_ref474;const groupFilters=filters.filter(filter=>{const fieldDefinition=getFieldFromFilter(fieldDefinitions,filter);return includesDocumentTypes([documentType],fieldDefinition);});return filterGroup({fieldDefinitions,filterDefinitions,filters:groupFilters,id:title,headerTitle:title});}).flat();return[...sharedItems,...groupedItems];}function buildPinnedMenuItems(_ref475){let{fieldDefinitions,filterDefinitions,titleFilter}=_ref475;const ungroupedPinnedFilters=Object.values(filterDefinitions).filter(isPinnedFilterDefWithoutGroup).filter(filterDef=>includesTitleInPinnedFilterDefinition(filterDef,titleFilter)).map(filterDef=>buildSearchFilter(filterDef));const groupedPinnedFilters=Object.values(filterDefinitions).filter(isPinnedFilterDefWithGroup).filter(filterDef=>includesTitleInPinnedFilterDefinition(filterDef,titleFilter)).reduce((acc,val)=>{acc[val.group]=acc[val.group]||[];acc[val.group].push(buildSearchFilter(val));return acc;},{});return[// Ungrouped
...filterGroup({fieldDefinitions,filterDefinitions,filters:ungroupedPinnedFilters,id:"pinned-ungrouped",tone:"primary"}),// Grouped
...Object.entries(groupedPinnedFilters).flatMap(_ref476=>{let[groupTitle,filters]=_ref476;return filterGroup({fieldDefinitions,filterDefinitions,filters,headerTitle:groupTitle,id:groupTitle,tone:"primary"});})];}function includesDocumentTypes(documentTypes,fieldDefinition){return fieldDefinition==null?void 0:fieldDefinition.documentTypes.some(type=>documentTypes.includes(type));}function includesTitleInFieldDefinition(field,currentTitle){const fieldTitle=field.titlePath.join("/");return fieldTitle.toLowerCase().includes(currentTitle.toLowerCase());}function includesTitleInPinnedFilterDefinition(filter,currentTitle){return filter.title.toLowerCase().includes(currentTitle.toLowerCase());}function isPinnedFilterDefWithGroup(filterDef){return filterDef.type==="pinned"&&typeof(filterDef==null?void 0:filterDef.group)!=="undefined";}function isPinnedFilterDefWithoutGroup(filterDef){return filterDef.type==="pinned"&&typeof(filterDef==null?void 0:filterDef.group)==="undefined";}function sharesDocumentTypes(documentTypes,fieldDefinition){return difference__default.default(documentTypes,(fieldDefinition==null?void 0:fieldDefinition.documentTypes)||[]).length===0;}function FilterTitle(_ref477){let{filter,maxLength}=_ref477;const{state:{definitions}}=useSearchState();const title=React.useMemo(()=>{const filterDef=getFilterDefinition(definitions.filters,filter.filterName);switch(filterDef==null?void 0:filterDef.type){case"field":{const fieldDefinition=getFieldFromFilter(definitions.fields,filter);if(fieldDefinition==null?void 0:fieldDefinition.titlePath){return fieldDefinition.titlePath[fieldDefinition.titlePath.length-1];}return null;}case"pinned":return filterDef.title;default:return null;}},[definitions,filter]);if(!title){return null;}return maxLength&&title.length>maxLength?/* @__PURE__ */jsxRuntime.jsxs("span",{children:[title.slice(0,maxLength),"\u2026"]}):/* @__PURE__ */jsxRuntime.jsx("span",{children:title});}function FilterIcon(_ref478){let{filter}=_ref478;var _a;const{state:{definitions}}=useSearchState();const icon=(_a=getFilterDefinition(definitions.filters,filter.filterName))==null?void 0:_a.icon;if(icon){return React.createElement(icon);}return/* @__PURE__ */jsxRuntime.jsx(icons.UnknownIcon,{});}function FilterDetails(_ref479){let{filter}=_ref479;var _a;const{state:{definitions}}=useSearchState();const fieldDefinition=getFieldFromFilter(definitions.fields,filter);return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[(fieldDefinition==null?void 0:fieldDefinition.titlePath)&&((_a=fieldDefinition.titlePath)==null?void 0:_a.length)>1&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:0,children:fieldDefinition.titlePath.slice(0,-1).map((pathTitle,index)=>{return/* @__PURE__ */jsxRuntime.jsxs(React.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx("span",{children:pathTitle}),index!==fieldDefinition.titlePath.length-2&&/* @__PURE__ */jsxRuntime.jsx("span",{style:{opacity:0.75,paddingLeft:"0.25em",paddingRight:"0.25em"},children:/* @__PURE__ */jsxRuntime.jsx(icons.ChevronRightIcon,{})})]},index);})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"flex-start",gap:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{style:{flexShrink:0},children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(FilterIcon,{filter})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:/* @__PURE__ */jsxRuntime.jsx(FilterTitle,{filter})})]})]});}function sanitizeFieldValue(name){if(React.isValidElement(name)){return stripHtmlTags(server.renderToString(name));}return typeof name==="string"?name:"";}function stripHtmlTags(str){var _a;return((_a=new DOMParser().parseFromString(str,"text/html"))==null?void 0:_a.body.textContent)||"";}const MAX_VISIBLE_TYPES=10;function FilterTooltip(_ref480){let{children,fieldDefinition,filterDefinition,visible}=_ref480;const{state:{documentTypesNarrowed}}=useSearchState();const{t}=useTranslation();const schema=useSchema();const fieldDefinitionDocumentTypeTitles=React.useMemo(()=>{if(fieldDefinition==null?void 0:fieldDefinition.documentTypes){return fieldDefinition.documentTypes.map(d=>{const defType=schema.get(d);return(defType==null?void 0:defType.title)||startCase__default.default(defType==null?void 0:defType.name);}).filter(isNonNullable$2).sort();}return[];},[fieldDefinition==null?void 0:fieldDefinition.documentTypes,schema]);const fieldDefinitionDescription=React.useMemo(()=>{if(fieldDefinition==null?void 0:fieldDefinition.documentTypes){const descriptions=fieldDefinition.documentTypes.map(d=>{const defType=schema.get(d);if(defType){const field=getSchemaField(defType,fieldDefinition.fieldPath);return(field==null?void 0:field.type.description)&&sanitizeFieldValue(field==null?void 0:field.type.description);}return null;}).filter(isNonNullable$2).sort();const uniqueDescriptions=uniq__default.default(descriptions);if(uniqueDescriptions.length===1){return uniqueDescriptions[0];}}return void 0;},[fieldDefinition==null?void 0:fieldDefinition.documentTypes,fieldDefinition==null?void 0:fieldDefinition.fieldPath,schema]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{tone:"default",radius:2,style:{maxWidth:"250px"},children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[fieldDefinition&&/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:t("search.filter-field-tooltip-name")}),/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{size:1,style:{fontFamily:"monospace"},tone:"primary",textOverflow:"ellipsis",children:fieldDefinition==null?void 0:fieldDefinition.name})]}),fieldDefinitionDescription&&/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:t("search.filter-field-tooltip-description")}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:truncateString(fieldDefinitionDescription,256)})]}),(filterDefinition==null?void 0:filterDefinition.description)&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:truncateString(filterDefinition.description,256)}),!documentTypesNarrowed.length&&fieldDefinitionDocumentTypeTitles.length>0&&/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:t("search.filter-field-tooltip-used-in-document-types")}),/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:1,radius:2,tone:"transparent",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,children:fieldDefinitionDocumentTypeTitles.length})})]}),/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{size:1,weight:"regular",muted:true,children:[fieldDefinitionDocumentTypeTitles.slice(0,MAX_VISIBLE_TYPES).join(", "),(fieldDefinitionDocumentTypeTitles==null?void 0:fieldDefinitionDocumentTypeTitles.length)>MAX_VISIBLE_TYPES?" +".concat(fieldDefinitionDocumentTypeTitles.length-MAX_VISIBLE_TYPES," more"):""]})]})]})}),disabled:!visible,fallbackPlacements:["left"],placement:"right",portal:true,children});}const MenuItemFilter=React.memo(function MenuItemFilter2(_ref481){let{item,onClose,...rest}=_ref481;const{dispatch,state:{filters}}=useSearchState();const handleClick=React.useCallback(()=>{dispatch({filter:item.filter,type:"TERMS_FILTERS_ADD"});onClose==null?void 0:onClose();},[dispatch,item.filter,onClose]);const isAlreadyActive=!!filters.find(f=>getFilterKey(f)===getFilterKey(item.filter));const tooltipEnabled=!!(item.fieldDefinition||item.filterDefinition.description);return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{...rest,children:/* @__PURE__ */jsxRuntime.jsx(ui.Button,{disabled:isAlreadyActive,fontSize:1,justify:"flex-start",mode:"bleed",onClick:isAlreadyActive?void 0:handleClick,padding:0,style:{position:"relative",whiteSpace:"normal",width:"100%"},tabIndex:-1,tone:item==null?void 0:item.tone,children:/* @__PURE__ */jsxRuntime.jsx(FilterTooltip,{fieldDefinition:item.fieldDefinition,filterDefinition:item.filterDefinition,visible:tooltipEnabled,children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:3,children:/* @__PURE__ */jsxRuntime.jsx(FilterDetails,{filter:item.filter})})})})});});const MenuItemHeader=React.memo(function MenuItemHeader2(_ref482){let{item}=_ref482;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingTop:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderBottom:true,paddingX:2,paddingY:3,tone:item==null?void 0:item.tone,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",weight:"medium",children:item.title})})});});const POPOVER_STYLES$1={width:"300px"};function AddFilterPopoverContent(_ref483){let{onClose}=_ref483;const[inputElement,setInputElement]=React.useState(null);const[titleFilter,setTitleFilter]=React.useState("");const{t}=useTranslation();const handleFilterChange=React.useCallback(e=>setTitleFilter(e.currentTarget.value),[setTitleFilter]);const handleFilterClear=React.useCallback(()=>setTitleFilter(""),[]);const schema=useSchema();const{state:{documentTypesNarrowed,definitions,filters,terms:{types}}}=useSearchState();const filteredMenuItems=React.useMemo(()=>createFilterMenuItems({documentTypesNarrowed,fieldDefinitions:definitions.fields,filterDefinitions:definitions.filters,schema,titleFilter,types,t}),[documentTypesNarrowed,definitions.fields,definitions.filters,schema,titleFilter,types,t]);const renderItem=React.useCallback(item=>{if(item.type==="filter"){return/* @__PURE__ */jsxRuntime.jsx(MenuItemFilter,{item,onClose,paddingBottom:1});}if(item.type==="header"){return/* @__PURE__ */jsxRuntime.jsx(MenuItemHeader,{item});}return null;},[onClose]);const getItemDisabled=React.useCallback(index=>{const filterItem=filteredMenuItems[index];return filterItem.type!=="filter"||!!filters.find(f=>getFilterKey(f)===getFilterKey(filterItem.filter));},[filteredMenuItems,filters]);const getItemKey=React.useCallback(index=>{const menuItem=filteredMenuItems[index];switch(menuItem.type){case"filter":return[...(menuItem.group?[menuItem.group]:[]),//
getFilterKey(menuItem.filter)].join("-");case"header":return"".concat(menuItem.type,"-").concat(menuItem.title);default:return index;}},[filteredMenuItems]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{direction:"column",style:POPOVER_STYLES$1,children:[/* @__PURE__ */jsxRuntime.jsx(FilterPopoverContentHeader,{ariaInputLabel:t("search.filter-by-title-aria-label"),onChange:handleFilterChange,onClear:handleFilterClear,ref:setInputElement,typeFilter:titleFilter}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[filteredMenuItems.length>0&&/* @__PURE__ */jsxRuntime.jsx(CommandList,{activeItemDataAttr:"data-hovered",ariaLabel:t("search.filters-aria-label",{count:filteredMenuItems.length}),autoFocus:"input",getItemDisabled,getItemKey,inputElement,itemHeight:45,items:filteredMenuItems,overscan:20,padding:1,paddingBottom:0,renderItem}),filteredMenuItems.length==0&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",children:t("search.filter-no-matches-found",{filter:titleFilter})})})]})]});}function AddFilterButton(){const[open,setOpen]=React.useState(false);const[buttonElement,setButtonElement]=React.useState(null);const[popoverElement,setPopoverElement]=React.useState(null);const{t}=useTranslation();const{state:{fullscreen}}=useSearchState();const handleClose=React.useCallback(()=>setOpen(false),[]);const handleOpen=React.useCallback(()=>setOpen(true),[]);ui.useClickOutside(handleClose,[buttonElement,popoverElement]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{__unstable_margins:[POPOVER_VERTICAL_MARGIN,0,0,0],content:/* @__PURE__ */jsxRuntime.jsx(FilterPopoverWrapper,{anchorElement:buttonElement,onClose:handleClose,children:/* @__PURE__ */jsxRuntime.jsx(AddFilterPopoverContent,{onClose:handleClose})}),open,placement:"bottom-start",radius:POPOVER_RADIUS,ref:setPopoverElement,portal:true,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.AddIcon,mode:"bleed",onClick:handleOpen,size:fullscreen?"large":"default",ref:setButtonElement,selected:open,text:t("search.action.add-filter")})});}const DocumentTypeFilterItem=React.memo(function TypeFilterItem(_ref484){let{selected,type,...rest}=_ref484;var _a,_b;const{dispatch}=useSearchState();const handleTypeAdd=React.useCallback(()=>{dispatch({type:"TERMS_TYPE_ADD",schemaType:type});},[dispatch,type]);const handleTypeRemove=React.useCallback(()=>{dispatch({type:"TERMS_TYPE_REMOVE",schemaType:type});},[dispatch,type]);const handleClick=React.useCallback(()=>{if(selected){handleTypeRemove();}else{handleTypeAdd();}},[handleTypeAdd,handleTypeRemove,selected]);return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{...rest,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{iconRight:selected&&icons.CheckmarkIcon,justify:"flex-start",mode:"bleed",onClick:handleClick,width:"fill",size:"large",tabIndex:-1,text:(_b=type.title)!=null?_b:type.name,tone:selected?"primary":"default"},(_a=type.title)!=null?_a:type.name)});});var __freeze$O=Object.freeze;var __defProp$O=Object.defineProperty;var __template$O=(cooked,raw)=>__freeze$O(__defProp$O(cooked,"raw",{value:__freeze$O(raw||cooked.slice())}));var _a$O;const ClearButtonBox=styled__default.default(ui.Box)(_a$O||(_a$O=__template$O(["\n  border-top: 1px solid ",";\n  flex-shrink: 0;\n"])),_ref485=>{let{theme}=_ref485;return theme.sanity.color.base.border;});const POPOVER_STYLES={width:"250px"};function DocumentTypesPopoverContent(){const[inputElement,setInputElement]=React.useState(null);const[typeFilter,setTypeFilter]=React.useState("");const commandListRef=React.useRef(null);const{t}=useTranslation();const schema=useSchema();const{dispatch,state:{terms:{types:selectedTypes}}}=useSearchState();const[selectedTypesSnapshot,setSelectedTypesSnapshot]=React.useState(selectedTypes);const documentTypeItems=useGetDocumentTypeItems(schema,selectedTypes,selectedTypesSnapshot,typeFilter);const handleFilterChange=React.useCallback(e=>setTypeFilter(e.currentTarget.value),[setTypeFilter]);const handleFilterClear=React.useCallback(()=>setTypeFilter(""),[]);const handleTypesClear=React.useCallback(()=>{var _a2,_b;setSelectedTypesSnapshot([]);dispatch({type:"TERMS_TYPES_CLEAR"});(_a2=commandListRef==null?void 0:commandListRef.current)==null?void 0:_a2.focusInputElement();(_b=commandListRef==null?void 0:commandListRef.current)==null?void 0:_b.scrollToIndex(0);},[dispatch]);const getItemKey=React.useCallback(index=>{const virtualItem=documentTypeItems[index];switch(virtualItem.type){case"divider":return"".concat(virtualItem.type,"-").concat(index);case"header":return"".concat(virtualItem.type,"-").concat(virtualItem.title);case"item":return"".concat(virtualItem.type,"-").concat(virtualItem.item.name);default:return index;}},[documentTypeItems]);const renderItem=React.useCallback(item=>{if(item.type==="divider"){return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingY:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{})});}if(item.type==="header"){return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{margin:2,padding:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:item.title})});}if(item.type==="item"){return/* @__PURE__ */jsxRuntime.jsx(DocumentTypeFilterItem,{paddingBottom:1,selected:item.selected,type:item.item});}return null;},[]);const getItemDisabled=React.useCallback(index=>{const item=documentTypeItems[index];return item.type!=="item";},[documentTypeItems]);const getItemSelected=React.useCallback(index=>{const item=documentTypeItems[index];return item.type==="item"&&item.selected;},[documentTypeItems]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{direction:"column",style:POPOVER_STYLES,children:[/* @__PURE__ */jsxRuntime.jsx(FilterPopoverContentHeader,{ariaInputLabel:t("search.action.filter-by-document-type-aria-label"),onChange:handleFilterChange,onClear:handleFilterClear,ref:setInputElement,typeFilter}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[documentTypeItems.length>0&&/* @__PURE__ */jsxRuntime.jsx(CommandList,{activeItemDataAttr:"data-hovered",ariaLabel:t("search.document-types-aria-label"),ariaMultiselectable:true,autoFocus:"input",getItemDisabled,getItemSelected,getItemKey,inputElement,itemHeight:37,items:documentTypeItems,overscan:20,padding:1,paddingBottom:0,ref:commandListRef,renderItem}),!documentTypeItems.length&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",children:t("search.document-types-no-matches-found",{filter:typeFilter})})})]}),!typeFilter&&selectedTypes.length>0&&/* @__PURE__ */jsxRuntime.jsx(ClearButton,{onClick:handleTypesClear,selectedTypes})]});}function ClearButton(_ref486){let{onClick,selectedTypes}=_ref486;const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ClearButtonBox,{padding:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("search.action.clear-type-filters-aria-label"),"data-name":"type-filter-button",disabled:selectedTypes.length===0,mode:"bleed",onClick,text:t("search.action.clear-type-filters-label"),tone:"primary"})})});}function useGetDocumentTypeItems(schema,selectedTypes,selectedTypesSnapshot,typeFilter){return React.useMemo(()=>{const[itemsSelected,itemsUnselected]=partition__default.default(getSelectableOmnisearchTypes(schema,typeFilter),type=>selectedTypesSnapshot.includes(type));const hasSelectedItems=itemsSelected.length>0;const hasUnselectedItems=itemsSelected.length>0;const items=[];if(hasSelectedItems){items.push({title:"Selected",type:"header"});}itemsSelected.forEach(item=>items.push({item,selected:selectedTypes.includes(item),type:"item"}));if(hasSelectedItems&&hasUnselectedItems){items.push({type:"divider"});}itemsUnselected.forEach(item=>items.push({item,selected:selectedTypes.includes(item),type:"item"}));return items;},[schema,selectedTypes,selectedTypesSnapshot,typeFilter]);}const FALLBACK_PLACEMENTS=["top-start","bottom-start"];function DocumentTypesButton(){const[open,setOpen]=React.useState(false);const[buttonElement,setButtonElement]=React.useState(null);const[popoverElement,setPopoverElement]=React.useState(null);const{state:{fullscreen,terms:{types}}}=useSearchState();const{t}=useTranslation();const handleClose=React.useCallback(()=>setOpen(false),[]);const handleOpen=React.useCallback(()=>setOpen(true),[]);ui.useClickOutside(handleClose,[buttonElement,popoverElement]);const title=React.useMemo(()=>documentTypesTruncated({types,t}),[types,t]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{__unstable_margins:[POPOVER_VERTICAL_MARGIN,0,0,0],content:/* @__PURE__ */jsxRuntime.jsx(FilterPopoverWrapper,{anchorElement:buttonElement,onClose:handleClose,children:/* @__PURE__ */jsxRuntime.jsx(DocumentTypesPopoverContent,{})}),open,placement:"bottom-start",fallbackPlacements:FALLBACK_PLACEMENTS,portal:true,radius:POPOVER_RADIUS,ref:setPopoverElement,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{iconRight:icons.ChevronDownIcon,mode:"ghost",onClick:handleOpen,size:fullscreen?"large":"default",ref:setButtonElement,selected:open,text:title,tone:"default"})});}var __freeze$N=Object.freeze;var __defProp$N=Object.defineProperty;var __template$N=(cooked,raw)=>__freeze$N(__defProp$N(cooked,"raw",{value:__freeze$N(raw||cooked.slice())}));var _a$N;const CustomBox=styled__default.default(ui.Box)(_a$N||(_a$N=__template$N(["\n  flex-shrink: ",";\n"])),_ref487=>{let{$flexShrink=0}=_ref487;return $flexShrink;});function FilterLabel(_ref488){let{filter,fontSize=1,showContent=true}=_ref488;const{t}=useTranslation();const{state:{definitions,fullscreen}}=useSearchState();const operator=getOperatorDefinition(definitions.operators,filter.operatorType);const ButtonValue=operator==null?void 0:operator.buttonValueComponent;const filterValue=filter.value;const components=React.useMemo(()=>({Field:()=>/* @__PURE__ */jsxRuntime.jsx(CustomBox,{$flexShrink:fullscreen?1:0,children:/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{tone:"default",size:fontSize,textOverflow:"ellipsis",weight:"medium",children:/* @__PURE__ */jsxRuntime.jsx(FilterTitle,{filter,maxLength:fullscreen?25:40})})}),Operator:_ref489=>{let{children}=_ref489;return showContent?/* @__PURE__ */jsxRuntime.jsx(CustomBox,{$flexShrink:0,children:/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{tone:"default",size:fontSize,textOverflow:"ellipsis",weight:"regular",children})}):null;},Value:_ref490=>{let{children}=_ref490;return showContent?/* @__PURE__ */jsxRuntime.jsx(CustomBox,{$flexShrink:1,children:/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{tone:"default",size:fontSize,textOverflow:"ellipsis",weight:"medium",children:ButtonValue?/* @__PURE__ */jsxRuntime.jsx(ButtonValue,{value:filterValue}):children})}):null;}}),[filter,fontSize,fullscreen,showContent,ButtonValue,filterValue]);if(!(operator==null?void 0:operator.descriptionKey)){console.warn("Missing `descriptionKey` for operator `%s`",filter.operatorType);}if(!showContent||!(operator==null?void 0:operator.descriptionKey)){const Field=components.Field;return/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",gap:1,children:/* @__PURE__ */jsxRuntime.jsx(Field,{})});}return/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",gap:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:operator==null?void 0:operator.descriptionKey,components,values:getFilterValues(filter)})});}function getFilterValues(filter){const values={};if(typeof filter.value==="number"){values.count=filter.value;}if(isStringOrNumber(filter.value)){values.value=filter.value;}if(isRecord$4(filter.value)&&"from"in filter.value&&isStringOrNumber(filter.value.from)){values.from=filter.value.from;}if(isRecord$4(filter.value)&&"to"in filter.value&&isStringOrNumber(filter.value.to)){values.to=filter.value.to;}return values;}function isStringOrNumber(value){return typeof value==="string"||typeof value==="number";}function FilterError(props){const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{...props,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"flex-start",gap:3,children:[/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{tone:"critical",children:/* @__PURE__ */jsxRuntime.jsx(icons.ErrorOutlineIcon,{})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{size:1,tone:"critical",weight:"medium",children:t("search.error.display-filter-title")}),/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{size:1,tone:"critical",children:t("search.error.display-filter-description")})]})]})});}function CustomMenuItem$1(_ref491){let{onClick,operator,selected}=_ref491;const handleClick=React.useCallback(()=>onClick(operator.type),[onClick,operator.type]);const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{onClick:handleClick,pressed:selected,tone:"default",text:t(operator.nameKey),iconRight:operator==null?void 0:operator.icon});}function OperatorsMenuButton(_ref492){let{filter,operator}=_ref492;var _a;const menuButtonId=React.useId();const{t}=useTranslation();const{dispatch,state}=useSearchState();const operatorItems=(_a=getFilterDefinition(state.definitions.filters,filter.filterName))==null?void 0:_a.operators;const handleClick=React.useCallback(operatorType=>{dispatch({filterKey:getFilterKey(filter),operatorType,type:"TERMS_FILTERS_SET_OPERATOR"});},[dispatch,filter]);if(!operator||!operatorItems||operatorItems.length<=1){return null;}return/* @__PURE__ */jsxRuntime.jsx(ui.Inline,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"ghost",iconRight:icons.ChevronDownIcon,text:t(operator.nameKey)}),id:menuButtonId||"",menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:operatorItems.map((item,index)=>{if(item.type==="item"){const menuOperator=getOperatorDefinition(state.definitions.operators,item.name);if(!menuOperator){return null;}return/* @__PURE__ */jsxRuntime.jsx(CustomMenuItem$1,{onClick:handleClick,operator:menuOperator,selected:operator.type===item.name},index);}if(item.type==="divider"){return/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{},index);}return null;})}),placement:"bottom-start",popover:{constrainSize:true,portal:false,radius:2}})});}function FilterForm(_ref493){let{filter}=_ref493;const[errorParams,setErrorParams]=React.useState(null);const{dispatch,state:{definitions,fullscreen}}=useSearchState();const filterDefinition=getFilterDefinition(definitions.filters,filter.filterName);const operator=getOperatorDefinition(definitions.operators,filter.operatorType);const fieldDefinition=getFieldFromFilter(definitions.fields,filter);const filterKey=getFilterKey(filter);const handleClose=React.useCallback(()=>{dispatch({filterKey:getFilterKey(filter),type:"TERMS_FILTERS_REMOVE"});},[dispatch,filter]);const handleValueChange=React.useCallback(value=>{dispatch({filterKey,type:"TERMS_FILTERS_SET_VALUE",value});},[dispatch,filterKey]);const handleCatchError=React.useCallback(params=>{setErrorParams(params);},[]);const Component=operator==null?void 0:operator.inputComponent;if(errorParams){return/* @__PURE__ */jsxRuntime.jsx(FilterError,{padding:4});}return/* @__PURE__ */jsxRuntime.jsx(ui.ErrorBoundary,{onCatch:handleCatchError,children:/* @__PURE__ */jsxRuntime.jsx(FocusLock__default.default,{autoFocus:!supportsTouch,returnFocus:true,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{direction:"column-reverse",children:[Component&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderTop:true,padding:3,children:/* @__PURE__ */jsxRuntime.jsx(Component,{fieldDefinition,onChange:handleValueChange,value:filter.value},filter.operatorType)}),/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"flex-start",gap:3,justify:"space-between",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingLeft:1,paddingRight:2,paddingY:1,children:/* @__PURE__ */jsxRuntime.jsx(FilterDetails,{filter})}),fullscreen&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.TrashIcon,mode:"bleed",onClick:handleClose,tone:"critical",tooltipProps:{content:"Remove filter"}})]}),(filterDefinition==null?void 0:filterDefinition.description)&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,padding:3,radius:2,tone:"transparent",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:filterDefinition.description})}),/* @__PURE__ */jsxRuntime.jsx(OperatorsMenuButton,{filter,operator})]})})]})})});}var __freeze$M=Object.freeze;var __defProp$M=Object.defineProperty;var __template$M=(cooked,raw)=>__freeze$M(__defProp$M(cooked,"raw",{value:__freeze$M(raw||cooked.slice())}));var _a$M;const ContainerFlex=styled__default.default(ui.Flex)(_a$M||(_a$M=__template$M(["\n  max-width: 480px;\n  min-width: 150px;\n  overflow: hidden;\n  overflow: clip;\n  width: 100%;\n"])));function FilterPopoverContent(_ref494){let{filter}=_ref494;return/* @__PURE__ */jsxRuntime.jsxs(ContainerFlex,{direction:"column",children:[/* @__PURE__ */jsxRuntime.jsx(FilterForm,{filter}),DEBUG_MODE]});}var __freeze$L=Object.freeze;var __defProp$L=Object.defineProperty;var __template$L=(cooked,raw)=>__freeze$L(__defProp$L(cooked,"raw",{value:__freeze$L(raw||cooked.slice())}));var _a$L,_b$p,_c$e,_d$6;const CloseButton=styled__default.default(ui.Button)(_a$L||(_a$L=__template$L(["\n  border-radius: ",";\n"])),_ref495=>{let{theme}=_ref495;return"0 ".concat(ui.rem(theme.sanity.radius[2])," ").concat(ui.rem(theme.sanity.radius[2])," 0");});const CloseCard=styled__default.default(ui.Card)(_b$p||(_b$p=__template$L(["\n  position: absolute;\n  right: 0;\n"])));const ContainerDiv=styled__default.default.div(_c$e||(_c$e=__template$L(["\n  align-items: center;\n  display: inline-flex;\n  max-width: 100%;\n  position: relative;\n"])));const LabelButton=styled__default.default(ui.Button)(_d$6||(_d$6=__template$L(["\n  border: none;\n  width: 100%;\n"])));function FilterButton(_ref496){let{filter,initialOpen}=_ref496;const[open,setOpen]=React.useState(initialOpen);const[buttonElement,setButtonElement]=React.useState(null);const[popoverElement,setPopoverElement]=React.useState(null);const{dispatch,state:{definitions,fullscreen}}=useSearchState();const{t}=useTranslation();const handleClose=React.useCallback(()=>setOpen(false),[]);const handleOpen=React.useCallback(()=>setOpen(true),[]);const handleRemove=React.useCallback(()=>dispatch({filterKey:getFilterKey(filter),type:"TERMS_FILTERS_REMOVE"}),[dispatch,filter]);const handleKeyDown=React.useCallback(event=>{if(["Backspace","Delete"].includes(event.key)){handleRemove();}},[handleRemove]);ui.useClickOutside(handleClose,[buttonElement,popoverElement]);const isValid=validateFilter({fieldDefinitions:definitions.fields,filter,filterDefinitions:definitions.filters,operatorDefinitions:definitions.operators});return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{__unstable_margins:[POPOVER_VERTICAL_MARGIN,0,0,0],content:/* @__PURE__ */jsxRuntime.jsx(FilterPopoverWrapper,{anchorElement:buttonElement,onClose:handleClose,children:/* @__PURE__ */jsxRuntime.jsx(FilterPopoverContent,{filter})}),constrainSize:true,open,overflow:"auto",placement:"bottom-start",portal:true,radius:POPOVER_RADIUS,ref:setPopoverElement,children:/* @__PURE__ */jsxRuntime.jsxs(ContainerDiv,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{__unstable_focusRing:true,display:"flex",radius:2,tone:isValid?"primary":"transparent",children:/* @__PURE__ */jsxRuntime.jsx(LabelButton,{mode:"bleed",onClick:handleOpen,onKeyDown:handleKeyDown,paddingLeft:fullscreen?3:2,paddingRight:fullscreen?3:5,paddingY:fullscreen?3:2,ref:setButtonElement,children:/* @__PURE__ */jsxRuntime.jsx(FilterLabel,{filter,showContent:isValid})})}),!fullscreen&&/* @__PURE__ */jsxRuntime.jsx(CloseCard,{__unstable_focusRing:true,display:"flex",radius:2,tone:isValid?"primary":"transparent",children:/* @__PURE__ */jsxRuntime.jsx(CloseButton,{"aria-label":t("search.action.remove-filter-aria-label"),fontSize:1,icon:icons.CloseIcon,mode:"bleed",onClick:handleRemove,onKeyDown:handleKeyDown,padding:2,radius:2})})]})});}function Filters(){const{dispatch,state:{filters,fullscreen,lastAddedFilter,terms:{types}}}=useSearchState();const{t}=useTranslation();const isMounted=React.useRef(false);const handleClear=React.useCallback(()=>{dispatch({type:"TERMS_FILTERS_CLEAR"});dispatch({type:"TERMS_TYPES_CLEAR"});},[dispatch]);const clearFiltersButtonVisible=filters.length>0||types.length>0;React.useEffect(()=>{isMounted.current=true;},[]);const lastAddedFilterKey=lastAddedFilter&&getFilterKey(lastAddedFilter);const ClearFiltersButton=()=>/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"bleed",onClick:handleClear,size:fullscreen?"large":"default",text:t("search.action.clear-filters"),tone:"critical"});return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"flex-start",gap:3,justify:"space-between",padding:2,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{flex:1,gap:2,wrap:"wrap",children:[/* @__PURE__ */jsxRuntime.jsx(DocumentTypesButton,{}),filters==null?void 0:filters.map(filter=>{const key=getFilterKey(filter);return/* @__PURE__ */jsxRuntime.jsx(FilterButton,{filter,initialOpen:isMounted.current&&lastAddedFilterKey===key},key);}),!fullscreen&&/* @__PURE__ */jsxRuntime.jsx(AddFilterButton,{})]}),clearFiltersButtonVisible&&!fullscreen&&/* @__PURE__ */jsxRuntime.jsx(ClearFiltersButton,{})]}),fullscreen&&/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{justify:"space-between",paddingBottom:2,paddingX:2,children:[/* @__PURE__ */jsxRuntime.jsx(AddFilterButton,{}),clearFiltersButtonVisible&&/* @__PURE__ */jsxRuntime.jsx(ClearFiltersButton,{})]}),DEBUG_MODE]});}function Instructions(){const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",direction:"column",gap:4,paddingX:4,paddingY:5,children:/* @__PURE__ */jsxRuntime.jsx(ui.Inline,{space:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"search.instructions",components:{ControlsIcon:()=>/* @__PURE__ */jsxRuntime.jsx(icons.ControlsIcon,{style:{padding:"0 0.25rem"}},0)}})})})});}function DocumentTypesPill(_ref497){let{availableCharacters,types}=_ref497;const{t}=useTranslation();const title=React.useMemo(()=>documentTypesTruncated({availableCharacters,types,t}),[availableCharacters,types,t]);return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,padding:2,radius:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:title})});}var __freeze$K=Object.freeze;var __defProp$K=Object.defineProperty;var __template$K=(cooked,raw)=>__freeze$K(__defProp$K(cooked,"raw",{value:__freeze$K(raw||cooked.slice())}));var _a$K;const FilterPillCard=styled__default.default(ui.Card)(_a$K||(_a$K=__template$K(["\n  cursor: default;\n"])));function FilterPill(_ref498){let{filter}=_ref498;return/* @__PURE__ */jsxRuntime.jsx(FilterPillCard,{border:true,padding:2,radius:2,tone:"primary",children:/* @__PURE__ */jsxRuntime.jsx(FilterLabel,{filter})});}var __freeze$J=Object.freeze;var __defProp$J=Object.defineProperty;var __template$J=(cooked,raw)=>__freeze$J(__defProp$J(cooked,"raw",{value:__freeze$J(raw||cooked.slice())}));var _a$J,_b$o,_c$d,_d$5;const DEFAULT_COMBINED_TYPE_COUNT=40;const RecentSearchItemButton=styled__default.default(ui.Button)(_a$J||(_a$J=__template$J(["\n  border-radius: ",";\n  cursor: default;\n  width: 100%;\n"])),_ref499=>{let{theme}=_ref499;return ui.rem(theme.sanity.radius[2]);});const SearchItemPillsBox=styled__default.default(ui.Box)(_b$o||(_b$o=__template$J(["\n  flex-shrink: 3;\n"])));const SearchItemQueryFlex=styled__default.default(ui.Flex)(_c$d||(_c$d=__template$J(["\n  flex-shrink: 2;\n"])));const CloseButtonDiv=styled__default.default.div(_d$5||(_d$5=__template$J(["\n  opacity: 0.8;\n  visibility: hidden;\n\n  @media (hover: hover) {\n    ",":hover & {\n      visibility: visible;\n    }\n    &:hover {\n      opacity: 0.4;\n    }\n  }\n"])),RecentSearchItemButton);function RecentSearchItem(_ref500){let{index,maxVisibleTypePillChars=DEFAULT_COMBINED_TYPE_COUNT,value,...rest}=_ref500;var _a2;const{dispatch,recentSearchesStore}=useSearchState();const availableCharacters=maxVisibleTypePillChars-value.query.length;const handleClick=React.useCallback(()=>{dispatch({type:"TERMS_SET",filters:value==null?void 0:value.filters,terms:value});if(recentSearchesStore){const updatedRecentSearches=recentSearchesStore==null?void 0:recentSearchesStore.addSearch(value,value==null?void 0:value.filters);dispatch({recentSearches:updatedRecentSearches,type:"RECENT_SEARCHES_SET"});}},[dispatch,recentSearchesStore,value]);const handleDelete=React.useCallback(event=>{event.stopPropagation();if(recentSearchesStore){const updatedRecentSearches=recentSearchesStore==null?void 0:recentSearchesStore.removeSearchAtIndex(index);dispatch({recentSearches:updatedRecentSearches,type:"RECENT_SEARCHES_SET"});}},[dispatch,index,recentSearchesStore]);return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{...rest,children:/* @__PURE__ */jsxRuntime.jsx(RecentSearchItemButton,{mode:"bleed",onClick:handleClick,paddingLeft:3,paddingRight:1,paddingY:1,tabIndex:-1,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"stretch",children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{paddingY:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.ClockIcon,{})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:"\u200B"})]}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"stretch",flex:1,gap:2,justify:"flex-start",marginLeft:3,wrap:"wrap",children:[value.query&&/* @__PURE__ */jsxRuntime.jsx(SearchItemQueryFlex,{align:"center",paddingY:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",weight:"medium",children:value.query})}),value.types.length>0&&/* @__PURE__ */jsxRuntime.jsx(SearchItemPillsBox,{children:/* @__PURE__ */jsxRuntime.jsx(DocumentTypesPill,{availableCharacters,types:value.types})}),(_a2=value==null?void 0:value.filters)==null?void 0:_a2.map((filter,i)=>{return/* @__PURE__ */jsxRuntime.jsx(FilterPill,{filter},i);})]}),/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",children:/* @__PURE__ */jsxRuntime.jsx(CloseButtonDiv,{onClick:handleDelete,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{padding:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.CloseIcon,{})})})})})]})})});}var __freeze$I=Object.freeze;var __defProp$I=Object.defineProperty;var __template$I=(cooked,raw)=>__freeze$I(__defProp$I(cooked,"raw",{value:__freeze$I(raw||cooked.slice())}));var _a$I;const VIRTUAL_LIST_RECENT_SEARCH_ITEM_HEIGHT=36;const MAX_COMBINED_TYPE_COUNT_SMALL=20;const MAX_COMBINED_TYPE_COUNT_LARGE=40;const RecentSearchesBox=styled__default.default(ui.Card)(_a$I||(_a$I=__template$I(["\n  overflow-x: hidden;\n  overflow-y: auto;\n  position: relative;\n"])));function RecentSearches(_ref501){let{inputElement}=_ref501;const{dispatch,recentSearchesStore,state:{filtersVisible,fullscreen,recentSearches}}=useSearchState();const commandListRef=React.useRef(null);const{t}=useTranslation();const handleClearRecentSearchesClick=React.useCallback(()=>{var _a2;if(recentSearchesStore){const updatedRecentSearches=recentSearchesStore.removeSearch();dispatch({recentSearches:updatedRecentSearches,type:"RECENT_SEARCHES_SET"});}(_a2=commandListRef==null?void 0:commandListRef.current)==null?void 0:_a2.focusInputElement();},[dispatch,recentSearchesStore]);const mediaIndex=ui.useMediaIndex();const maxVisibleTypePillChars=React.useMemo(()=>{return mediaIndex<2?MAX_COMBINED_TYPE_COUNT_SMALL:MAX_COMBINED_TYPE_COUNT_LARGE;},[mediaIndex]);const renderItem=React.useCallback((item,_ref502)=>{let{virtualIndex}=_ref502;return/* @__PURE__ */jsxRuntime.jsx(RecentSearchItem,{index:virtualIndex,maxVisibleTypePillChars,paddingBottom:1,value:item});},[maxVisibleTypePillChars]);const hasRecentSearches=!!recentSearches.length;return/* @__PURE__ */jsxRuntime.jsx(RecentSearchesBox,{borderTop:hasRecentSearches||!hasRecentSearches&&!filtersVisible&&fullscreen,flex:1,children:recentSearches.length>0?/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingBottom:2,paddingTop:4,paddingX:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,weight:"medium",children:t("search.recent-searches-label")})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(CommandList,{activeItemDataAttr:"data-hovered",ariaLabel:t("search.recent-searches-aria-label"),inputElement,initialIndex:0,itemHeight:VIRTUAL_LIST_RECENT_SEARCH_ITEM_HEIGHT,items:recentSearches,paddingX:2,paddingY:1,renderItem})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingBottom:2,paddingTop:1,paddingX:2,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"bleed",onClick:handleClearRecentSearchesClick,tone:"default",text:t("search.action.clear-recent-searches"),muted:true})})]}):!filtersVisible&&fullscreen&&/* @__PURE__ */jsxRuntime.jsx(Instructions,{})});}var __freeze$H=Object.freeze;var __defProp$H=Object.defineProperty;var __template$H=(cooked,raw)=>__freeze$H(__defProp$H(cooked,"raw",{value:__freeze$H(raw||cooked.slice())}));var _a$H,_b$n,_c$c;const rotate=styled.keyframes(_a$H||(_a$H=__template$H(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"])));const AnimatedSpinnerIcon=styled__default.default(icons.SpinnerIcon)(_b$n||(_b$n=__template$H(["\n  animation: "," 500ms linear infinite;\n"])),rotate);const FilterDiv=styled__default.default.div(_c$c||(_c$c=__template$H(["\n  line-height: 0;\n  position: relative;\n"])));const SearchHeader=React.forwardRef(function SearchHeader2(_ref503,ref){let{ariaInputLabel,onClose}=_ref503;const isMountedRef=React.useRef(false);const{dispatch,state:{filters,filtersVisible,fullscreen,result:{loading},terms:{types,query}}}=useSearchState();const{t}=useTranslation();const handleFiltersToggle=React.useCallback(()=>dispatch({type:"FILTERS_VISIBLE_SET",visible:!filtersVisible}),[dispatch,filtersVisible]);const handleQueryChange=React.useCallback(e=>dispatch({type:"TERMS_QUERY_SET",query:e.currentTarget.value}),[dispatch]);const handleQueryClear=React.useCallback(()=>{dispatch({type:"TERMS_QUERY_SET",query:""});},[dispatch]);React.useEffect(()=>{if(!fullscreen){dispatch({type:"FILTERS_VISIBLE_SET",visible:true});}},[dispatch,fullscreen]);React.useEffect(()=>{isMountedRef.current=true;},[]);const notificationBadgeVisible=filters.length>0||types.length>0;return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{flex:"none",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",flex:1,gap:fullscreen?2:1,padding:fullscreen?2:1,children:[fullscreen&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("search.action.close-search-aria-label"),icon:icons.ArrowLeftIcon,mode:"bleed",onClick:onClose,size:"large",tooltipProps:{content:t("search.action.close-search-aria-label")}}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(CustomTextInput,{__unstable_disableFocusRing:true,$background:fullscreen,$smallClearButton:fullscreen,"aria-label":ariaInputLabel,autoComplete:"off",border:false,clearButton:!!query,fontSize:[2,2,1],icon:loading?AnimatedSpinnerIcon:icons.SearchIcon,onChange:handleQueryChange,onClear:handleQueryClear,placeholder:t("search.placeholder"),radius:2,ref,spellCheck:false,value:query})}),fullscreen&&/* @__PURE__ */jsxRuntime.jsx(FilterDiv,{children:/* @__PURE__ */jsxRuntime.jsx(StatusButton,{"aria-expanded":filtersVisible,"aria-label":t("search.action.toggle-filters-aria-label",{context:filtersVisible?"hide":"show"}),icon:icons.ControlsIcon,mode:"bleed",onClick:handleFiltersToggle,selected:filtersVisible,size:"large",tone:notificationBadgeVisible?"primary":void 0,tooltipProps:{content:t("search.action.toggle-filters-label",{context:filtersVisible?"hide":"show"})}})})]})});});function NoResults(){const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ui.Container,{width:0,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{"aria-live":"assertive",space:4,paddingX:4,paddingY:5,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",muted:true,size:1,weight:"medium",children:t("search.no-results-title")}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",muted:true,size:1,children:t("search.no-results-help-description")})]})});}var __freeze$G=Object.freeze;var __defProp$G=Object.defineProperty;var __template$G=(cooked,raw)=>__freeze$G(__defProp$G(cooked,"raw",{value:__freeze$G(raw||cooked.slice())}));var _a$G;const TextWithToneStyle=styled__default.default(ui.Text)(_a$G||(_a$G=__template$G(["\n  &:not([data-muted]) {\n    &[data-tone='default'] {\n      --card-fg-color: var(--card-badge-default-fg-color);\n    }\n    &[data-tone='primary'] {\n      --card-fg-color: var(--card-badge-primary-fg-color);\n    }\n    &[data-tone='positive'] {\n      --card-fg-color: var(--card-badge-positive-fg-color);\n    }\n    &[data-tone='caution'] {\n      --card-fg-color: var(--card-badge-caution-fg-color);\n    }\n    &[data-tone='critical'] {\n      --card-fg-color: var(--card-badge-critical-fg-color);\n    }\n  }\n\n  &[data-dimmed] {\n    opacity: 0.3;\n  }\n"])));const TextWithTone=React.forwardRef(function TextWithTone2(props,ref){const{tone,dimmed,muted,...rest}=props;return/* @__PURE__ */jsxRuntime.jsx(TextWithToneStyle,{"data-ui":"TextWithTone","data-dimmed":dimmed?"":void 0,"data-muted":muted?"":void 0,"data-tone":tone,muted,ref,...rest});});function SearchError(){const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center","aria-live":"assertive",direction:"column",flex:1,gap:3,marginY:2,padding:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginBottom:1,children:/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{tone:"critical",children:/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})})}),/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{size:2,tone:"critical",weight:"medium",children:t("search.error.unspecified-error-title")}),/* @__PURE__ */jsxRuntime.jsx(TextWithTone,{size:1,tone:"critical",children:t("search.error.unspecified-error-help-description")})]});}const ORDERINGS={createdAsc:{ignoreScore:true,sort:{direction:"asc",field:"_createdAt"},titleKey:"search.ordering.created-ascending-label"},createdDesc:{ignoreScore:true,sort:{direction:"desc",field:"_createdAt"},titleKey:"search.ordering.created-descending-label"},relevance:{customMeasurementLabel:"relevance",sort:{direction:"desc",field:"_updatedAt"},titleKey:"search.ordering.best-match-label"},updatedAsc:{ignoreScore:true,sort:{direction:"asc",field:"_updatedAt"},titleKey:"search.ordering.updated-ascending-label"},updatedDesc:{ignoreScore:true,sort:{direction:"desc",field:"_updatedAt"},titleKey:"search.ordering.updated-descending-label"}};var __freeze$F=Object.freeze;var __defProp$F=Object.defineProperty;var __template$F=(cooked,raw)=>__freeze$F(__defProp$F(cooked,"raw",{value:__freeze$F(raw||cooked.slice())}));var _a$F;const MENU_ORDERINGS=[ORDERINGS.relevance,{type:"divider"},ORDERINGS.createdAsc,ORDERINGS.createdDesc,{type:"divider"},ORDERINGS.updatedAsc,ORDERINGS.updatedDesc];const SortMenuContentFlex=styled__default.default(ui.Flex)(_a$F||(_a$F=__template$F(["\n  box-sizing: border-box;\n"])));function isSearchDivider(item){return item.type==="divider";}function CustomMenuItem(_ref504){let{ordering}=_ref504;const{t}=useTranslation();const{dispatch,state:{ordering:currentOrdering}}=useSearchState();const handleClick=React.useCallback(()=>{dispatch({ordering,type:"ORDERING_SET"});},[dispatch,ordering]);const isSelected=React.useMemo(()=>isEqual__default$1.default(currentOrdering,ordering),[currentOrdering,ordering]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{onClick:handleClick,pressed:isSelected,tone:"default",text:t(ordering.titleKey)});}function SortMenu(){const{t}=useTranslation();const{state:{ordering}}=useSearchState();const menuButtonId=React.useId();const currentMenuItem=MENU_ORDERINGS.find(item=>isEqual__default$1.default(ordering,item)&&!isSearchDivider(item));if(!currentMenuItem){return null;}return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderBottom:true,children:/* @__PURE__ */jsxRuntime.jsx(SortMenuContentFlex,{align:"center",flex:1,padding:2,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"bleed",icon:icons.SortIcon,text:t(currentMenuItem.titleKey)}),id:menuButtonId||"",menu:/* @__PURE__ */jsxRuntime.jsx(ui.Menu,{children:MENU_ORDERINGS.map((item,index)=>{if(isSearchDivider(item)){return/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{},index);}return/* @__PURE__ */jsxRuntime.jsx(CustomMenuItem,{ordering:item},index);})}),placement:"bottom-start",popover:{portal:true,radius:2}})})});}var __freeze$E=Object.freeze;var __defProp$E=Object.defineProperty;var __template$E=(cooked,raw)=>__freeze$E(__defProp$E(cooked,"raw",{value:__freeze$E(raw||cooked.slice())}));var _a$E;const DebugScoreCard=styled__default.default(ui.Card)(_a$E||(_a$E=__template$E(["\n  cursor: help;\n  left: 0;\n  position: absolute;\n  top: 0;\n"])));function DebugOverlay(_ref505){let{data}=_ref505;const{score}=data;let tone="default";if(score<=0.1){tone="critical";}else if(score>=0.5){tone="primary";}const matchingStories=data.stories.filter(story=>story.score>0);return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:2,children:matchingStories.length?/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:matchingStories.map(story=>/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Code,{size:0,weight:"medium",children:story.path}),/* @__PURE__ */jsxRuntime.jsx(ui.Code,{size:0,children:story.why})]},story.path))}):/* @__PURE__ */jsxRuntime.jsx(ui.Code,{size:0,children:"No matches"})}),placement:"bottom-start",portal:true,children:/* @__PURE__ */jsxRuntime.jsx(DebugScoreCard,{padding:1,shadow:1,tone,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Code,{size:0,children:["score: ",score]})})})});}var __freeze$D=Object.freeze;var __defProp$D=Object.defineProperty;var __template$D=(cooked,raw)=>__freeze$D(__defProp$D(cooked,"raw",{value:__freeze$D(raw||cooked.slice())}));var _a$D;const VIRTUAL_LIST_SEARCH_RESULT_ITEM_HEIGHT=57;const VIRTUAL_LIST_OVERSCAN=4;const SearchResultsInnerFlex=styled__default.default(ui.Flex)(_a$D||(_a$D=__template$D(["\n  opacity: ",";\n  overflow-x: hidden;\n  overflow-y: auto;\n  position: relative;\n  transition: 300ms opacity;\n  width: 100%;\n"])),_ref506=>{let{$loading}=_ref506;return $loading?0.5:1;});function SearchResults(_ref507){let{inputElement}=_ref507;const{dispatch,onClose,recentSearchesStore,setSearchCommandList,state:{debug,filters,fullscreen,lastActiveIndex,result,terms}}=useSearchState();const{t}=useTranslation();const hasSearchResults=!!result.hits.length;const hasNoSearchResults=!result.hits.length&&result.loaded;const hasError=result.error;const handleSearchResultClick=React.useCallback(()=>{if(recentSearchesStore){const updatedRecentSearches=recentSearchesStore.addSearch(terms,filters);dispatch({recentSearches:updatedRecentSearches,type:"RECENT_SEARCHES_SET"});}onClose==null?void 0:onClose();},[dispatch,filters,onClose,recentSearchesStore,terms]);const renderItem=React.useCallback(item=>{return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(SearchResultItem,{documentId:getPublishedId(item.hit._id)||"",documentType:item.hit._type,onClick:handleSearchResultClick,paddingY:1}),debug&&/* @__PURE__ */jsxRuntime.jsx(DebugOverlay,{data:item})]});},[debug,handleSearchResultClick]);return/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderTop:fullscreen||!!(hasError||hasSearchResults||hasNoSearchResults),flex:1,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{direction:"column",height:"fill",children:[hasSearchResults&&/* @__PURE__ */jsxRuntime.jsx(SortMenu,{}),/* @__PURE__ */jsxRuntime.jsx(SearchResultsInnerFlex,{$loading:result.loading,"aria-busy":result.loading,flex:1,children:hasError?/* @__PURE__ */jsxRuntime.jsx(SearchError,{}):/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[hasSearchResults&&/* @__PURE__ */jsxRuntime.jsx(CommandList,{activeItemDataAttr:"data-hovered",ariaLabel:t("search.search-results-label"),"data-testid":"search-results",fixedHeight:true,initialIndex:lastActiveIndex,inputElement,itemHeight:VIRTUAL_LIST_SEARCH_RESULT_ITEM_HEIGHT,items:result.hits,overscan:VIRTUAL_LIST_OVERSCAN,paddingX:2,paddingY:1,ref:setSearchCommandList,renderItem}),hasNoSearchResults&&/* @__PURE__ */jsxRuntime.jsx(NoResults,{})]})})]})})});}var __freeze$C=Object.freeze;var __defProp$C=Object.defineProperty;var __template$C=(cooked,raw)=>__freeze$C(__defProp$C(cooked,"raw",{value:__freeze$C(raw||cooked.slice())}));var _a$C,_b$m;const InnerCard=styled__default.default(ui.Card)(_a$C||(_a$C=__template$C(["\n  flex-direction: column;\n  overflow: hidden;\n  overflow: clip;\n  pointer-events: all;\n  position: relative;\n"])));const SearchDialogBox=styled__default.default(ui.Box)(_b$m||(_b$m=__template$C(["\n  height: 100%;\n  left: 0;\n  overflow: hidden;\n  overflow: clip;\n  pointer-events: none;\n  position: fixed;\n  top: 0;\n  width: 100%;\n  z-index: 1;\n"])));function SearchDialog(_ref508){let{onClose,onOpen,open}=_ref508;const[inputElement,setInputElement]=React.useState(null);const{scheme}=useColorScheme();const{t}=useTranslation();const{state:{filtersVisible,terms}}=useSearchState();const hasValidTerms=hasSearchableTerms({terms});return/* @__PURE__ */jsxRuntime.jsx(SearchWrapper,{hasValidTerms,onClose,onOpen,open,children:open&&/* @__PURE__ */jsxRuntime.jsx(ui.Portal,{children:/* @__PURE__ */jsxRuntime.jsx(FocusLock__default.default,{autoFocus:!supportsTouch,returnFocus:true,children:/* @__PURE__ */jsxRuntime.jsx(SearchDialogBox,{children:/* @__PURE__ */jsxRuntime.jsxs(InnerCard,{display:"flex",height:"fill",scheme,tone:"default",children:[/* @__PURE__ */jsxRuntime.jsx(SearchHeader,{ariaInputLabel:hasValidTerms?t("search.search-results-aria-label"):t("search.recent-searches-aria-label"),onClose,ref:setInputElement}),filtersVisible&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderTop:true,flex:"none",children:/* @__PURE__ */jsxRuntime.jsx(Filters,{})}),hasValidTerms?/* @__PURE__ */jsxRuntime.jsx(SearchResults,{inputElement}):/* @__PURE__ */jsxRuntime.jsx(RecentSearches,{inputElement})]})})})})});}function StudioActiveToolLayout(props){const{activeTool}=props;return React.createElement(activeTool.component,{tool:activeTool});}function NoToolsScreen(){return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{height:"fill",children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",height:"fill",justify:"center",padding:4,sizing:"border",children:/* @__PURE__ */jsxRuntime.jsx(ui.Container,{width:0,children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:4,radius:2,shadow:1,tone:"caution",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{flex:1,marginLeft:3,space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"h1",size:1,weight:"medium",children:"No configured tools"}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:"Please configure a tool in your Studio configuration."}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"p",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx("a",{href:"https://www.sanity.io/docs/studio-tools",rel:"noreferrer",target:"_blank",children:"Learn how to add a tool \u2192"})})]})]})})})})});}function RedirectingScreen(props){const{reason="Redirecting\u2026"}=props;return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{height:"fill",children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",height:"fill",justify:"center",padding:4,sizing:"border",children:/* @__PURE__ */jsxRuntime.jsx(ui.Container,{width:0,children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:4,radius:2,shadow:1,tone:"primary",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.DoubleChevronRightIcon,{})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{flex:1,marginLeft:3,space:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"h1",size:1,weight:"bold",children:reason})})]})})})})});}function ToolNotFoundScreen(props){const{toolName}=props;return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{height:"fill",children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",height:"fill",justify:"center",padding:4,sizing:"border",children:/* @__PURE__ */jsxRuntime.jsx(ui.Container,{width:0,children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:4,radius:2,shadow:1,tone:"caution",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{flex:1,marginLeft:3,space:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{as:"h1",size:1,weight:"medium",children:["Tool not found: ",/* @__PURE__ */jsxRuntime.jsx("code",{children:toolName})]})})]})})})})});}const WORKSPACES_DOCS_URL="https://www.sanity.io/docs/workspaces";const useWorkspaceAuthStates=createHookFromObservableFactory(workspaces=>rxjs.combineLatest(workspaces.map(workspace=>// eslint-disable-next-line max-nested-callbacks
workspace.auth.state.pipe(operators.map(state=>[workspace.name,state])))).pipe(operators.map(entries=>Object.fromEntries(entries))));var __freeze$B=Object.freeze;var __defProp$B=Object.defineProperty;var __template$B=(cooked,raw)=>__freeze$B(__defProp$B(cooked,"raw",{value:__freeze$B(raw||cooked.slice())}));var _a$B;const STATE_TITLES={"logged-in":"","logged-out":"Signed out","no-access":""};const Media$1=styled__default.default.div(_a$B||(_a$B=__template$B(["\n  width: ",";\n  height: ",";\n\n  svg {\n    width: 100%;\n    height: 100%;\n  }\n"])),props=>props.$size==="small"?"25px":"41px",props=>props.$size==="small"?"25px":"41px");const WorkspacePreviewIcon=_ref509=>{let{icon,size="small"}=_ref509;const iconComponent=React.useMemo(()=>createIcon(icon),[icon]);return/* @__PURE__ */jsxRuntime.jsx(Media$1,{$size:size,children:iconComponent});};const createIcon=icon=>{if(reactIs.isValidElementType(icon))return React.createElement(icon);if(React.isValidElement(icon))return icon;return void 0;};function WorkspacePreview(props){const{state,subtitle,selected,title,icon,iconRight}=props;const iconRightComponent=React.useMemo(()=>createIcon(iconRight),[iconRight]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",flex:"none",gap:3,children:[/* @__PURE__ */jsxRuntime.jsx(WorkspacePreviewIcon,{icon,size:"small"}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{flex:1,space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,textOverflow:"ellipsis",weight:"medium",children:title}),subtitle&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",children:subtitle})]}),state&&STATE_TITLES[state]&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingLeft:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,textOverflow:"ellipsis",children:STATE_TITLES[state]})}),(selected||iconRightComponent)&&/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:4,paddingLeft:3,paddingRight:2,children:[selected&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:/* @__PURE__ */jsxRuntime.jsx(icons.CheckmarkIcon,{})}),iconRightComponent&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,children:iconRightComponent})]})]});}var __freeze$A=Object.freeze;var __defProp$A=Object.defineProperty;var __template$A=(cooked,raw)=>__freeze$A(__defProp$A(cooked,"raw",{value:__freeze$A(raw||cooked.slice())}));var _a$A;const LINKS=[{url:"https://slack.sanity.io/",i18nKey:"workspaces.community-title",title:"Community"},{url:"https://www.sanity.io/docs",i18nKey:"workspaces.docs-title",title:"Docs"},{url:"https://www.sanity.io/legal/privacy",i18nKey:"workspaces.privacy-title",title:"Privacy"},{url:"https://www.sanity.io",i18nKey:"workspaces.sanity-io-title",title:"sanity.io"}];const StyledText$1=styled__default.default(ui.Text)(_a$A||(_a$A=__template$A(["\n  a {\n    color: inherit;\n  }\n"])));function Layout(props){const{children,footer,header}=props;useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:6,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,radius:3,overflow:"auto",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{children:[typeof header==="object"&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:header}),typeof header==="string"&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingY:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{align:"center",size:1,children:header})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderTop:Boolean(header),borderBottom:Boolean(footer),children})}),footer&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:footer})]})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{direction:"column",gap:4,justify:"center",align:"center",paddingBottom:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:3,children:/* @__PURE__ */jsxRuntime.jsx(logos.SanityLogo,{})}),/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",gap:2,children:LINKS.map((link,index)=>/* @__PURE__ */jsxRuntime.jsxs(React.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(StyledText$1,{muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx("a",{href:link.url,target:"_blank",rel:"noopener noreferrer",children:link.title})}),index<LINKS.length-1&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,children:"\u2022"})]},link.title))})]})]});}function WorkspaceAuth(){var _a;const workspaces=useWorkspaces();const{activeWorkspace,setActiveWorkspace}=useActiveWorkspace();const[authStates]=useWorkspaceAuthStates(workspaces);const[selectedWorkspaceName,setSelectedWorkspaceName]=React.useState((activeWorkspace==null?void 0:activeWorkspace.name)||null);const selectedWorkspace=workspaces.length===1?workspaces[0]:workspaces.find(workspace=>workspace.name===selectedWorkspaceName);const LoginComponent=(_a=selectedWorkspace==null?void 0:selectedWorkspace.auth)==null?void 0:_a.LoginComponent;const handleBack=React.useCallback(()=>setSelectedWorkspaceName(null),[]);const{t}=useTranslation();if(!authStates)return/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{showText:true});if(LoginComponent&&selectedWorkspace){return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,children:[workspaces.length>1&&/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.ArrowLeftIcon,mode:"bleed",onClick:handleBack,text:t("workspaces.action.choose-another-workspace")})}),/* @__PURE__ */jsxRuntime.jsx(Layout,{header:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:3,children:/* @__PURE__ */jsxRuntime.jsx(WorkspacePreview,{icon:selectedWorkspace.icon,title:selectedWorkspace.title,subtitle:selectedWorkspace==null?void 0:selectedWorkspace.subtitle})}),children:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{padding:2,paddingBottom:3,paddingTop:4,children:/* @__PURE__ */React.createElement(LoginComponent,{...omit__default.default(selectedWorkspace,["type","__internal"]),key:selectedWorkspaceName})})})]});}return/* @__PURE__ */jsxRuntime.jsx(Layout,{header:t("workspaces.choose-your-workspace-label"),footer:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{padding:1,children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{as:"a",href:WORKSPACES_DOCS_URL,icon:icons.AddIcon,mode:"bleed",rel:"noopener noreferrer",size:"large",target:"__blank",text:t("workspaces.action.add-workspace")})}),children:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{space:1,paddingX:1,paddingY:2,children:workspaces.map(workspace=>{const authState=authStates[workspace.name];const state=authState.authenticated?"logged-in":workspace.auth.LoginComponent?"logged-out":"no-access";const handleSelectWorkspace=()=>{if(state==="logged-in"&&workspace.name!==activeWorkspace.name){setActiveWorkspace(workspace.name);}if(state==="logged-out"){setSelectedWorkspaceName(workspace.name);}};return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{as:"button",radius:2,padding:2,onClick:handleSelectWorkspace,children:/* @__PURE__ */jsxRuntime.jsx(WorkspacePreview,{icon:workspace==null?void 0:workspace.icon,iconRight:icons.ChevronRightIcon,state,subtitle:workspace==null?void 0:workspace.subtitle,title:(workspace==null?void 0:workspace.title)||workspace.name})},workspace.name);})})});}var __freeze$z=Object.freeze;var __defProp$z=Object.defineProperty;var __template$z=(cooked,raw)=>__freeze$z(__defProp$z(cooked,"raw",{value:__freeze$z(raw||cooked.slice())}));var _a$z;const StyledMenu$3=styled__default.default(ui.Menu)(_a$z||(_a$z=__template$z(["\n  max-width: 350px;\n  min-width: 250px;\n"])));const POPOVER_PROPS={constrainSize:true,fallbackPlacements:["bottom-end","bottom"],placement:"bottom-end"};function WorkspaceMenuButton(){const workspaces=useWorkspaces();const{activeWorkspace,setActiveWorkspace}=useActiveWorkspace();const[authStates]=useWorkspaceAuthStates(workspaces);const{navigateUrl}=router.useRouter();const{t}=useTranslation();const multipleWorkspaces=workspaces.length>1;if(!multipleWorkspaces){return null;}const disabled=!authStates;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:t("workspaces.select-workspace-tooltip"),disabled,portal:true,children:/* @__PURE__ */jsxRuntime.jsx(ui.Button,{disabled,mode:"bleed",padding:2,width:"fill",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,textOverflow:"ellipsis",weight:"medium",children:activeWorkspace.title})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(icons.ChevronDownIcon,{})})]})})})}),id:"workspace-menu",menu:!disabled&&authStates?/* @__PURE__ */jsxRuntime.jsx(StyledMenu$3,{children:workspaces.map(workspace=>{const authState=authStates[workspace.name];const state=authState.authenticated?"logged-in":workspace.auth.LoginComponent?"logged-out":"no-access";const handleSelectWorkspace=()=>{if(state==="logged-in"&&workspace.name!==activeWorkspace.name){setActiveWorkspace(workspace.name);}if(state==="logged-out"){navigateUrl({path:workspace.basePath});}};const isSelected=workspace.name===activeWorkspace.name;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{badgeText:STATE_TITLES[state],iconRight:isSelected?icons.CheckmarkIcon:void 0,onClick:handleSelectWorkspace,pressed:isSelected,preview:/* @__PURE__ */jsxRuntime.jsx(WorkspacePreviewIcon,{icon:workspace.icon,size:"small"}),selected:isSelected,__unstable_subtitle:workspace.subtitle,__unstable_space:1,text:(workspace==null?void 0:workspace.title)||workspace.name},workspace.name);})}):void 0,popover:POPOVER_PROPS});}function AuthenticateScreen(){return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{height:"fill",overflow:"auto",paddingX:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{height:"fill",direction:"column",align:"center",justify:"center",paddingTop:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Container,{width:0,children:/* @__PURE__ */jsxRuntime.jsx(WorkspaceAuth,{})})})});}function ConfigErrorsScreen(){return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:"TODO: implement config errors screen"});}var __freeze$y=Object.freeze;var __defProp$y=Object.defineProperty;var __template$y=(cooked,raw)=>__freeze$y(__defProp$y(cooked,"raw",{value:__freeze$y(raw||cooked.slice())}));var _a$y;const ScreenReaderLabel=styled__default.default.label(_a$y||(_a$y=__template$y(["\n  clip: rect(0 0 0 0);\n  clip-path: inset(50%);\n  height: 1px;\n  overflow: hidden;\n  overflow: clip;\n  position: absolute;\n  white-space: nowrap;\n  width: 1px;\n"])));function CorsOriginErrorScreen(props){const{projectId}=props;const origin=window.location.origin;const corsUrl=React.useMemo(()=>{const url=new URL("https://sanity.io/manage/project/".concat(projectId,"/api"));url.searchParams.set("cors","add");url.searchParams.set("origin",origin);url.searchParams.set("credentials","");return url.toString();},[origin,projectId]);React.useEffect(()=>{const handleFocus=()=>{window.location.reload();};window.addEventListener("focus",handleFocus);return()=>{window.removeEventListener("focus",handleFocus);};},[]);return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{height:"fill",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Dialog,{id:"cors-error-dialog",header:"Before you continue...",width:1,footer:{confirmButton:{text:"Continue",iconRight:icons.LaunchIcon,as:"a",href:corsUrl,target:"_blank",rel:"noopener noreferrer",tone:"primary"}},children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{children:["To access your content, you need to ",/* @__PURE__ */jsxRuntime.jsx("b",{children:"add the following URL as a CORS origin"})," to your Sanity project."]}),/* @__PURE__ */jsxRuntime.jsx(ScreenReaderLabel,{"aria-hidden":"true",children:"CORS URL to be added"}),/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{value:origin,readOnly:true})]})})});}function NotAuthenticatedScreen(){const[currentUser,setCurrentUser]=React.useState(null);const[error,handleError]=React.useState(null);if(error)throw error;const{activeWorkspace}=useActiveWorkspace();const handleLogout=React.useCallback(()=>{var _a,_b;(_b=(_a=activeWorkspace.auth).logout)==null?void 0:_b.call(_a);},[activeWorkspace]);React.useEffect(()=>{const subscription=activeWorkspace.auth.state.subscribe({next:_ref510=>{let{currentUser:user}=_ref510;setCurrentUser(user);},error:handleError});return()=>{subscription.unsubscribe();};},[activeWorkspace]);const providerTitle=getProviderTitle(currentUser==null?void 0:currentUser.provider);const providerHelp=providerTitle?" through ".concat(providerTitle):"";return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{height:"fill",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Dialog,{id:"not-authorized-dialog",header:"Not authorized",width:1,footer:{confirmButton:{text:"Sign out",onClick:handleLogout,tone:"default"}},children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{children:"You are not authorized to access this studio. Maybe you could ask someone to invite you to collaborate on this project?"}),/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{children:["If you think this is an error, verify that you are signed in with the correct account. You are currently signed in as"," ",/* @__PURE__ */jsxRuntime.jsxs("strong",{children:[currentUser==null?void 0:currentUser.name," (",currentUser==null?void 0:currentUser.email,")"]}),providerHelp,"."]})]})})});}function NotFoundScreen(props){return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{height:"fill",sizing:"border",tone:"caution",display:"flex",children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{direction:"row",justify:"center",flex:1,align:"center",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{as:"h1",children:"Workspace not found"}),/* @__PURE__ */jsxRuntime.jsx(ui.Inline,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{text:"Go to default workspace",onClick:props.onNavigateToDefaultWorkspace,mode:"ghost"})})]})})});}function renderPath(path){return path.map(segment=>{if(segment.kind==="type"){return"".concat(segment.name||"<unnamed>","(").concat(segment.type,")");}if(segment.kind==="property"){return segment.name;}return null;}).filter(Boolean).join(" > ");}function reportWarnings(schema){const problemGroups=schema._validation;const groupsWithWarnings=problemGroups==null?void 0:problemGroups.filter(group=>group.problems.some(problem=>problem.severity==="warning"));if((groupsWithWarnings==null?void 0:groupsWithWarnings.length)===0){return;}console.groupCollapsed("\u26A0\uFE0F Schema has ".concat(groupsWithWarnings==null?void 0:groupsWithWarnings.length," warnings"));groupsWithWarnings==null?void 0:groupsWithWarnings.forEach(group=>{const path=renderPath(group.path);console.group("%cAt ".concat(path),"color: #FF7636");group.problems.forEach(problem=>{console.log(problem.message);});console.groupEnd();});console.groupEnd();}var __freeze$x=Object.freeze;var __defProp$x=Object.defineProperty;var __template$x=(cooked,raw)=>__freeze$x(__defProp$x(cooked,"raw",{value:__freeze$x(raw||cooked.slice())}));var _a$x,_b$l;const TONES={error:"critical",warning:"caution"};const SegmentSpan=styled__default.default.code(_a$x||(_a$x=__template$x(["\n  && {\n    background: none;\n    color: inherit;\n  }\n"])));const ErrorMessageText=styled__default.default(ui.Text)(_b$l||(_b$l=__template$x(["\n  white-space: pre-line;\n"])));function SchemaProblemGroups(props){const{problemGroups}=props;useTranslation();const items=React.useMemo(()=>{const ret=[];for(const problemGroup of problemGroups){for(const problem of problemGroup.problems){ret.push({group:problemGroup,problem});}}return ret;},[problemGroups]);return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"ul",space:4,children:items.map((_ref511,i)=>{let{group,problem}=_ref511;const isError=problem.severity==="error";const isWarning=problem.severity==="warning";const schemaType=getTypeInfo(group);return/* @__PURE__ */jsxRuntime.jsxs(ui.Card,{border:true,padding:4,radius:2,tone:TONES[problem.severity],children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginRight:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{muted:true,size:1,children:[isError&&/* @__PURE__ */jsxRuntime.jsx(icons.ErrorOutlineIcon,{}),isWarning&&/* @__PURE__ */jsxRuntime.jsx(icons.WarningOutlineIcon,{})]})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:schemaType?/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[capitalize__default.default(schemaType.type),' type "',schemaType.name,'"']}):null})})]}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,overflow:"auto",padding:2,tone:"inherit",children:/* @__PURE__ */jsxRuntime.jsx(ui.Breadcrumbs,{separator:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:"\u2192"}),children:group.path.map((segment,j)=>{if(segment.kind==="type"){const text="".concat(_renderSegmentName(segment.name||"<anonymous ".concat(segment.type,">")),":").concat(segment.type);return/* @__PURE__ */jsxRuntime.jsx(ui.Text,{title:text,size:1,textOverflow:"ellipsis",children:/* @__PURE__ */jsxRuntime.jsx(SegmentSpan,{children:text})},j);}if(segment.kind==="property"){return/* @__PURE__ */jsxRuntime.jsx(ui.Text,{title:segment.name,size:1,textOverflow:"ellipsis",children:/* @__PURE__ */jsxRuntime.jsx(SegmentSpan,{children:segment.name})},j);}return null;})})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{as:"ul",marginTop:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{as:"li",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ErrorMessageText,{muted:true,size:1,children:problem.message}),problem.helpId&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx("a",{href:generateHelpUrl.generateHelpUrl(problem.helpId),target:"_blank",rel:"noopener noreferrer",children:"View documentation \u2192"})})]})})})]},i);})});}function getTypeInfo(problem){const first=problem.path[0];if(first.kind==="type"){return{name:first.name||"<anonymous ".concat(first.type,">"),type:first.type};}return null;}function _renderSegmentName(str){if(str==null?void 0:str.startsWith("<unnamed_type_@_index")){const parts=str.slice(1,-1).split("_");return"[".concat(parts[4],"]");}return str;}function SchemaErrorsScreen(_ref512){let{schema}=_ref512;var _a;const groupsWithErrors=((_a=schema._validation)==null?void 0:_a.filter(group=>group.problems.some(problem=>problem.severity==="error")))||[];React.useEffect(()=>reportWarnings(schema),[schema]);return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{height:"fill",overflow:"auto",paddingY:[4,5,6,7],paddingX:4,sizing:"border",children:/* @__PURE__ */jsxRuntime.jsx(ui.Container,{width:1,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:5,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{as:"h1",children:"Schema errors"}),/* @__PURE__ */jsxRuntime.jsx(SchemaProblemGroups,{problemGroups:groupsWithErrors})]})})});}function StudioErrorBoundary(_ref513){let{children,heading="An error occured"}=_ref513;const[{error},setError]=React.useState({error:null});const message=isRecord$4(error)&&typeof error.message==="string"&&error.message;const stack=isRecord$4(error)&&typeof error.stack==="string"&&error.stack;const handleResetError=React.useCallback(()=>setError({error:null}),[setError]);useHotModuleReload.useHotModuleReload(handleResetError);if(error instanceof CorsOriginError){return/* @__PURE__ */jsxRuntime.jsx(CorsOriginErrorScreen,{projectId:error==null?void 0:error.projectId});}if(error instanceof SchemaError){return/* @__PURE__ */jsxRuntime.jsx(SchemaErrorsScreen,{schema:error.schema});}if(!error){return/* @__PURE__ */jsxRuntime.jsx(ui.ErrorBoundary,{onCatch:setError,children});}return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{height:"fill",overflow:"auto",paddingY:[4,5,6,7],paddingX:4,sizing:"border",tone:"critical",children:/* @__PURE__ */jsxRuntime.jsx(ui.Container,{width:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{children:heading}),/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{onClick:handleResetError,text:"Retry",tone:"default"})}),/* @__PURE__ */jsxRuntime.jsx(ui.Card,{border:true,radius:2,overflow:"auto",padding:4,tone:"inherit",children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[message&&/* @__PURE__ */jsxRuntime.jsx(ui.Code,{size:1,children:/* @__PURE__ */jsxRuntime.jsxs("strong",{children:["Error: ",message]})}),stack&&/* @__PURE__ */jsxRuntime.jsx(ui.Code,{size:1,children:stack})]})})]})})});}var __freeze$w=Object.freeze;var __defProp$w=Object.defineProperty;var __template$w=(cooked,raw)=>__freeze$w(__defProp$w(cooked,"raw",{value:__freeze$w(raw||cooked.slice())}));var _a$w;const SearchFullscreenPortalCard=styled__default.default(ui.Card)(_a$w||(_a$w=__template$w(["\n  height: 100%;\n  left: 0;\n  overflow: hidden;\n  overflow: clip;\n  position: fixed;\n  top: 0;\n  width: 100%;\n  z-index: 200;\n"])));const NavbarContext=React.createContext({onSearchFullscreenOpenChange:()=>"",onSearchOpenChange:()=>"",searchFullscreenOpen:false,searchFullscreenPortalEl:null,searchOpen:false});function StudioLayout(){const Layout=useLayoutComponent();return/* @__PURE__ */jsxRuntime.jsx(Layout,{});}function StudioLayoutComponent(){var _a2;const{name,title,tools}=useWorkspace();const router$1=router.useRouter();const activeToolName=router.useRouterState(React.useCallback(routerState=>typeof routerState.tool==="string"?routerState.tool:void 0,[]));const activeTool=React.useMemo(()=>tools.find(tool=>tool.name===activeToolName),[activeToolName,tools]);const[searchFullscreenOpen,setSearchFullscreenOpen]=React.useState(false);const[searchFullscreenPortalEl,setSearchFullscreenPortalEl]=React.useState(null);const[searchOpen,setSearchOpen]=React.useState(false);const documentTitle=React.useMemo(()=>{const mainTitle=title||startCase__default.default(name);if(activeToolName){return"".concat(startCase__default.default(activeToolName)," | ").concat(mainTitle);}return mainTitle;},[activeToolName,name,title]);const toolControlsDocumentTitle=!!(activeTool==null?void 0:activeTool.controlsDocumentTitle);React.useEffect(()=>{if(toolControlsDocumentTitle){return;}document.title=documentTitle;},[documentTitle,toolControlsDocumentTitle]);const handleSearchFullscreenOpenChange=React.useCallback(open=>{setSearchFullscreenOpen(open);},[]);const handleSearchOpenChange=React.useCallback(open=>{setSearchOpen(open);},[]);const navbarContextValue=React.useMemo(()=>({searchFullscreenOpen,searchFullscreenPortalEl,searchOpen,onSearchFullscreenOpenChange:handleSearchFullscreenOpenChange,onSearchOpenChange:handleSearchOpenChange}),[searchFullscreenOpen,searchFullscreenPortalEl,searchOpen,handleSearchFullscreenOpenChange,handleSearchOpenChange]);const Navbar=useNavbarComponent();const ActiveToolLayout=useActiveToolLayoutComponent();const isLegacyDeskRedirect=!activeTool&&(activeToolName==="desk"||!activeToolName)&&typeof window!=="undefined"&&/\/desk(\/|$)/.test(window.location.pathname)&&tools.some(tool=>tool.name==="structure");React.useEffect(()=>{if(!isLegacyDeskRedirect){return;}router$1.navigateUrl({path:window.location.pathname.replace(/\/desk/,"/structure"),replace:true});},[isLegacyDeskRedirect,router$1]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{"data-ui":"ToolScreen",direction:"column",height:"fill","data-testid":"studio-layout",children:[/* @__PURE__ */jsxRuntime.jsx(NavbarContext.Provider,{value:navbarContextValue,children:/* @__PURE__ */jsxRuntime.jsx(Navbar,{})}),isLegacyDeskRedirect&&/* @__PURE__ */jsxRuntime.jsx(RedirectingScreen,{}),tools.length===0&&/* @__PURE__ */jsxRuntime.jsx(NoToolsScreen,{}),tools.length>0&&!activeTool&&activeToolName&&!isLegacyDeskRedirect&&/* @__PURE__ */jsxRuntime.jsx(ToolNotFoundScreen,{toolName:activeToolName}),searchFullscreenOpen&&/* @__PURE__ */jsxRuntime.jsx(SearchFullscreenPortalCard,{ref:setSearchFullscreenPortalEl,overflow:"auto"}),/* @__PURE__ */jsxRuntime.jsx(StudioErrorBoundary,{heading:"The ".concat(activeTool==null?void 0:activeTool.name," tool crashed"),children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{flex:1,hidden:searchFullscreenOpen,children:activeTool&&activeToolName&&/* @__PURE__ */jsxRuntime.jsx(router.RouteScope,{scope:activeToolName,__unsafe_disableScopedSearchParams:(_a2=activeTool.router)==null?void 0:_a2.__unsafe_disableScopedSearchParams,children:/* @__PURE__ */jsxRuntime.jsx(React.Suspense,{fallback:/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{showText:true}),children:/* @__PURE__ */jsxRuntime.jsx(ActiveToolLayout,{activeTool})})})})},activeTool==null?void 0:activeTool.name)]});}function pickToolMenuComponent(plugin){var _a,_b;return(_b=(_a=plugin.studio)==null?void 0:_a.components)==null?void 0:_b.toolMenu;}function pickNavbarComponent(plugin){var _a,_b;return(_b=(_a=plugin.studio)==null?void 0:_a.components)==null?void 0:_b.navbar;}function pickLayoutComponent(plugin){var _a,_b;return(_b=(_a=plugin.studio)==null?void 0:_a.components)==null?void 0:_b.layout;}function pickActiveToolLayoutComponent(plugin){var _a,_b;return(_b=(_a=plugin.studio)==null?void 0:_a.components)==null?void 0:_b.activeToolLayout;}function useToolMenuComponent(){return useMiddlewareComponents({defaultComponent:StudioToolMenu,pick:pickToolMenuComponent});}function useNavbarComponent(){return useMiddlewareComponents({defaultComponent:StudioNavbar,pick:pickNavbarComponent});}function useLayoutComponent(){return useMiddlewareComponents({defaultComponent:StudioLayoutComponent,pick:pickLayoutComponent});}function useActiveToolLayoutComponent(){return useMiddlewareComponents({defaultComponent:StudioActiveToolLayout,pick:pickActiveToolLayoutComponent});}function ConfigIssuesButton(){var _a;const schema=useSchema();const groupsWithWarnings=((_a=schema._validation)==null?void 0:_a.filter(group=>group.problems.some(problem=>problem.severity==="warning")))||[];const{scheme}=useColorScheme();const{t}=useTranslation();const dialogId=React.useId();const[isDialogOpen,setDialogOpen]=React.useState(false);const[buttonElement,setButtonElement]=React.useState(null);const handleOpen=React.useCallback(()=>setDialogOpen(true),[]);const handleClose=React.useCallback(()=>{setDialogOpen(false);if(buttonElement){buttonElement.focus();}},[buttonElement]);if(groupsWithWarnings.length===0){return null;}return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(StatusButton,{icon:icons.WarningOutlineIcon,mode:"bleed",onClick:handleOpen,ref:setButtonElement,selected:isDialogOpen,tone:"caution",tooltipProps:{scheme,content:t("configuration-issues.button.tooltip")}}),isDialogOpen&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Dialog,{header:"Configuration issues",width:2,onClickOutside:handleClose,onClose:handleClose,scheme,id:dialogId,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:4,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{as:"h2",size:1,weight:"medium",children:["Found ",groupsWithWarnings.length," schema warnings"]})," ",/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:"Configuration checks are only performed during development and will not be visible in production builds"})]}),/* @__PURE__ */jsxRuntime.jsx(SchemaProblemGroups,{problemGroups:groupsWithWarnings})]})})]});}const TrialDialogViewed=telemetry.defineEvent({name:"Trial Dialog Viewed",version:1,description:"User viewed a dialog or popover related to free trial"});const TrialDialogDismissed=telemetry.defineEvent({name:"Trial Dialog Dismissed",version:1,description:"User dismissed a dialog or popover related to free trial"});const TrialDialogCTAClicked=telemetry.defineEvent({name:"Trial Dialog CTA Clicked",version:1,description:"User clicked a CTA in a dialog or popover related to free trial"});function getTrialStage(_ref514){let{showOnLoad,dialogId}=_ref514;if(showOnLoad&&dialogId.toLowerCase()==="free-upgrade-popover")return"trialStarted";if(showOnLoad&&dialogId.toLowerCase()==="trial-ending-popover")return"trialEndingSoon";if(showOnLoad&&dialogId.toLowerCase()==="project-downgraded-to-free")return"trialEnded";if(!showOnLoad&&dialogId.toLowerCase()==="after-trial-upgrade")return"postTrial";return"trialActive";}const UpsellDialogViewed=telemetry.defineEvent({name:"Upsell Dialog Viewed",version:1,description:"User viewed the upsell dialog"});const UpsellDialogDismissed=telemetry.defineEvent({name:"Upsell Dialog Dismissed",version:1,description:"User dismissed the upsell dialog"});const UpsellDialogUpgradeCtaClicked=telemetry.defineEvent({name:"Upsell Dialog Upgrade CTA Clicked",version:1,description:'User clicked the "Upgrade" CTA in the upsell dialog'});const UpsellDialogLearnMoreCtaClicked=telemetry.defineEvent({name:"Upsell Dialog Learn More CTA Clicked",version:1,description:'User clicked the "Learn More" CTA in the upsell dialog'});const TRANSFORMATIONS={inlineIcon:(child,idx,block)=>{var _a,_b,_c,_d;if(!types.isPortableTextTextBlock(block))return block;const hasTextLeft=Boolean(((_a=block.children[idx-1])==null?void 0:_a._type)==="span"&&((_b=block.children[idx-1])==null?void 0:_b.text));const hasTextRight=Boolean(((_c=block.children[idx+1])==null?void 0:_c._type)==="span"&&((_d=block.children[idx+1])==null?void 0:_d.text));return{...child,hasTextRight,hasTextLeft};}};const transformBlocks=blocks=>{return blocks.map(block=>{if(types.isPortableTextTextBlock(block)&&block._type==="block"){const children=block.children.map((child,idx)=>{if(TRANSFORMATIONS[child._type]){return TRANSFORMATIONS[child._type](child,idx,block);}return child;});return{...block,children};}return block;});};var __freeze$v=Object.freeze;var __defProp$v=Object.defineProperty;var __template$v=(cooked,raw)=>__freeze$v(__defProp$v(cooked,"raw",{value:__freeze$v(raw||cooked.slice())}));var _a$v,_b$k,_c$b,_d$4,_e$3,_f$2,_g$1;const Divider=styled__default.default(ui.Box)(_a$v||(_a$v=__template$v(["\n  height: 1px;\n  background: var(--card-border-color);\n  width: 100%;\n"])));const SerializerContainer=styled__default.default.div(_b$k||(_b$k=__template$v(["\n  // Remove margin top of first element\n  > div:first-child {\n    margin-top: 0;\n  }\n  // Remove margin bottom to last box.\n  > [data-ui='Box']:last-child {\n    margin-bottom: 0;\n  }\n"])));const IconTextContainer=styled__default.default(ui.Text)(props=>{if(props.accent){return"\n    --card-icon-color: var(--card-accent-fg-color);\n    ";}return"";});const AccentSpan=styled__default.default.span(_c$b||(_c$b=__template$v(["\n  color: var(--card-accent-fg-color);\n  --card-icon-color: var(--card-accent-fg-color);\n"])));const SemiboldSpan=styled__default.default.span(_ref515=>{let{theme}=_ref515;const{weights}=theme.sanity.fonts.text;return styled.css(_d$4||(_d$4=__template$v(["\n    font-weight: ",";\n  "])),weights.semibold);});const InlineIcon=styled__default.default(icons.Icon)(_e$3||(_e$3=__template$v(["\n  &[data-sanity-icon] {\n    /* Forces the icon to leave the necessary space to the right or left it has surrounding text */\n    margin-left: ",";\n    margin-right: ",";\n  }\n"])),props=>props.$hasTextLeft?"0":"",props=>props.$hasTextRight?"0":"");const Link=styled__default.default.a(_f$2||(_f$2=__template$v(["\n  font-weight: 600;\n  color: ",";\n"])),props=>props.useTextColor?"var(--card-muted-fg-color) !important":"");const DynamicIconContainer=styled__default.default.span(_g$1||(_g$1=__template$v(["\n  > svg {\n    display: inline;\n    font-size: calc(21 / 16 * 1rem) !important;\n    margin: -0.375rem 0 !important;\n    *[stroke] {\n      stroke: currentColor;\n    }\n  }\n"])));const accentSpanWrapper=children=>/* @__PURE__ */jsxRuntime.jsx(AccentSpan,{children});const DynamicIcon=props=>{const[ref,setRef]=React.useState(null);React.useEffect(()=>{if(!ref)return;const controller=new AbortController();const signal=controller.signal;fetch(props.icon.url,{signal}).then(response=>{if(!response.ok){throw new Error("HTTP error! status: ".concat(response.status));}return response.text();}).then(data=>{if(!ref)return;ref.innerHTML=data;}).catch(error=>{if(error.name!=="AbortError"){console.error(error);}});return()=>{controller.abort();};},[ref,props.icon.url]);return/* @__PURE__ */jsxRuntime.jsx(DynamicIconContainer,{ref:setRef});};function NormalBlock(props){const{children}=props;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:2,marginBottom:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,children})});}function HeadingBlock(props){const{children}=props;return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:2,marginY:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{size:2,as:"h2",children})});}const components={block:{normal:_ref516=>{let{children}=_ref516;return/* @__PURE__ */jsxRuntime.jsx(NormalBlock,{children});},h2:_ref517=>{let{children}=_ref517;return/* @__PURE__ */jsxRuntime.jsx(HeadingBlock,{children});}},list:{bullet:_ref518=>{let{children}=_ref518;return children;},number:_ref519=>{let{children}=_ref519;return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children});},checkmarks:_ref520=>{let{children}=_ref520;return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children});}},listItem:{bullet:_ref521=>{let{children}=_ref521;return/* @__PURE__ */jsxRuntime.jsx(NormalBlock,{children});},number:_ref522=>{let{children}=_ref522;return/* @__PURE__ */jsxRuntime.jsx(NormalBlock,{children});},checkmarks:_ref523=>{let{children}=_ref523;return/* @__PURE__ */jsxRuntime.jsx(NormalBlock,{children});}},marks:{strong:_ref524=>{let{children}=_ref524;return/* @__PURE__ */jsxRuntime.jsx("strong",{children});},semibold:_ref525=>{let{children}=_ref525;return/* @__PURE__ */jsxRuntime.jsx(SemiboldSpan,{children});},link:props=>/* @__PURE__ */jsxRuntime.jsxs(Link,{href:props.value.href,rel:"noopener noreferrer",target:"_blank",useTextColor:props.value.useTextColor,children:[props.children,props.value.showIcon&&/* @__PURE__ */jsxRuntime.jsx(icons.LinkIcon,{style:{marginLeft:"2px"}})]}),accent:props=>/* @__PURE__ */jsxRuntime.jsx(AccentSpan,{children:props.children})},types:{inlineIcon:props=>{return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.ConditionalWrapper,{condition:props.value.accent,wrapper:accentSpanWrapper,children:props.value.sanityIcon?/* @__PURE__ */jsxRuntime.jsx(InlineIcon,{symbol:props.value.sanityIcon,$hasTextLeft:props.value.hasTextLeft,$hasTextRight:props.value.hasTextRight}):/* @__PURE__ */jsxRuntime.jsx(DynamicIcon,{icon:props.value.icon})});},divider:()=>/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginY:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingY:3,children:/* @__PURE__ */jsxRuntime.jsx(Divider,{})})}),iconAndText:props=>/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"flex-start",paddingX:2,paddingTop:1,paddingBottom:2,marginTop:2,gap:2,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:2,style:{flexShrink:0},children:[/* @__PURE__ */jsxRuntime.jsx(IconTextContainer,{size:1,accent:props.value.accent,children:props.value.sanityIcon?/* @__PURE__ */jsxRuntime.jsx(icons.Icon,{symbol:props.value.sanityIcon}):/* @__PURE__ */jsxRuntime.jsx(DynamicIcon,{icon:props.value.icon})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"semibold",accent:props.value.accent,children:props.value.title})]}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,accent:props.value.accent,children:props.value.text})]})}};function UpsellDescriptionSerializer(props){const value=React.useMemo(()=>transformBlocks(props.blocks),[props.blocks]);return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{tone:"default",children:/* @__PURE__ */jsxRuntime.jsx(SerializerContainer,{children:/* @__PURE__ */jsxRuntime.jsx(react$1.PortableText,{value,components,onMissingComponent:false})})});}var __freeze$u=Object.freeze;var __defProp$u=Object.defineProperty;var __template$u=(cooked,raw)=>__freeze$u(__defProp$u(cooked,"raw",{value:__freeze$u(raw||cooked.slice())}));var _a$u,_b$j,_c$a;const StyledButton$1=styled__default.default(TooltipDelayGroupProvider.Button)(_a$u||(_a$u=__template$u(["\n  position: absolute;\n  top: 12px;\n  right: 12px;\n  z-index: 20;\n  background: transparent;\n  border-radius: 9999px;\n  box-shadow: none;\n  color: white;\n  --card-fg-color: white;\n  :hover {\n    --card-fg-color: white;\n  }\n"])));const Image$2=styled__default.default.img(_b$j||(_b$j=__template$u(["\n  object-fit: cover;\n  width: 100%;\n  height: 100%;\n  height: 196px;\n"])));const StyledDialog$1=styled__default.default(TooltipDelayGroupProvider.Dialog)(_c$a||(_c$a=__template$u(["\n  > [data-ui='DialogCard'] {\n    max-width: 22.5rem;\n  }\n"])));function DialogContent(_ref526){let{onClose,onOpenNext,onOpenUrlCallback,content,open}=_ref526;var _a2,_b2,_c2,_d,_e;function handleClose(){onClose("xClick");}function handleClickOutside(){onClose("outsideClick");}function handleCTAClose(){onClose("ctaClicked");}const schemeValue=useColorSchemeValue();if(!open)return null;return/* @__PURE__ */jsxRuntime.jsxs(StyledDialog$1,{id:"free-trial-modal",onClose,onClickOutside:handleClickOutside,padding:false,__unstable_hideCloseButton:true,scheme:schemeValue,footer:{cancelButton:((_a2=content.secondaryButton)==null?void 0:_a2.text)?{text:content.secondaryButton.text,mode:"bleed",tone:"default",onClick:handleClose}:void 0,confirmButton:{text:(_b2=content.ctaButton)==null?void 0:_b2.text,mode:"default",tone:"primary",...(((_c2=content.ctaButton)==null?void 0:_c2.action)==="openUrl"?{href:content.ctaButton.url,target:"_blank",rel:"noopener noreferrer",as:"a",onClick:onOpenUrlCallback}:{onClick:((_d=content.ctaButton)==null?void 0:_d.action)==="openNext"?onOpenNext:handleCTAClose})}},children:[/* @__PURE__ */jsxRuntime.jsx(StyledButton$1,{icon:icons.CloseIcon,mode:"bleed",tone:"default",onClick:handleClose,tabIndex:-1,tooltipProps:null}),content.image&&/* @__PURE__ */jsxRuntime.jsx(Image$2,{src:content.image.asset.url,alt:(_e=content.image.asset.altText)!=null?_e:""}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{padding:3,direction:"column",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:2,marginTop:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{size:2,children:content.headingText})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:4,paddingBottom:3,children:/* @__PURE__ */jsxRuntime.jsx(UpsellDescriptionSerializer,{blocks:content.descriptionText})})]})]});}var __freeze$t=Object.freeze;var __defProp$t=Object.defineProperty;var __template$t=(cooked,raw)=>__freeze$t(__defProp$t(cooked,"raw",{value:__freeze$t(raw||cooked.slice())}));var _a$t;const CenteredStroke=styled__default.default.div(_a$t||(_a$t=__template$t(["\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n"])));const SvgFilledOutline=_ref527=>{let{daysLeft,totalDays}=_ref527;const progress=totalDays-daysLeft;const percentage=Math.round(progress/totalDays*100);const radius=10;const strokeDasharray=2*Math.PI*radius;const strokeDashOffset=strokeDasharray*((100-percentage)/100);const strokeWidth=1.2;const size=radius*2+strokeWidth;return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{children:/* @__PURE__ */jsxRuntime.jsx(CenteredStroke,{children:/* @__PURE__ */jsxRuntime.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 ".concat(size," ").concat(size),style:{transform:"rotate(-90deg)"},children:[/* @__PURE__ */jsxRuntime.jsx("circle",{r:radius,cx:size/2,cy:size/2,fill:"transparent",strokeWidth,stroke:percentage>75?color.yellow["600"].hex:color.purple["400"].hex}),/* @__PURE__ */jsxRuntime.jsx("circle",{r:radius,cx:size/2,cy:size/2,fill:"transparent",strokeWidth,stroke:"var(--card-border-color)",strokeDasharray,strokeDashoffset:strokeDashOffset})]})})});};const FreeTrialButtonTopbar=React.forwardRef(function FreeTrialButtonTopbar2(_ref528,ref){let{toggleShowContent,daysLeft,totalDays}=_ref528;const{t}=reactI18next.useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(TooltipDelayGroupProvider.Button,{mode:"bleed",onClick:toggleShowContent,ref,tooltipProps:{content:daysLeft?t("free-trial.tooltip.days-count",{count:daysLeft}):t("free-trial.tooltip.trial-finished")},children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:0,children:/* @__PURE__ */jsxRuntime.jsx(icons.BoltIcon,{})}),daysLeft>0&&/* @__PURE__ */jsxRuntime.jsx(SvgFilledOutline,{daysLeft,totalDays})]});});const FreeTrialButtonSidebar=React.forwardRef(function FreeTrialButtonSidebar2(_ref529,ref){let{toggleShowContent,daysLeft}=_ref529;const{t}=reactI18next.useTranslation();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{ref,icon:icons.BoltIcon,justify:"flex-start",mode:"bleed",size:"large",onClick:toggleShowContent,text:daysLeft?t("user-menu.action.free-trial",{count:daysLeft}):t("user-menu.action.free-trial-finished")});});const FreeTrialContext=React.createContext(void 0);const useFreeTrialContext=()=>{const context=React.useContext(FreeTrialContext);if(!context){throw new Error("useFreeTrial must be used within a FreeTrialProvider");}return context;};var __freeze$s=Object.freeze;var __defProp$s=Object.defineProperty;var __template$s=(cooked,raw)=>__freeze$s(__defProp$s(cooked,"raw",{value:__freeze$s(raw||cooked.slice())}));var _a$s;const Image$1=styled__default.default.img(_a$s||(_a$s=__template$s(["\n  object-fit: cover;\n  width: 100%;\n  height: 100%;\n  height: 180px;\n"])));function PopoverContent(_ref530){let{content,handleClose,handleOpenNext}=_ref530;var _a2,_b,_c,_d,_e;return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{radius:3,overflow:"hidden",width:0,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Container,{width:0,children:[content.image&&/* @__PURE__ */jsxRuntime.jsx(Image$1,{src:content.image.asset.url,alt:(_a2=content.image.asset.altText)!=null?_a2:""}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{padding:3,direction:"column",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:2,marginTop:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Heading,{size:1,children:content.headingText})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:4,children:/* @__PURE__ */jsxRuntime.jsx(UpsellDescriptionSerializer,{blocks:content.descriptionText})})]}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{width:"full",gap:3,justify:"flex-end",padding:3,children:[((_b=content.secondaryButton)==null?void 0:_b.text)&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"bleed",text:content.secondaryButton.text,tone:"default",onClick:()=>handleClose("xClick")}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"default",tooltipProps:null,text:(_c=content.ctaButton)==null?void 0:_c.text,autoFocus:true,tone:"primary",...(((_d=content.ctaButton)==null?void 0:_d.action)==="openUrl"?{href:content.ctaButton.url,target:"_blank",rel:"noopener noreferrer",as:"a"}:{onClick:((_e=content.ctaButton)==null?void 0:_e.action)==="openNext"?handleOpenNext:()=>handleClose("ctaClicked")})})]})]})});}function FreeTrial(_ref531){let{type}=_ref531;const{data,showDialog,showOnLoad,toggleShowContent}=useFreeTrialContext();const scheme=useColorSchemeValue();const telemetry=react.useTelemetry();const[ref,setRef]=React.useState(null);const[showPopover,setShowPopover]=React.useState(false);React.useEffect(()=>{if(ref){setShowPopover(true);}},[ref]);const closeAndReOpen=React.useCallback(()=>toggleShowContent(true),[toggleShowContent]);const toggleDialog=React.useCallback(()=>{ref==null?void 0:ref.focus();toggleShowContent(false);},[toggleShowContent,ref]);const handleClose=React.useCallback(dialogType=>{return action=>{const dialog=(data==null?void 0:data.showOnLoad)||(data==null?void 0:data.showOnClick);if(dialog)telemetry.log(TrialDialogDismissed,{dialogId:dialog.id,dialogRevision:dialog._rev,dialogType,source:"studio",trialDaysLeft:data.daysLeft,dialogTrialStage:getTrialStage({showOnLoad,dialogId:dialog.id}),dialogDismissAction:action});toggleDialog();};},[data,toggleDialog,showOnLoad,telemetry]);const handleDialogCTAClick=React.useCallback(action=>{return()=>{const dialog=(data==null?void 0:data.showOnLoad)||(data==null?void 0:data.showOnClick);if(dialog)telemetry.log(TrialDialogCTAClicked,{dialogId:dialog.id,dialogRevision:dialog._rev,dialogType:"modal",source:"studio",trialDaysLeft:data.daysLeft,dialogTrialStage:getTrialStage({showOnLoad,dialogId:dialog.id}),dialogCtaType:action==="openURL"?"upgrade":"learnMore"});closeAndReOpen();};},[data,closeAndReOpen,telemetry,showOnLoad]);const handlePopoverCTAClick=React.useCallback(()=>{if(data==null?void 0:data.showOnLoad)telemetry.log(TrialDialogCTAClicked,{dialogId:data.showOnLoad.id,dialogRevision:data.showOnLoad._rev,dialogType:"popover",source:"studio",trialDaysLeft:data.daysLeft,dialogTrialStage:getTrialStage({showOnLoad:true,dialogId:data.showOnLoad.id}),dialogCtaType:"learnMore"});closeAndReOpen();},[data==null?void 0:data.showOnLoad,data==null?void 0:data.daysLeft,closeAndReOpen,telemetry]);const handleOnTrialButtonClick=React.useCallback(()=>{if(data==null?void 0:data.showOnClick)telemetry.log(TrialDialogViewed,{dialogId:data.showOnClick.id,dialogRevision:data.showOnClick._rev,dialogTrigger:"fromClick",dialogType:"modal",source:"studio",trialDaysLeft:data.daysLeft,dialogTrialStage:getTrialStage({showOnLoad:true,dialogId:data.showOnClick.id})});closeAndReOpen();},[data==null?void 0:data.showOnClick,data==null?void 0:data.daysLeft,telemetry,closeAndReOpen]);if(!(data==null?void 0:data.id))return null;const dialogToRender=showOnLoad?data.showOnLoad:data.showOnClick;if(!dialogToRender)return null;const button=type==="sidebar"?/* @__PURE__ */jsxRuntime.jsx(FreeTrialButtonSidebar,{toggleShowContent:handleOnTrialButtonClick,daysLeft:data.daysLeft,ref:setRef}):/* @__PURE__ */jsxRuntime.jsx(FreeTrialButtonTopbar,{toggleShowContent:handleOnTrialButtonClick,daysLeft:data.daysLeft,totalDays:data.totalDays,ref:setRef});if((dialogToRender==null?void 0:dialogToRender.dialogType)==="popover"){return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Popover,{open:showDialog&&showPopover,size:0,scheme,radius:3,portal:true,placement:type==="sidebar"?"top":"bottom-end",content:/* @__PURE__ */jsxRuntime.jsx(PopoverContent,{content:dialogToRender,handleClose:handleClose("popover"),handleOpenNext:handlePopoverCTAClick}),children:button});}return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[button,/* @__PURE__ */jsxRuntime.jsx(DialogContent,{content:dialogToRender,onClose:handleClose("modal"),onOpenNext:handleDialogCTAClick("openNext"),onOpenUrlCallback:handleDialogCTAClick("openURL"),open:showDialog})]});}const SANITY_VERSION="3.30.1";const FreeTrialProvider=_ref532=>{let{children}=_ref532;var _a;const router$1=router.useRouter();const[data,setData]=React.useState(null);const[showDialog,setShowDialog]=React.useState(false);const[showOnLoad,setShowOnLoad]=React.useState(false);const client=useClient({apiVersion:"2023-12-11"});const telemetry=react.useTelemetry();React.useEffect(()=>{const dialog=data==null?void 0:data.showOnLoad;if(showDialog&&showOnLoad&&dialog){telemetry.log(TrialDialogViewed,{dialogId:dialog.id,dialogRevision:dialog._rev,dialogTrialStage:getTrialStage({showOnLoad,dialogId:dialog.id}),dialogTrigger:showOnLoad?"auto":"fromClick",dialogType:dialog.dialogType,source:"studio",trialDaysLeft:data.daysLeft});}},[showDialog,data,showOnLoad,telemetry]);const searchParamsAsString=new URLSearchParams(router$1.state._searchParams).toString();React.useEffect(()=>{const searchParams=new URLSearchParams(searchParamsAsString);const queryParams=new URLSearchParams();queryParams.append("studioVersion",SANITY_VERSION);const trialState=searchParams.get("trialState");if(trialState)queryParams.append("trialState",trialState);const seenBefore=searchParams.get("seenBefore");if(seenBefore)queryParams.append("seenBefore",seenBefore);const queryURL=queryParams.get("trialState")?"/journey/trial/override":"/journey/trial";const request=client.observable.request({url:"".concat(queryURL,"?").concat(queryParams.toString())}).subscribe(response=>{setData(response);if(response==null?void 0:response.showOnLoad){setShowOnLoad(true);setShowDialog(true);}},()=>{});return()=>{request.unsubscribe();};},[client,searchParamsAsString]);const toggleShowContent=React.useCallback(function(){let closeAndReOpen=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var _a2;if(showOnLoad){setShowOnLoad(false);setShowDialog(closeAndReOpen);if((_a2=data==null?void 0:data.showOnLoad)==null?void 0:_a2.id){client.request({url:"/journey/trial/".concat(data==null?void 0:data.showOnLoad.id),method:"POST"});}}else{setShowDialog(p=>!p);}},[client,showOnLoad,(_a=data==null?void 0:data.showOnLoad)==null?void 0:_a.id]);return/* @__PURE__ */jsxRuntime.jsx(FreeTrialContext.Provider,{value:{data,showDialog,toggleShowContent,showOnLoad},children});};function SanityLogo(){return/* @__PURE__ */jsxRuntime.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 33 33",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[/* @__PURE__ */jsxRuntime.jsx("rect",{width:"100%",height:"100%",fill:"#EC5446"}),/* @__PURE__ */jsxRuntime.jsx("path",{d:"M10.1637 8.5498C10.1637 11.3854 11.9461 13.0725 15.5143 13.9622L19.2955 14.8235C22.6725 15.5855 24.729 17.4783 24.729 20.5619C24.7553 21.9053 24.3107 23.2168 23.4698 24.2765C23.4698 21.1999 21.8499 19.5376 17.9425 18.538L14.2299 17.7086C11.257 17.0423 8.9623 15.4863 8.9623 12.1368C8.94666 10.8433 9.36932 9.58143 10.1637 8.5498Z",fill:"white"}),/* @__PURE__ */jsxRuntime.jsx("path",{d:"M21.1463 19.8069C22.7591 20.8206 23.4662 22.2384 23.4662 24.2729C22.1313 25.953 19.7861 26.8958 17.0297 26.8958C12.3899 26.8958 9.1427 24.6521 8.42111 20.7533H12.8769C13.4506 22.5432 14.9695 23.3726 16.9972 23.3726C19.4722 23.3726 21.1175 22.0753 21.1499 19.7998",fill:"#F8B1AA"}),/* @__PURE__ */jsxRuntime.jsx("path",{d:"M12.4801 12.7536C11.7436 12.3236 11.1394 11.7057 10.7316 10.9656C10.3238 10.2255 10.1276 9.3907 10.1638 8.54984C11.4518 6.88396 13.6923 5.8667 16.4235 5.8667C21.1499 5.8667 23.8848 8.31945 24.5595 11.7717H20.2732C19.8006 10.4107 18.6172 9.35089 16.4596 9.35089C14.1541 9.35089 12.5811 10.6694 12.4909 12.7536",fill:"#F8B1AA"})]});}var __freeze$r=Object.freeze;var __defProp$r=Object.defineProperty;var __template$r=(cooked,raw)=>__freeze$r(__defProp$r(cooked,"raw",{value:__freeze$r(raw||cooked.slice())}));var _a$r,_b$i;const LOGO_MARK_SIZE=25;const RADIUS=2;const LogoMarkContainer=styled__default.default(ui.Card).attrs({overflow:"hidden",radius:RADIUS})(_a$r||(_a$r=__template$r(["\n  height: ","px;\n  width: ","px;\n"])),LOGO_MARK_SIZE,LOGO_MARK_SIZE);const StyledCard$1=styled__default.default(ui.Card)(_b$i||(_b$i=__template$r(["\n  border-radius: ",";\n  display: flex;\n  outline: none;\n  text-decoration: none;\n  &:focus-visible {\n    box-shadow: ",";\n  }\n"])),_ref533=>{let{theme}=_ref533;return ui.rem(theme.sanity.radius[RADIUS]);},_ref534=>{let{theme}=_ref534;return focusRingStyle$1({base:theme.sanity.color.base,focusRing:{...theme.sanity.focusRing,offset:1}});});function HomeButton(){const workspaces=useWorkspaces();const{activeWorkspace}=useActiveWorkspace();const{href:rootHref,onClick:handleRootClick}=router.useStateLink({state:{}});const multipleWorkspaces=workspaces.length>1;return/* @__PURE__ */jsxRuntime.jsx(StyledCard$1,{as:"a",href:rootHref,onClick:handleRootClick,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(LogoMarkContainer,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",height:"fill",justify:"center",children:multipleWorkspaces||activeWorkspace.customIcon?/* @__PURE__ */jsxRuntime.jsx(WorkspacePreviewIcon,{icon:activeWorkspace.icon,size:"small"}):/* @__PURE__ */jsxRuntime.jsx(SanityLogo,{})})}),!multipleWorkspaces&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:activeWorkspace.title})})]})});}function AppearanceMenu$1(_ref535){let{setScheme}=_ref535;const{t}=useTranslation();const options=useColorSchemeOptions(setScheme,t);return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderTop:true,flex:"none",padding:2,overflow:"auto",children:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"ul",space:1,children:options.map(_ref536=>{let{icon,label,name,onSelect,selected,title}=_ref536;return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"li",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":label,icon,iconRight:selected&&/* @__PURE__ */jsxRuntime.jsx(icons.CheckmarkIcon,{}),justify:"flex-start",mode:"bleed",onClick:onSelect,selected,size:"large",text:title})},name);})})});}function LocaleMenu$1(){useLocale();{return null;}}function ManageMenu$1(){const{currentUser,projectId}=useWorkspace();const isAdmin=Boolean(currentUser&&userHasRole(currentUser,"administrator"));const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderTop:true,flex:"none",padding:2,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{as:"ul",space:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"li",children:/* @__PURE__ */jsxRuntime.jsx(FreeTrial,{type:"sidebar"})}),/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"li",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("user-menu.action.manage-project-aria-label"),as:"a",href:"https://sanity.io/manage/project/".concat(projectId),icon:icons.CogIcon,justify:"flex-start",mode:"bleed",size:"large",target:"_blank",text:t("user-menu.action.manage-project")})}),isAdmin&&/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"li",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("user-menu.action.invite-members-aria-label"),as:"a",href:"https://sanity.io/manage/project/".concat(projectId,"/members"),icon:icons.UsersIcon,justify:"flex-start",mode:"bleed",size:"large",target:"_blank",text:t("user-menu.action.invite-members")})})]})});}var __freeze$q=Object.freeze;var __defProp$q=Object.defineProperty;var __template$q=(cooked,raw)=>__freeze$q(__defProp$q(cooked,"raw",{value:__freeze$q(raw||cooked.slice())}));var _a$q,_b$h,_c$9;const ANIMATION_TRANSITION$1={bounce:0,damping:20,mass:0.5,stiffness:200,type:"spring"};const BACKDROP_VARIANTS={open:{opacity:1},closed:{opacity:0}};const INNER_CARD_VARIANTS={open:{x:"0%"},closed:{x:"-100%"}};const Root$6=styled__default.default(ui.Layer)(_a$q||(_a$q=__template$q(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n"])));const BackdropMotion=styled__default.default(framerMotion.motion(ui.Card))(_b$h||(_b$h=__template$q(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: var(--card-shadow-penumbra-color);\n"])));const InnerCardMotion=styled__default.default(framerMotion.motion(ui.Card))(_c$9||(_c$9=__template$q(["\n  position: relative;\n  pointer-events: all;\n  flex-direction: column;\n  height: 100%;\n  min-width: 200px;\n  max-width: 280px;\n  overflow: auto;\n"])));const NavDrawer=React.memo(function NavDrawer2(props){const{activeToolName,isOpen,onClose,tools}=props;const setScheme=useColorSchemeSetValue();const{auth,currentUser}=useWorkspace();const workspaces=useWorkspaces();const ToolMenu=useToolMenuComponent();const{t}=useTranslation();const handleKeyDown=React.useCallback(event=>{if(event.key==="Escape"){onClose();}},[onClose]);return/* @__PURE__ */jsxRuntime.jsx(framerMotion.AnimatePresence,{children:isOpen&&/* @__PURE__ */jsxRuntime.jsx(FocusLock__default.default,{returnFocus:true,children:/* @__PURE__ */jsxRuntime.jsxs(Root$6,{onKeyDown:handleKeyDown,children:[/* @__PURE__ */jsxRuntime.jsx(BackdropMotion,{animate:"open","data-open":isOpen,exit:"closed",initial:"closed",onClick:onClose,transition:ANIMATION_TRANSITION$1,variants:BACKDROP_VARIANTS}),/* @__PURE__ */jsxRuntime.jsxs(InnerCardMotion,{animate:"open","data-open":isOpen,display:"flex",exit:"closed",height:"fill",initial:"closed",shadow:1,transition:ANIMATION_TRANSITION$1,variants:INNER_CARD_VARIANTS,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderBottom:true,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,padding:3,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{flex:1,align:"center",paddingRight:2,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{flex:1,align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(UserAvatar,{size:1,user:"me"}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,marginLeft:3,title:(currentUser==null?void 0:currentUser.name)||(currentUser==null?void 0:currentUser.email),children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,textOverflow:"ellipsis",weight:"medium",children:(currentUser==null?void 0:currentUser.name)||(currentUser==null?void 0:currentUser.email)})})]})}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.CloseIcon,mode:"bleed",onClick:onClose,tooltipProps:{content:t("user-menu.close-menu")}})]}),workspaces.length>1&&/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{flex:1,gap:1,children:[/* @__PURE__ */jsxRuntime.jsx(HomeButton,{}),/* @__PURE__ */jsxRuntime.jsx(WorkspaceMenuButton,{})]})]})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{direction:"column",flex:1,justify:"space-between",overflow:"auto",children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{flex:"none",padding:2,children:/* @__PURE__ */jsxRuntime.jsx(ToolMenu,{activeToolName,closeSidebar:onClose,context:"sidebar",isSidebarOpen:isOpen,tools})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{direction:"column",children:[setScheme&&/* @__PURE__ */jsxRuntime.jsx(AppearanceMenu$1,{setScheme}),/* @__PURE__ */jsxRuntime.jsx(LocaleMenu$1,{}),/* @__PURE__ */jsxRuntime.jsx(ManageMenu$1,{})]})]}),auth.logout&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{flex:"none",padding:2,borderTop:true,children:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{iconRight:icons.LeaveIcon,justify:"flex-start",mode:"bleed",onClick:auth.logout,size:"large",text:t("user-menu.action.sign-out")})})})]})]})})});});function isQueryMatch(query,option){const lowercaseTitle=option.title.toLowerCase();const lowercaseQuery=query.trim().toLowerCase();const words=lowercaseQuery.split(/[\s\-_]+/);return words.every(word=>lowercaseTitle.includes(word));}function sortResultRelevance(query,a,b){const titleA=a.title.toLowerCase();const titleB=b.title.toLowerCase();const lowercaseQuery=query.trim().toLowerCase();if(titleA.startsWith(lowercaseQuery)&&!titleB.startsWith(lowercaseQuery)){return-1;}if(titleB.startsWith(lowercaseQuery)&&!titleA.startsWith(lowercaseQuery)){return 1;}if(titleA.includes(lowercaseQuery)&&!titleB.includes(lowercaseQuery)){return-1;}if(titleB.includes(lowercaseQuery)&&!titleA.includes(lowercaseQuery)){return 1;}return 0;}function filterOptions(options,query,getI18nText){const optionsWithTitle=options.map(option=>({...option,title:getI18nText({...option,title:(option==null?void 0:option.title)||option.id}).title}));const alphabetized=optionsWithTitle.sort((a,b)=>a.title.localeCompare(b.title));return alphabetized.filter(option=>isQueryMatch(query,option)).sort((a,b)=>sortResultRelevance(query,a,b));}var __freeze$p=Object.freeze;var __defProp$p=Object.defineProperty;var __template$p=(cooked,raw)=>__freeze$p(__defProp$p(cooked,"raw",{value:__freeze$p(raw||cooked.slice())}));var _a$p,_b$g,_c$8,_d$3,_e$2,_f$1;const StyledPopover$1=styled__default.default(TooltipDelayGroupProvider.Popover)(()=>{return styled.css(_a$p||(_a$p=__template$p(["\n    [data-ui='Popover__wrapper'] {\n      width: 320px;\n      display: flex;\n      flex-direction: column;\n      border-radius: ","px;\n      position: relative;\n      overflow: hidden;\n      overflow: clip;\n    }\n  "])),_ref537=>{let{theme}=_ref537;return theme.sanity.radius[3];});});const StyledDialog=styled__default.default(TooltipDelayGroupProvider.Dialog)(()=>{return styled.css(_b$g||(_b$g=__template$p(["\n    [data-ui='DialogCard'] {\n      justify-content: flex-start;\n    }\n  "])));});const RootFlex$1=styled__default.default(ui.Flex)(_c$8||(_c$8=__template$p([""])));const PopoverHeaderCard=styled__default.default(ui.Card)(_d$3||(_d$3=__template$p(["\n  min-height: max-content;\n"])));const DialogHeaderCard=styled__default.default(ui.Card)(_e$2||(_e$2=__template$p(["\n  min-height: max-content;\n"])));const PopoverListFlex=styled__default.default(ui.Flex)(props=>{const{$maxDisplayedItems,$itemHeight}=props;return styled.css(_f$1||(_f$1=__template$p(["\n    --item-height: ","px;\n    --max-items: ",";\n    --list-padding: 0.5rem;\n\n    position: relative;\n    max-height: calc(var(--item-height) * var(--max-items) + var(--list-padding));\n    min-height: calc((var(--item-height) * 1));\n  "])),$itemHeight,$maxDisplayedItems);});const INLINE_PREVIEW_HEIGHT=33;function NewDocumentListOption(props){const{option,currentUser,onClick,preview}=props;const params=React.useMemo(()=>({template:option.templateId,type:option.schemaType}),[option.schemaType,option.templateId]);const{onClick:onIntentClick,href}=router.useIntentLink({intent:"create",params});const handleDocumentClick=React.useCallback(event=>{onIntentClick(event);onClick(option);},[onIntentClick,onClick,option]);const{title}=useI18nText(option);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{disabled:option.hasPermission,portal:true,content:/* @__PURE__ */jsxRuntime.jsx(InsufficientPermissionsMessage,{currentUser,context:"create-document"}),children:/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{as:option.hasPermission?"a":"button","data-testid":"create-new-".concat(option.templateId),disabled:!option.hasPermission,href,marginBottom:1,onClick:handleDocumentClick,padding:preview==="inline"?3:4,radius:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:preview==="inline"?1:void 0,children:title})})})},option.id);}var __freeze$o=Object.freeze;var __defProp$o=Object.defineProperty;var __template$o=(cooked,raw)=>__freeze$o(__defProp$o(cooked,"raw",{value:__freeze$o(raw||cooked.slice())}));var _a$o;const ContentFlex=styled__default.default(ui.Flex)(_a$o||(_a$o=__template$o(["\n  min-height: 100px;\n"])));function NewDocumentList(props){const{currentUser,loading,onDocumentClick,options,preview,searchQuery,textInputElement}=props;const{t}=useTranslation();const hasOptions=options.length>0&&!loading;const handleDocumentClick=React.useCallback(()=>{onDocumentClick();},[onDocumentClick]);const getItemDisabled=React.useCallback(index=>{var _a2;return((_a2=options[index])==null?void 0:_a2.hasPermission)===false;},[options]);const renderItem=React.useCallback(item=>{return/* @__PURE__ */jsxRuntime.jsx(NewDocumentListOption,{currentUser,onClick:handleDocumentClick,option:item,preview},item.id);},[currentUser,handleDocumentClick,preview]);if(loading){return/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{showText:true});}if(!hasOptions&&searchQuery){return/* @__PURE__ */jsxRuntime.jsx(ContentFlex,{align:"center",flex:1,height:"fill",justify:"center",padding:4,sizing:"border",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",muted:true,size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{t,i18nKey:"new-document.no-results",values:{searchQuery}})})});}if(!hasOptions){return/* @__PURE__ */jsxRuntime.jsx(ContentFlex,{align:"center",flex:1,height:"fill",justify:"center",padding:4,sizing:"border",children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",muted:true,size:1,children:t("new-document.no-document-types-found")})});}return/* @__PURE__ */jsxRuntime.jsx(CommandList,{activeItemDataAttr:"data-hovered",ariaLabel:t("new-document.new-document"),autoFocus:supportsTouch?void 0:"input",getItemDisabled,inputElement:textInputElement,itemHeight:INLINE_PREVIEW_HEIGHT,items:options,overscan:5,padding:preview==="inline"?1:2,paddingBottom:0,renderItem});}const MAX_DISPLAYED_ITEMS=10;function NewDocumentButton(props){const{canCreateDocument,modal="popover",loading,options}=props;const[open,setOpen]=React.useState(false);const[searchQuery,setSearchQuery]=React.useState("");const[popoverElement,setPopoverElement]=React.useState(null);const[dialogElement,setDialogElement]=React.useState(null);const[buttonElement,setButtonElement]=React.useState(null);const[searchInputElement,setSearchInputElement]=React.useState(null);const{t}=useTranslation();const getI18nText=useGetI18nText(options);const{scheme}=useColorScheme();const currentUser=useCurrentUser();const schema=useSchema();const hasNewDocumentOptions=options.length>0;const disabled=!canCreateDocument||!hasNewDocumentOptions;const placeholder=t("new-document.filter-placeholder");const title=t("new-document.title");const openDialogAriaLabel=t("new-document.open-dialog-aria-label");const validOptions=React.useMemo(()=>options.filter(option=>{const optionSchema=schema.get(option.schemaType);return optionSchema&&!types.isDeprecatedSchemaType(optionSchema);}),[options,schema]);const filteredOptions=React.useMemo(()=>filterOptions(validOptions,searchQuery,getI18nText),[validOptions,searchQuery,getI18nText]);const handleSearchChange=React.useCallback(event=>{setSearchQuery(event.currentTarget.value);},[]);const handleToggleOpen=React.useCallback(()=>setOpen(v=>!v),[]);const handleClose=React.useCallback(()=>{setOpen(false);setSearchQuery("");buttonElement==null?void 0:buttonElement.focus();},[buttonElement]);const handleOpenButtonKeyDown=React.useCallback(e=>{if(e.key==="ArrowDown"&&!open){setOpen(true);}},[open]);const handlePopoverKeyDown=React.useCallback(e=>{if((e.key==="Escape"||e.key==="Tab")&&open){handleClose();}},[handleClose,open]);ui.useClickOutside(()=>{if(open){handleClose();}},[buttonElement,dialogElement,popoverElement]);const sharedListProps=React.useMemo(()=>({currentUser,loading,onDocumentClick:handleToggleOpen,options:filteredOptions,searchQuery,preview:modal==="popover"?"inline":"default",textInputElement:searchInputElement}),[currentUser,filteredOptions,handleToggleOpen,loading,modal,searchInputElement,searchQuery]);const sharedTextInputProps=React.useMemo(()=>({__unstable_disableFocusRing:true,border:false,"data-testid":"new-document-button-search-input",defaultValue:searchQuery,disabled:loading,icon:icons.SearchIcon,onChange:handleSearchChange,placeholder,ref:setSearchInputElement}),[handleSearchChange,loading,placeholder,searchQuery]);const sharedOpenButtonProps=React.useMemo(()=>({"aria-label":openDialogAriaLabel,"data-testid":"new-document-button",disabled:disabled||loading,icon:icons.AddIcon,text:t("new-document.button"),mode:"ghost",onClick:handleToggleOpen,ref:setButtonElement,selected:open}),[disabled,handleToggleOpen,loading,open,openDialogAriaLabel,t]);const tooltipContent=React.useMemo(()=>{if(!hasNewDocumentOptions){return/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:t("new-document.no-document-types-label")});}if(canCreateDocument){return/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:t("new-document.create-new-document-label")});}return/* @__PURE__ */jsxRuntime.jsx(InsufficientPermissionsMessage,{currentUser,context:"create-any-document"});},[canCreateDocument,currentUser,hasNewDocumentOptions,t]);const sharedTooltipProps=React.useMemo(()=>({content:tooltipContent,disabled:loading||open,scheme}),[loading,open,scheme,tooltipContent]);if(modal==="dialog"){return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{...sharedTooltipProps,children:/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{...sharedOpenButtonProps})})}),open&&/* @__PURE__ */jsxRuntime.jsx(StyledDialog,{header:title,id:"create-new-document-dialog",onClickOutside:handleClose,onClose:handleClose,ref:setDialogElement,scheme,width:1,children:/* @__PURE__ */jsxRuntime.jsxs(RootFlex$1,{direction:"column",flex:1,height:"fill",children:[/* @__PURE__ */jsxRuntime.jsx(DialogHeaderCard,{padding:2,borderBottom:true,children:/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{"data-testid":"new-document-button-search-input",...sharedTextInputProps})}),/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{direction:"column",overflow:"hidden",children:/* @__PURE__ */jsxRuntime.jsx(NewDocumentList,{...sharedListProps})})]})})]});}return/* @__PURE__ */jsxRuntime.jsx(StyledPopover$1,{constrainSize:true,onKeyDown:handlePopoverKeyDown,open,portal:true,radius:3,ref:setPopoverElement,scheme,content:/* @__PURE__ */jsxRuntime.jsxs(RootFlex$1,{direction:"column",flex:1,forwardedAs:FocusLock__default.default,height:"fill",returnFocus:true,children:[/* @__PURE__ */jsxRuntime.jsx(PopoverHeaderCard,{sizing:"border",children:/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderBottom:true,padding:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.TextInput,{...sharedTextInputProps,fontSize:1,radius:1})})})}),/* @__PURE__ */jsxRuntime.jsx(PopoverListFlex,{$itemHeight:INLINE_PREVIEW_HEIGHT,$maxDisplayedItems:MAX_DISPLAYED_ITEMS,direction:"column",overflow:"hidden",children:/* @__PURE__ */jsxRuntime.jsx(NewDocumentList,{...sharedListProps})})]}),children:/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{...sharedTooltipProps,children:/* @__PURE__ */jsxRuntime.jsx("div",{children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{...sharedOpenButtonProps,"aria-expanded":open,"aria-haspopup":"true",onKeyDown:handleOpenButtonKeyDown})})})})});}function useNewDocumentOptions(){const{__internal:{staticInitialValueTemplateItems}}=useSource();const[permissions,loading]=useTemplatePermissions({templateItems:staticInitialValueTemplateItems});const canCreateDocument=(permissions==null?void 0:permissions.some(p=>staticInitialValueTemplateItems.some(t=>t.id===p.id)))||false;const optionsWithPermissions=React.useMemo(()=>{return staticInitialValueTemplateItems.map(item=>{var _a;return{...item,title:(item==null?void 0:item.title)||item.id,hasPermission:((_a=permissions==null?void 0:permissions.find(p=>p.id===item.id))==null?void 0:_a.granted)||false};});},[permissions,staticInitialValueTemplateItems]);return{canCreateDocument,loading,options:optionsWithPermissions};}const PresenceMenuItem=React.memo(function PresenceMenuItem2(props){const{presence,focused,onFocus}=props;const[menuItemElement,setMenuItemElement]=React.useState(null);const{t}=useTranslation();const lastActiveLocation=orderBy__default.default(presence.locations||[],["lastActiveAt"],["desc"]).find(location=>location.documentId);const hasLink=Boolean(lastActiveLocation==null?void 0:lastActiveLocation.documentId);React.useEffect(()=>{if(focused&&menuItemElement){menuItemElement.focus();menuItemElement.setAttribute("data-selected","");}if(!focused){menuItemElement==null?void 0:menuItemElement.removeAttribute("data-selected");}},[menuItemElement,focused]);const handleFocus=React.useCallback(()=>{onFocus(presence.user.id);},[onFocus,presence.user.id]);const LinkComponent=React.useMemo(()=>// eslint-disable-next-line @typescript-eslint/no-shadow
React.forwardRef(function LinkComponent2(linkProps,ref){if(!(lastActiveLocation==null?void 0:lastActiveLocation.path))return null;return/* @__PURE__ */jsxRuntime.jsx(router.IntentLink,{...linkProps,intent:"edit",params:{id:lastActiveLocation==null?void 0:lastActiveLocation.documentId,path:PathUtils__namespace.toString(lastActiveLocation==null?void 0:lastActiveLocation.path)},ref});}),[lastActiveLocation]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:lastActiveLocation?LinkComponent:"div","data-as":"a",disabled:!hasLink,onFocus:handleFocus,preview:/* @__PURE__ */jsxRuntime.jsx(UserAvatar,{size:1,user:presence.user},presence.user.id),ref:setMenuItemElement,text:presence.user.displayName,tooltipProps:hasLink?void 0:{content:t("presence.not-in-a-document"),placement:"left"}});});var __freeze$n=Object.freeze;var __defProp$n=Object.defineProperty;var __template$n=(cooked,raw)=>__freeze$n(__defProp$n(cooked,"raw",{value:__freeze$n(raw||cooked.slice())}));var _a$n,_b$f;const StyledMenu$2=styled__default.default(ui.Menu)(_a$n||(_a$n=__template$n(["\n  max-width: 260px;\n"])));const FooterStack=styled__default.default(ui.Stack)(_b$f||(_b$f=__template$n(["\n  position: sticky;\n  bottom: 0;\n  background-color: var(--card-bg-color);\n"])));function PresenceMenu(){const presence=useGlobalPresence();const{projectId}=useWorkspace();const{scheme}=useColorScheme();const{t}=useTranslation();const hasPresence=presence.length>0;const[focusedId,setFocusedId]=React.useState();const handleItemFocus=React.useCallback(id=>{setFocusedId(id);},[]);const handleClearFocusedItem=React.useCallback(()=>{setFocusedId("");},[]);const handleClose=React.useCallback(()=>{setFocusedId("");},[]);const button=React.useMemo(()=>{return/* @__PURE__ */jsxRuntime.jsx(StatusButton,{icon:icons.UsersIcon,mode:"bleed",tone:hasPresence?"positive":void 0,tooltipProps:{content:t("presence.tooltip-content")}});},[hasPresence,t]);const popoverProps=React.useMemo(()=>({constrainSize:true,fallbackPlacements:["bottom"],placement:"bottom",portal:true,scheme}),[scheme]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button,"aria-label":t("presence.aria-label"),id:"global-presence-menu",menu:/* @__PURE__ */jsxRuntime.jsxs(StyledMenu$2,{children:[hasPresence&&presence.map(item=>/* @__PURE__ */jsxRuntime.jsx(PresenceMenuItem,{focused:focusedId===item.user.id,onFocus:handleItemFocus,presence:item},item.user.id)),!hasPresence&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{weight:"medium",size:1,children:t("presence.no-one-else-title")}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,children:t("presence.no-one-else-description")})]})}),/* @__PURE__ */jsxRuntime.jsxs(FooterStack,{space:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:"a",href:"https://sanity.io/manage/project/".concat(projectId),iconRight:icons.CogIcon,onFocus:handleClearFocusedItem,rel:"noopener noreferrer",target:"_blank",text:t("presence.action.manage-members")})]})]}),onClose:handleClose,popover:popoverProps});}function getHelpResources(client,locale){return client.withConfig({apiVersion:"1"}).observable.request({url:"/help",/*
      query and tag is used by analytics for tracking.
      Builds to: `{m: ['sanity@3.0.2']}' and serializes to: `?m=sanity@3.0.2`.
      Final format will be e.g. https://api.sanity.io/v1/help?tag=sanity.studio.module.version-check&m=sanity%403.0.2
      */query:{m:["sanity@".concat(SANITY_VERSION)],locale},tag:"module.version-check",json:true});}function useGetHelpResources(){const client=useClient({apiVersion:"1"});const locale=useCurrentLocale().id;const moduleStatus$=React.useMemo(()=>getHelpResources(client,locale),[client,locale]);return useLoadable(moduleStatus$);}function ResourcesMenuItems(_ref538){let{error,isLoading,value}=_ref538;var _a;const sections=(_a=value==null?void 0:value.resources)==null?void 0:_a.sectionArray;const latestStudioVersion=value==null?void 0:value.latestVersion;const{t}=useTranslation();if(isLoading){return/* @__PURE__ */jsxRuntime.jsx(LoadingBlock,{showText:true});}const fallbackLinks=/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:"a",text:t("help-resources.action.join-our-community"),href:"https://www.sanity.io/exchange/community",target:"_blank"}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:"a",text:t("help-resources.action.help-and-support"),href:"https://www.sanity.io/contact/support",target:"_blank"}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:"a",text:t("help-resources.action.contact-sales"),href:"https://www.sanity.io/contact/sales?ref=studio",target:"_blank"}),/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{})]});return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[(value===void 0||error)&&/* @__PURE__ */jsxRuntime.jsx("div",{children:fallbackLinks}),!error&&(sections==null?void 0:sections.map(subSection=>{if(!subSection)return null;return/* @__PURE__ */jsxRuntime.jsx(SubSection,{subSection},subSection._key);})),/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{padding:3,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,weight:"medium",textOverflow:"ellipsis",children:t("help-resources.studio-version",{studioVersion:SANITY_VERSION})}),!error&&latestStudioVersion&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingTop:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,textOverflow:"ellipsis",children:t("help-resources.latest-sanity-version",{latestVersion:latestStudioVersion})})})]})]});}function SubSection(_ref539){let{subSection}=_ref539;var _a;return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[(_a=subSection==null?void 0:subSection.items)==null?void 0:_a.map(item=>{if(!item||!item.title)return null;switch(item._type){case"externalLink":if(!item.url)return null;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:"a",tone:"default",text:item.title,href:item.url,target:"_blank"},item._key);case"internalAction":if(!item.type)return null;return item.type==="show-welcome-modal"&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{text:item.title},item._key);default:return null;}}),/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{})]});}var __freeze$m=Object.freeze;var __defProp$m=Object.defineProperty;var __template$m=(cooked,raw)=>__freeze$m(__defProp$m(cooked,"raw",{value:__freeze$m(raw||cooked.slice())}));var _a$m;const StyledMenu$1=styled__default.default(ui.Menu)(_a$m||(_a$m=__template$m(["\n  max-width: 300px;\n  min-width: 200px;\n"])));function ResourcesButton(){const{t}=useTranslation();const{value,error,isLoading}=useGetHelpResources();return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{"aria-label":t("help-resources.title"),icon:icons.HelpCircleIcon,mode:"bleed",tooltipProps:{content:t("help-resources.title")}}),id:"menu-button-resources",menu:/* @__PURE__ */jsxRuntime.jsx(StyledMenu$1,{children:/* @__PURE__ */jsxRuntime.jsx(ResourcesMenuItems,{error,isLoading,value})}),popover:{constrainSize:true}});}var __freeze$l=Object.freeze;var __defProp$l=Object.defineProperty;var __template$l=(cooked,raw)=>__freeze$l(__defProp$l(cooked,"raw",{value:__freeze$l(raw||cooked.slice())}));var _a$l,_b$e;const ANIMATION_TRANSITION={duration:0.4,type:"spring"};const CARD_VARIANTS={open:{opacity:1,scale:1,x:"-50%"},closed:{opacity:0,scale:0.99,x:"-50%"}};const OVERLAY_VARIANTS={open:{opacity:1},closed:{opacity:0}};const Y_POSITION=12;const MotionOverlay=styled__default.default(framerMotion.motion(ui.Card))(_a$l||(_a$l=__template$l(["\n  background-color: var(--card-backdrop-color);\n  bottom: 0;\n  left: 0;\n  position: absolute;\n  right: 0;\n  top: 0;\n"])));const SearchMotionCard=styled__default.default(framerMotion.motion(ui.Card))(_b$e||(_b$e=__template$l(["\n  display: flex !important;\n  flex-direction: column;\n  left: 50%;\n  max-height: min(\n    calc(100vh - ","vh - ","px),\n    ","px\n  );\n  position: absolute;\n  top: ","vh;\n  width: min(calc(100vw - ","px), ","px);\n"])),Y_POSITION,POPOVER_INPUT_PADDING,POPOVER_MAX_HEIGHT,Y_POSITION,POPOVER_INPUT_PADDING*2,POPOVER_MAX_WIDTH);function SearchPopover(_ref540){let{disableFocusLock,onClose,onOpen,open}=_ref540;const[inputElement,setInputElement]=React.useState(null);const popoverElement=React.useRef(null);const{isTopLayer,zIndex}=ui.useLayer();const{t}=useTranslation();const{onClose:onSearchClose,state:{filtersVisible,terms}}=useSearchState();const hasValidTerms=hasSearchableTerms({terms});const handleClickOutside=React.useCallback(()=>{if(isTopLayer&&onSearchClose&&open){onSearchClose();}},[isTopLayer,onSearchClose,open]);ui.useClickOutside(handleClickOutside,[popoverElement.current]);return/* @__PURE__ */jsxRuntime.jsx(SearchWrapper,{hasValidTerms,onClose,onOpen,open,children:/* @__PURE__ */jsxRuntime.jsx(framerMotion.AnimatePresence,{children:open&&/* @__PURE__ */jsxRuntime.jsx(ui.Portal,{children:/* @__PURE__ */jsxRuntime.jsxs(FocusLock__default.default,{autoFocus:!supportsTouch,disabled:disableFocusLock,returnFocus:true,children:[/* @__PURE__ */jsxRuntime.jsx(MotionOverlay,{animate:"open",exit:"closed",initial:"closed",style:{zIndex},transition:ANIMATION_TRANSITION,variants:OVERLAY_VARIANTS}),/* @__PURE__ */jsxRuntime.jsxs(SearchMotionCard,{animate:"open",exit:"closed",initial:"closed",overflow:"hidden",radius:POPOVER_RADIUS,ref:popoverElement,shadow:2,style:{zIndex},transition:ANIMATION_TRANSITION,variants:CARD_VARIANTS,children:[/* @__PURE__ */jsxRuntime.jsx(SearchHeader,{ariaInputLabel:hasValidTerms?t("search.search-results-aria-label"):t("search.recent-searches-aria-label"),onClose,ref:setInputElement}),filtersVisible&&/* @__PURE__ */jsxRuntime.jsx(ui.Card,{borderTop:true,flex:"none",children:/* @__PURE__ */jsxRuntime.jsx(Filters,{})}),hasValidTerms?/* @__PURE__ */jsxRuntime.jsx(SearchResults,{inputElement}):/* @__PURE__ */jsxRuntime.jsx(RecentSearches,{inputElement})]})]})})})});}const RECENT_SEARCHES_KEY="search::recent";const MAX_RECENT_SEARCHES=5;const RECENT_SEARCH_VERSION=2;function createRecentSearchesStore(_ref541){let{dataset,fieldDefinitions,filterDefinitions,operatorDefinitions,projectId,schema,user,version=RECENT_SEARCH_VERSION}=_ref541;if(!dataset||!projectId||!supportsLocalStorage||!user){return void 0;}const lsKey="".concat(RECENT_SEARCHES_KEY,"__").concat(projectId,":").concat(dataset,":").concat(user.id);return{/**
     * Write a search term to Local Storage and return updated recent searches.
     */addSearch:(searchTerm,filters)=>{const storedFilters=(filters||[]).map(filter=>({fieldId:filter.fieldId,filterName:filter.filterName,operatorType:filter.operatorType,value:filter.value}));const validStoredFilters=storedFilters.filter(filter=>validateFilter({fieldDefinitions,filter,filterDefinitions,operatorDefinitions}));const newSearchItem={created:(/* @__PURE__ */new Date()).toISOString(),filters:validStoredFilters,terms:{query:searchTerm.query.trim(),typeNames:searchTerm.types.map(s=>s.name)}};const comparator=JSON.stringify(omit__default$1.default(newSearchItem,"created"));const newRecent={version,recentSearches:[newSearchItem,...getRecentStoredSearch(lsKey,version).recentSearches.filter(r=>{return JSON.stringify(omit__default$1.default(r,"created"))!==comparator;})].slice(0,MAX_RECENT_SEARCHES)};window.localStorage.setItem(lsKey,JSON.stringify(newRecent));return getRecentSearchTerms({fieldDefinitions,filterDefinitions,lsKey,operatorDefinitions,schema,version});},/**
     * Fetch all recent searches from Local Storage.
     * Invalid search terms will be filtered out and terms will be re-written to Local Storage.
     */getRecentSearches:()=>getRecentSearchTerms({fieldDefinitions,filterDefinitions,lsKey,operatorDefinitions,schema,version}),/**
     * Remove all search terms from Local Storage and return updated recent searches.
     */removeSearch:()=>{const searchTerms=getRecentStoredSearch(lsKey,version);const newRecent={...searchTerms,recentSearches:[]};window.localStorage.setItem(lsKey,JSON.stringify(newRecent));return getRecentSearchTerms({fieldDefinitions,filterDefinitions,lsKey,operatorDefinitions,schema,version});},/**
     * Remove a search term from Local Storage and return updated recent searches.
     */removeSearchAtIndex:index=>{const searchTerms=getRecentStoredSearch(lsKey,version);if(index<0||index>searchTerms.recentSearches.length){return getRecentSearchTerms({fieldDefinitions,filterDefinitions,lsKey,operatorDefinitions,schema,version});}const newRecent={...searchTerms,recentSearches:[...searchTerms.recentSearches.slice(0,index),...searchTerms.recentSearches.slice(index+1)]};window.localStorage.setItem(lsKey,JSON.stringify(newRecent));return getRecentSearchTerms({fieldDefinitions,filterDefinitions,lsKey,operatorDefinitions,schema,version});}};}function getRecentStoredSearch(lsKey,version){const recentString=supportsLocalStorage?window.localStorage.getItem(lsKey):void 0;return recentString?JSON.parse(recentString):{version,recentSearches:[]};}function getRecentSearchTerms(_ref542){let{lsKey,schema,fieldDefinitions,filterDefinitions,operatorDefinitions,version}=_ref542;const storedSearchTerms=verifySearchVersionNumber({lsKey,storedSearch:getRecentStoredSearch(lsKey,version)});return sanitizeStoredSearch({studioSchema:schema,storedSearch:storedSearchTerms,lsKey,filterDefinitions,fieldDefinitions,operatorDefinitions,version}).recentSearches.filter(r=>!!r.terms).map((r,index)=>({__recent:{index,timestamp:new Date(r.created).getTime()},filters:r.filters,query:r.terms.query,types:r.terms.typeNames.map(typeName=>schema.get(typeName)).filter(s=>!!(s&&s.jsonType==="object"))}));}function verifySearchVersionNumber(_ref543){let{lsKey,storedSearch}=_ref543;if(storedSearch.version!==RECENT_SEARCH_VERSION){const newStoredSearch={version:RECENT_SEARCH_VERSION,recentSearches:[]};window.localStorage.setItem(lsKey,JSON.stringify(newStoredSearch));return newStoredSearch;}return storedSearch;}function sanitizeStoredSearch(_ref544){let{fieldDefinitions,filterDefinitions,lsKey,operatorDefinitions,storedSearch,studioSchema,version}=_ref544;const searchableTypeNames=getSearchableOmnisearchTypes(studioSchema).map(schema=>schema.name);const filteredSearch=storedSearch.recentSearches.filter(recentSearch=>{return(// Has valid searchable types (not hidden by omnisearch)
recentSearch.terms.typeNames.every(typeName=>searchableTypeNames.includes(typeName))&&recentSearch.filters.every(filter=>validateFilter({fieldDefinitions,filter,filterDefinitions,operatorDefinitions})));});const newStoredSearch={version:RECENT_SEARCH_VERSION,recentSearches:filteredSearch};if(newStoredSearch.recentSearches.length<storedSearch.recentSearches.length){window.localStorage.setItem(lsKey,JSON.stringify(newStoredSearch));}return getRecentStoredSearch(lsKey,version);}const MAX_OBJECT_TRAVERSAL_DEPTH=3;function createFieldDefinitions(schema,filterDefinitions){var _a;const searchableDocumentTypeNames=getSearchableOmnisearchTypes(schema).map(s=>s.name);const{documentTypes,objectTypes}=(((_a=schema._original)==null?void 0:_a.types)||[]).filter(t=>isDocumentObjectDefinition(t)?searchableDocumentTypeNames.includes(t.name):true).filter(schemaType=>schemaType.name!=="slug").filter(schemaType=>!schemaType.name.startsWith("sanity.")).reduce((acc,schemaType)=>{if(isDocumentObjectDefinition(schemaType)){acc.documentTypes[schemaType.name]=schemaType;}if(isObjectDefinition(schemaType)){acc.objectTypes[schemaType.name]=schemaType;}return acc;},{documentTypes:{},objectTypes:{}})||{documentTypes:{},objectTypes:{}};const supportedFieldTypes=getSupportedFieldTypes(filterDefinitions);return getDocumentFieldDefinitions(supportedFieldTypes,documentTypes,objectTypes);}function createFieldDefinitionDictionary(fieldDefinitions){return fieldDefinitions.reduce((acc,val)=>{acc[val.id]=val;return acc;},{});}function generateFieldId(field){return[field.type,field.fieldPath,field.filterName,field.documentTypes.join(",")].join("-");}function getDocumentFieldDefinitions(supportedFieldTypes,documentTypes,objectTypes){function addFieldDefinitionRecursive(_ref545){let{acc,defType,depth=0,documentType,prevFieldPath,prevTitlePath}=_ref545;var _a;const continueRecursion=depth<=MAX_OBJECT_TRAVERSAL_DEPTH;const isInternalField=defType.name.startsWith("_");const title=(defType==null?void 0:defType.title)?sanitizeFieldValue(defType.title):startCase__default$1.default(defType.name);const fieldPath=prevFieldPath?"".concat(prevFieldPath,".").concat(defType.name):defType.name;const titlePath=prevTitlePath?[...prevTitlePath,title]:[title];if(!continueRecursion)return;const existingObject=objectTypes[defType.type];const existingDocument=documentTypes[defType.type];const inlineObject=isObjectDefinition(defType)?defType:null;const targetObject=existingDocument||existingObject||inlineObject;if(targetObject){(_a=targetObject==null?void 0:targetObject.fields)==null?void 0:_a.forEach(field=>addFieldDefinitionRecursive({acc,defType:field,depth:depth+1,documentType,prevFieldPath:fieldPath,prevTitlePath:titlePath}));return;}if(!supportedFieldTypes.includes(defType.type))return;acc.push({documentTypes:documentType&&!isInternalField?[documentType]:[],fieldPath,filterName:resolveFilterName(defType),id:"",name:defType.name,titlePath,title,type:defType.type});}const fieldDefinitions=Object.values(documentTypes).reduce((acc,documentType)=>{const documentFields=documentType.fields.reduce((a,field)=>{addFieldDefinitionRecursive({acc:a,defType:field,documentType:documentType.name});return a;},[]);acc.push(...documentFields);return acc;},[]).reduce((acc,val)=>{const prevIndex=acc.findIndex(v=>v.fieldPath===val.fieldPath&&v.title===val.title&&v.type===val.type);if(prevIndex>-1){acc[prevIndex]={...acc[prevIndex],documentTypes:[...acc[prevIndex].documentTypes,...val.documentTypes]};}else{acc.push(val);}return acc;},[]).map(addFieldDefinitionId).sort(sortFieldDefinitions);return fieldDefinitions;}function addFieldDefinitionId(field){return{...field,id:generateFieldId(field)};}function isArrayOfPrimitives(schemaType){var _a;if(isArrayDefinition(schemaType)){return schemaType.of.every(item=>["boolean","number","string"].includes(item.type))&&(((_a=schemaType.options)==null?void 0:_a.list)?schemaType.options.list.length>0:false);}return false;}function isArrayDefinition(schemaType){return schemaType.type==="array";}function isDocumentObjectDefinition(schemaType){return schemaType.type==="document";}function isObjectDefinition(schemaType){return schemaType.type==="object";}function isStringDefinition(schemaType){return schemaType.type==="string";}function isStringListDefinition(schemaType){var _a;if(isStringDefinition(schemaType)){return((_a=schemaType.options)==null?void 0:_a.list)?schemaType.options.list.length>0:false;}return false;}function resolveFilterName(schemaType){if(isStringListDefinition(schemaType)){return"stringList";}if(isArrayDefinition(schemaType)){if(schemaType.of.some(item=>item.type==="reference")){return"arrayReferences";}if(schemaType.of.find(item=>item.type==="block")){return"portableText";}if(isArrayOfPrimitives(schemaType)){return"arrayList";}}return schemaType.type;}function sortFieldDefinitions(a,b){const aTitlePath=a.titlePath.slice(0,-1).join("/");const bTitlePath=b.titlePath.slice(0,-1).join("/");return a.title.localeCompare(b.title)||aTitlePath.localeCompare(bTitlePath)||a.fieldPath.localeCompare(b.fieldPath);}function isRecentSearchTerms(terms){return typeof terms.__recent!=="undefined";}const rootName="core:studio:navbar:search:";debug__default.default(rootName);function debugWithName(name){const namespace="".concat(rootName).concat(name);if(debug__default.default&&debug__default.default.enabled(namespace)){return debug__default.default(namespace);}return debug__default.default(rootName);}function isDebugMode(){return typeof window==="undefined"?false:window.location.hash.slice(1).split(";").includes(DEBUG_FRAGMENT);}function initialSearchState(_ref546){let{currentUser,fullscreen,recentSearches=[],definitions}=_ref546;return{currentUser,debug:isDebugMode(),documentTypesNarrowed:[],filters:[],filtersVisible:true,fullscreen,lastActiveIndex:-1,ordering:ORDERINGS.relevance,pageIndex:0,recentSearches,result:{error:null,hasMore:null,hits:[],loaded:false,loading:false},terms:{query:"",types:[]},definitions};}const debug=debugWithName("reducer");function searchReducer(state,action){let prefix="\u{1F50D}";if(action.type.startsWith("SEARCH_REQUEST")){prefix="\u{1F6A8}";}if(action.type.startsWith("RECENT_SEARCHES")){prefix="\u{1F4BE}";}debug(prefix,action);switch(action.type){case"FILTERS_VISIBLE_SET":return{...state,filtersVisible:action.visible};case"LAST_ACTIVE_INDEX_SET":return{...state,lastActiveIndex:action.index};case"ORDERING_RESET":return{...state,ordering:ORDERINGS.relevance,terms:stripRecent(state.terms)};case"ORDERING_SET":return{...state,ordering:action.ordering,terms:stripRecent(state.terms)};case"PAGE_INCREMENT":return{...state,pageIndex:state.pageIndex+1,terms:stripRecent(state.terms)};case"RECENT_SEARCHES_SET":return{...state,recentSearches:action.recentSearches};case"SEARCH_CLEAR":return{...state,pageIndex:0,result:{...state.result,hasMore:null,hits:[]}};case"SEARCH_REQUEST_COMPLETE":return{...state,result:{...state.result,error:null,hasMore:action.hits.length>0,hits:state.pageIndex>0?[...state.result.hits,...action.hits]:action.hits,loaded:true,loading:false}};case"SEARCH_REQUEST_ERROR":return{...state,result:{...state.result,error:action.error,loaded:false,loading:false}};case"SEARCH_REQUEST_START":return{...state,result:{...state.result,loaded:false,loading:true}};case"TERMS_FILTERS_ADD":{const newFilter={...action.filter,value:getOperatorInitialValue(state.definitions.operators,action.filter.operatorType)};const filters=[...state.filters,newFilter];return{...state,documentTypesNarrowed:narrowDocumentTypes({fieldDefinitions:state.definitions.fields,filters,types:state.terms.types}),filters,lastAddedFilter:newFilter,terms:{...state.terms,filter:generateFilterQuery({fieldDefinitions:state.definitions.fields,filterDefinitions:state.definitions.filters,filters,operatorDefinitions:state.definitions.operators})}};}case"TERMS_FILTERS_CLEAR":{const filters=[];return{...state,documentTypesNarrowed:narrowDocumentTypes({fieldDefinitions:state.definitions.fields,filters,types:state.terms.types}),filters,terms:{...state.terms,filter:generateFilterQuery({fieldDefinitions:state.definitions.fields,filterDefinitions:state.definitions.filters,filters,operatorDefinitions:state.definitions.operators})}};}case"TERMS_FILTERS_REMOVE":{const index=state.filters.findIndex(filter=>getFilterKey(filter)===action.filterKey);const filters=[...state.filters.slice(0,index),//
...state.filters.slice(index+1)];return{...state,documentTypesNarrowed:narrowDocumentTypes({fieldDefinitions:state.definitions.fields,filters,types:state.terms.types}),filters,terms:{...state.terms,filter:generateFilterQuery({fieldDefinitions:state.definitions.fields,filterDefinitions:state.definitions.filters,filters,operatorDefinitions:state.definitions.operators})}};}case"TERMS_FILTERS_SET_OPERATOR":{const matchedFilter=state.filters.find(filter=>getFilterKey(filter)===action.filterKey);const currentOperator=getOperatorDefinition(state.definitions.operators,matchedFilter==null?void 0:matchedFilter.operatorType);const nextOperator=getOperatorDefinition(state.definitions.operators,action.operatorType);const nextInitialValue=nextOperator==null?void 0:nextOperator.initialValue;const inputComponentChanged=(currentOperator==null?void 0:currentOperator.inputComponent)!=(nextOperator==null?void 0:nextOperator.inputComponent);const filters=state.filters.map(filter=>{if(getFilterKey(filter)===action.filterKey){return{...filter,operatorType:action.operatorType,...(inputComponentChanged?{value:nextInitialValue}:{})};}return filter;});return{...state,filters,terms:{...state.terms,filter:generateFilterQuery({fieldDefinitions:state.definitions.fields,filterDefinitions:state.definitions.filters,filters,operatorDefinitions:state.definitions.operators})}};}case"TERMS_FILTERS_SET_VALUE":{const filters=state.filters.map(filter=>{if(getFilterKey(filter)===action.filterKey){return{...filter,value:action.value};}return filter;});return{...state,filters,terms:{...state.terms,filter:generateFilterQuery({fieldDefinitions:state.definitions.fields,filterDefinitions:state.definitions.filters,filters,operatorDefinitions:state.definitions.operators})}};}case"TERMS_QUERY_SET":return{...state,pageIndex:0,result:{...state.result,loaded:false},terms:stripRecent({...state.terms,query:action.query})};case"TERMS_SET":{const filters=action.filters||[];const types=[...(state.terms.types||[]),//
...action.terms.types].sort(sortTypes);return{...state,documentTypesNarrowed:narrowDocumentTypes({fieldDefinitions:state.definitions.fields,filters,types}),filters,lastAddedFilter:null,pageIndex:0,result:{...state.result,loaded:false},terms:{...action.terms,filter:generateFilterQuery({fieldDefinitions:state.definitions.fields,filterDefinitions:state.definitions.filters,filters,operatorDefinitions:state.definitions.operators})}};}case"TERMS_TYPE_ADD":{const types=[...(state.terms.types||[]),//
action.schemaType].sort(sortTypes);const documentTypesNarrowed=narrowDocumentTypes({fieldDefinitions:state.definitions.fields,filters:[],types});const filters=state.filters.filter(f=>{const fieldDefinition=getFieldFromFilter(state.definitions.fields,f);if(fieldDefinition){if(fieldDefinition.documentTypes.length===0){return true;}return documentTypesNarrowed.every(type=>fieldDefinition.documentTypes.findIndex(t=>t===type)>-1);}return true;});return{...state,documentTypesNarrowed,filters,pageIndex:0,result:{...state.result,loaded:false},terms:stripRecent({...state.terms,filter:generateFilterQuery({fieldDefinitions:state.definitions.fields,filterDefinitions:state.definitions.filters,operatorDefinitions:state.definitions.operators,filters}),types})};}case"TERMS_TYPE_REMOVE":{const types=(state.terms.types||[]).filter(s=>s!==action.schemaType);return{...state,documentTypesNarrowed:narrowDocumentTypes({fieldDefinitions:state.definitions.fields,filters:state.filters,types}),pageIndex:0,result:{...state.result,loaded:false},terms:stripRecent({...state.terms,types})};}case"TERMS_TYPES_CLEAR":{const types=[];return{...state,documentTypesNarrowed:narrowDocumentTypes({fieldDefinitions:state.definitions.fields,filters:state.filters,types}),pageIndex:0,result:{...state.result,loaded:false},terms:stripRecent({...state.terms,types:[]})};}default:return state;}}function stripRecent(terms){if(isRecentSearchTerms(terms)){const{__recent,...rest}=terms;return rest;}return terms;}function SearchProvider(_ref547){let{children,fullscreen}=_ref547;const onCloseRef=React.useRef(null);const[searchCommandList,setSearchCommandList]=React.useState(null);const client=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const schema=useSchema();const currentUser=useCurrentUser();const{search:{operators,filters}}=useSource();const{dataset,projectId}=client.config();const{fieldDefinitions,filterDefinitions,operatorDefinitions}=React.useMemo(()=>{return{fieldDefinitions:createFieldDefinitionDictionary(createFieldDefinitions(schema,filters)),filterDefinitions:createFilterDefinitionDictionary(filters),operatorDefinitions:createOperatorDefinitionDictionary(operators)};},[filters,operators,schema]);const recentSearchesStore=React.useMemo(()=>createRecentSearchesStore({dataset,fieldDefinitions,filterDefinitions,operatorDefinitions,projectId,schema,user:currentUser,version:RECENT_SEARCH_VERSION}),[currentUser,dataset,fieldDefinitions,filterDefinitions,operatorDefinitions,projectId,schema]);const recentSearches=React.useMemo(()=>recentSearchesStore==null?void 0:recentSearchesStore.getRecentSearches(),[recentSearchesStore]);const initialState=React.useMemo(()=>initialSearchState({currentUser,fullscreen,recentSearches,definitions:{fields:fieldDefinitions,operators:operatorDefinitions,filters:filterDefinitions}}),[currentUser,fieldDefinitions,filterDefinitions,fullscreen,operatorDefinitions,recentSearches]);const[state,dispatch]=React.useReducer(searchReducer,initialState);const{documentTypesNarrowed,filters:currentFilters,ordering,pageIndex,result,terms}=state;const isMountedRef=React.useRef(false);const previousOrderingRef=React.useRef(initialState.ordering);const previousPageIndexRef=React.useRef(initialState.pageIndex);const previousTermsRef=React.useRef(initialState.terms);const{handleSearch,searchState}=useSearch({initialState:{...result,terms},onComplete:hits=>dispatch({hits,type:"SEARCH_REQUEST_COMPLETE"}),onError:error=>dispatch({error,type:"SEARCH_REQUEST_ERROR"}),onStart:()=>dispatch({type:"SEARCH_REQUEST_START"}),schema});const hasValidTerms=hasSearchableTerms({terms});const documentTypes=documentTypesNarrowed.map(documentType=>schema.get(documentType));const completeFilters=currentFilters.filter(filter=>validateFilter({fieldDefinitions,filter,filterDefinitions,operatorDefinitions}));const handleSetOnClose=React.useCallback(onClose=>{onCloseRef.current=onClose;},[]);React.useEffect(()=>{const orderingChanged=!isEqual__default$1.default(ordering,previousOrderingRef.current);const pageIndexChanged=pageIndex!==previousPageIndexRef.current;const termsChanged=!isEqual__default$1.default(terms,previousTermsRef.current);if(orderingChanged||pageIndexChanged||termsChanged){const sortLabel=(ordering==null?void 0:ordering.customMeasurementLabel)||"".concat(ordering.sort.field," ").concat(ordering.sort.direction);handleSearch({options:{// Comments prepended to each query for future measurement
comments:[...(isRecentSearchTerms(terms)?["findability-recent-search:".concat(terms.__recent.index)]:[]),"findability-selected-types:".concat(terms.types.length),"findability-sort:".concat(sortLabel),"findability-source: global","findability-filter-count:".concat(completeFilters.length)],limit:SEARCH_LIMIT,offset:pageIndex*SEARCH_LIMIT,skipSortByScore:ordering.ignoreScore,sort:[ordering.sort]},terms:{...terms,// Narrow document type search
...(documentTypes?{types:documentTypes}:{})}});previousPageIndexRef.current=pageIndex;}previousOrderingRef.current=ordering;previousTermsRef.current=terms;},[completeFilters.length,currentFilters,documentTypes,handleSearch,hasValidTerms,ordering,pageIndex,searchState.terms,terms]);React.useEffect(()=>{if(!hasValidTerms&&(isMountedRef==null?void 0:isMountedRef.current)&&result.hits.length>0){dispatch({type:"SEARCH_CLEAR"});}isMountedRef.current=true;},[dispatch,hasValidTerms,result.hits,terms.query,terms.types]);return/* @__PURE__ */jsxRuntime.jsx(SearchContext.Provider,{value:{dispatch,onClose:onCloseRef==null?void 0:onCloseRef.current,recentSearchesStore,searchCommandList,setSearchCommandList,setOnClose:handleSetOnClose,state:{...state,fullscreen}},children});}function LocaleMenu(){useLocale();{return null;}}function AppearanceMenu(_ref548){let{setScheme}=_ref548;const{t}=useTranslation();const options=useColorSchemeOptions(setScheme,t);return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{}),options.map(_ref549=>{let{icon,label,name,onSelect,selected,title}=_ref549;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{"aria-label":label,icon,onClick:onSelect,pressed:selected,text:title,iconRight:selected&&/* @__PURE__ */jsxRuntime.jsx(icons.CheckmarkIcon,{})},name);})]});}var __freeze$k=Object.freeze;var __defProp$k=Object.defineProperty;var __template$k=(cooked,raw)=>__freeze$k(__defProp$k(cooked,"raw",{value:__freeze$k(raw||cooked.slice())}));var _a$k;const Root$5=styled__default.default.div(_a$k||(_a$k=__template$k(["\n  position: absolute;\n  width: 18px;\n  height: 18px;\n  background: var(--card-bg-color);\n  bottom: -4px;\n  right: -4px;\n  border-radius: 50%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border: 1px solid var(--card-bg-color);\n  box-sizing: content-box;\n\n  svg {\n    box-sizing: content-box;\n    border: 1px solid var(--card-hairline-soft-color);\n    border-radius: 50%;\n    padding: 2px;\n    width: 12px;\n    height: 12px;\n  }\n\n  &[data-logo='github'] {\n    svg {\n      path {\n        fill: var(--card-fg-color);\n      }\n    }\n  }\n\n  &[data-logo='saml'] {\n    svg {\n      path {\n        fill: var(--card-fg-color);\n      }\n    }\n  }\n"])));const Google=/* @__PURE__ */jsxRuntime.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[/* @__PURE__ */jsxRuntime.jsxs("g",{clipPath:"url(#clip0)",children:[/* @__PURE__ */jsxRuntime.jsx("path",{d:"M12 6.13764C12 5.72977 11.9663 5.31971 11.8943 4.91846H6.12036V7.22895H9.42684C9.28963 7.97412 8.84876 8.63332 8.20322 9.05221V10.5514H10.1759C11.3342 9.50637 12 7.9631 12 6.13764Z",fill:"#4285F4"}),/* @__PURE__ */jsxRuntime.jsx("path",{d:"M6.12019 12.0002C7.77118 12.0002 9.16349 11.4688 10.1779 10.5517L8.20529 9.05253C7.65646 9.41851 6.94793 9.62574 6.12244 9.62574C4.52544 9.62574 3.17136 8.56971 2.68552 7.1499H0.649902V8.69537C1.68908 10.7215 3.80567 12.0002 6.12019 12.0002V12.0002Z",fill:"#34A853"}),/* @__PURE__ */jsxRuntime.jsx("path",{d:"M2.68332 7.14986C2.4269 6.40469 2.4269 5.59778 2.68332 4.8526V3.30713H0.649951C-0.218278 5.00252 -0.218278 6.99995 0.649951 8.69533L2.68332 7.14986V7.14986Z",fill:"#FBBC04"}),/* @__PURE__ */jsxRuntime.jsx("path",{d:"M6.12019 2.37483C6.99291 2.3616 7.8364 2.68348 8.46845 3.27433L10.2161 1.56131C9.1095 0.542752 7.64071 -0.017233 6.12019 0.000404333C3.80566 0.000404333 1.68908 1.27911 0.649902 3.3074L2.68326 4.85288C3.16686 3.43087 4.52319 2.37483 6.12019 2.37483V2.37483Z",fill:"#EA4335"})]}),/* @__PURE__ */jsxRuntime.jsx("defs",{children:/* @__PURE__ */jsxRuntime.jsx("clipPath",{id:"clip0",children:/* @__PURE__ */jsxRuntime.jsx("rect",{width:"12",height:"12",fill:"white"})})})]});const GitHub=/* @__PURE__ */jsxRuntime.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[/* @__PURE__ */jsxRuntime.jsx("g",{clipPath:"url(#clip0)",children:/* @__PURE__ */jsxRuntime.jsx("path",{d:"M11.195 3.13503C10.6711 2.22838 9.91808 1.47537 9.01144 0.951471C8.09222 0.414976 7.08837 0.146729 5.99987 0.146729C4.91137 0.146729 3.90752 0.414976 2.98831 0.951471C2.08163 1.47534 1.32862 2.22836 0.804744 3.13503C0.268248 4.05497 0 5.05883 0 6.14659C0 7.45399 0.381531 8.62978 1.14459 9.67394C1.90765 10.7181 2.89327 11.4408 4.10143 11.8419C4.24208 11.868 4.34624 11.8497 4.41392 11.7872C4.44666 11.7577 4.47263 11.7215 4.49006 11.681C4.50749 11.6405 4.51595 11.5967 4.51488 11.5527C4.51488 11.537 4.51361 11.3963 4.51105 11.1307C4.5085 10.8651 4.50722 10.6334 4.50722 10.4355L4.32745 10.4666C4.18407 10.4895 4.03885 10.4986 3.89375 10.494C3.71159 10.4908 3.53001 10.4725 3.35087 10.4393C3.16049 10.4045 2.98119 10.3246 2.82796 10.2064C2.66705 10.0846 2.54715 9.91661 2.48428 9.72484L2.40602 9.54506C2.34022 9.40286 2.25754 9.2691 2.15976 9.14666C2.04775 9.00072 1.93447 8.90176 1.81991 8.84977L1.76518 8.81064C1.72769 8.78356 1.6936 8.75205 1.66367 8.71679C1.63479 8.6841 1.61108 8.64719 1.59334 8.60734C1.57766 8.57085 1.5907 8.54085 1.63247 8.51731C1.67461 8.49405 1.75123 8.48256 1.86068 8.48256L2.01692 8.50582C2.12108 8.52662 2.24996 8.5891 2.40356 8.69326C2.5585 8.79876 2.68797 8.93748 2.78254 9.09932C2.90239 9.31294 3.04695 9.47575 3.21624 9.58775C3.38552 9.69976 3.55609 9.75576 3.72793 9.75576C3.87725 9.7578 4.02641 9.74479 4.17312 9.7169C4.29459 9.69195 4.41264 9.65254 4.52473 9.59952C4.57162 9.25037 4.69931 8.98212 4.90782 8.79477C4.63684 8.76849 4.36827 8.72157 4.10444 8.6544C3.84797 8.58382 3.60133 8.48141 3.37029 8.34958C3.12825 8.218 2.91442 8.04015 2.74095 7.82613C2.57421 7.6178 2.4374 7.34417 2.3305 7.00524C2.2236 6.6663 2.1707 6.27584 2.1718 5.83383C2.1718 5.20357 2.37757 4.66708 2.7891 4.22435C2.59629 3.75006 2.61453 3.21885 2.84383 2.63073C2.99487 2.58385 3.21879 2.61897 3.51559 2.73608C3.81239 2.85319 4.02983 2.95352 4.16792 3.03707C4.30601 3.12025 4.41665 3.19058 4.49983 3.24804C5.48153 2.9773 6.51821 2.9773 7.49991 3.24804L7.79679 3.0606C8.0249 2.92356 8.26549 2.80849 8.51535 2.71693C8.79135 2.61276 9.00231 2.58412 9.14825 2.63101C9.38248 3.21949 9.40327 3.7507 9.21064 4.22462C9.62199 4.66735 9.82776 5.20385 9.82795 5.83411C9.82795 6.27684 9.77459 6.66904 9.66787 7.01071C9.56116 7.35238 9.42325 7.62601 9.25415 7.8316C9.07785 8.04326 8.86311 8.21966 8.62124 8.35149C8.39008 8.48329 8.14337 8.5857 7.88682 8.65632C7.62412 8.72277 7.35674 8.76915 7.087 8.79505C7.35698 9.02927 7.49206 9.3994 7.49225 9.90543V11.5527C7.49115 11.5964 7.49929 11.6398 7.51612 11.6802C7.53295 11.7206 7.5581 11.7569 7.58993 11.7869C7.65505 11.8493 7.75794 11.8675 7.89858 11.8416C9.10693 11.4403 10.0926 10.7177 10.8557 9.67367C11.6188 8.62968 12.0003 7.4539 12.0003 6.14632C11.9997 5.05873 11.7313 4.05497 11.195 3.13503V3.13503Z",fill:"black"})}),/* @__PURE__ */jsxRuntime.jsx("defs",{children:/* @__PURE__ */jsxRuntime.jsx("clipPath",{id:"clip0",children:/* @__PURE__ */jsxRuntime.jsx("rect",{width:"12",height:"12",fill:"white"})})})]});const Saml=/* @__PURE__ */jsxRuntime.jsxs("svg",{width:"17",height:"9",viewBox:"0 0 17 9",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[/* @__PURE__ */jsxRuntime.jsx("path",{d:"M0.0691681 5.98162C0.115833 7.24157 1.07247 8.00221 2.59841 8.00221C4.17102 8.00221 5.12299 7.19957 5.12299 5.86962C5.12299 4.83832 4.55367 4.25501 3.25172 3.96569L2.56108 3.80703C1.8331 3.64837 1.53445 3.38704 1.53445 2.91106C1.53445 2.40708 1.94977 2.09442 2.61708 2.09442C3.27505 2.09442 3.6997 2.43508 3.75103 2.99039H5.00166C4.95966 1.78643 4.01236 0.997795 2.60308 0.997795C1.14713 0.997795 0.218496 1.79577 0.218496 3.05105C0.218496 4.04968 0.815808 4.69366 2.03376 4.96898L2.73374 5.13231C3.51304 5.30497 3.8117 5.54763 3.8117 6.00495C3.8117 6.55093 3.34972 6.90092 2.62174 6.90092C1.85644 6.90092 1.38045 6.56493 1.31979 5.98162H0.0691681Z"}),/* @__PURE__ */jsxRuntime.jsx("path",{d:"M5.97695 5.98162C6.02362 7.24157 6.98025 8.00221 8.5062 8.00221C10.0788 8.00221 11.0308 7.19957 11.0308 5.86962C11.0308 4.83832 10.4615 4.25501 9.15951 3.96569L8.46886 3.80703C7.74089 3.64837 7.44223 3.38704 7.44223 2.91106C7.44223 2.40708 7.85755 2.09442 8.52486 2.09442C9.18284 2.09442 9.60749 2.43508 9.65882 2.99039H10.9094C10.8674 1.78643 9.92015 0.997795 8.51086 0.997795C7.05492 0.997795 6.12628 1.79577 6.12628 3.05105C6.12628 4.04968 6.72359 4.69366 7.94155 4.96898L8.64153 5.13231C9.42083 5.30497 9.71949 5.54763 9.71949 6.00495C9.71949 6.55093 9.2575 6.90092 8.52953 6.90092C7.76422 6.90092 7.28824 6.56493 7.22758 5.98162H5.97695Z"}),/* @__PURE__ */jsxRuntime.jsx("path",{d:"M16.9852 5.01565V3.98435C16.9852 2.11309 16.0099 0.997795 14.3953 0.997795C12.7807 0.997795 11.8054 2.11309 11.8054 3.98435V5.01565C11.8054 6.88692 12.7807 8.00221 14.3953 8.00221C16.0099 8.00221 16.9852 6.88692 16.9852 5.01565ZM14.3953 6.82625C13.5833 6.82625 13.154 6.21494 13.154 5.00165V3.99835C13.154 2.78506 13.5833 2.17375 14.3953 2.17375C15.2073 2.17375 15.6366 2.78506 15.6366 3.99835V5.00165C15.6366 6.21494 15.2073 6.82625 14.3953 6.82625Z"})]});const LoginProviderLogo=_ref550=>{let{provider}=_ref550;const isSaml=provider==null?void 0:provider.startsWith("saml-");const logoName=isSaml?"saml":provider;return/* @__PURE__ */jsxRuntime.jsxs(Root$5,{"data-logo":logoName,children:[provider==="google"&&Google,provider==="github"&&GitHub,provider==="sanity"&&/* @__PURE__ */jsxRuntime.jsx(logos.SanityMonogram,{}),isSaml&&Saml]});};function ManageMenu(){const{currentUser,projectId}=useWorkspace();const isAdmin=Boolean(currentUser&&userHasRole(currentUser,"administrator"));const{t}=useTranslation();return/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:"a","aria-label":t("user-menu.action.manage-project-aria-label"),href:"https://sanity.io/manage/project/".concat(projectId),target:"_blank",text:t("user-menu.action.manage-project"),icon:icons.CogIcon}),isAdmin&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{as:"a","aria-label":t("user-menu.action.invite-members-aria-label"),href:"https://sanity.io/manage/project/".concat(projectId,"/members"),target:"_blank",text:t("user-menu.action.invite-members"),icon:icons.UsersIcon})]});}var __freeze$j=Object.freeze;var __defProp$j=Object.defineProperty;var __template$j=(cooked,raw)=>__freeze$j(__defProp$j(cooked,"raw",{value:__freeze$j(raw||cooked.slice())}));var _a$j,_b$d;const StyledMenu=styled__default.default(ui.Menu)(_a$j||(_a$j=__template$j(["\n  min-width: 200px;\n  max-width: 300px;\n"])));const AvatarBox=styled__default.default(ui.Box)(_b$d||(_b$d=__template$j(["\n  position: relative;\n  min-width: ","px;\n  min-height: ","px;\n"])),_ref551=>{let{theme}=_ref551;return theme.sanity.avatar.sizes[2].size;},_ref552=>{let{theme}=_ref552;return theme.sanity.avatar.sizes[2].size;});function UserMenu(){const{currentUser,auth}=useWorkspace();const scheme=useColorSchemeValue();const setScheme=useColorSchemeSetValue();const providerTitle=getProviderTitle(currentUser==null?void 0:currentUser.provider);const{t}=useTranslation();const popoverProps=React.useMemo(()=>({placement:"bottom",portal:true,preventOverflow:true,scheme,constrainSize:true}),[scheme]);return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuButton,{button:/* @__PURE__ */jsxRuntime.jsx(ui.Button,{mode:"bleed",padding:0,radius:"full",children:/* @__PURE__ */jsxRuntime.jsx(UserAvatar,{size:1,user:"me"})}),id:"user-menu",menu:/* @__PURE__ */jsxRuntime.jsxs(StyledMenu,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.Card,{padding:2,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{disabled:!providerTitle,portal:true,content:t("user-menu.login-provider",{providerTitle}),children:/* @__PURE__ */jsxRuntime.jsxs(AvatarBox,{marginRight:3,children:[/* @__PURE__ */jsxRuntime.jsx(UserAvatar,{size:2,user:"me"}),(currentUser==null?void 0:currentUser.provider)&&/* @__PURE__ */jsxRuntime.jsx(LoginProviderLogo,{provider:currentUser.provider})]})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{space:2,flex:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",textOverflow:"ellipsis",children:currentUser==null?void 0:currentUser.name}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,muted:true,textOverflow:"ellipsis",children:currentUser==null?void 0:currentUser.email})]})]})}),setScheme&&/* @__PURE__ */jsxRuntime.jsx(AppearanceMenu,{setScheme}),/* @__PURE__ */jsxRuntime.jsx(LocaleMenu,{}),/* @__PURE__ */jsxRuntime.jsx(ManageMenu,{}),auth.logout&&/* @__PURE__ */jsxRuntime.jsxs(jsxRuntime.Fragment,{children:[/* @__PURE__ */jsxRuntime.jsx(ui.MenuDivider,{}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.MenuItem,{iconRight:icons.LeaveIcon,text:t("user-menu.action.sign-out"),disabled:!auth.logout,...(auth.logout&&{onClick:auth.logout})})]})]}),popover:popoverProps});}var __freeze$i=Object.freeze;var __defProp$i=Object.defineProperty;var __template$i=(cooked,raw)=>__freeze$i(__defProp$i(cooked,"raw",{value:__freeze$i(raw||cooked.slice())}));var _a$i,_b$c,_c$7;const RootLayer=styled__default.default(ui.Layer)(_a$i||(_a$i=__template$i(["\n  min-height: auto;\n  position: relative;\n\n  &[data-search-open='true'] {\n    top: 0;\n    position: sticky;\n  }\n"])));const RootCard=styled__default.default(ui.Card)(_b$c||(_b$c=__template$i(["\n  line-height: 0;\n"])));const NavGrid=styled__default.default(ui.Grid)(_c$7||(_c$7=__template$i(["\n  grid-template-columns: auto auto auto;\n  @media screen and (min-width: ",") {\n    grid-template-columns: 1fr auto 1fr;\n  }\n"])),_ref553=>{let{theme}=_ref553;return"".concat(theme.sanity.media[3],"px");});function StudioNavbar(props){const{__internal_rightSectionNode=null}=props;const{name,tools}=useWorkspace();const routerState=router.useRouterState();const mediaIndex=ui.useMediaIndex();const activeToolName=typeof routerState.tool==="string"?routerState.tool:void 0;const newDocumentOptions=useNewDocumentOptions();const{t}=useTranslation();const{onSearchFullscreenOpenChange,onSearchOpenChange,searchFullscreenOpen,searchFullscreenPortalEl,searchOpen}=React.useContext(NavbarContext);const ToolMenu=useToolMenuComponent();const[drawerOpen,setDrawerOpen]=React.useState(false);const routerStateRef=React.useRef(routerState);const workspaceNameRef=React.useRef(name);React.useEffect(()=>{if(routerStateRef.current.tool!==routerState.tool||name!==workspaceNameRef.current){setDrawerOpen(false);}routerStateRef.current=routerState;workspaceNameRef.current=name;},[name,routerState]);const[drawerButtonEl,setDrawerButtonEl]=React.useState(null);const[searchOpenButtonEl,setSearchOpenButtonEl]=React.useState(null);const shouldRender=React.useMemo(()=>({resources:mediaIndex>1,collapsedPresenceMenu:mediaIndex<=1,loginStatus:mediaIndex>1,searchFullscreen:mediaIndex<=1,configIssues:mediaIndex>1&&isDev,newDocumentFullscreen:mediaIndex<=1,tools:mediaIndex>=3}),[mediaIndex]);React.useEffect(()=>{onSearchFullscreenOpenChange(searchFullscreenOpen);},[searchFullscreenOpen,onSearchFullscreenOpenChange]);React.useEffect(()=>{if(shouldRender.searchFullscreen){onSearchOpenChange(false);}else{onSearchFullscreenOpenChange(false);}},[onSearchFullscreenOpenChange,onSearchOpenChange,shouldRender.searchFullscreen]);const handleOpenSearch=React.useCallback(()=>{onSearchOpenChange(true);},[onSearchOpenChange]);const handleOpenSearchFullscreen=React.useCallback(()=>{onSearchFullscreenOpenChange(true);},[onSearchFullscreenOpenChange]);const handleCloseSearch=React.useCallback(()=>{onSearchOpenChange(false);},[onSearchOpenChange]);const handleCloseSearchFullscreen=React.useCallback(()=>{onSearchFullscreenOpenChange(false);searchOpenButtonEl==null?void 0:searchOpenButtonEl.focus();},[onSearchFullscreenOpenChange,searchOpenButtonEl]);const handleCloseDrawer=React.useCallback(()=>{setDrawerOpen(false);drawerButtonEl==null?void 0:drawerButtonEl.focus();},[drawerButtonEl]);const handleOpenDrawer=React.useCallback(()=>{setDrawerOpen(true);},[]);return/* @__PURE__ */jsxRuntime.jsx(FreeTrialProvider,{children:/* @__PURE__ */jsxRuntime.jsxs(RootLayer,{zOffset:100,"data-search-open":searchFullscreenOpen,children:[/* @__PURE__ */jsxRuntime.jsx(RootCard,{borderBottom:true,"data-testid":"studio-navbar","data-ui":"Navbar",padding:3,sizing:"border",children:/* @__PURE__ */jsxRuntime.jsxs(NavGrid,{gap:1,children:[/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.TooltipDelayGroupProvider,{children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:2,justify:"flex-start",children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:2,children:[!shouldRender.tools&&/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{mode:"bleed",icon:icons.MenuIcon,onClick:handleOpenDrawer,ref:setDrawerButtonEl,tooltipProps:{content:t("user-menu.open-menu"),placement:"bottom"}}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:1,children:[/* @__PURE__ */jsxRuntime.jsx(HomeButton,{}),/* @__PURE__ */jsxRuntime.jsx(WorkspaceMenuButton,{})]})]}),/* @__PURE__ */jsxRuntime.jsx(NewDocumentButton,{...newDocumentOptions,modal:shouldRender.newDocumentFullscreen?"dialog":"popover"}),!shouldRender.searchFullscreen&&/* @__PURE__ */jsxRuntime.jsx(SearchButton,{onClick:handleOpenSearch,ref:setSearchOpenButtonEl})]})}),/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center",justify:"center",children:shouldRender.tools&&/* @__PURE__ */jsxRuntime.jsx(ToolMenu,{activeToolName,closeSidebar:handleCloseDrawer,context:"topbar",isSidebarOpen:false,tools})}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.TooltipDelayGroupProvider,{children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:1,justify:"flex-end",children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.LayerProvider,{children:/* @__PURE__ */jsxRuntime.jsx(SearchProvider,{fullscreen:shouldRender.searchFullscreen,children:/* @__PURE__ */jsxRuntime.jsx(ui.BoundaryElementProvider,{element:document.body,children:shouldRender.searchFullscreen?/* @__PURE__ */jsxRuntime.jsx(ui.PortalProvider,{element:searchFullscreenPortalEl,children:/* @__PURE__ */jsxRuntime.jsx(SearchDialog,{onClose:handleCloseSearchFullscreen,onOpen:handleOpenSearchFullscreen,open:searchFullscreenOpen})}):/* @__PURE__ */jsxRuntime.jsx(SearchPopover,{onClose:handleCloseSearch,onOpen:handleOpenSearch,open:searchOpen})})})}),shouldRender.tools&&/* @__PURE__ */jsxRuntime.jsx(FreeTrial,{type:"topbar"}),shouldRender.configIssues&&/* @__PURE__ */jsxRuntime.jsx(ConfigIssuesButton,{}),shouldRender.resources&&/* @__PURE__ */jsxRuntime.jsx(ResourcesButton,{}),/* @__PURE__ */jsxRuntime.jsx(PresenceMenu,{}),shouldRender.searchFullscreen&&/* @__PURE__ */jsxRuntime.jsx(SearchButton,{onClick:handleOpenSearchFullscreen,ref:setSearchOpenButtonEl}),// eslint-disable-next-line camelcase
__internal_rightSectionNode]}),shouldRender.tools&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:"none",marginLeft:1,children:/* @__PURE__ */jsxRuntime.jsx(UserMenu,{})})]})})]})}),!shouldRender.tools&&/* @__PURE__ */jsxRuntime.jsx(NavDrawer,{activeToolName,isOpen:drawerOpen,onClose:handleCloseDrawer,tools})]})});}var __freeze$h=Object.freeze;var __defProp$h=Object.defineProperty;var __template$h=(cooked,raw)=>__freeze$h(__defProp$h(cooked,"raw",{value:__freeze$h(raw||cooked.slice())}));var _a$h,_b$b;function _isReactElement(node){return Boolean(node);}const OptionObserveElement=styled__default.default(ObserveElement)(_a$h||(_a$h=__template$h(["\n  list-style: none;\n  white-space: nowrap;\n  flex-shrink: 0;\n  opacity: 0;\n  visibility: hidden;\n"])));const HiddenRow=styled__default.default(ui.Flex)(_b$b||(_b$b=__template$h(["\n  opacity: 0;\n  height: 0.1px;\n  overflow: hidden;\n"])));const CollapseTabList=React.forwardRef(function CollapseTabList2(props,ref){const{children:childrenProp,gap,menuButtonProps,disableRestoreFocusOnClose,onMenuClose,collapsed,...rest}=props;const[rootEl,setRootEl]=React.useState(null);const[hiddenElements,setHiddenElements]=React.useState([]);const[showChildren,setShowChildren]=React.useState(false);const children=React.useMemo(()=>React.Children.toArray(childrenProp).filter(_isReactElement),[childrenProp]);const displayChildren=React.useMemo(()=>{if(collapsed)return null;if(!showChildren)return null;return children.filter(c=>!hiddenElements.some(h=>h.key===c.key));},[children,collapsed,hiddenElements,showChildren]);const intersectionOptions=React.useMemo(()=>({root:rootEl,threshold:1,rootMargin:"1px"}),[rootEl]);const menuButton=React.useMemo(()=>(menuButtonProps==null?void 0:menuButtonProps.button)||/* @__PURE__ */jsxRuntime.jsx(ContextMenuButton,{}),[menuButtonProps]);const menuOptionsArray=React.useMemo(()=>collapsed?children:// eslint-disable-next-line max-nested-callbacks
children.filter(_ref554=>{let{key}=_ref554;return hiddenElements.find(o=>o.key===key);}),[children,hiddenElements,collapsed]);const handleIntersection=React.useCallback((e,child)=>{const isHidden=hiddenElements.some(el=>el.key===child.key);if(!showChildren)setShowChildren(true);const isIntersecting=e.isIntersecting;if(!isHidden&&!isIntersecting)setHiddenElements(prev=>[...prev,child]);if(isHidden&&isIntersecting)setHiddenElements(prev=>prev.filter(el=>el.key!==child.key));},[hiddenElements,showChildren,setShowChildren,setHiddenElements]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{direction:"column",ref,sizing:"border",style:{position:"relative"},...rest,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{justify:"center",gap,flex:1,children:[displayChildren,(hiddenElements.length>0||collapsed)&&/* @__PURE__ */jsxRuntime.jsx(CollapseOverflowMenu,{disableRestoreFocusOnClose,menuButton,menuButtonProps,menuOptions:menuOptionsArray,onMenuClose})]}),/* @__PURE__ */jsxRuntime.jsxs(HiddenRow,{justify:"flex-start",gap,ref:setRootEl,"data-hidden":true,"aria-hidden":"true",children:[React.cloneElement(menuButton,{disabled:true,"aria-hidden":true}),children==null?void 0:children.map(child=>/* @__PURE__ */jsxRuntime.jsx(OptionObserveElement,{options:intersectionOptions,onIntersectionChange:e=>handleIntersection(e[0],child),children:React.cloneElement(child,{disabled:true,"aria-hidden":true,tabIndex:-1})},"".concat(child.key,"_observer")))]})]});});const ToolLink=React.forwardRef(function ToolLink2(props,ref){const{name,...rest}=props;const state=router.useRouterState(React.useCallback(()=>({tool:name,// make sure to clear tool state when navigating to another tool
[name]:void 0}),[name]));return/* @__PURE__ */jsxRuntime.jsx(router.StateLink,{state,...rest,ref});});function ToolCollapseMenu(props){const{activeToolName,tools}=props;const{scheme}=useColorScheme();const[collapseMenuEl,setCollapseMenuEl]=React.useState(null);useRovingFocus({rootElement:collapseMenuEl,navigation:["arrows"]});const menuButtonProps=React.useMemo(()=>({popover:{constrainSize:true,portal:true,scheme}}),[scheme]);const children=React.useMemo(()=>tools.map((tool,index)=>{const title=(tool==null?void 0:tool.title)||startCase__default.default(tool.name);const Link=React.forwardRef(function Link2(linkProps,ref){return/* @__PURE__ */jsxRuntime.jsx(ToolLink,{...linkProps,ref,name:tool.name,children:linkProps.children});});return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{as:Link,"data-as":"a",mode:"bleed",selected:activeToolName===tool.name,text:title},"".concat(tool.name,"-").concat(index));}),[activeToolName,tools]);return/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{justify:"center",marginX:4,children:/* @__PURE__ */jsxRuntime.jsx(CollapseTabList,{"data-testid":"tool-collapse-menu",gap:1,menuButtonProps,ref:setCollapseMenuEl,children})});}function ToolVerticalMenu(props){const{activeToolName,isVisible,tools}=props;return React.useMemo(()=>/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"ul",space:1,children:tools.map(tool=>{const title=(tool==null?void 0:tool.title)||startCase__default.default(tool.name);const Link=React.forwardRef(function Link2(linkProps,ref){return/* @__PURE__ */jsxRuntime.jsx(ToolLink,{...linkProps,ref,name:tool.name,children:linkProps.children});});return/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{as:"li",children:/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{as:Link,justify:"flex-start",mode:"bleed",selected:activeToolName===tool.name,size:"large",tabIndex:isVisible?0:-1,text:title})},tool.name);})}),[activeToolName,isVisible,tools]);}function StudioToolMenu(props){const{context,isSidebarOpen,tools,...restProps}=props;if(tools.length<=1){return null;}if(context==="sidebar"){return/* @__PURE__ */jsxRuntime.jsx(ToolVerticalMenu,{isVisible:isSidebarOpen,tools,...restProps});}return/* @__PURE__ */jsxRuntime.jsx(ToolCollapseMenu,{tools,...restProps});}var __freeze$g=Object.freeze;var __defProp$g=Object.defineProperty;var __template$g=(cooked,raw)=>__freeze$g(__defProp$g(cooked,"raw",{value:__freeze$g(raw||cooked.slice())}));var _a$g;const SCROLLBAR_SIZE=12;const SCROLLBAR_BORDER_SIZE=4;function buildResizeHandleDataUri(hexColor){const encodedStrokeColor=encodeURIComponent(hexColor);const encodedSvg="%3Csvg width='9' height='9' viewBox='0 0 9 9' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 8L8 1' stroke='".concat(encodedStrokeColor,"' stroke-linecap='round'/%3E%3Cpath d='M5 8L8 5' stroke='").concat(encodedStrokeColor,"' stroke-linecap='round'/%3E%3C/svg%3E%0A");return'url("data:image/svg+xml,'.concat(encodedSvg,'")');}const GlobalStyle=styled.createGlobalStyle(props=>{const{color,font}=theme.getTheme_v2(props.theme);return styled.css(_a$g||(_a$g=__template$g(["\n    ::-webkit-resizer {\n      background-image: ",";\n      background-repeat: no-repeat;\n      background-position: bottom right;\n    }\n\n    ::-webkit-scrollbar {\n      width: ","px;\n      height: ","px;\n    }\n\n    ::-webkit-scrollbar-corner {\n      background-color: transparent;\n    }\n\n    ::-webkit-scrollbar-thumb {\n      background-clip: content-box;\n      background-color: var(--card-border-color, ",");\n      border: ","px solid transparent;\n    }\n\n    ::-webkit-scrollbar-thumb:hover {\n      background-color: var(--card-muted-fg-color, ",");\n    }\n\n    ::-webkit-scrollbar-track {\n      background: transparent;\n    }\n\n    *::selection {\n      background-color: ",";\n    }\n\n    html {\n      background-color: ",";\n    }\n\n    body {\n      scrollbar-gutter: stable;\n    }\n\n    #sanity {\n      font-family: ",";\n    }\n\n    b {\n      font-weight: ",";\n    }\n\n    strong {\n      font-weight: ",";\n    }\n  "])),buildResizeHandleDataUri(color.icon),SCROLLBAR_SIZE,SCROLLBAR_SIZE,color.border,SCROLLBAR_BORDER_SIZE,color.muted.fg,theme.rgba(color.focusRing,0.3),color.bg,font.text.family,font.text.weights.medium,font.text.weights.medium);});const errorChannel=globalScope.__sanityErrorChannel;function ErrorLogger(){const{push:pushToast}=ui.useToast();React.useEffect(()=>{if(!errorChannel)return void 0;return errorChannel.subscribe(msg=>{if(!msg.error){return;}if(isKnownError(msg.error)){return;}console.error(msg.error);pushToast({// Use the error message as the ID in order to prevent duplicates from showing
// A bit of a hack, but serves
id:msg.error.message,closable:true,description:msg.error.message,duration:5e3,title:"Uncaught error",status:"error"});});},[pushToast]);return null;}function isKnownError(err){if(err instanceof SchemaError){return true;}if(err instanceof CorsOriginError){return true;}if(err instanceof ConfigResolutionError){return true;}return false;}function AuthBoundary(_ref555){let{children,AuthenticateComponent=AuthenticateScreen,LoadingComponent=LoadingBlock,NotAuthenticatedComponent=NotAuthenticatedScreen}=_ref555;const[error,handleError]=React.useState(null);if(error)throw error;const[loggedIn,setLoggedIn]=React.useState("loading");const{activeWorkspace}=useActiveWorkspace();React.useEffect(()=>{var _a,_b;(_b=(_a=activeWorkspace.auth).handleCallbackUrl)==null?void 0:_b.call(_a).catch(handleError);},[activeWorkspace.auth]);React.useEffect(()=>{const subscription=activeWorkspace.auth.state.subscribe({next:_ref556=>{let{authenticated,currentUser}=_ref556;var _a;if(((_a=currentUser==null?void 0:currentUser.roles)==null?void 0:_a.length)===0){setLoggedIn("unauthorized");return;}setLoggedIn(authenticated?"logged-in":"logged-out");},error:handleError});return()=>{subscription.unsubscribe();};},[activeWorkspace]);if(loggedIn==="loading")return/* @__PURE__ */jsxRuntime.jsx(LoadingComponent,{});if(loggedIn==="unauthorized")return/* @__PURE__ */jsxRuntime.jsx(NotAuthenticatedComponent,{});if(loggedIn==="logged-out")return/* @__PURE__ */jsxRuntime.jsx(AuthenticateComponent,{});return/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children});}const Z_OFFSET={toast:[100,11e3]};const sessionId=telemetry.createSessionId();function StudioTelemetryProvider(props){const client=useClient({apiVersion:"v2023-12-18"});const projectId=client.config().projectId;const store=React.useMemo(()=>{return telemetry.createBatchedStore(sessionId,{// submit any pending events every <n> ms
flushInterval:3e4,// implements user consent resolving
resolveConsent:()=>client.request({uri:"/intake/telemetry-status"}),// implements sending events to backend
sendEvents:batch=>client.request({uri:"/intake/batch",method:"POST",json:true,body:{projectId,batch}}),// opts into a different strategy for sending events when the browser close, reload or navigate away from the current page
sendBeacon:batch=>navigator.sendBeacon(client.getUrl("/intake/batch"),JSON.stringify({projectId,batch}))});},[client,projectId]);React.useEffect(()=>{store.logger.updateUserProperties({userAgent:navigator.userAgent,screen:{density:window.devicePixelRatio,height:window.screen.height,width:window.screen.width,innerHeight:window.innerHeight,innerWidth:window.innerWidth},studioVersion:SANITY_VERSION,plugins:arrify__default.default(props.config).flatMap(config=>{var _a;return((_a=config.plugins)==null?void 0:_a.flatMap(plugin=>({name:plugin.name||"<unnamed>"})))||[];})});},[props.config,store.logger]);return/* @__PURE__ */jsxRuntime.jsx(react.TelemetryProvider,{store,children:props.children});}const defaultTheme=theme.buildTheme();const isThemerTheme=theme=>theme.__themer===true;function getThemeValues(theme){var _a,_b;return{...defaultTheme,v2:theme.v2,fonts:isThemerTheme(theme)?defaultTheme.fonts:(_a=theme.fonts)!=null?_a:defaultTheme.fonts,color:(_b=theme.color)!=null?_b:defaultTheme.color};}function StudioThemeProvider(_ref557){let{children}=_ref557;const theme=useActiveWorkspace().activeWorkspace.theme;if(theme.__legacy){const scheme=theme.__dark?"dark":"light";return/* @__PURE__ */jsxRuntime.jsx(ColorSchemeSetValueContext.Provider,{value:false,children:/* @__PURE__ */jsxRuntime.jsx(ColorSchemeValueContext.Provider,{value:scheme,children:/* @__PURE__ */jsxRuntime.jsx(ui.ThemeProvider,{scheme,theme:getThemeValues(theme),children:/* @__PURE__ */jsxRuntime.jsx(ui.LayerProvider,{children})})})});}return/* @__PURE__ */jsxRuntime.jsx(ui.ThemeProvider,{theme:getThemeValues(theme),children:/* @__PURE__ */jsxRuntime.jsx(ui.LayerProvider,{children})});}var __freeze$f=Object.freeze;var __defProp$f=Object.defineProperty;var __template$f=(cooked,raw)=>__freeze$f(__defProp$f(cooked,"raw",{value:__freeze$f(raw||cooked.slice())}));var _a$f,_b$a;styled__default.default(ui.Flex)(_a$f||(_a$f=__template$f([""])));styled__default.default(ui.Box).attrs({padding:4})(_b$a||(_b$a=__template$f([""])));function createRouter(opts){const{basePath="/",tools}=opts;const toolRoute=router.route.create("/:tool",toolParams=>{let tool=tools.find(current=>current.name===toolParams.tool);if(!tool&&toolParams.tool==="desk"){tool=tools.find(current=>current.name==="structure");}return tool?router.route.scope(tool.name,"/",tool.router):router.route.create("/");});return router.route.create(basePath,[router.route.intents("/intent"),toolRoute]);}function getOrderedTools(tools){const pluginConfig={};const config=pluginConfig.toolSwitcher||{};const order=config.order||[];const hidden=config.hidden||[];if(!order.length&&!hidden.length){return tools;}const keyed=tools.reduce((target,tool)=>{const title=tool.title||"<unknown>";if(!tool.name){console.warn('Tool "'.concat(title,'" does not have the required "name" property'));return target;}if(target[tool.name]){const existing=target[tool.name].tool.title;console.warn('Tools with duplicate name "'.concat(tool.name,'" found ("').concat(title,'" and "').concat(existing,'")'));return target;}const toolIndex=order.indexOf(tool.name);target[tool.name]={tool,index:toolIndex===-1?Infinity:toolIndex};return target;},{});const isVisible=tool=>hidden.indexOf(tool.name)===-1;const ret=tools.filter(isVisible);ret.sort((tool1,tool2)=>{const toolA=keyed[tool1.name];const toolB=keyed[tool2.name];const indexA=toolA?toolA.index:Infinity;const indexB=toolB?toolB.index:Infinity;if(indexA===indexB){return 0;}return indexA-indexB;});return ret;}const WEIGHTED_CREATE_INTENT_PARAMS=["template"];const WEIGHTED_EDIT_INTENT_PARAMS=["mode"];function resolveUrlStateWithDefaultTool(tools,state){const orderedTools=getOrderedTools(tools);const defaultTool=orderedTools[0];if(!state||state.tool||!defaultTool){return state;}return Object.assign({},state,{tool:defaultTool.name});}function makeBackwardsCompatible(tools,state){if(!state){return state;}if(getOrderedTools(tools).find(tool=>tool.name===state.space)){return{...state,tool:state.space,space:void 0};}return state;}function resolveDefaultState(tools,state){const urlStateWithDefaultTool=resolveUrlStateWithDefaultTool(tools,makeBackwardsCompatible(tools,state));return urlStateWithDefaultTool;}function resolveIntentState(tools,prevState,nextState){var _a;const{intent,params,payload}=nextState;if(typeof intent!=="string"){throw new Error("intent must be a string");}if(!isRecord$4(params)){throw new Error("intent params must be a string");}const orderedTools=getOrderedTools(tools);const currentTool=(prevState==null?void 0:prevState.tool)?orderedTools.find(tool=>tool.name===prevState.tool):null;const otherTools=currentTool?orderedTools.filter(tool=>tool!==currentTool):orderedTools;let weightedParams=[];if(intent==="create"){weightedParams=WEIGHTED_CREATE_INTENT_PARAMS;}else if(intent==="edit"){weightedParams=WEIGHTED_EDIT_INTENT_PARAMS;}const initialMatch={score:-1,tool:null};const{tool:matchingTool}=(currentTool?[currentTool,...otherTools]:orderedTools).reduce((prev,tool)=>{if(!tool||typeof tool.canHandleIntent!=="function"){return prev;}const canHandle=tool.canHandleIntent(intent,params,prevState&&prevState[tool.name]);if(typeof canHandle==="boolean"){return canHandle&&prev.score<0?{score:0,tool}:prev;}if(!isRecord$4(canHandle)){return prev;}const score=weightedParams.reduce((prevScore,weightedParam)=>{return weightedParam in params&&canHandle[weightedParam]===true?prevScore+1:prevScore;},0);return score>prev.score?{score,tool}:prev;},initialMatch);if(matchingTool==null?void 0:matchingTool.getIntentState){const _toolState=matchingTool.getIntentState(intent,params,prevState&&prevState[matchingTool.name],payload);const{_searchParams,...toolState}=_toolState;const nextUrlState={...prevState,tool:matchingTool.name,[matchingTool.name]:toolState};if((_a=matchingTool.router)==null?void 0:_a.__unsafe_disableScopedSearchParams){nextUrlState._searchParams=_searchParams;}else{toolState._searchParams=_searchParams;}return{type:"state",isNotFound:false,state:nextUrlState};}return{type:"intent",isNotFound:true,intent:{name:intent,params}};}function decodeUrlState(rootRouter,pathname){return{type:"state",state:rootRouter.decode(pathname)||{},isNotFound:rootRouter.isNotFound(pathname)};}function WorkspaceRouterProvider(_ref558){let{children,LoadingComponent,workspace}=_ref558;const{basePath,tools}=workspace;const history=useRouterHistory();const router$1=React.useMemo(()=>createRouter({basePath,tools}),[basePath,tools]);const[state,onNavigate]=useRouterFromWorkspaceHistory(history,router$1,tools);if(!state)return/* @__PURE__ */jsxRuntime.jsx(LoadingComponent,{});return/* @__PURE__ */jsxRuntime.jsx(router.RouterProvider,{onNavigate,router:router$1,state,children});}function useRouterFromWorkspaceHistory(history,router,tools){var _a;const store=React.useMemo(()=>{const routerBasePath=router.getBasePath();const routerBasePathRegex=new RegExp("^".concat(escapeRegExp__default.default(routerBasePath),"(\\/|$)"),"i");const shouldHandle=pathname=>// this is necessary to prevent emissions intended for other workspaces.
routerBasePath==="/"?true:routerBasePathRegex.test(pathname);return{subscribe:onStoreChange=>history.listen(onStoreChange),getSnapshot:()=>"".concat(history.location.pathname).concat(history.location.search||""),// Always return null for the server snapshot, as we can't know how to resolve intents until after authentication is done, which is browser-only
getServerSnapshot:()=>null,selector:pathname=>typeof pathname==="string"&&shouldHandle(pathname)?decodeUrlState(router,pathname):null};},[history,router]);const event=withSelector.useSyncExternalStoreWithSelector(store.subscribe,store.getSnapshot,store.getServerSnapshot,store.selector,isEqual__default.default);const prevEvent=React.useRef(event);React.useEffect(()=>{var _a2;if((event==null?void 0:event.type)==="state"&&!((_a2=event.state)==null?void 0:_a2.intent)){const defaultState=resolveDefaultState(tools,event.state);if(defaultState&&defaultState!==event.state){history.replace(router.encode(defaultState));}}},[event==null?void 0:event.state,event==null?void 0:event.type,history,router,tools]);React.useEffect(()=>{const resolvedIntent=maybeResolveIntent(event,router,tools,prevEvent);if(resolvedIntent){history.replace(resolvedIntent);}else{prevEvent.current=event;}},[event,history,router,tools]);const handleNavigate=React.useMemo(()=>{return _ref559=>{let{path,replace}=_ref559;const predictedEvent=store.selector(path);const resolvedIntent=maybeResolveIntent(predictedEvent,router,tools,prevEvent);const resolvedPath=typeof resolvedIntent==="string"?resolvedIntent:path;if(replace){history.replace(resolvedPath);}else{history.push(resolvedPath);}};},[history,router,store,tools]);return[(_a=event==null?void 0:event.state)!=null?_a:null,handleNavigate];}function maybeResolveIntent(event,router,tools,prevEvent){var _a,_b;if((event==null?void 0:event.type)==="state"&&((_a=event.state)==null?void 0:_a.intent)){const redirectState=resolveIntentState(tools,((_b=prevEvent.current)==null?void 0:_b.type)==="state"?prevEvent.current.state:{},event.state);if((redirectState==null?void 0:redirectState.type)==="state"){return router.encode(redirectState.state);}}return null;}function WorkspaceLoader(_ref560){let{children,LoadingComponent}=_ref560;const[error,handleError]=React.useState(null);if(error)throw error;const{activeWorkspace}=useActiveWorkspace();const[workspace,setWorkspace]=React.useState(null);React.useEffect(()=>{const subscription=rxjs.combineLatest(activeWorkspace.__internal.sources.map(_ref561=>{let{source}=_ref561;return source.pipe(operators.catchError(err=>{if(err instanceof ConfigResolutionError)return rxjs.of(err);throw err;}));})).pipe(operators.map(results=>{const errors=results.filter(result=>result instanceof ConfigResolutionError);if(errors.length){throw new ConfigResolutionError({name:activeWorkspace.name,causes:errors,type:"workspace"});}return results;}),operators.map(_ref562=>{let[rootSource,...restOfSources]=_ref562;return{...activeWorkspace,...rootSource,unstable_sources:[rootSource,...restOfSources],type:"workspace"};})).subscribe({next:setWorkspace,error:handleError});return()=>subscription.unsubscribe();},[activeWorkspace]);if(!workspace)return/* @__PURE__ */jsxRuntime.jsx(LoadingComponent,{});return/* @__PURE__ */jsxRuntime.jsx(WorkspaceProvider,{workspace,children:/* @__PURE__ */jsxRuntime.jsx(SourceProvider,{source:workspace.unstable_sources[0],children:/* @__PURE__ */jsxRuntime.jsx(WorkspaceRouterProvider,{LoadingComponent,workspace,children})})});}function WorkspaceLoaderBoundary(_ref563){let{ConfigErrorsComponent,...props}=_ref563;const[{error},setError]=React.useState({error:null});if(error)throw error;return/* @__PURE__ */jsxRuntime.jsx(ui.ErrorBoundary,{onCatch:setError,children:/* @__PURE__ */jsxRuntime.jsx(WorkspaceLoader,{...props})});}Refractor__default.default.registerLanguage(bash__default.default);Refractor__default.default.registerLanguage(javascript__default.default);Refractor__default.default.registerLanguage(json__default.default);Refractor__default.default.registerLanguage(jsx2__default.default);Refractor__default.default.registerLanguage(typescript__default.default);function StudioProvider(_ref564){let{children,config,basePath,onSchemeChange,scheme,unstable_history:history,unstable_noAuthBoundary:noAuthBoundary}=_ref564;const _children=/* @__PURE__ */jsxRuntime.jsx(WorkspaceLoaderBoundary,{LoadingComponent:LoadingBlock,ConfigErrorsComponent:ConfigErrorsScreen,children:/* @__PURE__ */jsxRuntime.jsx(StudioTelemetryProvider,{config,children:/* @__PURE__ */jsxRuntime.jsx(LocaleProvider,{children:/* @__PURE__ */jsxRuntime.jsx(ResourceCacheProvider,{children})})})});return/* @__PURE__ */jsxRuntime.jsx(ColorSchemeProvider,{onSchemeChange,scheme,children:/* @__PURE__ */jsxRuntime.jsxs(ui.ToastProvider,{paddingY:7,zOffset:Z_OFFSET.toast,children:[/* @__PURE__ */jsxRuntime.jsx(ErrorLogger,{}),/* @__PURE__ */jsxRuntime.jsx(StudioErrorBoundary,{children:/* @__PURE__ */jsxRuntime.jsx(WorkspacesProvider,{config,basePath,children:/* @__PURE__ */jsxRuntime.jsx(ActiveWorkspaceMatcher,{unstable_history:history,NotFoundComponent:NotFoundScreen,LoadingComponent:LoadingBlock,children:/* @__PURE__ */jsxRuntime.jsx(StudioThemeProvider,{children:/* @__PURE__ */jsxRuntime.jsx(UserColorManagerProvider,{children:noAuthBoundary?_children:/* @__PURE__ */jsxRuntime.jsx(AuthBoundary,{LoadingComponent:LoadingBlock,AuthenticateComponent:AuthenticateScreen,NotAuthenticatedComponent:NotAuthenticatedScreen,children:_children})})})})})})]})});}function useClient(clientOptions){const source=useSource();if(!clientOptions){console.warn('Calling `useClient()` without specifying an API version is deprecated and will stop working in the next dev-preview release - please migrate to use `useClient({apiVersion: "2021-06-07"})`.');return source.getClient({apiVersion:"2021-06-07"});}return source.getClient(clientOptions);}function useDataset(){return useSource().dataset;}function useDocumentOperation(publishedDocId,docTypeName){const documentStore=useDocumentStore();return reactRx.useMemoObservable(()=>documentStore.pair.editOperations(publishedDocId,docTypeName),[docTypeName,documentStore.pair,publishedDocId]);}const INITIAL_LOADING_STATE={isLoading:true,enabled:true,features:[]};function fetchFeatures(_ref565){let{versionedClient}=_ref565;return versionedClient.observable.request({uri:"/features",tag:"features"});}const cachedFeatureRequest=/* @__PURE__ */new Map();function useFeatureEnabled(featureKey){const versionedClient=useClient(DEFAULT_STUDIO_CLIENT_OPTIONS);const{projectId}=useSource();if(!cachedFeatureRequest.get(projectId)){const features=fetchFeatures({versionedClient}).pipe(operators.shareReplay(),operators.catchError(error=>{console.error(error);return rxjs.of([]);}));cachedFeatureRequest.set(projectId,features);}const featureInfo=reactRx.useMemoObservable(()=>(cachedFeatureRequest.get(projectId)||rxjs.of([])).pipe(operators.map(function(){let features=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return{isLoading:false,enabled:Boolean(features==null?void 0:features.includes(featureKey)),features};}),operators.startWith(INITIAL_LOADING_STATE),operators.catchError(err=>{console.error(err);return rxjs.of({isLoading:false,enabled:true,features:[]});})),[featureKey,projectId],INITIAL_LOADING_STATE);return featureInfo;}function useListFormat(){let options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};const currentLocale=useCurrentLocale().id;return intlCache.listFormat(currentLocale,options);}function useProjectId(){return useSource().projectId;}const FIVE_SECONDS=1e3*5;const TWENTY_SECONDS=1e3*20;const ONE_MINUTE=1e3*60;const ONE_HOUR=ONE_MINUTE*60;const NO_YEAR_DATE_ONLY_FORMAT={month:"short",day:"numeric"};const DATE_ONLY_FORMAT={...NO_YEAR_DATE_ONLY_FORMAT,year:"numeric"};const FULL_DATE_FORMAT={...DATE_ONLY_FORMAT,hour:"numeric",minute:"numeric"};function useRelativeTime(time){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const resolved=useFormatRelativeTime(time,options);const[,forceUpdate]=React.useReducer(x=>x+1,0);React.useEffect(()=>{let timerId;function tick(interval){timerId=window.setTimeout(()=>{forceUpdate();timerId=window.setTimeout(()=>tick(interval),interval);},interval);}if(resolved.refreshInterval!==null){tick(resolved.refreshInterval);}return()=>{if(timerId!==null){clearTimeout(timerId);}};},[forceUpdate,resolved.refreshInterval]);return resolved.timestamp;}function useFormatRelativeTime(date){let opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const{t}=useTranslation();const currentLocale=useCurrentLocale().id;const{timeZone,minimal}=opts;const parsedDate=date instanceof Date?date:new Date(date);const useTemporalPhrase=Boolean(opts.useTemporalPhrase);const format=React.useCallback(function formatWithUnit(count,unit){const isNextOrPrevDay=unit==="day"&&Math.abs(count)===1;const isNextOrPrevWeek=unit==="week"&&Math.abs(count)===1;if(useTemporalPhrase||isNextOrPrevDay){return intlCache.relativeTimeFormat(currentLocale,{// Force 'long' formatting for dates within the next/previous week as `Intl.RelativeTimeFormat`
// will display these as `next wk.` or `last wk.`  which we don't want!
// Idiomatic dates should always be displayed in full. There may be a more elegant way to handle this.
style:minimal&&!isNextOrPrevWeek?"short":"long",numeric:"auto"}).format(count,unit);}return intlCache.numberFormat(currentLocale,{style:"unit",unit,unitDisplay:minimal?"short":"long"}).format(Math.abs(count));},[currentLocale,useTemporalPhrase,minimal]);if(!parsedDate.getTime()){return{timestamp:"",refreshInterval:null};}const now=opts.relativeTo||Date.now();const diffMonths=dateFns.differenceInMonths(now,parsedDate);const diffYears=dateFns.differenceInYears(now,parsedDate);if(diffMonths||diffYears){if(opts.minimal&&diffYears===0){return{timestamp:intlCache.dateTimeFormat(currentLocale,{...NO_YEAR_DATE_ONLY_FORMAT,timeZone}).format(parsedDate),refreshInterval:null};}if(opts.minimal){return{timestamp:intlCache.dateTimeFormat(currentLocale,{...DATE_ONLY_FORMAT,timeZone}).format(parsedDate),refreshInterval:null};}return{timestamp:intlCache.dateTimeFormat(currentLocale,{...FULL_DATE_FORMAT,timeZone}).format(parsedDate),refreshInterval:null};}const diffWeeks=dateFns.differenceInWeeks(parsedDate,now);if(diffWeeks){return{timestamp:format(diffWeeks,"week"),refreshInterval:ONE_HOUR};}const diffDays=dateFns.differenceInDays(parsedDate,now);if(diffDays){return{timestamp:format(diffDays,"day"),refreshInterval:ONE_HOUR};}const diffHours=dateFns.differenceInHours(parsedDate,now);if(diffHours){return{timestamp:format(diffHours,"hour"),refreshInterval:ONE_MINUTE};}const diffMins=dateFns.differenceInMinutes(parsedDate,now);if(diffMins){return{timestamp:format(diffMins,"minute"),refreshInterval:TWENTY_SECONDS};}const diffSeconds=dateFns.differenceInSeconds(parsedDate,now);if(Math.abs(diffSeconds)>10){return{timestamp:format(diffSeconds,"second"),refreshInterval:FIVE_SECONDS};}return{timestamp:t("relative-time.just-now"),refreshInterval:FIVE_SECONDS};}function useSchema(){return useSource().schema;}function useTemplates(){return useSource().templates;}var __freeze$e=Object.freeze;var __defProp$e=Object.defineProperty;var __template$e=(cooked,raw)=>__freeze$e(__defProp$e(cooked,"raw",{value:__freeze$e(raw||cooked.slice())}));var _a$e;const StyledText=styled__default.default(ui.Text)(_a$e||(_a$e=__template$e(["\n  white-space: nowrap;\n"])));function DocumentStatus(_ref566){let{absoluteDate,draft,published,singleLine}=_ref566;const{t}=useTranslation();const draftUpdatedAt=draft&&"_updatedAt"in draft?draft._updatedAt:"";const publishedUpdatedAt=published&&"_updatedAt"in published?published._updatedAt:"";const intlDateFormat=useDateTimeFormat({dateStyle:"medium",timeStyle:"short"});const draftDateAbsolute=draftUpdatedAt&&intlDateFormat.format(new Date(draftUpdatedAt));const publishedDateAbsolute=publishedUpdatedAt&&intlDateFormat.format(new Date(publishedUpdatedAt));const draftUpdatedTimeAgo=useRelativeTime(draftUpdatedAt||"",{minimal:true,useTemporalPhrase:true});const publishedUpdatedTimeAgo=useRelativeTime(publishedUpdatedAt||"",{minimal:true,useTemporalPhrase:true});const publishedDate=absoluteDate?publishedDateAbsolute:publishedUpdatedTimeAgo;const updatedDate=absoluteDate?draftDateAbsolute:draftUpdatedTimeAgo;return/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:singleLine?"center":"flex-start",direction:singleLine?"row":"column",gap:2,wrap:"nowrap",children:[!publishedDate&&/* @__PURE__ */jsxRuntime.jsx(StyledText,{size:1,weight:"medium",children:t("document-status.not-published")}),publishedDate&&/* @__PURE__ */jsxRuntime.jsx(StyledText,{size:1,weight:"medium",children:t("document-status.published",{date:publishedDate})}),updatedDate&&/* @__PURE__ */jsxRuntime.jsx(StyledText,{muted:true,size:1,wrap:"nowrap",children:t("document-status.edited",{date:updatedDate})})]});}function useShallowCompareMemoize(value){const ref=React.useRef(void 0);if(!shallowEquals__default.default(value,ref.current)){ref.current=value;}return[ref.current];}function useShallowCompareEffect(callback,dependencies){React.useEffect(callback,useShallowCompareMemoize(dependencies));}const HookStateContainer=React.memo(function HookStateContainer2(props){const{hook,args,id,onNext,onReset,onRequestUpdate}=props;const hookState=hook({...args,onComplete:()=>{onReset(id);}});useShallowCompareEffect(()=>{onNext(id,hookState);onRequestUpdate();return()=>{onNext(id,null);onRequestUpdate();};},hookState);return null;},(prev,next)=>prev.args===next.args);const EMPTY_ARRAY=[];function InsufficientPermissionsMessage(_ref567){let{currentUser,context}=_ref567;const{t}=useTranslation();const list=useListFormat({style:"short",type:"unit"});const roles=(currentUser==null?void 0:currentUser.roles)||EMPTY_ARRAY;const Roles=React.useCallback(()=>/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:list.formatToParts(roles.map(role=>role.title||startCase__default.default(role.name))).map((i,index)=>i.type==="element"?// eslint-disable-next-line react/no-array-index-key
/* @__PURE__ */jsxRuntime.jsx("code",{children:i.value},"".concat(i.value,"-").concat(index)):// eslint-disable-next-line react/no-array-index-key
/* @__PURE__ */jsxRuntime.jsx(React.Fragment,{children:i.value},"".concat(i.value,"-").concat(index)))}),[roles,list]);return/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Inline,{space:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:0,children:/* @__PURE__ */jsxRuntime.jsx(icons.AccessDeniedIcon,{})}),/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,weight:"medium",children:t("insufficient-permissions-message.title")})]}),/* @__PURE__ */jsxRuntime.jsx(ui.Inline,{marginTop:4,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{i18nKey:"insufficient-permissions-message.not-authorized-explanation",t,context})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Inline,{marginTop:4,marginBottom:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,children:/* @__PURE__ */jsxRuntime.jsx(Translate,{i18nKey:"insufficient-permissions-message.roles",t,components:{Roles}})})})]});}const StyledContainer=styled__default.default(ui.Container)(props=>{const{theme}=props;const{container,media}=theme.sanity;return ui._responsive(media,props.$width,val=>({// Make sure that the Container gets the correct width when used inside a popover.
width:val==="auto"?"none":ui.rem(container[val]),// Make sure that the Container width is constrained by available space.
maxWidth:"100%"}));});const PopoverContainer=React.forwardRef(function PopoverContainer2(props,ref){const{width,...restProps}=props;const widthArr=ui.useArrayProp(width);return/* @__PURE__ */jsxRuntime.jsx(StyledContainer,{...restProps,"data-ui":"PopoverContainer",$width:widthArr,ref});});var __freeze$d=Object.freeze;var __defProp$d=Object.defineProperty;var __template$d=(cooked,raw)=>__freeze$d(__defProp$d(cooked,"raw",{value:__freeze$d(raw||cooked.slice())}));var _a$d,_b$9;const StyledPopover=styled__default.default(TooltipDelayGroupProvider.Popover)(()=>{return styled.css(_a$d||(_a$d=__template$d(["\n    // Make the popover scrollable if it overflows the viewport\n    [data-ui='Popover__wrapper'] {\n      overflow: auto;\n    }\n  "])));});const StickyLayer=styled__default.default(ui.Layer)(props=>{const radii=props.theme.sanity.radius[3];return styled.css(_b$9||(_b$9=__template$d(["\n    position: sticky;\n    top: 0;\n    width: 100%;\n    background: var(--card-bg-color);\n    border-bottom: 1px solid var(--card-border-color);\n    border-top-left-radius: ","px;\n    border-top-right-radius: ","px;\n  "])),radii,radii);});function PopoverDialog(props){const{children,header,onClose,referenceElement,containerRef,width}=props;const handleClose=React.useCallback(()=>{onClose();referenceElement==null?void 0:referenceElement.focus();},[onClose,referenceElement]);const content=/* @__PURE__ */jsxRuntime.jsx(PopoverContainer,{width,children:/* @__PURE__ */jsxRuntime.jsx(FocusLock__default.default,{autoFocus:true,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{ref:containerRef,children:[/* @__PURE__ */jsxRuntime.jsx(StickyLayer,{children:/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:2,paddingLeft:4,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",gap:2,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:1,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,textOverflow:"ellipsis",weight:"medium",children:header})}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Button,{icon:icons.CloseIcon,mode:"bleed",onClick:handleClose,tooltipProps:{content:"Close"}})]})})}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:4,children})]})})});return/* @__PURE__ */jsxRuntime.jsx(StyledPopover,{portal:true,constrainSize:true,content,open:true,referenceElement});}var __freeze$c=Object.freeze;var __defProp$c=Object.defineProperty;var __template$c=(cooked,raw)=>__freeze$c(__defProp$c(cooked,"raw",{value:__freeze$c(raw||cooked.slice())}));var _a$c;const StyledCard=styled__default.default(ui.Card)(()=>{return styled.css(_a$c||(_a$c=__template$c(["\n    /* TextWithTone uses its own logic to set color, and we therefore need */\n    /* to override this logic in order to set the correct color in different states */\n    &[data-selected],\n    &[data-pressed],\n    &:active {\n      [data-ui='TextWithTone'] {\n        color: inherit;\n      }\n    }\n  "])));});const PreviewCardContext=React.createContext({selected:false});function usePreviewCard(){const context=React.useContext(PreviewCardContext);if(!context){throw new Error("PreviewCard: missing context value");}return context;}const PreviewCard=React.forwardRef(function PreviewCard2(props,ref){const{children,selected,as,...restProps}=props;return/* @__PURE__ */jsxRuntime.jsx(StyledCard,{"data-ui":"PreviewCard",...restProps,forwardedAs:as,ref,selected,children:/* @__PURE__ */jsxRuntime.jsx(PreviewCardContext.Provider,{value:{selected},children})});});const PREVIEW_SIZES={block:{icon:25,media:{width:33,height:33}},blockImage:{icon:25,media:{width:600,height:400}},compact:{icon:21,media:{width:25,height:25}},default:{icon:21,media:{width:33,height:33}},detail:{icon:25,media:{width:73,height:73}},inline:{icon:15,media:{width:15,height:15}},media:{icon:25,media:{width:160,height:160}}};var __freeze$b=Object.freeze;var __defProp$b=Object.defineProperty;var __template$b=(cooked,raw)=>__freeze$b(__defProp$b(cooked,"raw",{value:__freeze$b(raw||cooked.slice())}));var _a$b;const MediaWrapper=styled__default.default.span(props=>{const{$dimensions,$layout,$radius,$responsive}=props;const width=$dimensions.width||0;const height=$dimensions.width||0;const iconSize=PREVIEW_SIZES[$layout].icon;return styled.css(_a$b||(_a$b=__template$b(["\n    position: relative;\n    width: ",";\n    height: ",";\n    min-width: ",";\n    border-radius: ",";\n    display: flex;\n    overflow: hidden;\n    overflow: clip;\n    align-items: center;\n    justify-content: center;\n\n    & img {\n      position: absolute;\n      left: 0;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      object-fit: contain;\n      border-radius: inherit;\n    }\n\n    & svg {\n      // Shared styles for SVG icons\n      color: var(--card-icon-color);\n      display: block;\n      flex: 1;\n\n      // Specific styles for non Sanity icons\n      &:not([data-sanity-icon]) {\n        height: 1em;\n        width: 1em;\n        max-width: 1em;\n        max-height: 1em;\n      }\n\n      // Specific styles for Sanity icons\n      &[data-sanity-icon] {\n        display: block;\n        font-size: calc("," / 16 * 1em);\n      }\n    }\n\n    & > span[data-border] {\n      display: block;\n      position: absolute;\n      left: 0;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      box-shadow: inset 0 0 0 1px var(--card-fg-color);\n      opacity: 0.1;\n      border-radius: inherit;\n      pointer-events: none;\n    }\n  "])),$responsive?"100%":ui.rem(width),$responsive?"100%":ui.rem(height),$responsive?void 0:ui.rem(width),_ref568=>{let{theme}=_ref568;return ui.rem(theme.sanity.radius[$radius]);},iconSize);});MediaWrapper.displayName="MediaWrapper";function Media(props){const{border=true,dimensions,layout,media,radius=1,responsive=false,styles}=props;return/* @__PURE__ */jsxRuntime.jsxs(MediaWrapper,{$dimensions:dimensions,$layout:layout,$radius:radius,$responsive:responsive,className:styles==null?void 0:styles.media,"data-testid":"Media",children:[renderMedia({dimensions,layout,media}),border&&/* @__PURE__ */jsxRuntime.jsx("span",{"data-border":true})]});}function renderMedia(props){const{dimensions,layout,media,styles}=props;if(reactIs.isValidElementType(media)){return React.createElement(media,{dimensions,layout});}if(typeof media==="string"){return/* @__PURE__ */jsxRuntime.jsx(ui.Text,{as:"span",className:styles==null?void 0:styles.mediaString,size:1,children:media});}if(React.isValidElement(media)){return media;}return null;}function renderPreviewMedia(value,layout,dimensions){if(reactIs.isValidElementType(value)){return React.createElement(value,{layout,dimensions});}if(typeof value==="string"){return/* @__PURE__ */jsxRuntime.jsx("div",{children:value});}return value;}function renderPreviewNode(value,layout,fallbackNode){if(typeof value==="string"){return value;}if(reactIs.isValidElementType(value)){return React.createElement(value,{layout});}return value||fallbackNode;}var __freeze$a=Object.freeze;var __defProp$a=Object.defineProperty;var __template$a=(cooked,raw)=>__freeze$a(__defProp$a(cooked,"raw",{value:__freeze$a(raw||cooked.slice())}));var _a$a,_b$8;const DEFAULT_MEDIA_DIMENSIONS$6={...PREVIEW_SIZES.compact.media,aspect:1,fit:"crop",dpr:useDevicePixelRatio.getDevicePixelRatio()};const Root$4=styled__default.default(ui.Flex)(_a$a||(_a$a=__template$a(["\n  height: ",";\n  box-sizing: content-box;\n"])),ui.rem(PREVIEW_SIZES.compact.media.height));const TitleSkeleton$3=styled__default.default(ui.TextSkeleton).attrs({animated:true,radius:1,size:1})(_b$8||(_b$8=__template$a(["\n  max-width: ",";\n  width: 80%;\n"])),ui.rem(160));function CompactPreview(props){const{children,isPlaceholder,media,status,title}=props;const{t}=useTranslation();const statusNode=status&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{"data-testid":"compact-preview__status",paddingLeft:4,paddingRight:1,children:renderPreviewNode(status,"compact")});if(isPlaceholder){return/* @__PURE__ */jsxRuntime.jsx(Root$4,{align:"center","data-testid":"default-preview",paddingLeft:media?1:2,paddingRight:2,paddingY:1,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",flex:1,gap:2,children:[media&&/* @__PURE__ */jsxRuntime.jsx(ui.Skeleton,{animated:true,radius:2,style:PREVIEW_SIZES.compact.media}),/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{"data-testid":"compact-preview__heading",flex:1,space:2,children:/* @__PURE__ */jsxRuntime.jsx(TitleSkeleton$3,{})}),statusNode]})});}return/* @__PURE__ */jsxRuntime.jsxs(Root$4,{align:"center","data-testid":"compact-preview",paddingLeft:media?1:2,paddingRight:2,paddingY:1,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",flex:1,gap:2,children:[media&&/* @__PURE__ */jsxRuntime.jsx(Media,{border:false,dimensions:DEFAULT_MEDIA_DIMENSIONS$6,layout:"compact",media}),/* @__PURE__ */jsxRuntime.jsx(ui.Stack,{"data-testid":"compact-preview__header",flex:1,space:2,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{size:1,style:{color:"inherit"},textOverflow:"ellipsis",weight:"medium",children:[title&&renderPreviewNode(title,"compact"),!title&&/* @__PURE__ */jsxRuntime.jsx("span",{style:{color:"var(--card-muted-fg-color)"},children:t("preview.default.title-fallback")})]})}),statusNode]}),children&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginLeft:1,children})]});}var __freeze$9=Object.freeze;var __defProp$9=Object.defineProperty;var __template$9=(cooked,raw)=>__freeze$9(__defProp$9(cooked,"raw",{value:__freeze$9(raw||cooked.slice())}));var _a$9,_b$7,_c$6;const DEFAULT_MEDIA_DIMENSIONS$5={...PREVIEW_SIZES.default.media,aspect:1,fit:"crop",dpr:useDevicePixelRatio.getDevicePixelRatio()};const Root$3=styled__default.default(ui.Flex)(_a$9||(_a$9=__template$9(["\n  height: ",";\n  box-sizing: content-box;\n"])),ui.rem(PREVIEW_SIZES.default.media.height));const TitleSkeleton$2=styled__default.default(ui.TextSkeleton).attrs({animated:true,radius:1,size:1})(_b$7||(_b$7=__template$9(["\n  max-width: ",";\n  width: 80%;\n"])),ui.rem(160));const SubtitleSkeleton$2=styled__default.default(ui.TextSkeleton).attrs({animated:true,radius:1,size:1})(_c$6||(_c$6=__template$9(["\n  max-width: ",";\n  width: 60%;\n"])),ui.rem(120));function DefaultPreview(props){const{title,subtitle,media,status,isPlaceholder,children,styles}=props;const{t}=useTranslation();const rootClassName=classNames__default.default(styles==null?void 0:styles.root,Boolean(subtitle)&&(styles==null?void 0:styles.hasSubtitle));const statusNode=status&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{className:styles==null?void 0:styles.status,"data-testid":"default-preview__status",children:renderPreviewNode(status,"default")});if(isPlaceholder){return/* @__PURE__ */jsxRuntime.jsx(Root$3,{align:"center",className:styles==null?void 0:styles.placeholder,"data-testid":"default-preview",padding:2,paddingLeft:media?2:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",flex:1,gap:2,children:[media&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:"none",children:/* @__PURE__ */jsxRuntime.jsx(ui.Skeleton,{animated:true,radius:1,style:PREVIEW_SIZES.default.media})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{"data-testid":"default-preview__heading",flex:1,space:2,children:[/* @__PURE__ */jsxRuntime.jsx(TitleSkeleton$2,{}),/* @__PURE__ */jsxRuntime.jsx(SubtitleSkeleton$2,{})]}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:"none",padding:1,children:statusNode})]})});}return/* @__PURE__ */jsxRuntime.jsx(Root$3,{align:"center",className:rootClassName,"data-testid":"default-preview",padding:2,paddingLeft:media?2:3,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",flex:1,gap:2,children:[media&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:"none",children:/* @__PURE__ */jsxRuntime.jsx(Media,{dimensions:DEFAULT_MEDIA_DIMENSIONS$5,layout:"default",media,styles})}),/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{className:styles==null?void 0:styles.heading,"data-testid":"default-preview__header",flex:1,space:2,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{className:styles==null?void 0:styles.title,size:1,style:{color:"inherit"},textOverflow:"ellipsis",weight:"medium",children:[title&&renderPreviewNode(title,"default"),!title&&/* @__PURE__ */jsxRuntime.jsx("span",{style:{color:"var(--card-muted-fg-color)"},children:t("preview.default.title-fallback")})]}),subtitle&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",className:styles==null?void 0:styles.subtitle,children:renderPreviewNode(subtitle,"default")})]}),/* @__PURE__ */jsxRuntime.jsx(ui.Box,{flex:"none",padding:1,children:statusNode}),children&&/* @__PURE__ */jsxRuntime.jsx("div",{className:styles==null?void 0:styles.children,children})]})});}var __freeze$8=Object.freeze;var __defProp$8=Object.defineProperty;var __template$8=(cooked,raw)=>__freeze$8(__defProp$8(cooked,"raw",{value:__freeze$8(raw||cooked.slice())}));var _a$8,_b$6,_c$5,_d$2,_e$1,_f,_g;const RootFlex=styled__default.default(ui.Flex).attrs({align:"center"})(_a$8||(_a$8=__template$8(["\n  height: ",";\n"])),ui.rem(PREVIEW_SIZES.detail.media.height));const StatusBox=styled__default.default(ui.Box)(_b$6||(_b$6=__template$8(["\n  white-space: nowrap;\n"])));const MediaSkeleton$1=styled__default.default(ui.Skeleton).attrs({animated:true,radius:2})(_c$5||(_c$5=__template$8(["\n  width: ",";\n  height: ",";\n"])),ui.rem(PREVIEW_SIZES.detail.media.width),ui.rem(PREVIEW_SIZES.detail.media.height));const TitleSkeleton$1=styled__default.default(ui.TextSkeleton).attrs({animated:true,radius:1,size:1})(_d$2||(_d$2=__template$8(["\n  max-width: ","; /* 80% of 200px */\n  width: 80%;\n"])),ui.rem(160));const SubtitleSkeleton$1=styled__default.default(ui.TextSkeleton).attrs({animated:true,radius:1,size:1})(_e$1||(_e$1=__template$8(["\n  max-width: ","; /* 60% of 200px */\n  width: 60%;\n"])),ui.rem(120));const DescriptionSkeleton=styled__default.default(ui.TextSkeleton).attrs({animated:true,radius:1,size:1})(_f||(_f=__template$8(["\n  max-width: ","; /* 90% of 200px */\n  width: 90%;\n"])),ui.rem(180));const DescriptionText=styled__default.default(ui.Text)(_ref569=>{let{theme}=_ref569;const{fonts}=theme.sanity;const textSize1=fonts.text.sizes[1];const maxLines=2;const maxHeight=textSize1.lineHeight*maxLines;return styled.css(_g||(_g=__template$8(["\n    & > span {\n      max-height: ",";\n\n      /* Multi-line text overflow */\n      display: -webkit-box;\n      overflow: hidden;\n      overflow: clip;\n      text-overflow: ellipsis;\n      -webkit-line-clamp: ",";\n      -webkit-box-orient: vertical;\n    }\n  "])),ui.rem(maxHeight),maxLines);});const DEFAULT_MEDIA_DIMENSIONS$4={...PREVIEW_SIZES.detail.media,fit:"crop",aspect:1,dpr:useDevicePixelRatio.getDevicePixelRatio()};function DetailPreview(props){const{title,subtitle,description,mediaDimensions=DEFAULT_MEDIA_DIMENSIONS$4,media,status,children,isPlaceholder}=props;const{t}=useTranslation();const statusNode=status&&/* @__PURE__ */jsxRuntime.jsx(StatusBox,{marginLeft:3,paddingRight:1,children:renderPreviewNode(status,"detail")});if(isPlaceholder){return/* @__PURE__ */jsxRuntime.jsx(RootFlex,{"data-testid":"detail-preview",paddingLeft:media?2:3,paddingRight:2,paddingY:2,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",flex:1,gap:3,children:[media&&/* @__PURE__ */jsxRuntime.jsx(MediaSkeleton$1,{"data-testid":"detail-preview__media"}),/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"center","data-testid":"detail-preview__header",flex:1,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{flex:1,space:2,children:[/* @__PURE__ */jsxRuntime.jsx(TitleSkeleton$1,{}),/* @__PURE__ */jsxRuntime.jsx(SubtitleSkeleton$1,{}),description&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:1,children:/* @__PURE__ */jsxRuntime.jsx(DescriptionSkeleton,{})})]})}),statusNode]})});}return/* @__PURE__ */jsxRuntime.jsx(RootFlex,{"data-testid":"detail-preview",paddingLeft:media?2:3,paddingRight:2,paddingY:2,children:/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center",flex:1,gap:3,children:[media&&/* @__PURE__ */jsxRuntime.jsx(Media,{dimensions:mediaDimensions,layout:"detail",media}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{align:"center","data-testid":"detail-preview__header",flex:1,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{flex:1,space:2,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Text,{textOverflow:"ellipsis",size:1,style:{color:"inherit"},weight:"medium",children:[title&&renderPreviewNode(title,"detail"),!title&&/* @__PURE__ */jsxRuntime.jsx(jsxRuntime.Fragment,{children:t("preview.default.title-fallback")})]}),subtitle&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",children:renderPreviewNode(subtitle,"detail")}),description&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:1,children:/* @__PURE__ */jsxRuntime.jsx(DescriptionText,{muted:true,size:1,children:renderPreviewNode(description,"detail")})})]}),statusNode]}),children]})});}var __freeze$7=Object.freeze;var __defProp$7=Object.defineProperty;var __template$7=(cooked,raw)=>__freeze$7(__defProp$7(cooked,"raw",{value:__freeze$7(raw||cooked.slice())}));var _a$7,_b$5,_c$4;const SIZE=43;const STROKE_WIDTH$1=3;const Root$2=styled__default.default.svg(_a$7||(_a$7=__template$7(["\n  width: ","px;\n  height: ","px;\n  transform: rotate(-90deg);\n"])),SIZE,SIZE);const BgCircle=styled__default.default.circle(_ref570=>{let{theme}=_ref570;const{color:color$1}=theme.sanity;return styled.css(_b$5||(_b$5=__template$7(["\n    fill: none;\n    stroke: ",";\n    stroke-width: ","px;\n  "])),color.hues.gray[color$1.dark?900:100].hex,STROKE_WIDTH$1);});const ProgressCircle=styled__default.default.circle(_ref571=>{let{theme}=_ref571;const{color:color$1}=theme.sanity;return styled.css(_c$4||(_c$4=__template$7(["\n    fill: none;\n    stroke: ",";\n    stroke-width: ","px;\n    transition: stroke-dashoffset 75ms;\n  "])),color.hues.blue[color$1.dark?400:500].hex,STROKE_WIDTH$1);});function CircularProgress(props){const{value:valueProp}=props;const value=Math.min(Math.max(valueProp,0),100);const radius=SIZE/2-STROKE_WIDTH$1/2;const circ=2*Math.PI*radius;const offset=(100-value)/100*circ;const viewBox="".concat(SIZE/2," ").concat(SIZE/2," ").concat(SIZE," ").concat(SIZE);return/* @__PURE__ */jsxRuntime.jsxs(Root$2,{viewBox,children:[/* @__PURE__ */jsxRuntime.jsx(BgCircle,{cx:SIZE,cy:SIZE,r:radius}),/* @__PURE__ */jsxRuntime.jsx(ProgressCircle,{cx:SIZE,cy:SIZE,r:radius,style:{strokeDasharray:circ,strokeDashoffset:"".concat(offset,"px")}})]});}var __freeze$6=Object.freeze;var __defProp$6=Object.defineProperty;var __template$6=(cooked,raw)=>__freeze$6(__defProp$6(cooked,"raw",{value:__freeze$6(raw||cooked.slice())}));var _a$6,_b$4;const STROKE_WIDTH=0.5;const Root$1=styled__default.default(ui.Card)(_a$6||(_a$6=__template$6(["\n  overflow: hidden;\n  overflow: clip;\n"])));const Bar=styled__default.default(ui.Card)(_ref572=>{let{theme}=_ref572;const{color:color$1}=theme.sanity;return styled.css(_b$4||(_b$4=__template$6(["\n    height: ","rem;\n    background: ",";\n    transition: transform 75ms;\n  "])),STROKE_WIDTH,color.hues.blue[color$1.dark?400:500].hex);});function LinearProgress(props){const{value}=props;return/* @__PURE__ */jsxRuntime.jsx(Root$1,{radius:5,children:/* @__PURE__ */jsxRuntime.jsx(Bar,{radius:5,style:{transform:"translate3d(".concat(value-100,"%, 0, 0)")}})});}var __freeze$5=Object.freeze;var __defProp$5=Object.defineProperty;var __template$5=(cooked,raw)=>__freeze$5(__defProp$5(cooked,"raw",{value:__freeze$5(raw||cooked.slice())}));var _a$5,_b$3,_c$3,_d$1,_e;const RootBox$1=styled__default.default(ui.Box)(_a$5||(_a$5=__template$5(["\n  position: relative;\n"])));const MediaFlex=styled__default.default(ui.Flex).attrs({align:"center",justify:"center"})(_b$3||(_b$3=__template$5(["\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n"])));const MediaSkeleton=styled__default.default(ui.Skeleton).attrs({animated:true,radius:2})(_c$3||(_c$3=__template$5(["\n  width: 100%;\n  height: 100%;\n"])));const ProgressFlex=styled__default.default(ui.Flex).attrs({align:"center",justify:"center"})(_d$1||(_d$1=__template$5(["\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n\n  &:before {\n    background-color: var(--card-bg-color);\n    opacity: 0.75;\n    content: '';\n    display: block;\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n  }\n\n  > svg {\n    position: relative;\n    z-index: 2;\n  }\n"])));const TooltipContentStack=styled__default.default(ui.Stack).attrs({space:2})(_e||(_e=__template$5(["\n  max-width: ",";\n"])),ui.rem(200));const DEFAULT_MEDIA_DIMENSIONS$3={...PREVIEW_SIZES.media.media,aspect:1,fit:"crop",dpr:useDevicePixelRatio.getDevicePixelRatio()};function MediaPreview(props){const{media,mediaDimensions=DEFAULT_MEDIA_DIMENSIONS$3,children,isPlaceholder,progress=-1,subtitle,title,withBorder=true,withRadius=true}=props;const aspect=mediaDimensions.aspect||1;const STYLES_PADDER=React.useMemo(()=>({paddingBottom:"".concat(100/aspect,"%")}),[aspect]);const tooltipContent=React.useMemo(()=>{if(!title||!subtitle){return null;}return/* @__PURE__ */jsxRuntime.jsxs(TooltipContentStack,{children:[title&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",size:1,weight:"medium",children:renderPreviewNode(title,"media")}),subtitle&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{align:"center",muted:true,size:1,children:renderPreviewNode(subtitle,"media")})]});},[subtitle,title]);return/* @__PURE__ */jsxRuntime.jsx(ui.Box,{padding:2,children:/* @__PURE__ */jsxRuntime.jsxs(RootBox$1,{"data-testid":"media-preview",flex:1,overflow:"hidden",children:[/* @__PURE__ */jsxRuntime.jsx("div",{style:STYLES_PADDER}),/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{content:tooltipContent,disabled:!tooltipContent,placement:"top",portal:true,children:/* @__PURE__ */jsxRuntime.jsxs(MediaFlex,{children:[isPlaceholder?/* @__PURE__ */jsxRuntime.jsx(MediaSkeleton,{}):/* @__PURE__ */jsxRuntime.jsx(Media,{border:withBorder,dimensions:mediaDimensions,layout:"media",media,radius:withRadius?1:0,responsive:true}),typeof progress==="number"&&progress>-1&&/* @__PURE__ */jsxRuntime.jsx(ProgressFlex,{children:/* @__PURE__ */jsxRuntime.jsx(CircularProgress,{value:progress})})]})}),children]})});}var __freeze$4=Object.freeze;var __defProp$4=Object.defineProperty;var __template$4=(cooked,raw)=>__freeze$4(__defProp$4(cooked,"raw",{value:__freeze$4(raw||cooked.slice())}));var _a$4,_b$2,_c$2;const HeaderFlex$2=styled__default.default(ui.Flex).attrs({align:"center"})(_a$4||(_a$4=__template$4(["\n  height: ",";\n  white-space: nowrap;\n  position: relative;\n  z-index: 1;\n"])),ui.rem(PREVIEW_SIZES.block.media.height));const MediaCard=styled__default.default(ui.Card)(_b$2||(_b$2=__template$4(["\n  overflow: hidden;\n  position: relative;\n  padding-bottom: ","%;\n\n  & > span {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n  }\n"])),_ref573=>{let{$ratio}=_ref573;return $ratio;});const RootBox=styled__default.default(ui.Box).attrs({overflow:"hidden"})(_c$2||(_c$2=__template$4(["\n  border-radius: ","px;\n"])),_ref574=>{let{theme}=_ref574;return theme.sanity.radius[1];});const DEFAULT_MEDIA_DIMENSIONS$2={...PREVIEW_SIZES.blockImage.media,fit:"fillmax",dpr:useDevicePixelRatio.getDevicePixelRatio()};const getRatio=dimensions=>{const{height,width}=dimensions;if(!height||!width){return 1;}return height/width*100;};function BlockImagePreview(props){const{actions,title,subtitle,description,fallbackTitle="Untitled",mediaDimensions=DEFAULT_MEDIA_DIMENSIONS$2,media,children,status}=props;return/* @__PURE__ */jsxRuntime.jsxs(RootBox,{children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{children:[/* @__PURE__ */jsxRuntime.jsxs(HeaderFlex$2,{paddingBottom:3,paddingLeft:2,paddingRight:1,paddingTop:1,children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{flex:1,space:2,children:[(title||fallbackTitle)&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,textOverflow:"ellipsis",weight:"medium",children:title?renderPreviewNode(title,"block"):fallbackTitle}),subtitle&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",children:renderPreviewNode(subtitle,"block")})]}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:1,paddingLeft:1,children:[status&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:2,paddingY:3,children:renderPreviewNode(status,"block")}),actions]})]}),/* @__PURE__ */jsxRuntime.jsx(MediaCard,{$ratio:getRatio(mediaDimensions),__unstable_checkered:true,display:"flex",sizing:"border",radius:2,tone:"inherit",children:/* @__PURE__ */jsxRuntime.jsx(Media,{border:false,dimensions:mediaDimensions,layout:"blockImage",media,radius:0,responsive:true})})]}),description&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:2,paddingY:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,children:renderPreviewNode(description,"block")})}),children&&/* @__PURE__ */jsxRuntime.jsx("div",{children})]});}var __freeze$3=Object.freeze;var __defProp$3=Object.defineProperty;var __template$3=(cooked,raw)=>__freeze$3(__defProp$3(cooked,"raw",{value:__freeze$3(raw||cooked.slice())}));var _a$3;const DEFAULT_MEDIA_DIMENSIONS$1={...PREVIEW_SIZES.block.media,aspect:1,fit:"crop",dpr:useDevicePixelRatio.getDevicePixelRatio()};const HeaderFlex$1=styled__default.default(ui.Flex).attrs({align:"center"})(_a$3||(_a$3=__template$3(["\n  min-height: ",";\n"])),ui.rem(PREVIEW_SIZES.block.media.height));function BlockPreview(props){const{actions,title,subtitle,description,mediaDimensions=DEFAULT_MEDIA_DIMENSIONS$1,media,status,children}=props;return/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{"data-testid":"block-preview",space:1,children:[/* @__PURE__ */jsxRuntime.jsxs(HeaderFlex$1,{"data-testid":"block-preview__header",children:[media&&/* @__PURE__ */jsxRuntime.jsx(Media,{dimensions:mediaDimensions,layout:"block",media}),/* @__PURE__ */jsxRuntime.jsxs(ui.Box,{flex:1,paddingLeft:media?2:1,children:[/* @__PURE__ */jsxRuntime.jsx(ui.Text,{size:1,textOverflow:"ellipsis",weight:"medium",children:title?renderPreviewNode(title,"block"):"Untitled"}),subtitle&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:2,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",children:renderPreviewNode(subtitle,"block")})}),description&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",children:renderPreviewNode(description,"block")})})]}),/* @__PURE__ */jsxRuntime.jsxs(ui.Flex,{gap:1,paddingLeft:1,children:[status&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{paddingX:2,paddingY:3,children:renderPreviewNode(status,"block")}),actions]})]}),children&&/* @__PURE__ */jsxRuntime.jsx("div",{"data-testid":"block-preview__children",children})]});}var __freeze$2=Object.freeze;var __defProp$2=Object.defineProperty;var __template$2=(cooked,raw)=>__freeze$2(__defProp$2(cooked,"raw",{value:__freeze$2(raw||cooked.slice())}));var _a$2,_b$1,_c$1;const RootSpan=styled__default.default.span(_a$2||(_a$2=__template$2(["\n  display: inline-flex;\n  align-items: center;\n  vertical-align: top;\n  height: calc(1em - 1px);\n  max-width: 100%;\n"])));const MediaSpan=styled__default.default.span(_b$1||(_b$1=__template$2(["\n  position: relative;\n  display: inline-block;\n  width: calc(1em - 1px);\n  height: calc(1em - 1px);\n  min-width: calc(1em - 1px);\n\n  & img {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    border-radius: ",";\n  }\n\n  & img + span {\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    box-shadow: inset 0 0 0 1px var(--card-fg-color);\n    opacity: 0.2;\n    border-radius: ",";\n  }\n\n  & svg {\n    display: block;\n    font-size: calc(14 / 16 * 1em);\n    margin: 1px 0;\n\n    &[data-sanity-icon] {\n      font-size: calc(18 / 16 * 1em);\n      margin: calc(1px + (2 / 18 * -1em)) 0;\n    }\n  }\n"])),_ref575=>{let{theme}=_ref575;return ui.rem(theme.sanity.radius[1]);},_ref576=>{let{theme}=_ref576;return ui.rem(theme.sanity.radius[1]);});const TextSpan=styled__default.default(ui.Text).attrs({forwardedAs:"span"})(_ref577=>{let{theme}=_ref577;const textFont=theme.sanity.fonts.text;const textSize=textFont.sizes[1];return styled.css(_c$1||(_c$1=__template$2(["\n    font-size: calc("," / 16 * 1em);\n    font-weight: ",";\n    box-sizing: border-box;\n    display: inline-block;\n    vertical-align: top;\n    line-height: ",";\n    padding-left: 0.5em;\n    padding-right: calc(0.5em - 2px);\n    min-width: 0;\n\n    & > span {\n      display: block;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      overflow: hidden;\n      overflow: clip;\n    }\n  "])),textSize.fontSize,textFont.weights.medium,textSize.lineHeight/textSize.fontSize);});const DEFAULT_MEDIA_DIMENSIONS={...PREVIEW_SIZES.inline.media,fit:"crop",aspect:1,dpr:useDevicePixelRatio.getDevicePixelRatio()};function InlinePreview(props){const{title,fallbackTitle="Untitled",media,mediaDimensions=DEFAULT_MEDIA_DIMENSIONS}=props;return/* @__PURE__ */jsxRuntime.jsxs(RootSpan,{"data-testid":"inline-preview",children:[media&&/* @__PURE__ */jsxRuntime.jsxs(MediaSpan,{"data-testid":"inline-preview-media",children:[renderPreviewMedia(media,"inline",mediaDimensions),/* @__PURE__ */jsxRuntime.jsx("span",{})]}),/* @__PURE__ */jsxRuntime.jsx(TextSpan,{"data-testid":"inline-preview-title",size:1,children:renderPreviewNode(title,"inline",fallbackTitle)})]});}var __freeze$1=Object.freeze;var __defProp$1=Object.defineProperty;var __template$1=(cooked,raw)=>__freeze$1(__defProp$1(cooked,"raw",{value:__freeze$1(raw||cooked.slice())}));var _a$1,_b,_c,_d;const DEFAULT_MEDIA_DIMENSION={...PREVIEW_SIZES.default.media,aspect:1,fit:"crop",dpr:useDevicePixelRatio.getDevicePixelRatio()};const Root=styled__default.default(ui.Box)(_a$1||(_a$1=__template$1(["\n  height: 100%;\n\n  a {\n    color: currentColor;\n    text-decoration: none;\n  }\n\n  svg[data-sanity-icon] {\n    margin: 0;\n  }\n"])));const HeaderFlex=styled__default.default(ui.Flex).attrs({align:"center"})(_b||(_b=__template$1(["\n  height: ",";\n"])),ui.rem(PREVIEW_SIZES.default.media.height));const TitleSkeleton=styled__default.default(ui.TextSkeleton).attrs({animated:true,radius:1})(_c||(_c=__template$1(["\n  max-width: ",";\n  width: 80%;\n"])),ui.rem(160));const SubtitleSkeleton=styled__default.default(ui.TextSkeleton).attrs({animated:true,radius:1,size:1})(_d||(_d=__template$1(["\n  max-width: ",";\n  width: 60%;\n"])),ui.rem(120));function TemplatePreview(props){const{description,isPlaceholder,media,mediaDimensions=DEFAULT_MEDIA_DIMENSION,subtitle,title="Untitled"}=props;if(isPlaceholder){return/* @__PURE__ */jsxRuntime.jsx(Root,{children:/* @__PURE__ */jsxRuntime.jsx(HeaderFlex,{children:/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{flex:1,space:2,children:[/* @__PURE__ */jsxRuntime.jsx(TitleSkeleton,{}),/* @__PURE__ */jsxRuntime.jsx(SubtitleSkeleton,{})]})})});}return/* @__PURE__ */jsxRuntime.jsxs(Root,{children:[/* @__PURE__ */jsxRuntime.jsxs(HeaderFlex,{children:[/* @__PURE__ */jsxRuntime.jsxs(ui.Stack,{flex:1,space:2,children:[reactIs.isValidElementType(title)&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{textOverflow:"ellipsis",children:React.createElement(title,{layout:"default"})}),React.isValidElement(title)&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{textOverflow:"ellipsis",children:title}),reactIs.isValidElementType(subtitle)&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",children:React.createElement(subtitle,{layout:"default"})}),React.isValidElement(subtitle)&&/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,textOverflow:"ellipsis",children:subtitle})]}),media&&/* @__PURE__ */jsxRuntime.jsx(ui.Flex,{align:"flex-start",paddingLeft:2,children:/* @__PURE__ */jsxRuntime.jsx(Media,{dimensions:mediaDimensions,layout:"default",media})})]}),description&&/* @__PURE__ */jsxRuntime.jsx(ui.Box,{marginTop:3,children:/* @__PURE__ */jsxRuntime.jsx(ui.Text,{muted:true,size:1,style:{whiteSpace:"break-spaces"},children:description})})]});}const MUTATION_ATTRIBUTE_FILTER=["aria-hidden","disabled","href"];const FOCUSABLE='a[href], button, input, textarea, select, details, [tabindex]:not([tabindex="-1"])';function getFocusableElements(element){return[...element.querySelectorAll(FOCUSABLE)].filter(el=>!el.hasAttribute("disabled")&&el.getAttribute("aria-hidden")!=="true");}function useRovingFocus(props){const{direction="horizontal",initialFocus,loop=true,navigation=["arrows"],pause=false,rootElement}=props;const[focusedIndex,setFocusedIndex]=React.useState(-1);const[focusableElements,setFocusableElements]=React.useState([]);const focusableLen=focusableElements.length;const lastFocusableIndex=focusableLen-1;const nextKey=direction==="horizontal"?"ArrowRight":"ArrowDown";const prevKey=direction==="horizontal"?"ArrowLeft":"ArrowUp";const handleSetElements=React.useCallback(()=>{if(rootElement){const els=getFocusableElements(rootElement);setFocusableElements(els);}},[rootElement]);const handleFocus=React.useCallback(index=>{setFocusedIndex(index);},[]);const handleKeyDown=React.useCallback(event=>{if(pause){return;}const focusPrev=()=>{event.preventDefault();setFocusedIndex(prevIndex=>{const next=(prevIndex+lastFocusableIndex)%focusableLen;if(!loop&&next===lastFocusableIndex){return prevIndex;}return next;});};const focusNext=()=>{event.preventDefault();setFocusedIndex(prevIndex=>{const next=(prevIndex+1)%focusableLen;if(!loop&&next===0){return prevIndex;}return next;});};if(event.key==="Tab"&&navigation.includes("tab")){if(event.shiftKey){focusPrev();}else{focusNext();}}if(navigation.includes("arrows")){if(event.key===prevKey){focusPrev();}if(event.key===nextKey){focusNext();}}},[pause,prevKey,navigation,nextKey,lastFocusableIndex,focusableLen,loop]);React.useEffect(()=>{handleSetElements();},[handleSetElements,initialFocus,direction]);React.useEffect(()=>{const mo=new MutationObserver(handleSetElements);if(rootElement){mo.observe(rootElement,{childList:true,subtree:true,attributeFilter:MUTATION_ATTRIBUTE_FILTER});}return()=>{mo.disconnect();};},[focusableElements,handleSetElements,rootElement]);React.useEffect(()=>{var _a;focusableElements.forEach((el,index)=>{if(index===focusedIndex){el.setAttribute("tabIndex","0");el.setAttribute("aria-selected","true");el.focus();el.onfocus=()=>handleFocus(index);el.onblur=()=>handleFocus(-1);}else{el.setAttribute("tabIndex","-1");el.setAttribute("aria-selected","false");el.onfocus=()=>handleFocus(index);}});if(focusedIndex===-1&&focusableElements){const initialIndex=initialFocus==="last"?lastFocusableIndex:0;(_a=focusableElements[initialIndex])==null?void 0:_a.setAttribute("tabIndex","0");}},[focusableElements,focusedIndex,handleFocus,initialFocus,lastFocusableIndex]);React.useEffect(()=>{rootElement==null?void 0:rootElement.addEventListener("keydown",handleKeyDown);return()=>{rootElement==null?void 0:rootElement.removeEventListener("keydown",handleKeyDown);};},[handleKeyDown,rootElement]);return void 0;}var __freeze=Object.freeze;var __defProp=Object.defineProperty;var __template=(cooked,raw)=>__freeze(__defProp(cooked,"raw",{value:__freeze(raw||cooked.slice())}));var _a;const StyledButton=styled__default.default(TooltipDelayGroupProvider.Button)(_a||(_a=__template(["\n  position: relative;\n  // The children in button is rendered inside a span, we need to absolutely position it.\n  & > span:nth-child(2) {\n    position: absolute;\n    top: 6px;\n    right: 6px;\n    padding: 0;\n  }\n"])));const Dot=styled__default.default.div({width:4,height:4,borderRadius:3,boxShadow:"0 0 0 1px var(--card-bg-color)"});const StatusButton=React.forwardRef(function StatusButton2(props,ref){const{disabled:disabledProp,icon,label,mode="bleed",text,tone,...restProps}=props;const theme=ui.useTheme();const{t}=reactI18next.useTranslation();const toneColor=tone&&theme.sanity.color.solid[tone];const dotStyle=React.useMemo(()=>({backgroundColor:toneColor==null?void 0:toneColor.enabled.bg}),[toneColor]);const disabled=Boolean(disabledProp);return/* @__PURE__ */jsxRuntime.jsx(StyledButton,{"data-ui":"StatusButton",...restProps,"aria-label":label||t("status-button.aria-label"),disabled,mode,ref,text,icon,children:tone&&/* @__PURE__ */jsxRuntime.jsx(Dot,{style:dotStyle})});});const TooltipOfDisabled=React.forwardRef(function DisabledTooltip(_ref578,ref){let{children,content,disabled,...restProps}=_ref578;return/* @__PURE__ */jsxRuntime.jsx(TooltipDelayGroupProvider.Tooltip,{...restProps,content,disabled:disabled||!content,ref,children:/* @__PURE__ */jsxRuntime.jsx("div",{children})});});const ImperativeToast=React.forwardRef((_,ref)=>{const{push}=ui.useToast();React.useImperativeHandle(ref,()=>({push}));return null;});ImperativeToast.displayName="ImperativeToast";const defaults={navbar:200,navbarPopover:5e5,navbarDialog:500001,// pane
pane:100,paneHeader:[110,15e3],paneFooter:[120,2e4],paneResizer:[130,25e3],//
popover:200,modal:200,movingItem:1e4,drawershade:1e6,drawer:1000001,fullscreen:12e5,toast:[100,11e3],// NOT IN USE
portal:200,dropdown:200,navbarFixed:1010,fullscreenEdit:1050,popoverBackground:1060,tooltip:200,modalBackground:2e3,spinner:3e3};const ZIndexContext=React.createContext(defaults);function useZIndex(){return React.useContext(ZIndexContext);}function LegacyLayerProvider(_ref579){let{children,zOffset:zOffsetKey}=_ref579;const zIndex=useZIndex();const zOffset=zIndex[zOffsetKey];return/* @__PURE__ */jsxRuntime.jsx(ui.LayerProvider,{zOffset,children});}const TransformPatches=React.memo(function OnChangeProvider(props){const{transform}=props;const callbacks=useFormCallbacks();const handleChange=React.useCallback(patchEvent=>{const patches=patchEvent.patches;const transformedPatches=transform(patches);callbacks.onChange(PatchEvent.from(transformedPatches));},[callbacks,transform]);const contextValue=React.useMemo(()=>({...callbacks,onChange:handleChange}),[callbacks,handleChange]);return/* @__PURE__ */jsxRuntime.jsx(FormCallbacksContext.Provider,{value:contextValue,children:props.children});});exports.ActiveWorkspaceMatcher=ActiveWorkspaceMatcher;exports.ActiveWorkspaceMatcherContext=ActiveWorkspaceMatcherContext;exports.AddonDatasetContext=AddonDatasetContext;exports.ArrayOfObjectOptionsInput=ArrayOfObjectOptionsInput;exports.ArrayOfObjectsFunctions=ArrayOfObjectsFunctions;exports.ArrayOfObjectsInput=ArrayOfObjectsInput;exports.ArrayOfObjectsItem=ArrayOfObjectsItem;exports.ArrayOfOptionsInput=ArrayOfOptionsInput;exports.ArrayOfPrimitiveOptionsInput=ArrayOfPrimitiveOptionsInput;exports.ArrayOfPrimitivesFunctions=ArrayOfPrimitivesFunctions;exports.ArrayOfPrimitivesInput=ArrayOfPrimitivesInput;exports.ArrayOfPrimitivesItem=ArrayOfPrimitivesItem;exports.AutoCollapseMenu=AutoCollapseMenu;exports.BlockImagePreview=BlockImagePreview;exports.BlockPreview=BlockPreview;exports.BooleanInput=BooleanInput;exports.CONNECTING=CONNECTING;exports.ChangeBreadcrumb=ChangeBreadcrumb;exports.ChangeIndicator=ChangeIndicator;exports.ChangeIndicatorContext=ChangeIndicatorContext;exports.ChangeList=ChangeList;exports.ChangeResolver=ChangeResolver;exports.ChangeTitleSegment=ChangeTitleSegment;exports.Checkbox=Checkbox;exports.CircularProgress=CircularProgress;exports.CollapseMenu=CollapseMenu;exports.CollapseMenuButton=CollapseMenuButton;exports.ColorSchemeCustomProvider=ColorSchemeCustomProvider;exports.ColorSchemeLocalStorageProvider=ColorSchemeLocalStorageProvider;exports.ColorSchemeProvider=ColorSchemeProvider;exports.ColorSchemeSetValueContext=ColorSchemeSetValueContext;exports.ColorSchemeValueContext=ColorSchemeValueContext;exports.CommandList=CommandList;exports.CompactPreview=CompactPreview;exports.ConfigPropertyError=ConfigPropertyError;exports.ConfigResolutionError=ConfigResolutionError;exports.Connector=Connector;exports.ConnectorContext=ConnectorContext;exports.ContextMenuButton=ContextMenuButton;exports.CorsOriginError=CorsOriginError;exports.DEBUG_LAYER_BOUNDS=DEBUG_LAYER_BOUNDS;exports.DEFAULT_MAX_RECURSION_DEPTH=DEFAULT_MAX_RECURSION_DEPTH;exports.DEFAULT_STUDIO_CLIENT_OPTIONS=DEFAULT_STUDIO_CLIENT_OPTIONS;exports.DRAFTS_FOLDER=DRAFTS_FOLDER;exports.DateInput=DateInput;exports.DateTimeInput=DateTimeInput;exports.DatetimeFieldDiff=DatetimeFieldDiff;exports.DefaultMarkers=DefaultMarkers;exports.DefaultPreview=DefaultPreview;exports.DetailPreview=DetailPreview;exports.DiffCard=DiffCard;exports.DiffContext=DiffContext;exports.DiffErrorBoundary=DiffErrorBoundary;exports.DiffFromTo=DiffFromTo;exports.DiffInspectWrapper=DiffInspectWrapper;exports.DiffString=DiffString;exports.DiffStringSegment=DiffStringSegment;exports.DiffTooltip=DiffTooltip;exports.DocumentChangeContext=DocumentChangeContext;exports.DocumentFieldActionsProvider=DocumentFieldActionsProvider;exports.DocumentIdProvider=DocumentIdProvider;exports.DocumentPreviewPresence=DocumentPreviewPresence;exports.DocumentStatus=DocumentStatus;exports.DocumentStatusIndicator=DocumentStatusIndicator;exports.EMPTY_ARRAY=EMPTY_ARRAY$9;exports.EMPTY_OBJECT=EMPTY_OBJECT;exports.EmailInput=EmailInput;exports.FallbackDiff=FallbackDiff;exports.FieldActionMenu=FieldActionMenu;exports.FieldActionsProvider=FieldActionsProvider;exports.FieldActionsResolver=FieldActionsResolver;exports.FieldChange=FieldChange;exports.FieldPresence=FieldPresence;exports.FieldPresenceInner=FieldPresenceInner;exports.FieldPresenceWithOverlay=FieldPresenceWithOverlay;exports.FieldPresenceWithoutOverlay=FieldPresenceWithoutOverlay;exports.FormBuilderContext=FormBuilderContext;exports.FormCallbacksContext=FormCallbacksContext;exports.FormCallbacksProvider=FormCallbacksProvider;exports.FormField=FormField;exports.FormFieldHeaderText=FormFieldHeaderText;exports.FormFieldPresenceContext=FormFieldPresenceContext;exports.FormFieldSet=FormFieldSet;exports.FormFieldStatus=FormFieldStatus;exports.FormFieldValidationStatus=FormFieldValidationStatus;exports.FormInput=FormInput;exports.FormValueProvider=FormValueProvider;exports.FromTo=FromTo;exports.FromToArrow=FromToArrow;exports.GetFormValueProvider=GetFormValueProvider;exports.GlobalStyle=GlobalStyle;exports.GroupChange=GroupChange;exports.HookStateContainer=HookStateContainer;exports.HoveredFieldContext=HoveredFieldContext;exports.ImperativeToast=ImperativeToast;exports.InlinePreview=InlinePreview;exports.InsufficientPermissionsMessage=InsufficientPermissionsMessage;exports.LegacyLayerProvider=LegacyLayerProvider;exports.LinearProgress=LinearProgress;exports.LoadingBlock=LoadingBlock;exports.LocaleProvider=LocaleProvider;exports.LocaleProviderBase=LocaleProviderBase;exports.MediaPreview=MediaPreview;exports.MemberField=MemberField;exports.MemberFieldError=MemberFieldError;exports.MemberFieldSet=MemberFieldSet;exports.MemberItemError=MemberItemError;exports.MetaInfo=MetaInfo;exports.NavbarContext=NavbarContext;exports.NoChanges=NoChanges;exports.NumberInput=NumberInput;exports.ObjectInput=ObjectInput;exports.ObjectInputMember=ObjectInputMember;exports.ObjectInputMembers=ObjectInputMembers;exports.ObjectMembers=ObjectMembers;exports.OverlayDisabled=OverlayDisabled;exports.PatchEvent=PatchEvent;exports.PopoverDialog=PopoverDialog;exports.PortableTextInput=PortableTextInput;exports.PresenceOverlay=PresenceOverlay;exports.PresenceProvider=PresenceProvider;exports.Preview=Preview;exports.PreviewCard=PreviewCard;exports.PreviewLoader=PreviewLoader;exports.ReferenceInputOptionsProvider=ReferenceInputOptionsProvider;exports.ResourceCacheProvider=ResourceCacheProvider;exports.RevertChangesButton=RevertChangesButton;exports.ReviewChangesContext=ReviewChangesContext;exports.SANITY_PATCH_TYPE=SANITY_PATCH_TYPE;exports.SANITY_VERSION=SANITY_VERSION;exports.SESSION_ID=SESSION_ID;exports.SanityDefaultPreview=SanityDefaultPreview;exports.SchemaError=SchemaError;exports.ScrollContainer=ScrollContainer;exports.ScrollContext=ScrollContext;exports.SearchButton=SearchButton;exports.SearchDialog=SearchDialog;exports.SelectInput=SelectInput;exports.SlugInput=SlugInput;exports.SlugPreview=SlugPreview;exports.SourceProvider=SourceProvider;exports.StatusButton=StatusButton;exports.StringInput=StringInput;exports.StringPreview=StringPreview;exports.StudioCrossDatasetReferenceInput=StudioCrossDatasetReferenceInput;exports.StudioFileInput=StudioFileInput;exports.StudioImageInput=StudioImageInput;exports.StudioLayout=StudioLayout;exports.StudioLayoutComponent=StudioLayoutComponent;exports.StudioNavbar=StudioNavbar;exports.StudioProvider=StudioProvider;exports.StudioReferenceInput=StudioReferenceInput;exports.StudioToolMenu=StudioToolMenu;exports.SvgWrapper=SvgWrapper;exports.TagsArrayInput=TagsArrayInput;exports.TemplatePreview=TemplatePreview;exports.TextInput=TextInput;exports.TextWithTone=TextWithTone;exports.Timeline=Timeline;exports.TimelineController=TimelineController;exports.ToolLink=ToolLink;exports.TooltipOfDisabled=TooltipOfDisabled;exports.Tracker=Tracker$1;exports.TransformPatches=TransformPatches;exports.Translate=Translate;exports.UniversalArrayInput=UniversalArrayInput;exports.UpsellDescriptionSerializer=UpsellDescriptionSerializer;exports.UpsellDialogDismissed=UpsellDialogDismissed;exports.UpsellDialogLearnMoreCtaClicked=UpsellDialogLearnMoreCtaClicked;exports.UpsellDialogUpgradeCtaClicked=UpsellDialogUpgradeCtaClicked;exports.UpsellDialogViewed=UpsellDialogViewed;exports.UrlInput=UrlInput;exports.UserAvatar=UserAvatar;exports.UserColorManagerProvider=UserColorManagerProvider;exports.ValidationProvider=ValidationProvider;exports.ValueError=ValueError;exports.VirtualizerScrollInstanceContext=VirtualizerScrollInstanceContext;exports.VirtualizerScrollInstanceProvider=VirtualizerScrollInstanceProvider;exports.WorkspaceProvider=WorkspaceProvider;exports.WorkspacesContext=WorkspacesContext;exports.WorkspacesProvider=WorkspacesProvider;exports.ZIndexContext=ZIndexContext;exports.__tmp_wrap_presenceStore=__tmp_wrap_presenceStore;exports._createAuthStore=_createAuthStore;exports._useColorSchemeInternalValue=_useColorSchemeInternalValue;exports.asLoadable=asLoadable;exports.checkoutPair=checkoutPair;exports.collate=collate;exports.createAuthStore=createAuthStore;exports.createBufferedDocument=createBufferedDocument;exports.createConnectionStatusStore=createConnectionStatusStore;exports.createDocumentPreviewStore=createDocumentPreviewStore;exports.createDocumentStore=createDocumentStore;exports.createDraftFrom=createDraftFrom;exports.createGrantsStore=createGrantsStore;exports.createHistoryStore=createHistoryStore;exports.createHookFromObservableFactory=createHookFromObservableFactory;exports.createKeyValueStore=createKeyValueStore;exports.createObservableBufferedDocument=createObservableBufferedDocument;exports.createProjectStore=createProjectStore;exports.createPublishedFrom=createPublishedFrom;exports.createSchema=createSchema;exports.createSearchQuery=createSearchQuery;exports.createSharedResizeObserver=createSharedResizeObserver;exports.createTrackerScope=createTrackerScope;exports.createUseReporter=createUseReporter;exports.createUserColorManager=createUserColorManager;exports.createUserStore=createUserStore;exports.dec=dec;exports.defaultLocale=defaultLocale;exports.defaultResolveAnnotationComponent=defaultResolveAnnotationComponent;exports.defaultResolveBlockComponent=defaultResolveBlockComponent;exports.defaultResolveFieldComponent=defaultResolveFieldComponent;exports.defaultResolveInlineBlockComponent=defaultResolveInlineBlockComponent;exports.defaultResolveInputComponent=defaultResolveInputComponent;exports.defaultResolveItemComponent=defaultResolveItemComponent;exports.defaultTheme=defaultTheme;exports.defaults=defaults;exports.defineLocale=defineLocale;exports.defineLocaleResourceBundle=defineLocaleResourceBundle;exports.defineLocalesResources=defineLocalesResources;exports.defineSearchFilter=defineSearchFilter;exports.defineSearchFilterOperators=defineSearchFilterOperators;exports.defineSearchOperator=defineSearchOperator;exports.diffMatchPatch=diffMatchPatch;exports.documentFieldActionsReducer=documentFieldActionsReducer;exports.documentIdEquals=documentIdEquals;exports.editState=editState;exports.emitOperation=emitOperation;exports.escapeField=escapeField;exports.fieldNeedsEscape=fieldNeedsEscape;exports.findIndex=findIndex;exports.flattenConfig=flattenConfig;exports.getAnnotationAtPath=getAnnotationAtPath;exports.getAnnotationColor=getAnnotationColor;exports.getDiffAtPath=getDiffAtPath;exports.getDocumentPairPermissions=getDocumentPairPermissions;exports.getDocumentValuePermissions=getDocumentValuePermissions;exports.getDraftId=getDraftId;exports.getFieldLevel=getFieldLevel;exports.getIdPair=getIdPair;exports.getInitialValueStream=getInitialValueStream;exports.getItemKey=getItemKey;exports.getItemKeySegment=getItemKeySegment;exports.getNamelessWorkspaceIdentifier=getNamelessWorkspaceIdentifier;exports.getPairListener=getPairListener;exports.getPreviewPaths=getPreviewPaths;exports.getPreviewStateObservable=getPreviewStateObservable;exports.getPreviewValueWithFallback=getPreviewValueWithFallback;exports.getProviderTitle=getProviderTitle;exports.getPublishedId=getPublishedId;exports.getSchemaTypeTitle=getSchemaTypeTitle;exports.getSearchTypesWithMaxDepth=getSearchTypesWithMaxDepth;exports.getSearchableTypes=getSearchableTypes;exports.getTemplatePermissions=getTemplatePermissions;exports.getValueAtPath=getValueAtPath;exports.getValueError=getValueError;exports.getWorkspaceIdentifier=getWorkspaceIdentifier;exports.globalScope=globalScope;exports.grantsPermissionOn=grantsPermissionOn;exports.immutableReconcile=immutableReconcile;exports.inc=inc;exports.initialDocumentFieldActions=initialDocumentFieldActions;exports.insert=insert;exports.intlCache=intlCache;exports.isAddedItemDiff=isAddedItemDiff;exports.isArrayOfBlocksInputProps=isArrayOfBlocksInputProps;exports.isArrayOfObjectsInputProps=isArrayOfObjectsInputProps;exports.isArrayOfPrimitivesInputProps=isArrayOfPrimitivesInputProps;exports.isAuthStore=isAuthStore;exports.isBooleanInputProps=isBooleanInputProps;exports.isBuilder=isBuilder;exports.isCookielessCompatibleLoginMethod=isCookielessCompatibleLoginMethod;exports.isDev=isDev;exports.isDraft=isDraft;exports.isDraftId=isDraftId;exports.isEmptyObject=isEmptyObject$1;exports.isFieldChange=isFieldChange;exports.isGroupChange=isGroupChange;exports.isMemberArrayOfObjects=isMemberArrayOfObjects;exports.isMemberObject=isMemberObject;exports.isNonNullable=isNonNullable$2;exports.isNumberInputProps=isNumberInputProps;exports.isObjectInputProps=isObjectInputProps;exports.isObjectItemProps=isObjectItemProps;exports.isProd=isProd;exports.isPublishedId=isPublishedId;exports.isRecord=isRecord$4;exports.isRemovedItemDiff=isRemovedItemDiff;exports.isString=isString;exports.isStringInputProps=isStringInputProps;exports.isUnchangedDiff=isUnchangedDiff;exports.joinPath=joinPath;exports.listenQuery=listenQuery;exports.matchWorkspace=matchWorkspace;exports.memoize=memoize;exports.memoizeKeyGen=memoizeKeyGen;exports.memoizedPair=memoizedPair;exports.newDraftFrom=newDraftFrom;exports.noop=noop$2;exports.normalizeIndexSegment=normalizeIndexSegment;exports.normalizeIndexTupleSegment=normalizeIndexTupleSegment;exports.normalizeKeySegment=normalizeKeySegment;exports.normalizePathSegment=normalizePathSegment;exports.onRetry=onRetry;exports.operationEvents=operationEvents;exports.operatorDefinitions=operatorDefinitions;exports.pathToString=pathToString$1;exports.pathsAreEqual=pathsAreEqual;exports.prefixPath=prefixPath;exports.prepareConfig=prepareConfig;exports.prepareForPreview=prepareForPreview;exports.removeDupes=removeDupes;exports.removeMissingReferences=removeMissingReferences;exports.removeUndefinedLocaleResources=removeUndefinedLocaleResources;exports.resizeObserver=resizeObserver;exports.resolveDiffComponent=resolveDiffComponent;exports.resolveInitialObjectValue=resolveInitialObjectValue;exports.resolveInitialValue=resolveInitialValue;exports.resolveInitialValueForType=resolveInitialValueForType;exports.resolveSchemaTypes=resolveSchemaTypes;exports.set=set;exports.setIfMissing=setIfMissing;exports.sliceString=sliceString;exports.snapshotPair=snapshotPair;exports.stringToPath=stringToPath;exports.supportsTouch=supportsTouch;exports.truncateString=truncateString;exports.unset=unset;exports.usEnglishLocale=usEnglishLocale;exports.useActiveWorkspace=useActiveWorkspace;exports.useAnnotationColor=useAnnotationColor;exports.useAnnotationComponent=useAnnotationComponent;exports.useBlockComponent=useBlockComponent;exports.useClient=useClient;exports.useColorScheme=useColorScheme;exports.useColorSchemeOptions=useColorSchemeOptions;exports.useColorSchemeSetValue=useColorSchemeSetValue;exports.useColorSchemeValue=useColorSchemeValue;exports.useConnectionStatusStore=useConnectionStatusStore;exports.useCurrentLocale=useCurrentLocale;exports.useCurrentUser=useCurrentUser;exports.useDataset=useDataset;exports.useDateTimeFormat=useDateTimeFormat;exports.useDidUpdate=useDidUpdate;exports.useDiffAnnotationColor=useDiffAnnotationColor;exports.useDocumentChange=useDocumentChange;exports.useDocumentOperation=useDocumentOperation;exports.useDocumentPairPermissions=useDocumentPairPermissions;exports.useDocumentPairPermissionsFromHookFactory=useDocumentPairPermissionsFromHookFactory;exports.useDocumentPresence=useDocumentPresence;exports.useDocumentPreview=useDocumentPreview;exports.useDocumentPreviewStore=useDocumentPreviewStore;exports.useDocumentStore=useDocumentStore;exports.useDocumentValuePermissions=useDocumentValuePermissions;exports.useDocumentValuePermissionsFromHookFactory=useDocumentValuePermissionsFromHookFactory;exports.useDocumentValues=useDocumentValues;exports.useFeatureEnabled=useFeatureEnabled;exports.useFieldActions=useFieldActions;exports.useFieldComponent=useFieldComponent;exports.useFormBuilder=useFormBuilder;exports.useFormCallbacks=useFormCallbacks;exports.useFormValue=useFormValue;exports.useGetI18nText=useGetI18nText;exports.useGlobalPresence=useGlobalPresence;exports.useGrantsStore=useGrantsStore;exports.useHistoryStore=useHistoryStore;exports.useHoveredField=useHoveredField;exports.useI18nText=useI18nText;exports.useInitialValue=useInitialValue;exports.useInitialValueResolverContext=useInitialValueResolverContext;exports.useInlineBlockComponent=useInlineBlockComponent;exports.useInputComponent=useInputComponent;exports.useItemComponent=useItemComponent;exports.useKeyValueStore=useKeyValueStore;exports.useListFormat=useListFormat;exports.useLoadable=useLoadable;exports.useLocale=useLocale;exports.useMiddlewareComponents=useMiddlewareComponents;exports.usePresenceStore=usePresenceStore;exports.usePreviewCard=usePreviewCard;exports.usePreviewComponent=usePreviewComponent;exports.useProjectId=useProjectId;exports.useProjectStore=useProjectStore;exports.useReferenceInputOptions=useReferenceInputOptions;exports.useReferringDocuments=useReferringDocuments;exports.useRelativeTime=useRelativeTime;exports.useReportedValues=useReportedValues$1;exports.useReporter=useReporter$1;exports.useResolveInitialValueForType=useResolveInitialValueForType;exports.useResourceCache=useResourceCache;exports.useRovingFocus=useRovingFocus;exports.useSchema=useSchema;exports.useSearchMaxFieldDepth=useSearchMaxFieldDepth;exports.useSource=useSource;exports.useTemplatePermissions=useTemplatePermissions;exports.useTemplatePermissionsFromHookFactory=useTemplatePermissionsFromHookFactory;exports.useTemplates=useTemplates;exports.useTranslation=useTranslation;exports.useUnique=useUnique;exports.useUnitFormatter=useUnitFormatter;exports.useUser=useUser;exports.useUserColor=useUserColor;exports.useUserColorManager=useUserColorManager;exports.useUserStore=useUserStore;exports.useVirtualizerScrollInstance=useVirtualizerScrollInstance;exports.useWorkspace=useWorkspace;exports.useWorkspaces=useWorkspaces;exports.useZIndex=useZIndex;exports.userHasRole=userHasRole;exports.validateBasePaths=validateBasePaths;exports.validateDocument=validateDocument;exports.validateNames=validateNames;exports.validateTemplates=validateTemplates;exports.validateWorkspaces=validateWorkspaces;exports.validation=validation;exports.visitDiff=visitDiff;
//# sourceMappingURL=TransformPatches-9Ddwm1na.js.map
