{"version":3,"file":"previewAction-DgzrEWwB.js","sources":["../../src/_internal/cli/actions/preview/previewAction.ts"],"sourcesContent":["import {type CliCommandArguments, type CliCommandContext, type CliConfig} from '@sanity/cli'\nimport path from 'path'\n\nimport {type PreviewServerOptions, startPreviewServer} from '../../server'\nimport {getSharedServerConfig, gracefulServerDeath} from '../../util/servers'\n\nexport interface StartPreviewServerCommandFlags {\n  host?: string\n  port?: string\n}\n\nexport default async function startSanityPreviewServer(\n  args: CliCommandArguments<StartPreviewServerCommandFlags>,\n  context: CliCommandContext,\n): Promise<void> {\n  const flags = args.extOptions\n  const {workDir, cliConfig} = context\n\n  const defaultRootDir = path.resolve(path.join(workDir, 'dist'))\n  const rootDir = path.resolve(args.argsWithoutOptions[0] || defaultRootDir)\n  const config = getPreviewServerConfig({flags, workDir, cliConfig, rootDir})\n\n  try {\n    await startPreviewServer(config)\n  } catch (err) {\n    gracefulServerDeath('preview', config.httpHost, config.httpPort, err)\n  }\n}\n\nfunction getPreviewServerConfig({\n  flags,\n  workDir,\n  cliConfig,\n  rootDir,\n}: {\n  flags: StartPreviewServerCommandFlags\n  rootDir: string\n  workDir: string\n  cliConfig?: CliConfig\n}): PreviewServerOptions {\n  const baseConfig = getSharedServerConfig({flags, workDir, cliConfig})\n  return {\n    ...baseConfig,\n    root: rootDir,\n  }\n}\n"],"names":["startSanityPreviewServer","args","context","flags","extOptions","workDir","cliConfig","defaultRootDir","path","default","resolve","join","rootDir","argsWithoutOptions","config","getPreviewServerConfig","startPreviewServer","err","gracefulServerDeath","httpHost","httpPort","_ref","baseConfig","getSharedServerConfig","root"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAW8B,eAAAA,wBAAAA,CAC5BC,MACAC,OACe,EAAA;EACf,MAAMC,QAAQF,IAAK,CAAAG,UAAA;EACb,MAAA;IAACC,OAAS;IAAAC;EAAa,CAAA,GAAAJ,OAAA;EAE7B,MAAMK,iBAAiBC,aAAK,CAAAC,OAAA,CAAAC,OAAA,CAAQF,aAAAA,CAAAA,QAAKG,IAAK,CAAAN,OAAA,EAAS,MAAM,CAAC,CAAA;EAC9D,MAAMO,UAAUJ,aAAK,CAAAC,OAAA,CAAAC,OAAA,CAAQT,KAAKY,kBAAmB,CAAA,CAAC,KAAKN,cAAc,CAAA;EACzE,MAAMO,SAASC,sBAAuB,CAAA;IAACZ;IAAOE,OAAS;IAAAC,SAAA;IAAWM;GAAQ,CAAA;EAEtE,IAAA;IACF,MAAMI,aAAAA,CAAAA,mBAAmBF,MAAM,CAAA;WACxBG,GAAK,EAAA;IACZC,OAAA,CAAAA,mBAAA,CAAoB,SAAW,EAAAJ,MAAA,CAAOK,QAAU,EAAAL,MAAA,CAAOM,UAAUH,GAAG,CAAA;EACtE;AACF;AAEA,SAASF,sBAAuBA,CAAAM,IAAA,EAUP;EAAA,IAVO;IAC9BlB,KAAA;IACAE,OAAA;IACAC,SAAA;IACAM;EACF,CAKyB,GAAAS,IAAA;EACvB,MAAMC,aAAaC,OAAAA,CAAAA,qBAAsB,CAAA;IAACpB,KAAO;IAAAE,OAAA;IAASC;GAAU,CAAA;EAC7D,OAAA;IACL,GAAGgB,UAAA;IACHE,IAAM,EAAAZ;EAAA,CACR;AACF;"}