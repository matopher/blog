/// <reference types="react" />

import type { ClientPerspective } from '@sanity/client'
import type { ComponentType } from 'react'
import type { DocumentStore } from 'sanity'
import type { Observable } from 'rxjs'
import { Plugin as Plugin_2 } from 'sanity'
import type { PreviewUrlResolver } from '@sanity/preview-url-secret/define-preview-url'
import type { PreviewUrlResolverOptions } from '@sanity/preview-url-secret/define-preview-url'
import type { QueryParams } from '@sanity/client'
import type { SanityClient } from 'sanity'

export declare interface DeskDocumentPaneParams {
  inspect?: string
  path?: string
  rev?: string
  since?: string
  template?: string
  templateParams?: string
  view?: string
  pathKey?: string
  instruction?: string
  comment?: string
}

export declare interface DocumentLocation {
  title: string
  href: string
}

export declare type DocumentLocationResolver = (
  params: {
    id: string
    type: string
  },
  context: {
    documentStore: DocumentStore
  },
) =>
  | DocumentLocationsState
  | null
  | undefined
  | Observable<DocumentLocationsState | null | undefined>

export declare interface DocumentLocationsState {
  locations?: DocumentLocation[]
  message?: string
  tone?: 'positive' | 'caution' | 'critical'
}

/** @internal */
export declare interface FrameState {
  title: string | undefined
  url: string | undefined
}

/** @internal */
export declare type LiveQueriesState = Record<string, LiveQueriesStateValue>

/** @internal */
export declare interface LiveQueriesStateValue {
  query: string
  params: QueryParams
  perspective: ClientPerspective
  receivedAt: number
  /**
   * If false it means the query can't safely be garbage collected,
   * as older versions of @sanity/core-loader doesn't fire listen events
   * on an interval.
   */
  heartbeat: number | false
}

export declare interface NavigatorOptions {
  minWidth?: number
  maxWidth?: number
  component: ComponentType
}

export declare type PresentationNavigate = (
  nextState: PresentationStateParams,
  nextSearchState?: PresentationSearchParams,
  forceReplace?: boolean,
) => void

export declare type PresentationNavigateContextValue = (
  preview: string | undefined,
  document?: {
    type: string
    id: string
  },
) => void

export declare interface PresentationParams
  extends PresentationStateParams,
    DeskDocumentPaneParams {
  id?: string
  preview?: string
  perspective?: string
  viewport?: string
}

export declare interface PresentationPluginOptions {
  devMode?: boolean | (() => boolean)
  icon?: ComponentType
  name?: string
  title?: string
  locate?: DocumentLocationResolver
  previewUrl: PreviewUrlOption
  components?: {
    unstable_navigator?: NavigatorOptions
  }
  /**
   * @deprecated this feature flag is no longer needed
   */
  unstable_showUnsafeShareUrl?: boolean
}

export declare interface PresentationSearchParams
  extends DeskDocumentPaneParams {
  preview?: string
  perspective?: string
  viewport?: string
}

export declare interface PresentationStateParams {
  type?: string
  id?: string
  path?: string
}

export declare const presentationTool: Plugin_2<PresentationPluginOptions>

export declare type PreviewUrlOption =
  | string
  | PreviewUrlResolver<SanityClient>
  | PreviewUrlResolverOptions

export { PreviewUrlResolver }

export { PreviewUrlResolverOptions }

export declare function usePresentationNavigate(): PresentationNavigateContextValue

export declare function usePresentationParams(): PresentationParams

export {}
