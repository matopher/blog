{"version":3,"file":"index.cjs","sources":["../../src/constants.ts","../../src/PresentationContext.ts","../../src/useDocumentLocations.ts","../../src/document/LocationsBanner.tsx","../../src/document/PresentationDocumentContext.ts","../../src/document/PresentationDocumentHeader.tsx","../../src/document/PresentationDocumentProvider.tsx","../../src/fieldActions/openInStructure.ts","../../src/getIntentState.ts","../../src/router.ts","../../src/plugin.tsx","../../src/PresentationNavigateContext.ts","../../src/PresentationParamsContext.ts","../../src/usePresentationParams.ts","../../src/usePresentationNavigate.ts"],"sourcesContent":["import { ComposeIcon } from '@sanity/icons'\n\nexport const DEFAULT_TOOL_ICON = ComposeIcon\nexport const DEFAULT_TOOL_NAME = 'presentation'\nexport const DEFAULT_TOOL_TITLE = 'Presentation'\n\n// @todo import from core sanity package\nexport const COMMENTS_INSPECTOR_NAME = 'sanity/structure/comments'\n\nexport const EDIT_INTENT_MODE = 'presentation'\n\n// How long we wait until an iframe is loaded until we consider it to be slow and possibly failed\nexport const MAX_TIME_TO_OVERLAYS_CONNECTION = 3000 // ms\n\n// The API version to use when using `@sanity/client`\nexport const API_VERSION = '2023-10-16'\n\n// Heartbeats shouldn't fire on intervals that are so short it causes performance issues\nexport const MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL = 1000 // ms\n\n// Batch size for fetching documents building up the cache\nexport const LIVE_QUERY_CACHE_BATCH_SIZE = 100\n\n// Total cache size for documents that are live queried\nexport const LIVE_QUERY_CACHE_SIZE = 2048\n","import { createContext } from 'react'\n\nimport {\n  DeskDocumentPaneParams,\n  PresentationNavigate,\n  PresentationParams,\n} from './types'\n\nexport interface PresentationContextValue {\n  deskParams: DeskDocumentPaneParams\n  devMode: boolean\n  name: string\n  navigate: PresentationNavigate\n  params: PresentationParams\n}\n\nexport const PresentationContext =\n  createContext<PresentationContextValue | null>(null)\n","import { useEffect, useState } from 'react'\nimport { isObservable, of } from 'rxjs'\nimport { useDocumentStore } from 'sanity'\n\nimport { DocumentLocationResolver, DocumentLocationsState } from './types'\n\nconst INITIAL_STATE: DocumentLocationsState = { locations: [] }\n\nexport function useDocumentLocations(props: {\n  id: string\n  locate?: DocumentLocationResolver\n  type: string\n}): DocumentLocationsState {\n  const { id, locate, type } = props\n  const documentStore = useDocumentStore()\n  const [state, setLocations] = useState<DocumentLocationsState>(INITIAL_STATE)\n\n  useEffect(() => {\n    if (!locate) return undefined\n\n    const params = { id, type }\n    const context = { documentStore }\n\n    const result = locate(params, context)\n    const locations$ = isObservable(result) ? result : of(result)\n\n    const sub = locations$.subscribe((d) => setLocations(d || INITIAL_STATE))\n\n    return () => sub.unsubscribe()\n  }, [documentStore, id, locate, type])\n\n  return state\n}\n","import {\n  ChevronRightIcon,\n  DesktopIcon,\n  ErrorOutlineIcon,\n  InfoOutlineIcon,\n  WarningOutlineIcon,\n} from '@sanity/icons'\nimport { Box, Card, Flex, Stack, Text } from '@sanity/ui'\nimport {\n  ComponentType,\n  createElement,\n  ReactNode,\n  useCallback,\n  useContext,\n  useState,\n} from 'react'\nimport { ObjectSchemaType } from 'sanity'\nimport { useIntentLink } from 'sanity/router'\n\nimport { DEFAULT_TOOL_NAME, DEFAULT_TOOL_TITLE } from '../constants'\nimport { PresentationContext } from '../PresentationContext'\nimport { DocumentLocation, PresentationPluginOptions } from '../types'\nimport { useDocumentLocations } from '../useDocumentLocations'\n\nconst LENGTH_FORMAT: Record<number, string> = {\n  1: 'one',\n  2: 'two',\n  3: 'three',\n  4: 'four',\n  5: 'five',\n  6: 'six',\n  7: 'seven',\n  8: 'eight',\n  9: 'nine',\n}\n\nconst TONE_ICONS: Record<'positive' | 'caution' | 'critical', ComponentType> = {\n  positive: InfoOutlineIcon,\n  caution: WarningOutlineIcon,\n  critical: ErrorOutlineIcon,\n}\n\nexport function LocationsBanner(props: {\n  documentId: string\n  options: PresentationPluginOptions\n  schemaType: ObjectSchemaType\n  showPresentationTitle: boolean\n}): ReactNode {\n  const { documentId, options, schemaType, showPresentationTitle } = props\n  const presentation = useContext(PresentationContext)\n\n  const { message, locations, tone } = useDocumentLocations({\n    id: documentId,\n    locate: options.locate,\n    type: schemaType.name,\n  })\n\n  const len = locations?.length || 0\n\n  const [expanded, setExpanded] = useState(false)\n\n  const toggle = useCallback(() => setExpanded((v) => !v), [])\n\n  const title =\n    message ||\n    (len ? (\n      <>\n        Used on {LENGTH_FORMAT[len] || len} {len === 1 ? <>page</> : <>pages</>}\n      </>\n    ) : null)\n\n  if (len === 0 && !title) {\n    return null\n  }\n\n  return (\n    <Card padding={1} radius={3} border tone={tone}>\n      <div style={{ margin: -1 }}>\n        {!locations && (\n          <Flex align=\"flex-start\" gap={3} padding={3}>\n            {tone && (\n              <Box flex=\"none\">\n                <Text size={1}>{createElement(TONE_ICONS[tone])}</Text>\n              </Box>\n            )}\n            <Box flex={1}>\n              <Text size={1} weight=\"medium\">\n                {showPresentationTitle && (\n                  <>{options.title || DEFAULT_TOOL_TITLE} &middot; </>\n                )}\n                {title}\n              </Text>\n            </Box>\n          </Flex>\n        )}\n\n        {locations && (\n          <>\n            <Card\n              as=\"button\"\n              onClick={toggle}\n              padding={3}\n              radius={2}\n              tone=\"inherit\"\n            >\n              <Flex gap={3}>\n                <Box flex=\"none\">\n                  <Text size={1}>\n                    <ChevronRightIcon\n                      style={{\n                        transform: `rotate(${expanded ? '90deg' : 0})`,\n                        transition: 'transform 100ms ease-in-out',\n                      }}\n                    />\n                  </Text>\n                </Box>\n                <Box flex={1}>\n                  <Text size={1} weight=\"medium\">\n                    {showPresentationTitle && (\n                      <>{options.title || DEFAULT_TOOL_TITLE} &middot; </>\n                    )}\n                    {title}\n                  </Text>\n                </Box>\n              </Flex>\n            </Card>\n            <Stack hidden={!expanded} marginTop={1} space={1}>\n              {locations.map((l, index) => (\n                <LocationItem\n                  active={\n                    (options.name || DEFAULT_TOOL_NAME) ===\n                      presentation?.name &&\n                    l.href === presentation?.params.preview\n                  }\n                  documentId={documentId}\n                  documentType={schemaType.name}\n                  key={index}\n                  node={l}\n                  toolName={options.name || DEFAULT_TOOL_NAME}\n                />\n              ))}\n            </Stack>\n          </>\n        )}\n      </div>\n    </Card>\n  )\n}\n\nfunction LocationItem(props: {\n  active: boolean\n  documentId: string\n  documentType: string\n  node: DocumentLocation\n  toolName: string\n}) {\n  const { documentId, documentType, node, active, toolName } = props\n  const presentation = useContext(PresentationContext)\n  const navigate = presentation?.navigate\n\n  const presentationLinkProps = useIntentLink({\n    intent: 'edit',\n    params: {\n      id: documentId,\n      type: documentType,\n      mode: 'presentation',\n      presentation: toolName,\n      ...presentation?.deskParams,\n      preview: node.href,\n    },\n  })\n\n  const handleClick = useCallback(() => {\n    navigate?.({}, { preview: node.href })\n  }, [node.href, navigate])\n\n  return (\n    <Card\n      {...(presentation ? {} : presentationLinkProps)}\n      as={presentation ? 'button' : 'a'}\n      key={node.href}\n      onClick={handleClick}\n      padding={3}\n      radius={2}\n      pressed={active}\n      tone=\"inherit\"\n    >\n      <Flex gap={3}>\n        <Box flex=\"none\">\n          <Text size={1}>\n            <DesktopIcon />\n          </Text>\n        </Box>\n        <Stack flex={1} space={2}>\n          <Text size={1} weight=\"medium\">\n            {node.title}\n          </Text>\n          <Text muted size={1} textOverflow=\"ellipsis\">\n            {node.href}\n          </Text>\n        </Stack>\n      </Flex>\n    </Card>\n  )\n}\n","import { createContext } from 'react'\n\nimport { PresentationDocumentContextValue } from './types'\n\nexport const PresentationDocumentContext =\n  createContext<PresentationDocumentContextValue | null>(null)\n","import { rem, Stack } from '@sanity/ui'\nimport { type ReactNode, useContext } from 'react'\nimport { type ObjectSchemaType, type PublishedId } from 'sanity'\nimport styled from 'styled-components'\n\nimport type { PresentationPluginOptions } from '../types'\nimport { LocationsBanner } from './LocationsBanner'\nimport { PresentationDocumentContext } from './PresentationDocumentContext'\n\nconst LocationStack = styled(Stack)`\n  min-height: ${rem(42)};\n\n  & + &:empty {\n    display: none;\n  }\n`\n\nexport function PresentationDocumentHeader(props: {\n  documentId: PublishedId\n  options: PresentationPluginOptions\n  schemaType: ObjectSchemaType\n}): ReactNode {\n  const { documentId, options, schemaType } = props\n\n  const context = useContext(PresentationDocumentContext)\n\n  if (context && context.options[0] !== options) {\n    return <LocationStack marginBottom={5} space={5} />\n  }\n\n  const len = context?.options?.length || 0\n\n  return (\n    <LocationStack marginBottom={5} space={5}>\n      <Stack space={2}>\n        {context?.options.map((o, idx) => (\n          <LocationsBanner\n            documentId={documentId}\n            key={idx}\n            options={o}\n            schemaType={schemaType}\n            showPresentationTitle={len > 1}\n          />\n        ))}\n      </Stack>\n    </LocationStack>\n  )\n}\n","import {\n  ReactElement,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\n\nimport { PresentationPluginOptions } from '../types'\nimport { PresentationDocumentContext } from './PresentationDocumentContext'\nimport { PresentationDocumentContextValue } from './types'\n\n/** @internal */\nexport function PresentationDocumentProvider(props: {\n  children?: ReactNode\n  options: PresentationPluginOptions\n}): ReactElement {\n  const { children, options } = props\n  const parent = useContext(PresentationDocumentContext)\n  const parentRegister = parent?.register\n\n  const [optionsArray, setOptionsArray] = useState<PresentationPluginOptions[]>(\n    () => [],\n  )\n\n  const register = useCallback(\n    (options: PresentationPluginOptions) => {\n      if (parentRegister) {\n        return parentRegister(options)\n      }\n\n      setOptionsArray((prev) => [options].concat(prev))\n\n      return () => {\n        setOptionsArray((prev) => prev.filter((o) => o !== options))\n      }\n    },\n    [parentRegister],\n  )\n\n  const registerRef = useRef(register)\n  registerRef.current = register\n\n  const context: PresentationDocumentContextValue = useMemo(\n    () => ({\n      options: parent?.options || optionsArray,\n      register,\n    }),\n    [optionsArray, parent, register],\n  )\n\n  useEffect(() => registerRef.current(options), [options])\n\n  return (\n    <PresentationDocumentContext.Provider value={context}>\n      {children}\n    </PresentationDocumentContext.Provider>\n  )\n}\n","import { MasterDetailIcon } from '@sanity/icons'\nimport { useContext, useMemo } from 'react'\nimport {\n  defineDocumentFieldAction,\n  DocumentFieldActionItem,\n  isRecord,\n  pathToString,\n  Tool,\n  useWorkspace,\n} from 'sanity'\nimport { useRouter } from 'sanity/router'\n\nimport { PresentationContext } from '../PresentationContext'\n\nexport const openInStructure = defineDocumentFieldAction({\n  name: 'presentation/openInStructure',\n  useAction({ documentId, documentType, path }) {\n    const workspace = useWorkspace()\n    const { navigateIntent } = useRouter()\n    const presentation = useContext(PresentationContext)\n\n    const defaultStructureTool = useMemo(\n      () => findStructureTool(workspace.tools, documentId, documentType),\n      [documentId, documentType, workspace.tools],\n    )\n\n    return {\n      type: 'action',\n      hidden: !presentation || path.length > 0 || !defaultStructureTool,\n      icon: defaultStructureTool?.icon || MasterDetailIcon,\n      title: `Open in ${defaultStructureTool?.title || 'Structure'}`,\n      onAction() {\n        navigateIntent('edit', {\n          id: documentId,\n          type: documentType,\n          mode: 'structure',\n          path: pathToString(path),\n        })\n      },\n      renderAsButton: true,\n    } satisfies DocumentFieldActionItem\n  },\n})\n\nfunction findStructureTool(\n  tools: Tool[],\n  documentId: string,\n  documentType: string,\n): Tool | undefined {\n  const results = tools.map((t) => {\n    const match = t.canHandleIntent?.(\n      'edit',\n      {\n        id: documentId,\n        type: documentType,\n        mode: 'structure',\n      },\n      {},\n    )\n\n    return { tool: t, match }\n  })\n\n  const modeMatches = results.filter((t) => isRecord(t.match) && t.match.mode)\n\n  if (modeMatches.length > 0) {\n    return modeMatches[0].tool\n  }\n\n  const matches = results.filter((t) => t.match)\n\n  return matches[0]?.tool\n}\n","import { uuid } from '@sanity/uuid'\nimport { getPublishedId } from 'sanity'\nimport { encodeJsonParams, SearchParam } from 'sanity/router'\n\nimport { PresentationStateParams } from './types'\n\n/**\n * @internal\n */\nexport function getIntentState(\n  intent: string,\n  params: Record<string, string>,\n  _routerState: undefined,\n  payload: unknown,\n):\n  | (PresentationStateParams & { _searchParams: SearchParam[] })\n  | { intent: string; params: Record<string, string>; payload: unknown } {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const { id, mode, path, presentation, type, ...searchParams } = params\n\n  if (intent === 'edit' && id) {\n    return {\n      type: type || '*',\n      id: getPublishedId(id),\n      path,\n      _searchParams: Object.entries(searchParams),\n    }\n  }\n\n  if (intent === 'create') {\n    searchParams.preview =\n      searchParams.preview ||\n      new URLSearchParams(window.location.search).get('preview') ||\n      '/'\n\n    if (payload && typeof payload === 'object') {\n      searchParams.templateParams = encodeJsonParams(\n        payload as Record<string, unknown>,\n      )\n    }\n\n    return {\n      type: type || '*',\n      id: id || uuid(),\n      _searchParams: Object.entries(searchParams),\n    }\n  }\n  return { intent, params, payload }\n}\n","import { route } from 'sanity/router'\n\nexport const router = route.create(\n  '/',\n  { __unsafe_disableScopedSearchParams: true },\n  [\n    route.intents('/intent'),\n    route.create(':type', [route.create(':id', [route.create(':path')])]),\n  ],\n)\n","import type { SanityDocument } from '@sanity/client'\nimport { lazy, Suspense } from 'react'\nimport {\n  definePlugin,\n  getPublishedId,\n  InputProps,\n  isDocumentSchemaType,\n} from 'sanity'\n\nimport {\n  DEFAULT_TOOL_ICON,\n  DEFAULT_TOOL_NAME,\n  EDIT_INTENT_MODE,\n} from './constants'\nimport { PresentationDocumentHeader } from './document/PresentationDocumentHeader'\nimport { PresentationDocumentProvider } from './document/PresentationDocumentProvider'\nimport { openInStructure } from './fieldActions/openInStructure'\nimport { getIntentState } from './getIntentState'\nimport { router } from './router'\nimport { PresentationPluginOptions } from './types'\n\nconst PresentationTool = lazy(() => import('./PresentationTool'))\nconst BroadcastDisplayedDocument = lazy(\n  () => import('./loader/BroadcastDisplayedDocument'),\n)\n\nexport const presentationTool = definePlugin<PresentationPluginOptions>(\n  (options) => {\n    const toolName = options.name || DEFAULT_TOOL_NAME\n\n    function PresentationDocumentInput(props: InputProps) {\n      const value = props.value as SanityDocument\n      const documentId = value?._id ? getPublishedId(value?._id) : undefined\n\n      if (isDocumentSchemaType(props.schemaType)) {\n        return (\n          <PresentationDocumentProvider options={options}>\n            {options.locate && documentId && (\n              <PresentationDocumentHeader\n                documentId={documentId}\n                options={options}\n                schemaType={props.schemaType}\n              />\n            )}\n            {props.renderDefault(props)}\n            <Suspense key=\"broadcast-displayed-document\">\n              <BroadcastDisplayedDocument value={value} />\n            </Suspense>\n          </PresentationDocumentProvider>\n        )\n      }\n\n      return props.renderDefault(props)\n    }\n\n    function canHandleCreateIntent(params: Record<string, unknown>) {\n      // We can't handle create intents without a `type` parameter\n      if (!('type' in params)) {\n        return false\n      }\n\n      if ('presentation' in params && params.presentation !== toolName) {\n        return false\n      }\n\n      return 'template' in params ? { template: true } : true\n    }\n\n    function canHandleEditIntent(params: Record<string, unknown>) {\n      // We can't handle edit intents without `type` or `id` parameters\n      if (!('type' in params) || !('id' in params)) {\n        return false\n      }\n\n      if ('presentation' in params && params.presentation !== toolName) {\n        return false\n      }\n\n      return 'mode' in params\n        ? { mode: params.mode === EDIT_INTENT_MODE }\n        : true\n    }\n\n    return {\n      document: {\n        unstable_fieldActions: (prev) => {\n          return [\n            ...prev.filter((a) => a.name !== openInStructure.name), // prevent duplication\n            openInStructure,\n          ]\n        },\n      },\n\n      form: {\n        components: {\n          input: PresentationDocumentInput,\n        },\n      },\n\n      tools: [\n        {\n          icon: options.icon || DEFAULT_TOOL_ICON,\n          name: toolName,\n          title: options.title,\n          component: PresentationTool,\n          options,\n          canHandleIntent(intent, params) {\n            if (intent === 'create') return canHandleCreateIntent(params)\n            if (intent === 'edit') return canHandleEditIntent(params)\n            return false\n          },\n          getIntentState,\n          router,\n        },\n      ],\n    }\n  },\n)\n","import { createContext } from 'react'\n\nexport type PresentationNavigateContextValue = (\n  preview: string | undefined,\n  document?: { type: string; id: string },\n) => void\n\nexport const PresentationNavigateContext =\n  createContext<PresentationNavigateContextValue | null>(null)\n","import { createContext } from 'react'\n\nimport { PresentationParams } from './types'\n\nexport const PresentationParamsContext =\n  createContext<PresentationParams | null>(null)\n","import { useContext } from 'react'\n\nimport { PresentationParamsContext } from './PresentationParamsContext'\nimport { PresentationParams } from './types'\n\nexport function usePresentationParams(): PresentationParams {\n  const params = useContext(PresentationParamsContext)\n\n  if (!params) {\n    throw new Error('Presentation params context is missing')\n  }\n\n  return params\n}\n","import { useContext } from 'react'\n\nimport {\n  PresentationNavigateContext,\n  PresentationNavigateContextValue,\n} from './PresentationNavigateContext'\n\nexport function usePresentationNavigate(): PresentationNavigateContextValue {\n  const navigate = useContext(PresentationNavigateContext)\n\n  if (!navigate) {\n    throw new Error('Presentation navigate context is missing')\n  }\n\n  return navigate\n}\n\nexport type { PresentationNavigateContextValue }\n"],"names":["jsxRuntime","require","react","sanity","icons","ui","styled","router$1","rxjs","uuid","_interopDefaultCompat","e","default","styled__default","DEFAULT_TOOL_ICON","ComposeIcon","DEFAULT_TOOL_NAME","DEFAULT_TOOL_TITLE","EDIT_INTENT_MODE","PresentationContext","createContext","INITIAL_STATE","locations","LENGTH_FORMAT","TONE_ICONS","positive","InfoOutlineIcon","caution","WarningOutlineIcon","critical","ErrorOutlineIcon","LocationsBanner","props","documentId","options","schemaType","showPresentationTitle","presentation","useContext","message","tone","id","locate","type","documentStore","useDocumentStore","state","setLocations","useState","useEffect","result","sub","isObservable","of","subscribe","d","unsubscribe","useDocumentLocations","name","len","length","expanded","setExpanded","toggle","useCallback","v","title","jsxs","Fragment","children","jsx","Card","padding","radius","border","style","margin","Flex","align","gap","Box","flex","Text","size","createElement","weight","as","onClick","ChevronRightIcon","transform","transition","Stack","hidden","marginTop","space","map","l","index","LocationItem","active","href","params","preview","documentType","node","toolName","navigate","presentationLinkProps","useIntentLink","intent","mode","deskParams","handleClick","key","pressed","DesktopIcon","muted","textOverflow","PresentationDocumentContext","LocationStack","rem","PresentationDocumentHeader","_a","context","marginBottom","o","idx","PresentationDocumentProvider","parent","parentRegister","register","optionsArray","setOptionsArray","prev","concat","filter","registerRef","useRef","current","useMemo","Provider","value","openInStructure","defineDocumentFieldAction","useAction","path","workspace","useWorkspace","navigateIntent","useRouter","defaultStructureTool","tools","results","t","tool","match","canHandleIntent","call","modeMatches","isRecord","findStructureTool","icon","MasterDetailIcon","onAction","pathToString","renderAsButton","getIntentState","_routerState","payload","searchParams","getPublishedId","_searchParams","Object","entries","URLSearchParams","window","location","search","get","templateParams","encodeJsonParams","router","route","create","__unsafe_disableScopedSearchParams","intents","PresentationTool","lazy","Promise","resolve","then","BroadcastDisplayedDocument","presentationTool","definePlugin","document","unstable_fieldActions","a","form","components","input","_id","isDocumentSchemaType","renderDefault","Suspense","component","template","canHandleCreateIntent","canHandleEditIntent","PresentationNavigateContext","PresentationParamsContext","exports","A","C","D","E","L","M","P","b","c","Error","p","u"],"mappings":"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"}