"use strict";var e=Object.defineProperty,t=(t,n,r)=>(((t,n,r)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r})(t,"symbol"!=typeof n?n+"":n,r),r),n=require("react/jsx-runtime"),r=require("@sanity/client/csm"),i=require("@sanity/ui"),o=require("react"),s=require("sanity"),a=require("sanity/router"),l=require("sanity/structure"),c=require("styled-components"),u=require("./index.cjs"),d=require("./DisplayedDocumentBroadcaster.cjs"),p=require("@sanity/icons"),f=require("@sanity/preview-url-secret/without-secret-search-params"),h=require("framer-motion"),m=require("@sanity/preview-url-secret/create-secret"),v=require("fast-deep-equal"),g=require("@sanity/preview-url-secret/define-preview-url"),x=require("suspend-react");function y(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var b=y(c),w=y(v);let j;const k=new Uint8Array(16);function P(){if(!j&&(j=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!j))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return j(k)}const E=[];for(let e=0;e<256;++e)E.push((e+256).toString(16).slice(1));var C={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function S(e,t,n){if(C.randomUUID&&!t&&!e)return C.randomUUID();const r=(e=e||{}).random||(e.rng||P)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return E[e[t+0]]+E[e[t+1]]+E[e[t+2]]+E[e[t+3]]+"-"+E[e[t+4]]+E[e[t+5]]+"-"+E[e[t+6]]+E[e[t+7]]+"-"+E[e[t+8]]+E[e[t+9]]+"-"+E[e[t+10]]+E[e[t+11]]+E[e[t+12]]+E[e[t+13]]+E[e[t+14]]+E[e[t+15]]}(r)}const I=1e3,R=1e3,T=500,z=["handshake/syn","handshake/syn-ack","handshake/ack"],D=e=>z.some((t=>t===e)),L=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function M(e){const t=e.target,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(D(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(l(e,"connected"),c(e,"handshake/ack",{id:e.id}))}}const o=t=>{var r,i,o;const{data:s}=t;if(!D(s.type)&&n.find((e=>e.id===s.connectionId))){const t=n.find((e=>e.config.id===s.from));if(t){const n=[s.type,s.data];null==(i=(r=t.config).onEvent)||i.call(r,...n),null==(o=e.onEvent)||o.call(e,...n),u(t,"channel/response",{responseTo:s.id},!1)}}};function s(t){var r;if(L(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(t)){const{data:e}=t;null==(r=n.find((t=>t.config.id===e.from)))||r.handler(t)}}function a(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function l(t,n){var s,l,d;t.status=n,null==(l=(s=t.config).onStatusUpdate)||l.call(s,n,t.config.id),null==(d=e.onStatusUpdate)||d.call(e,n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,a(t),function(e){e.id=S(),e.interval=window.setInterval((()=>{c(e,"handshake/syn",{id:e.id})}),T)}(t)):"connected"===n?(t.handler=o,r(t),function(e){if(a(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:R;e.heartbeat=window.setInterval((()=>{u(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{u(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),a(t))}function c(n,r,i){if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:S(),to:n.config.id,type:r};try{null==t||t.postMessage(o,{targetOrigin:"*"})}catch{throw new Error(`Failed to postMessage '${o.id}' on '${e.id}'`)}}function u(n,r,i,o=!0){const s=S();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const a={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:s,to:n.config.id,type:r};if(o){const t=setTimeout((()=>{a.connectionId===n.id&&(window.removeEventListener("message",o,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),l(n,"reconnecting"),console.warn(`Received no response to message '${a.type}' on client '${e.id}' (ID: '${a.id}').`))}),I),o=e=>{var n;const{data:r}=e;"channel/response"===r.type&&null!=(n=r.data)&&n.responseTo&&r.data.responseTo===a.id&&(window.removeEventListener("message",o,!1),clearTimeout(t))};window.addEventListener("message",o,!1)}try{null==t||t.postMessage(a,{targetOrigin:e.targetOrigin})}catch{throw new Error(`Failed to postMessage '${a.id}' on client '${e.id}'`)}}return window.addEventListener("message",s,!1),n.forEach((e=>{l(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(u(e,"channel/disconnect",{id:e.id},!1),l(e,"disconnected"))})),window.removeEventListener("message",s,!1),n.forEach((e=>{a(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");u(i,t,r)}))}}}const O=/^([A-Za-z]+):([0-9]+)$/,$=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,U=/^([A-Za-z]+):([a-z0-9]+)$/;const A={alt:"altKey",ctrl:"ctrlKey",mod:typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function F(e){return"Alt"===e.key}function _(e){const{children:t,message:r,onRetry:o,onContinueAnyway:s,...a}=e,l=n.jsx(i.Button,{fontSize:1,mode:"ghost",onClick:o,text:"Retry"}),c=n.jsx(i.Button,{fontSize:1,mode:"ghost",tone:"critical",onClick:s,text:"Continue anyway"});return n.jsx(i.Card,{height:"fill",...a,children:n.jsx(i.Flex,{align:"center",height:"fill",justify:"center",children:n.jsx(i.Container,{padding:4,sizing:"border",width:0,children:n.jsxs(i.Stack,{space:4,children:[n.jsxs(i.Stack,{space:3,children:[n.jsx(i.Text,{size:1,weight:"semibold",children:"An error occured"}),n.jsx(i.Text,{muted:!0,size:1,children:r})]}),t,o&&s?n.jsxs(i.Inline,{space:2,children:[l,c]}):o?n.jsx(i.Box,{children:l}):s?n.jsx(i.Box,{children:c}):null]})})})})}function B(){const e=o.useContext(u.P);if(!e)throw new Error("Presentation context is missing");return e}function W(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const q=o.forwardRef((function(e,t){const{deskParams:r,params:i}=B();return n.jsx(a.StateLink,{...e,ref:t,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),N=o.forwardRef((function(e,t){const{documentId:r,documentType:i,parentRefPath:o,template:s,...l}=e;return n.jsx(a.StateLink,{...l,ref:t,state:{id:r,type:i},title:void 0})}));function V(e){const{children:t,params:r,onDeskParams:i,previewUrl:c,refs:u}=e,{state:d,resolvePathFromState:p}=a.useRouter(),f=s.useUnique(Object.fromEntries(d._searchParams||[])),h=o.useCallback((e=>`${p(d)}${W({...f,...e})}`),[p,f,d]),m=o.useMemo((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:r,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:e=>{const{childId:t,...r}=e,i=null==u?void 0:u.find((e=>e._id===t||s.getPublishedId(e._id)===t));return i?n.jsx(a.StateLink,{...r,state:{id:t,type:i._type,_searchParams:Object.entries({preview:c})}}):n.jsx("div",{...r})},BackLink:q,ReferenceChildLink:N,ParameterizedLink:()=>n.jsx(n.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{var t;i({...e,inspect:null!=(t=e.inspect)?t:void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:h})),[h,i,r,c,u]);return n.jsx(l.PaneRouterContext.Provider,{value:m,children:t})}const K=b.default(l.PaneLayout)`
  height: 100%;
`,G=b.default(i.Flex)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,J=b.default(i.Code)`
  white-space: pre-wrap;
`;function H(e){const{onDeskParams:t,previewUrl:r,refs:s}=e,{devMode:a}=B(),c=o.useMemo((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:s.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[s]),[u,d]=o.useState(null),p=o.useCallback((()=>d(null)),[]),[f]=o.useState((()=>({})));return o.useEffect((()=>d(null)),[s]),u?n.jsx(_,{flex:1,message:"Could not render the document list",onRetry:p,children:a&&n.jsx(i.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:n.jsxs(i.Stack,{space:3,children:[n.jsx(i.Label,{muted:!0,size:0,children:"Error message"}),n.jsx(J,{size:1,children:u.error.message})]})})}):n.jsx(i.ErrorBoundary,{onCatch:d,children:n.jsx(K,{children:n.jsx(l.StructureToolProvider,{children:n.jsx(V,{params:f,onDeskParams:t,previewUrl:r,refs:s,children:n.jsx(G,{direction:"column",flex:1,children:n.jsx(l.DocumentListPane,{index:0,itemId:"$root",pane:c,paneKey:"$root"})})})})})})}const X=b.default(i.Code)`
  white-space: pre-wrap;
`;function Z(e){const{documentId:t,documentType:r,params:s,onDeskParams:c,onFocusPath:u}=e,{template:d,templateParams:p}=s,{devMode:f}=B(),h=o.useMemo((()=>({id:t,options:{id:t,type:r,template:d,templateParameters:a.decodeJsonParams(p)},title:"",type:"document"})),[t,r,d,p]),[m,v]=o.useState(null),g=o.useCallback((()=>v(null)),[]);o.useEffect((()=>{v(null)}),[t,r,s]);const{setLayoutCollapsed:x}=l.useStructureTool(),y=o.useCallback((()=>x(!0)),[x]),b=o.useCallback((()=>x(!1)),[x]);return m?n.jsx(_,{flex:1,message:"Could not render the document editor",onRetry:g,children:f&&n.jsx(i.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:n.jsxs(i.Stack,{space:3,children:[n.jsx(i.Label,{muted:!0,size:0,children:"Error message"}),n.jsx(X,{size:1,children:m.error.message})]})})}):n.jsx(i.ErrorBoundary,{onCatch:v,children:n.jsx(l.PaneLayout,{style:{height:"100%"},onExpand:b,onCollapse:y,children:n.jsx(V,{onDeskParams:c,params:s,children:n.jsx(l.DocumentPane,{paneKey:"document",index:1,itemId:"document",pane:h,onFocusPath:u})})})})}function Q(e){const{deskParams:t,documentId:r,documentType:i,onDeskParams:o,onFocusPath:s}=e;return n.jsx(l.StructureToolProvider,{children:n.jsx(Z,{documentId:r,documentType:i,params:t,onDeskParams:o,onFocusPath:s})})}function Y(e){const{deskParams:t,documentId:r,documentType:i,onDeskParams:o,onFocusPath:s,previewUrl:a,refs:l}=e;return r&&i?n.jsx(Q,{deskParams:t,documentId:r,documentType:i,onDeskParams:o,onFocusPath:s}):n.jsx(H,{onDeskParams:o,previewUrl:a,refs:l})}const ee=o.createContext(null);ee.displayName="PanelsContext";const te=b.default.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,ne=function({children:e,defaultSize:t=null,id:r,minWidth:i,maxWidth:s,order:a=0}){const l=o.useContext(ee);if(null===l)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:c,registerElement:u,unregisterElement:d}=l,p=c(r);return o.useLayoutEffect((()=>(u(r,{id:r,type:"panel",defaultSize:t,maxWidth:null!=s?s:null,minWidth:null!=i?i:0,order:a}),()=>{d(r)})),[r,t,a,s,i,u,d]),n.jsx(te,{style:p,children:e})};const re=b.default.div`
  position: relative;
`,ie=b.default.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,oe=function({id:e,order:t,disabled:r=!1}){const i=o.useRef(null),s=o.useContext(ee);if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const a=function(e){return o.useRef(e||S()).current}(e),{activeResizer:l,drag:c,startDragging:u,stopDragging:d,registerElement:p,unregisterElement:f}=s,h=l===a;if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const m=o.useCallback((e=>{u(a,e.nativeEvent)}),[a,u]),v=o.useCallback((e=>{c(a,e)}),[a,c]),g=o.useCallback((()=>{i.current.blur(),d()}),[d]);return o.useEffect((()=>{if(h&&!r)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[r,h,v,g]),o.useLayoutEffect((()=>(p(a,{id:a,order:t,type:"resizer",el:i}),()=>{f(a)})),[a,t,p,f]),n.jsx(re,{onMouseDown:m,ref:i,children:n.jsxs(ie,{$disabled:r,children:[n.jsx("span",{}),n.jsx("span",{})]})})};function se(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const ae="presentation/panels",le=()=>JSON.parse(localStorage.getItem(ae)||"{}"),ce=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function ue(){return o.useMemo((()=>{const e=(e,t)=>{(e=>{localStorage.setItem(ae,JSON.stringify(e))})({...le(),[ce(e)]:t})};return{get:e=>le()[ce(e)],set:e,setDebounced:se(e,100)}}),[])}function de(e,t,n){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/n*100,s=i/n*100;return Math.min(o,Math.max(s,t))}function pe(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function fe(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function he(e){return"panel"===e.type}function me(e){return"resizer"===e.type}function ve(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function ge(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let o=0;for(let t=0;t<e.length;t++){const r=e[t],s=i[t],a=de(r,s,n);s!=a&&(o+=s-a,i[t]=a)}if("0.000"!==o.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:s,minWidth:a}=r;a=a/n*100,null!=s&&(s=s/n*100);const l=Math.min(null!=s?s:100,Math.max(a,i[t]+o));if(l!==i[t]&&(o-=l-i[t],i[t]=l,"0.000"===Math.abs(o).toFixed(3)))break}return i}const xe=b.default.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,ye=function({children:e}){const t=o.useRef(null),[r,i]=o.useState(new Map),s=o.useMemo((()=>ve(r).filter(he)),[r]),[a,l]=o.useState([]),[c,u]=o.useState(null),d=o.useRef({elements:r,panels:s,widths:a}),p=o.useCallback((e=>({flexGrow:pe(s,e,a),pointerEvents:null===c?void 0:"none"})),[c,s,a]),f=o.useCallback(((e,t)=>{i((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),h=o.useCallback((e=>{i((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),m=o.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),v=o.useCallback(((e,t)=>{const n=ve(r),i=n.findIndex((t=>t.id===e)),o=r.get(e);if(!o||!me(o))return;const s=o.el.current;s&&(m.current={resizerIndex:i,panelBefore:n.reduce(((e,t,n)=>he(t)&&n<i?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&he(t)&&n>i?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:fe(t,s),resizerRect:s.getBoundingClientRect(),widths:d.current.widths},u(e))}),[r]),g=o.useCallback((()=>{u(null)}),[]),x=o.useCallback(((e,n)=>{n.preventDefault(),n.stopPropagation();const{containerWidth:i,dragOffset:o,panelBefore:s,panelAfter:a,resizerRect:c}=m.current;if(null==s||null==a)return;const u=r.get(e);if(!u||!me(u))return;const p=u.el.current;if(!p)return;const f=fe(n,p,o,c);if(0===f)return;const{widths:h}=d.current,v=function(e,t,n,r,i,o){const{panels:s,widths:a}=i,{widths:l}=o,c=l||a,u=[...c];{const i=e<0?r:n,o=c[s.findIndex((e=>e.id===i.id))],a=de(i,o+Math.abs(e),t);if(o===a)return c;e=e<0?o-a:a-o}let d=0,p=e<0?n:r,f=s.findIndex((e=>e.id===p.id));for(;;){const n=s[f],r=c[f],i=de(n,r-(Math.abs(e)-Math.abs(d)),t);if(r!==i&&(d+=r-i,u[f]=i,d.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--f<0)break}else if(++f>=s.length)break}return 0===d?c:(p=e<0?r:n,f=s.findIndex((e=>e.id===p.id)),u[f]=c[f]+d,u)}(f/t.current.getBoundingClientRect().width*100,i,s,a,d.current,m.current);h.some(((e,t)=>e!==v[t]))&&l(v)}),[r]);o.useLayoutEffect((()=>{d.current.elements=r,d.current.panels=s,d.current.widths=a}),[r,s,a]);const y=ue();o.useLayoutEffect((()=>{const{widths:e}=d.current;if(e.length===s.length)return;const t=y.get(s);if(t){const e=ge(s,t,window.innerWidth);return void l(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(s);l(n)}),[y,s]),o.useEffect((()=>{a.length&&y.setDebounced(s,a)}),[y,s,a]),o.useLayoutEffect((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=d.current,n=ge(e,t,window.innerWidth);t.some(((e,t)=>e!==n[t]))&&l(n)}));return e.observe(t.current),()=>{e.disconnect()}}),[]);const b=o.useMemo((()=>({activeResizer:c,drag:x,getPanelStyle:p,registerElement:f,startDragging:v,stopDragging:g,unregisterElement:h})),[c,x,p,f,v,g,h]);return n.jsx(ee.Provider,{value:b,children:n.jsx(xe,{ref:t,children:e})})},be=function(e){const{children:t,navigate:r}=e,i=o.useCallback(((e,t=void 0)=>{r(t||{},e?{preview:e}:{})}),[r]);return n.jsx(u.a.Provider,{value:i,children:t})};function we(e){const{unstable_navigator:t}=e,r=!(null==t||!t.component),[i,s]=function(e,t){const[n,r]=o.useState((()=>{var n;return JSON.parse(null!=(n=localStorage.getItem(e))?n:JSON.stringify(t))}));return o.useEffect((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,r]}("presentation/navigator",r),a=!!r&&i,l=o.useMemo((()=>{if(r)return()=>s((e=>!e))}),[r,s]),c=o.useCallback((function(){return n.jsx(n.Fragment,{children:a&&n.jsx(je,{...t})})}),[a,t]);return[{navigatorEnabled:a,toggleNavigator:l},c]}const je=o.memo((function(e){const{minWidth:t,maxWidth:r,component:i}=e,o=null!=t&&null!=r&&t===r;return n.jsxs(n.Fragment,{children:[n.jsx(ne,{id:"navigator",minWidth:t,maxWidth:r,order:1,children:n.jsx(i,{})}),n.jsx(oe,{order:2,disabled:o})]})})),ke=function(e){const{children:t,params:r}=e,i=o.useMemo((()=>r),[r]);return n.jsx(u.b.Provider,{value:i,children:t})},Pe=function(e){const{children:t,deskParams:r,devMode:i,name:s,navigate:a,params:l}=e,c=o.useMemo((()=>({deskParams:r,devMode:i,name:s,navigate:a,params:l})),[r,i,s,a,l]);return n.jsx(u.P.Provider,{value:c,children:t})};var Ee,Ce,Se,Ie,Re=class extends Error{constructor(e){super(e[0].message),t(this,"issues"),this.name="ValiError",this.issues=e}};function Te(e,t){return Array.isArray(e)?[void 0,e]:[e,t]}function ze(e,t,n,r,i){var o,s,a,l,c;const u=null!=(c=null!=(l=null!=(a=null!=(s=null!=(o=t.message)?o:function(e,t){var n;return null==(n=null==Ie?void 0:Ie.get(e))?void 0:n.get(t)}(n,i.lang))?s:e?(d=i.lang,null==Se?void 0:Se.get(d)):null)?a:null==r?void 0:r.message)?l:function(e){return null==Ce?void 0:Ce.get(e)}(i.lang))?c:i.message;var d;return"function"==typeof u?u(i):u}function De(e,t,n){return{typed:e,output:t,issues:n}}function Le(e){let t=typeof e;return"object"===t&&(t=e?Object.getPrototypeOf(e).constructor.name:"null"),"string"===t?`"${e}"`:"number"===t||"bigint"===t||"boolean"===t?`${e}`:t}function Me(e,t,n){var r;const i=null!=(r=n.received)?r:Le(n.input),o={reason:e.type,context:n.context.type,expected:n.context.expects,received:i,message:`Invalid ${n.label}: ${n.context.expects?`Expected ${n.context.expects} but r`:"R"}eceived ${i}`,input:n.input,requirement:n.context.requirement,path:n.path,lang:null==t?void 0:t.lang,abortEarly:null==t?void 0:t.abortEarly,abortPipeEarly:null==t?void 0:t.abortPipeEarly,skipPipe:null==t?void 0:t.skipPipe};return o.message=ze(!1,n.context,n.reference,t,o),o}function Oe(e,t,n,r){if(e.pipe&&(null==n||!n.skipPipe))for(const i of e.pipe){const o=i._parse(t);if(o.issues){for(const t of o.issues){const i=Me(e,n,t);r?r.push(i):r=[i]}if(null!=n&&n.abortEarly||null!=n&&n.abortPipeEarly)break}else t=o.output}return De(!0,t,r)}function $e(e,t,n,r,i){var o,s;const a=Le(n),l=null!=(o=null==i?void 0:i.expected)?o:e.expects,c={reason:null!=(s=null==i?void 0:i.reason)?s:"type",context:e.type,expected:l,received:a,message:`Invalid type: Expected ${l} but received ${a}`,input:n,path:null==i?void 0:i.path,issues:null==i?void 0:i.issues,lang:null==r?void 0:r.lang,abortEarly:null==r?void 0:r.abortEarly,abortPipeEarly:null==r?void 0:r.abortPipeEarly,skipPipe:null==r?void 0:r.skipPipe};return c.message=ze(!0,e,t,r,c),{typed:!1,output:n,issues:[c]}}function Ue(e,t){return{...e,fallback:t,_parse(t,n){const r=e._parse(t,n);return r.issues?De(!0,function(e,t){return"function"==typeof e.fallback?e.fallback(t):e.fallback}(this,{input:t,issues:r.issues})):r}}}function Ae(e,t,n,r){const[i,o,s]=function(e,t,n){if(!e||"object"==typeof e&&!Array.isArray(e)){const[r,i]=Te(t,n);return[e,r,i]}const[r,i]=Te(e,t);return[void 0,r,i]}(t,n,r);let a;return{type:"object",expects:"Object",async:!1,entries:e,rest:i,message:o,pipe:s,_parse(e,t){if(e&&"object"==typeof e){a=null!=a?a:Object.entries(this.entries);let n,r=!0;const i={};for(const[o,s]of a){const a=e[o],l=s._parse(a,t);if(l.issues){const i={type:"object",origin:"value",input:e,key:o,value:a};for(const e of l.issues)e.path?e.path.unshift(i):e.path=[i],null==n||n.push(e);if(n||(n=l.issues),null!=t&&t.abortEarly){r=!1;break}}l.typed||(r=!1),(void 0!==l.output||o in e)&&(i[o]=l.output)}if(this.rest&&(null==t||!t.abortEarly||!n))for(const o in e)if(!(o in this.entries)){const s=e[o],a=this.rest._parse(s,t);if(a.issues){const i={type:"object",origin:"value",input:e,key:o,value:s};for(const e of a.issues)e.path?e.path.unshift(i):e.path=[i],null==n||n.push(e);if(n||(n=a.issues),null!=t&&t.abortEarly){r=!1;break}}a.typed||(r=!1),i[o]=a.output}return r?Oe(this,i,t,n):De(!1,i,n)}return $e(this,Ae,e,t)}}}function Fe(e,t){return{type:"picklist",expects:e.map(Le).join(" | "),async:!1,options:e,message:t,_parse(e,t){return this.options.includes(e)?De(!0,e):$e(this,Fe,e,t)}}}function _e(e,t,n){const r=e._parse(t,function(e){var t,n,r,i;return{lang:null!=(t=null==e?void 0:e.lang)?t:null==Ee?void 0:Ee.lang,message:null==e?void 0:e.message,abortEarly:null!=(n=null==e?void 0:e.abortEarly)?n:null==Ee?void 0:Ee.abortEarly,abortPipeEarly:null!=(r=null==e?void 0:e.abortPipeEarly)?r:null==Ee?void 0:Ee.abortPipeEarly,skipPipe:null!=(i=null==e?void 0:e.skipPipe)?i:null==Ee?void 0:Ee.skipPipe}}(n));if(r.issues)throw new Re(r.issues);return r.output}const Be="ACTION_IFRAME_LOADED",We="ACTION_IFRAME_REFRESH",qe="ACTION_IFRAME_RELOAD",Ne="ACTION_PERSPECTIVE",Ve="ACTION_VIEWPORT",Ke="ACTION_VISUAL_EDITING_OVERLAYS_TOGGLE",Ge=(e,t)=>{switch(t.type){case Be:return"loaded"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"loaded"}};case We:return"refreshing"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"refreshing"}};case qe:return"reloading"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"reloading"}};case Ne:return{...e,perspective:_e(Xe,t.perspective)};case Ve:return{...e,viewport:_e(Ze,t.viewport)};case Ke:return Je(e,t);default:return e}},Je=(e,t)=>e.visualEditing.overlaysEnabled===t.enabled?e:{...e,visualEditing:{...e.visualEditing,overlaysEnabled:t.enabled}},He=Fe(["loading","loaded","refreshing","reloading"]),Xe=Ue(Fe(["published","previewDrafts"]),"previewDrafts"),Ze=Ue(Fe(["desktop","mobile"]),"desktop"),Qe=Ae({iframe:Ae({status:He}),perspective:Xe,viewport:Ze,visualEditing:Ae({overlaysEnabled:function e(t,n){const[r,i]=Te(t,n);return{type:"boolean",expects:"boolean",async:!1,message:r,pipe:i,_parse(t,n){return"boolean"==typeof t?Oe(this,t,n):$e(this,e,t,n)}}}()})}),Ye={iframe:{status:"loading"},perspective:"previewDrafts",viewport:"desktop",visualEditing:{overlaysEnabled:!1}};function et(e){return _e(Qe,{...Ye,...e})}const tt=h.motion(b.default.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),nt=function(e){var t;const{basePath:r="/"}=(null==(t=s.useActiveWorkspace())?void 0:t.activeWorkspace)||{},{fontSize:a=1,onChange:l,origin:c,padding:u=3,value:d}=e,f=o.useRef(null),[h,m]=o.useState(void 0),[v,g]=o.useState(void 0),x=o.useCallback((e=>{m(e.currentTarget.value)}),[]),y=o.useCallback((e=>{var t;if("Enter"===e.key){if(void 0===h)return;const e=h.startsWith("/")||""===h?`${c}${h}`:h;if(!e.startsWith(c+"/")&&e!==c)return void g(`URL must start with ${c}`);if(!c&&(e.startsWith(`${r}/`)||e===r))return void g(`URL can't have the same base path as the Studio ${r}`);const n=e===c?c+"/":e;g(void 0),m(void 0),l(n.slice(c.length)),null==(t=f.current)||t.blur()}"Escape"===e.key&&(g(void 0),m(void 0))}),[r,l,c,h]),b=o.useCallback((()=>{g(void 0),m(void 0)}),[]);o.useEffect((()=>{g(void 0),m(void 0)}),[c,d]);const w=o.useMemo((()=>({icon:p.ResetIcon})),[]);return n.jsx(n.Fragment,{children:n.jsx(i.TextInput,{clearButton:v?w:void 0,customValidity:v,fontSize:a,onBlur:b,onClear:()=>{g(void 0),m(c+d)},onChange:x,onKeyDownCapture:y,padding:u,style:{zIndex:1},radius:2,ref:f,space:u,value:void 0===h?`${c}${d}`:h})})};function rt(e){const{initialUrl:t,openPopup:r,previewLocationOrigin:s,previewLocationRoute:a}=e,l=o.useCallback((e=>{e.preventDefault(),r(e.currentTarget.href)}),[r]);return n.jsxs(n.Fragment,{children:[n.jsx(it,{initialUrl:t,previewLocationOrigin:s,previewLocationRoute:a}),n.jsx(i.MenuItem,{icon:p.LaunchIcon,text:"Open preview",as:"a",href:`${s}${a}`,onClick:l,rel:"opener",target:"_blank"})]})}function it(e){const{initialUrl:t,previewLocationOrigin:r,previewLocationRoute:a}=e,{push:l}=i.useToast(),c=s.useClient({apiVersion:u.A}),d=s.useCurrentUser(),[h,v]=o.useState(!1);return n.jsx(i.MenuItem,{disabled:h,onClick:()=>{if(null==navigator||!navigator.clipboard)return l({closable:!0,status:"error",title:"Clipboard not supported"}),!1;v(!0);let e,n=`${r}${a}`;const i=()=>{l({id:e,closable:!0,status:"success",title:"The URL is copied to the clipboard"}),v(!1)},o=e=>{l({closable:!0,status:"error",title:"Copy failed",description:e.message||e.toString()}),v(!1)};if(f.hasSecretSearchParams(t)&&typeof ClipboardItem<"u"){const r="text/plain",s=new ClipboardItem({[r]:(async()=>{e=l({closable:!0,title:"Copying URL to clipboard…"});const i=await m.createPreviewSecret(c,"@sanity/presentation",typeof window>"u"?"":location.href,null==d?void 0:d.id);return n=f.setSecretSearchParams(t,i.secret,a).toString(),new Blob([n],{type:r})})()});navigator.clipboard.write([s]).then(i).catch(o)}else navigator.clipboard.writeText(n).then(i).catch(o)},text:"Copy link",icon:p.CopyIcon})}const ot=h.motion(i.Flex),st=b.default(i.Switch)`
  & > span {
    width: 21px;
    height: 13px;
    overflow: hidden;

    & > span:nth-child(1) {
      width: 21px;
      height: 13px;
    }

    & > span:nth-child(2) {
      width: 9px;
      height: 9px;
      top: 2px;
      left: 2px;
    }
  }

  & input:checked + span {
    & > span:nth-child(2) {
      transform: translate3d(8px, 0, 0) !important;
    }
  }
`,at={previewDrafts:"Drafts",published:"Published"},lt="caution",ct="positive",ut={previewDrafts:p.EditIcon,published:p.PublishIcon},dt=o.forwardRef((function(e,t){const{dispatch:r,iframe:a,initialUrl:l,loadersConnection:c,navigatorEnabled:d,onPathChange:m,onRefresh:v,openPopup:g,overlaysConnection:x,params:y,perspective:b,targetOrigin:w,toggleNavigator:j,toggleOverlay:k,viewport:P,visualEditing:{overlaysEnabled:E}}=e,{devMode:C}=B(),S=i.usePrefersReducedMotion(),I=o.useCallback((()=>r({type:Ve,viewport:"desktop"})),[r]),R=o.useCallback((()=>r({type:Ve,viewport:"mobile"})),[r]),T="loading"===a.status||"reloading"===a.status,[z,D]=o.useState(!1),L="refreshing"===a.status,[M,O]=o.useState(!1),$=T||L||"connecting"===x,U=o.useMemo((()=>w===location.origin?"":w),[w]),A=o.useCallback((()=>{v((()=>{"function"==typeof t||null==t||!t.current||(r({type:qe}),t.current.src=`${w}${y.preview||"/"}`)}))}),[r,v,y.preview,w,t]),F=o.useCallback((()=>{"function"==typeof t||null==t||!t.current||(t.current.src=l.toString(),r({type:qe}))}),[r,t,l]),W=o.useCallback((()=>{N(!0)}),[]),[q,N]=o.useState(!1),[V,K]=o.useState(!1);o.useEffect((()=>{if(!(T||L||"connecting"!==x&&"reconnecting"!==x)){const e=setTimeout((()=>{K(!0)}),1e3);return()=>clearTimeout(e)}}),[x,T,L]),o.useEffect((()=>{if(!T&&!L&&V){if("connected"===x&&(O(!1),K(!1),D(!1),N(!1)),"connecting"===x){const e=setTimeout((()=>{D(!0),console.error("Unable to connect to visual editing. Make sure you've setup '@sanity/visual-editing' correctly")}),u.M);return()=>clearTimeout(e)}if("reconnecting"===x){const e=setTimeout((()=>{D(!0),O(!0)}),u.M);return()=>clearTimeout(e)}"disconnected"===x&&O(!0)}}),[T,x,L,V]);const G=o.useMemo((()=>{const e=new URL(y.preview||"/",w),{pathname:t,search:n}=f.withoutSecretSearchParams(e);return`${t}${n}`}),[y.preview,w]),J=o.useCallback((()=>{r({type:Be})}),[r]);return n.jsx(h.MotionConfig,{transition:S?{duration:0}:void 0,children:n.jsxs(i.TooltipDelayGroupProvider,{delay:1e3,children:[n.jsx(i.Card,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:n.jsxs(i.Flex,{align:"center",gap:2,style:{minHeight:0},children:[j&&n.jsx(i.Tooltip,{animate:!0,content:n.jsx(i.Text,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:n.jsx(i.Button,{"aria-label":"Toggle navigator",fontSize:1,icon:p.PanelLeftIcon,mode:"bleed",onClick:j,padding:3,selected:d})}),n.jsx(i.Tooltip,{animate:!0,content:n.jsxs(i.Flex,{align:"center",style:{whiteSpace:"nowrap"},children:[n.jsx(i.Box,{padding:1,children:n.jsx(i.Text,{size:1,children:E?"Disable edit overlay":"Enable edit overlay"})}),n.jsx(i.Box,{paddingY:1,children:n.jsx(s.Hotkeys,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:n.jsx(i.Card,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:E?"positive":void 0,children:n.jsxs(i.Flex,{align:"center",gap:2,children:[n.jsx("div",{style:{margin:-2},children:n.jsx(st,{checked:E,onChange:k,disabled:"loading"===a.status||"connected"!==x})}),n.jsx(i.Box,{children:n.jsx(i.Text,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),n.jsx(i.Tooltip,{animate:!0,content:n.jsx(i.Text,{size:1,children:"loading"===a.status?"Loading…":"reloading"===a.status||"refreshing"===a.status?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:n.jsx(i.Button,{"aria-label":"Refresh preview",fontSize:1,icon:p.RefreshIcon,mode:"bleed",loading:"reloading"===a.status||"refreshing"===a.status,onClick:A,padding:3})}),n.jsx(i.Box,{flex:1,children:n.jsx(nt,{onChange:m,origin:U,value:G})}),n.jsx(i.Flex,{align:"center",flex:"none",gap:1,children:n.jsx(i.MenuButton,{button:n.jsx(i.Button,{fontSize:1,iconRight:p.ShareIcon,mode:"bleed",padding:3,space:2}),id:"location-menu",menu:n.jsx(i.Menu,{children:n.jsx(rt,{initialUrl:l,openPopup:g,previewLocationOrigin:U,previewLocationRoute:G})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),n.jsx(i.Flex,{align:"center",flex:"none",gap:1,children:n.jsx(i.MenuButton,{button:n.jsx(i.Button,{fontSize:1,iconRight:p.ChevronDownIcon,mode:"bleed",padding:3,space:2,text:at["connected"===c?b:"previewDrafts"],loading:"reconnecting"===c&&"loaded"!==a.status,disabled:"connected"!==c}),id:"perspective-menu",menu:n.jsxs(i.Menu,{style:{maxWidth:240},children:[n.jsx(i.MenuItem,{fontSize:1,onClick:()=>r({type:Ne,perspective:"previewDrafts"}),padding:3,pressed:"previewDrafts"===b,tone:lt,children:n.jsxs(i.Flex,{align:"flex-start",gap:3,children:[n.jsx(i.Box,{flex:"none",children:n.jsx(i.Text,{size:1,children:o.createElement(ut.previewDrafts)})}),n.jsxs(i.Stack,{flex:1,space:2,children:[n.jsx(i.Text,{size:1,weight:"medium",children:at.previewDrafts}),n.jsx(i.Text,{muted:!0,size:1,children:"View this page with latest draft content"})]}),n.jsx(i.Box,{flex:"none",children:n.jsx(i.Text,{muted:!0,size:1,style:{opacity:"previewDrafts"===b?1:0},children:n.jsx(p.CheckmarkIcon,{})})})]})}),n.jsx(i.MenuItem,{fontSize:1,onClick:()=>r({type:Ne,perspective:"published"}),padding:3,pressed:"published"===b,tone:ct,children:n.jsxs(i.Flex,{align:"flex-start",gap:3,children:[n.jsx(i.Box,{flex:"none",children:n.jsx(i.Text,{size:1,children:o.createElement(ut.published)})}),n.jsxs(i.Stack,{flex:1,space:2,children:[n.jsx(i.Text,{size:1,weight:"medium",children:at.published}),n.jsx(i.Text,{muted:!0,size:1,children:"View this page with published content"})]}),n.jsx(i.Box,{flex:"none",children:n.jsx(i.Text,{muted:!0,size:1,style:{opacity:"published"===b?1:0},children:n.jsx(p.CheckmarkIcon,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),n.jsxs(i.Flex,{align:"center",flex:"none",gap:1,children:[n.jsx(i.Tooltip,{animate:!0,content:n.jsx(i.Text,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:n.jsx(i.Button,{"aria-label":"Full viewport",fontSize:1,icon:p.DesktopIcon,mode:"bleed",onClick:I,padding:3,selected:"desktop"===P})}),n.jsx(i.Tooltip,{animate:!0,content:n.jsx(i.Text,{size:1,children:"Narrow viewport"}),padding:2,placement:"bottom",portal:!0,children:n.jsx(i.Button,{"aria-label":"Narrow viewport",fontSize:1,icon:p.MobileDeviceIcon,mode:"bleed",onClick:R,padding:3,selected:"mobile"===P})})]})]})}),n.jsx(i.Card,{flex:1,tone:"transparent",children:n.jsxs(i.Flex,{align:"center",height:"fill",justify:"center",padding:"desktop"===P?0:2,sizing:"border",style:{position:"relative",cursor:$?"wait":void 0},children:[n.jsx(h.AnimatePresence,{children:M||T||L||!V||q?(T||"connecting"===x&&"refreshing"!==a.status)&&!q?n.jsx(ot,{initial:"initial",animate:"animate",exit:"exit",variants:ft,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:n.jsxs(i.Flex,{style:{...pt[P]},justify:"center",align:"center",direction:"column",gap:4,children:[n.jsx(i.Spinner,{muted:!0}),n.jsx(i.Text,{muted:!0,size:1,children:"Loading…"})]})}):M&&!q?n.jsx(ot,{initial:"initial",animate:"animate",exit:"exit",variants:ht,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:n.jsx(_,{flex:1,message:"Could not connect to the preview",onRetry:F,onContinueAnyway:W,children:C&&n.jsxs(n.Fragment,{children:["connected"!==x&&n.jsx(i.Card,{padding:3,radius:2,tone:"critical",children:n.jsxs(i.Stack,{space:3,children:[n.jsx(i.Label,{muted:!0,size:0,children:"Overlay connection status"}),n.jsx(i.Code,{size:1,children:x})]})}),"connected"!==c&&n.jsx(i.Card,{padding:3,radius:2,tone:"critical",children:n.jsxs(i.Stack,{space:3,children:[n.jsx(i.Label,{muted:!0,size:0,children:"Loader connection status"}),n.jsx(i.Code,{size:1,children:c})]})})]})})}):null:n.jsx(ot,{initial:"initial",animate:"animate",exit:"exit",variants:ft,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:z?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:z?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:n.jsxs(i.Flex,{style:{...pt[P]},justify:"center",align:"center",direction:"column",gap:4,children:[z&&n.jsx(i.Button,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),n.jsx(i.Card,{radius:2,tone:z?"caution":"inherit",padding:4,shadow:1,children:n.jsxs(i.Flex,{justify:"center",align:"center",direction:"column",gap:4,children:[n.jsx(i.Spinner,{muted:!0}),n.jsx(i.Text,{muted:!0,size:1,children:z?n.jsx(n.Fragment,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})}),z&&n.jsx(i.Button,{fontSize:1,tone:"critical",onClick:W,text:"Continue anyway"})]})})}),n.jsx(tt,{ref:t,style:{pointerEvents:(T||"connecting"===x&&"refreshing"!==a.status)&&!q?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:l.toString(),initial:["background"],variants:mt,animate:[(T||"connecting"===x&&"refreshing"!==a.status)&&!q?"background":"active",T?"reloading":"idle",P,V&&!q?"timedOut":""],onLoad:J})]})})]})})})),pt={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},ft={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},ht={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},mt={desktop:{...pt.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...pt.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};let vt=!1;function gt(e){var t;if(void 0===e)return;const n=null==(t=decodeURIComponent(e))?void 0:t.split(".");return"drafts"===n[0]&&n.shift(),n.join(".")}function xt(e){if(void 0!==e)return r.studioPath.toString(function(e){const t=[];for(const n of e.split(".")){const e=O.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=$.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=U.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function yt(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function bt({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:r,frameStateRef:i}){const a=o.useMemo((()=>{const{id:t,path:i,type:o}={id:gt((s=n).id),path:xt(s.path),type:s.type};var s;return{id:t,type:o,path:i,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,viewport:r.viewport,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,templateParams:r.templateParams,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}}),[n,r,e]),l=o.useMemo((()=>yt({inspect:a.inspect,path:a.path,rev:a.rev,since:a.since,template:a.template,templateParams:a.templateParams,view:a.view,pathKey:a.pathKey,instruction:a.instruction,comment:a.comment})),[a.comment,a.inspect,a.instruction,a.path,a.pathKey,a.rev,a.since,a.template,a.templateParams,a.view]),c=o.useRef(n);o.useEffect((()=>{c.current=n}),[n]);return{deskParams:l,navigate:o.useMemo((()=>se(((e,n={},r)=>{e.id&&(e.id=s.getPublishedId(e.id));const{_searchParams:o,...a}=c.current,l=(o||[]).reduce(((e,[t,n])=>(e[t]=n,e)),{}),u=yt({...a,...e}),d=yt({...l,...n});a.id!==u.id&&(delete d.template,delete d.templateParams),u._searchParams=Object.entries(d).reduce(((e,[t,n])=>[...e,[t,n]]),[]);const p=null!=r?r:d.preview===i.current.url;t(u,{replace:p})}),50)),[t,i]),params:a}}function wt(e,t,n){var r,i;const a=s.useClient({apiVersion:u.A}),l=s.useActiveWorkspace(),c=(null==(r=null==l?void 0:l.activeWorkspace)?void 0:r.basePath)||"/",d=(null==(i=null==l?void 0:l.activeWorkspace)?void 0:i.name)||"default",p=function(e,t,n){const r=s.useCurrentUser();return o.useMemo((()=>["@sanity/presentation",t,n,e,null==r?void 0:r.id,jt]),[t,null==r?void 0:r.id,e,n])}(t,c,d),f=function(e,t){const n=s.useClient({apiVersion:u.A}),r=s.useCurrentUser(),[i,a]=o.useState(""),l=e?x.suspend((async()=>await m.createPreviewSecret(n,"@sanity/presentation",typeof window>"u"?"":location.href,null==r?void 0:r.id)),[...t,i]):null;return o.useEffect((()=>{if(!l)return;const e=setTimeout((()=>{o.startTransition((()=>a(l.expiresAt.toString())))}),l.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[l]),(null==l?void 0:l.secret)||null}("object"==typeof e||"function"==typeof e,p);return x.suspend((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith(`${c}/`)&&r.pathname!==c?r:t}const t=await("object"==typeof e?g.definePreviewUrl(e):e)({client:a,previewUrlSecret:f,previewSearchParam:n,referrer:typeof document>"u"?null:document.referrer,studioBasePath:c});return new URL(t,location.origin)}),[...p,f])}const jt=Symbol();const kt=o.lazy((()=>Promise.resolve().then((function(){return require("./LoaderQueries.cjs")})))),Pt=o.lazy((()=>Promise.resolve().then((function(){return require("./PostMessageRefreshMutations.cjs")})))),Et=b.default(i.Flex)`
  overflow-x: auto;
`;exports.default=function(e){var t;const{previewUrl:c,components:p}=null!=(t=e.tool.options)?t:{},f=e.tool.name||u.D,{unstable_navigator:h}=p||{},{navigate:m,state:v}=a.useRouter(),g=s.useUnique(Object.fromEntries(v._searchParams||[])),x=wt(c||"/",f,g.preview||null),[y]=o.useState((()=>{var t;const n=null==(t=e.tool.options)?void 0:t.devMode;return"function"==typeof n?n():"boolean"==typeof n?n:typeof window<"u"&&"localhost"===window.location.hostname})),b=o.useMemo((()=>x.origin),[x.origin]),j=o.useRef(null),[k,P]=o.useState(),[E,C]=o.useState({}),S=o.useRef({title:void 0,url:void 0}),{params:I,deskParams:R,navigate:T}=bt({initialPreviewUrl:x,routerNavigate:m,routerState:v,routerSearchParams:g,frameStateRef:S}),[z,D]=o.useReducer(Ge,{perspective:I.perspective,viewport:I.viewport},et),[L,O]=function(e,t){if("published"!==e&&"previewDrafts"!==e)throw new Error(`Invalid perspective: ${e}`);const[n,r]=o.useState({}),[i,s]=o.useState({}),a=o.useRef(""),l=o.useCallback(((e,n,i=[])=>{const o=i.filter((e=>"_projectId"in e&&e._projectId?(vt||(console.warn("Cross dataset references are not supported yet, ignoring source document",e),vt=!0),!1):e));("published"===n?r:s)((n=>{const r={};for(const e of o)r[e._id]=e;if(a.current!==t.current.url)return a.current=t.current.url,{[e]:r};const i=n[e];return w.default(i,r)?n:{...n,[e]:r}}))}),[t]);return[o.useMemo((()=>{const t=Object.values("published"===e?n:i).reduce(((e,t)=>(Object.values(t).forEach((t=>{e[t._id]=t})),e)),{});return Object.values(t)}),[e,i,n]),l]}(z.perspective,S),$=s.useProjectId(),U=s.useDataset();o.useEffect((()=>{(z.perspective!==I.perspective||z.viewport!==I.viewport)&&T({},{perspective:"previewDrafts"===z.perspective?void 0:z.perspective,viewport:"desktop"===z.viewport?void 0:z.viewport})}),[I.perspective,z.perspective,T,z.viewport,I.viewport]);const[_,B]=o.useState("connecting"),[W,q]=o.useState("connecting"),[N,V]=o.useState("connecting"),[K]=o.useState((()=>new Set)),G=o.useCallback((e=>{const t=window.open(e,"_blank");t&&K.add(t)}),[K]);o.useEffect((()=>{if(K.size&&k)for(const e of K)e&&"closed"in e&&!e.closed&&k.addSource(e)}),[k,K,K.size]),o.useEffect((()=>{var e;const t=null==(e=j.current)?void 0:e.contentWindow;if(!t)return;const n=function(e){const{destroy:t,send:n}=M(e),r=new Set,i=new WeakMap,o=new Set;return{destroy:()=>{t();for(const e of o)e()},send:(e,t,o)=>{n(e,t,o);for(const n of r)n&&"closed"in n&&!n.closed&&i.has(n)&&i.get(n)(e,t,o)},addSource(t){if(r.has(t))return;if(!("closed"in t))throw console.warn("Source is unsupported",{source:t}),new Error("Source is unsupported");if(t.closed)throw new Error("Source is closed");const{send:n,destroy:s}=M({...e,target:t,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:t,onEvent:n,...r}=e;return{...r,onEvent:n?(e,t)=>{if("preview-kit/documents"!==e&&"overlay/navigate"!==e&&"loader/documents"!==e)return n(e,t)}:void 0}}))});o.add(s),i.set(t,n),r.add(t)}}}({id:"presentation",target:t,targetOrigin:b,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:B,onEvent(e,t){if("visual-editing/focus"!==e&&"overlay/focus"!==e||!("id"in t))if("visual-editing/navigate"===e||"overlay/navigate"===e){const{title:e,url:n}=t;S.current.url!==n&&T({},{preview:n}),S.current={title:e,url:n}}else"visual-editing/meta"===e?S.current.title=t.title:"visual-editing/toggle"===e||"overlay/toggle"===e?D({type:Ke,enabled:t.enabled}):"visual-editing/documents"===e?O("visual-editing",t.perspective,t.documents):"visual-editing/refreshing"===e&&"manual"===t.source?clearTimeout(ce.current):"visual-editing/refreshing"===e&&"mutation"===t.source?D({type:We}):"visual-editing/refreshed"===e&&D({type:Be});else T({type:t.type,id:t.id,path:t.path})}},{id:"loaders",heartbeat:!0,onStatusUpdate:q,onEvent(e,t){if("loader/documents"===e&&t.projectId===$&&t.dataset===U)O("loaders",t.perspective,t.documents);else if("loader/query-listen"===e&&t.projectId===$&&t.dataset===U){if("number"==typeof t.heartbeat&&t.heartbeat<u.c)throw new Error(`Loader query listen heartbeat interval must be at least ${u.c}ms`);C((e=>{var n,r,i;return{...e,[(r=t.query,i=t.params,`${r}-${"string"==typeof i?i:JSON.stringify(i)}`)]:{perspective:t.perspective,query:t.query,params:t.params,receivedAt:Date.now(),heartbeat:null!=(n=t.heartbeat)&&n}}}))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:V,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===$&&t.dataset===U&&O("preview-kit",t.perspective,t.documents)}}]});return P(n),()=>{n.destroy(),P(void 0)}}),[U,$,O,T,b]),o.useEffect((()=>{const e=setInterval((()=>o.startTransition((()=>C((e=>{if(Object.keys(e).length<1)return e;const t=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&t>e.receivedAt+e.heartbeat)))return e;const n={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&t>i.receivedAt+i.heartbeat||(n[r]=i);return n}))))),u.c);return()=>clearInterval(e)}),[]);const J=o.useCallback((e=>{T({path:r.studioPath.toString(e)},{},!0)}),[T]),H=o.useCallback((e=>{const t=new URL(e,x.origin),n=t.pathname+t.search;t.origin===x.origin&&n!==I.preview&&T({},{preview:n})}),[x,I,T]),X=o.useCallback((e=>{T({},e)}),[T]);o.useEffect((()=>{null==k||k.send("overlays","presentation/perspective",{perspective:z.perspective})}),[k,z.perspective]),o.useEffect((()=>{I.id&&I.path?null==k||k.send("overlays","presentation/focus",{id:I.id,path:I.path}):null==k||k.send("overlays","presentation/blur",void 0)}),[k,I.id,I.path]),o.useEffect((()=>{S.current.url&&I.preview&&S.current.url!==I.preview&&(S.current.url=I.preview,"connected"!==_&&j.current?j.current.src=`${b}${I.preview}`:null==k||k.send("overlays","presentation/navigate",{url:I.preview,type:"replace"}))}),[k,_,b,I.preview]);const Z=o.useCallback((()=>null==k?void 0:k.send("overlays","presentation/toggleOverlay",void 0)),[k]),[Q,ee]=o.useState(null);o.useEffect((()=>{const e=e=>{F(e)&&Z()},t=e=>{var t;F(e)&&Z(),t=e,["mod","\\"].every((e=>A[e]?t[A[e]]:t.key===e.toUpperCase()))&&Z()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[Z]);const[te,re]=o.useState(null),[{navigatorEnabled:ie,toggleNavigator:se},ae]=we({unstable_navigator:h}),le=o.useRef(I.id);o.useEffect((()=>{I.rev&&le.current&&I.id!==le.current&&T({},{rev:void 0}),le.current=I.id}));const ce=o.useRef(),ue=o.useCallback((e=>{if(D({type:We}),k)return ce.current=window.setTimeout(e,300),void k.send("overlays","presentation/refresh",{source:"manual",livePreviewEnabled:"connected"===N||"connected"===W});e()}),[k,W,N]),de=s.useWorkspace(),pe=o.useCallback((({id:e,type:t,path:n})=>{if(S.current.url)return{title:S.current.title||S.current.url,name:"edit",params:{id:e,path:n,type:t,inspect:u.C,workspace:de.name,mode:u.E,preview:I.preview}}}),[I.preview,de.name]);return n.jsxs(n.Fragment,{children:[n.jsx(Pe,{deskParams:R,devMode:y,name:f,params:I,navigate:T,children:n.jsx(be,{navigate:T,children:n.jsx(ke,{params:I,children:n.jsx(Et,{height:"fill",children:n.jsxs(ye,{children:[n.jsx(ae,{}),n.jsx(ne,{id:"preview",minWidth:325,defaultSize:ie?50:75,order:3,children:n.jsx(i.Flex,{direction:"column",flex:1,height:"fill",ref:re,children:n.jsx(i.BoundaryElementProvider,{element:te,children:n.jsx(dt,{dispatch:D,iframe:z.iframe,initialUrl:x,loadersConnection:W,navigatorEnabled:ie,onPathChange:H,onRefresh:ue,openPopup:G,overlaysConnection:_,params:I,perspective:z.perspective,ref:j,targetOrigin:b,toggleNavigator:se,toggleOverlay:Z,viewport:z.viewport,visualEditing:z.visualEditing})})})}),n.jsx(oe,{order:4}),n.jsx(ne,{id:"content",minWidth:325,order:5,children:n.jsx(d.D,{documentId:I.id,setDisplayedDocument:ee,children:n.jsx(l.CommentsIntentProvider,{getIntent:pe,children:n.jsx(Y,{refs:L,deskParams:R,documentId:I.id,documentType:I.type,onDeskParams:X,onFocusPath:J,previewUrl:I.preview})})})})]})})})})}),k&&n.jsx(o.Suspense,{children:n.jsx(kt,{channel:k,liveQueries:E,perspective:z.perspective,liveDocument:Q,documentsOnPage:L})}),k&&I.id&&I.type&&n.jsx(o.Suspense,{children:n.jsx(Pt,{channel:k,id:I.id,type:I.type,loadersConnection:W,previewKitConnection:N})})]})};//# sourceMappingURL=PresentationTool.cjs.map
