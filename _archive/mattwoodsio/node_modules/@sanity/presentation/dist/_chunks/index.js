import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{createContext as i,useState as o,useEffect as r,useContext as a,useCallback as s,createElement as c,useRef as l,useMemo as d,lazy as u,Suspense as p}from"react";import{useDocumentStore as m,defineDocumentFieldAction as h,useWorkspace as f,pathToString as v,isRecord as y,getPublishedId as g,definePlugin as w,isDocumentSchemaType as b}from"sanity";import{ComposeIcon as x,ChevronRightIcon as P,DesktopIcon as T,InfoOutlineIcon as I,WarningOutlineIcon as _,ErrorOutlineIcon as j,MasterDetailIcon as z}from"@sanity/icons";import{Card as S,Flex as A,Box as D,Text as k,Stack as B,rem as O}from"@sanity/ui";import C from"styled-components";import{useIntentLink as E,useRouter as $,encodeJsonParams as H,route as L}from"sanity/router";import{isObservable as N,of as U}from"rxjs";import{uuid as M}from"@sanity/uuid";const R=x,q="presentation",F="Presentation",G="sanity/structure/comments",J="presentation",K=3e3,Q="2023-10-16",V=1e3,W=100,X=2048,Y=i(null),Z={locations:[]};const ee={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},te={positive:I,caution:_,critical:j};function ne(i){const{documentId:l,options:d,schemaType:u,showPresentationTitle:p}=i,h=a(Y),{message:f,locations:v,tone:y}=function(e){const{id:t,locate:n,type:i}=e,a=m(),[s,c]=o(Z);return r((()=>{if(!n)return;const e=n({id:t,type:i},{documentStore:a}),o=(N(e)?e:U(e)).subscribe((e=>c(e||Z)));return()=>o.unsubscribe()}),[a,t,n,i]),s}({id:l,locate:d.locate,type:u.name}),g=(null==v?void 0:v.length)||0,[w,b]=o(!1),x=s((()=>b((e=>!e))),[]),T=f||(g?t(n,{children:["Used on ",ee[g]||g," ",e(n,1===g?{children:"page"}:{children:"pages"})]}):null);return 0!==g||T?e(S,{padding:1,radius:3,border:!0,tone:y,children:t("div",{style:{margin:-1},children:[!v&&t(A,{align:"flex-start",gap:3,padding:3,children:[y&&e(D,{flex:"none",children:e(k,{size:1,children:c(te[y])})}),e(D,{flex:1,children:t(k,{size:1,weight:"medium",children:[p&&t(n,{children:[d.title||F," · "]}),T]})})]}),v&&t(n,{children:[e(S,{as:"button",onClick:x,padding:3,radius:2,tone:"inherit",children:t(A,{gap:3,children:[e(D,{flex:"none",children:e(k,{size:1,children:e(P,{style:{transform:`rotate(${w?"90deg":0})`,transition:"transform 100ms ease-in-out"}})})}),e(D,{flex:1,children:t(k,{size:1,weight:"medium",children:[p&&t(n,{children:[d.title||F," · "]}),T]})})]})}),e(B,{hidden:!w,marginTop:1,space:1,children:v.map(((t,n)=>e(ie,{active:(d.name||q)===(null==h?void 0:h.name)&&t.href===(null==h?void 0:h.params.preview),documentId:l,documentType:u.name,node:t,toolName:d.name||q},n)))})]})]})}):null}function ie(n){const{documentId:i,documentType:o,node:r,active:l,toolName:d}=n,u=a(Y),p=null==u?void 0:u.navigate,m=E({intent:"edit",params:{id:i,type:o,mode:"presentation",presentation:d,...null==u?void 0:u.deskParams,preview:r.href}}),h=s((()=>{null==p||p({},{preview:r.href})}),[r.href,p]);return c(S,{...u?{}:m,as:u?"button":"a",key:r.href,onClick:h,padding:3,radius:2,pressed:l,tone:"inherit"},t(A,{gap:3,children:[e(D,{flex:"none",children:e(k,{size:1,children:e(T,{})})}),t(B,{flex:1,space:2,children:[e(k,{size:1,weight:"medium",children:r.title}),e(k,{muted:!0,size:1,textOverflow:"ellipsis",children:r.href})]})]}))}const oe=i(null),re=C(B)`
  min-height: ${O(42)};

  & + &:empty {
    display: none;
  }
`;function ae(t){var n;const{documentId:i,options:o,schemaType:r}=t,s=a(oe);if(s&&s.options[0]!==o)return e(re,{marginBottom:5,space:5});const c=(null==(n=null==s?void 0:s.options)?void 0:n.length)||0;return e(re,{marginBottom:5,space:5,children:e(B,{space:2,children:null==s?void 0:s.options.map(((t,n)=>e(ne,{documentId:i,options:t,schemaType:r,showPresentationTitle:c>1},n)))})})}function se(t){const{children:n,options:i}=t,c=a(oe),u=null==c?void 0:c.register,[p,m]=o((()=>[])),h=s((e=>u?u(e):(m((t=>[e].concat(t))),()=>{m((t=>t.filter((t=>t!==e))))})),[u]),f=l(h);f.current=h;const v=d((()=>({options:(null==c?void 0:c.options)||p,register:h})),[p,c,h]);return r((()=>f.current(i)),[i]),e(oe.Provider,{value:v,children:n})}const ce=h({name:"presentation/openInStructure",useAction({documentId:e,documentType:t,path:n}){const i=f(),{navigateIntent:o}=$(),r=a(Y),s=d((()=>function(e,t,n){var i;const o=e.map((e=>{var i;return{tool:e,match:null==(i=e.canHandleIntent)?void 0:i.call(e,"edit",{id:t,type:n,mode:"structure"},{})}})),r=o.filter((e=>y(e.match)&&e.match.mode));return r.length>0?r[0].tool:null==(i=o.filter((e=>e.match))[0])?void 0:i.tool}(i.tools,e,t)),[e,t,i.tools]);return{type:"action",hidden:!r||n.length>0||!s,icon:(null==s?void 0:s.icon)||z,title:`Open in ${(null==s?void 0:s.title)||"Structure"}`,onAction(){o("edit",{id:e,type:t,mode:"structure",path:v(n)})},renderAsButton:!0}}});function le(e,t,n,i){const{id:o,mode:r,path:a,presentation:s,type:c,...l}=t;return"edit"===e&&o?{type:c||"*",id:g(o),path:a,_searchParams:Object.entries(l)}:"create"===e?(l.preview=l.preview||new URLSearchParams(window.location.search).get("preview")||"/",i&&"object"==typeof i&&(l.templateParams=H(i)),{type:c||"*",id:o||M(),_searchParams:Object.entries(l)}):{intent:e,params:t,payload:i}}const de=L.create("/",{__unsafe_disableScopedSearchParams:!0},[L.intents("/intent"),L.create(":type",[L.create(":id",[L.create(":path")])])]),ue=u((()=>import("./PresentationTool.js"))),pe=u((()=>import("./BroadcastDisplayedDocument.js"))),me=w((n=>{const i=n.name||q;return{document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==ce.name)),ce]},form:{components:{input:function(i){const o=i.value,r=null!=o&&o._id?g(null==o?void 0:o._id):void 0;return b(i.schemaType)?t(se,{options:n,children:[n.locate&&r&&e(ae,{documentId:r,options:n,schemaType:i.schemaType}),i.renderDefault(i),e(p,{children:e(pe,{value:o})},"broadcast-displayed-document")]}):i.renderDefault(i)}}},tools:[{icon:n.icon||R,name:i,title:n.title,component:ue,options:n,canHandleIntent:(e,t)=>"create"===e?function(e){return"type"in e&&(!("presentation"in e)||e.presentation===i)&&(!("template"in e)||{template:!0})}(t):"edit"===e&&function(e){return"type"in e&&"id"in e&&(!("presentation"in e)||e.presentation===i)&&(!("mode"in e)||{mode:e.mode===J})}(t),getIntentState:le,router:de}]}})),he=i(null);function fe(){const e=a(he);if(!e)throw new Error("Presentation navigate context is missing");return e}const ve=i(null);function ye(){const e=a(ve);if(!e)throw new Error("Presentation params context is missing");return e}export{Q as A,G as C,q as D,J as E,X as L,K as M,Y as P,he as a,ve as b,V as c,W as d,ye as e,me as p,fe as u};//# sourceMappingURL=index.js.map
