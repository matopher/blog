"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_chunks/constants.cjs");exports.urlSearchParamPreviewPathname=e.b,exports.urlSearchParamPreviewSecret=e.u,exports.validatePreviewUrl=async function(r,t,i="Cloudflare-Workers"===(e=>null==(e=globalThis.navigator)?void 0:e.userAgent)()){const s=function(r){if(!r)throw new TypeError("`client` is required");if(!r.config().token)throw new TypeError("`client` must have a `token` specified");return r.withConfig({apiVersion:e.a,useCdn:!1,perspective:"published",resultSourceMap:!1,stega:!1})}(r);let o;try{o=function(r){const t=new URL(r,"http://localhost"),i=t.searchParams.get(e.u);if(!i)throw new Error("Missing secret");let s;const o=t.searchParams.get(e.b);if(o){const{pathname:e,search:r}=new URL(o,"http://localhost");s=`${e}${r}`}return{secret:i,redirectTo:s}}(t)}catch(r){return e.i&&console.error("Failed to parse preview URL",r,{previewUrl:t,client:s}),{isValid:!1}}const{isValid:n,studioUrl:a}=await async function(r,t,i){if(typeof EdgeRuntime<"u"&&await new Promise((e=>setTimeout(e,300))),!t||!t.trim())return{isValid:!1,studioUrl:null};const s=await r.fetch(e.f,{secret:t},{tag:e.t,...i?void 0:{cache:"no-store"}});return null!=s&&s._id&&null!=s&&s._updatedAt&&null!=s&&s.secret?{isValid:t===s.secret,studioUrl:s.studioUrl}:{isValid:!1,studioUrl:null}}(s,o.secret,i),l=n?o.redirectTo:void 0;let c;if(n)try{c=new URL(a).origin}catch(r){e.i&&console.error("Failed to parse studioUrl",r,{previewUrl:t,studioUrl:a})}return{isValid:n,redirectTo:l,studioOrigin:c}};//# sourceMappingURL=index.cjs.map
